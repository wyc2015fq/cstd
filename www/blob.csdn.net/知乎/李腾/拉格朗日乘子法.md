# 拉格朗日乘子法 - 知乎
# 

> *把自己学到的东西教会给下一个人，是让自己掌握所学的最佳途径之一*

人生面临的最大苦恼就是：欲望无限，资源有限。上天总是随时随处用这种苦恼来考验人类，所以我们总是要不断面对带约束的优化问题（即条件极值问题）。

拉格朗日（Lagrange）乘子法是求解条件极值问题的利器，做工程的人会经常用到它。虽然在应用拉格朗日乘子法时，我们把条件极值问题转化称为一个方程求解的问题，整个过程都是代数的。但拉格朗日乘子法的原创思想是非常几何直观的，用向量语言表述起来很漂亮，也很容易理解和记忆。

## **条件极值问题**

首先来重温一下拉格朗日当年面对的问题：

> ![\max f(x)](https://www.zhihu.com/equation?tex=%5Cmax+f%28x%29)![s.t\quad g_k(x) = 0, \quad k=1,2,...,K](https://www.zhihu.com/equation?tex=s.t%5Cquad+g_k%28x%29+%3D+0%2C+%5Cquad+k%3D1%2C2%2C...%2CK)                                          (1)
其中 ![x=(x_1, x_2, ..., x_N)\in R^N](https://www.zhihu.com/equation?tex=x%3D%28x_1%2C+x_2%2C+...%2C+x_N%29%5Cin+R%5EN) ，函数 ![f, g_1, g_2, ..., g_K](https://www.zhihu.com/equation?tex=f%2C+g_1%2C+g_2%2C+...%2C+g_K)都是从 ![R^N](https://www.zhihu.com/equation?tex=R%5EN) 到 ![R](https://www.zhihu.com/equation?tex=R) 的函数

用白话来说，就是你希望通过改变 ![x](https://www.zhihu.com/equation?tex=x) 来使目标函数 ![f(x)](https://www.zhihu.com/equation?tex=f%28x%29) 取得最大值，然而 ![x](https://www.zhihu.com/equation?tex=x) 的 ![N](https://www.zhihu.com/equation?tex=N) 个分量之间并不是独立的， ![x](https://www.zhihu.com/equation?tex=x) 在运动变化过程中，必须满足（1）中的 ![K](https://www.zhihu.com/equation?tex=K) 个约束条件。

## **拉格朗日乘子法**

拉格朗日乘子法表述为以下定理：

> 条件极值问题的最优解 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A) 如果存在，那么它必然满足以下条件：存在实数 ![\lambda_1, \lambda_2, ..., \lambda_K](https://www.zhihu.com/equation?tex=%5Clambda_1%2C+%5Clambda_2%2C+...%2C+%5Clambda_K) 使得
![\nabla f(x^*) = \sum_{k=1}^{K}{\lambda_k\nabla g_k(x^*)} ](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%5E%2A%29+%3D+%5Csum_%7Bk%3D1%7D%5E%7BK%7D%7B%5Clambda_k%5Cnabla+g_k%28x%5E%2A%29%7D+)                                                        (2)
因此，为了求出条件极值问题的最优解，只需要先求解一个 ![N+K](https://www.zhihu.com/equation?tex=N%2BK) 元的方程即可：关于 ![x_1, x_2, ..., x_N, \lambda_1, \lambda_2, ..., \lambda_K](https://www.zhihu.com/equation?tex=x_1%2C+x_2%2C+...%2C+x_N%2C+%5Clambda_1%2C+%5Clambda_2%2C+...%2C+%5Clambda_K) 的方程组（1）和（2）。

用向量语言来表述就很直观：如果条件极值点 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A) 存在，那么在该点处，目标函数的改进方向 ![\nabla f(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%5E%2A%29) 必然落在 ![K](https://www.zhihu.com/equation?tex=K) 个约束函数在该点处法向量  ![\nabla g_1(x^*), \nabla g_2(x^*), ..., \nabla g_K(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+g_1%28x%5E%2A%29%2C+%5Cnabla+g_2%28x%5E%2A%29%2C+...%2C+%5Cnabla+g_K%28x%5E%2A%29)  张成的线性子空间内。

## **拉格朗日乘子法的直观证明**

**第1步，将条件极值问题几何化**
- 首先在脑海中分配一片空间，代表 ![R^N](https://www.zhihu.com/equation?tex=R%5EN)
- 之后在空间中添加一个你喜欢的曲面，代表约束条件 ![g_k(x)=0](https://www.zhihu.com/equation?tex=g_k%28x%29%3D0)
- 之后在曲面上添加一个动点，代表 ![x](https://www.zhihu.com/equation?tex=x)
- 之后在空间里添加一层层互不相交但又充满整个空间的曲面族，代表目标函数 ![f(x)](https://www.zhihu.com/equation?tex=f%28x%29) 的等值面
- 之后让 ![x](https://www.zhihu.com/equation?tex=x) 在约束条件曲面上自由地移动，穿过一层层的目标函数等值面，使 ![f(x)](https://www.zhihu.com/equation?tex=f%28x%29) 越变越高
- 然而约束条件曲面终于峰回路转，掉头往回， ![x](https://www.zhihu.com/equation?tex=x) 只能站在掉头的位置，看着函数值更高的等值面在远方层层展开，而自己再不能前进一步
- 下图是一个 ![K=1](https://www.zhihu.com/equation?tex=K%3D1) 的例子， ![K=2](https://www.zhihu.com/equation?tex=K%3D2) 的例子涉及两个一般曲面的交线，实在画不出来
![](https://pic1.zhimg.com/v2-735a600479a324aceb84ab0acf96acfc_b.jpg)
**第2步，局部线性化（用切平面近似曲面）**
- 曲面变化太多端，人脑显卡不够用。让我们来用局部线性化来抓主要矛盾，去掉不必要的复杂性
- 只要你相信，在每个局部，光滑的约束条件曲面和目标函数等值面完全可以用其切平面来近似，那么你脑海中的曲面就BIU的一声都变成了平面，世界就变得简单了起来
- 对可行域内任意一点 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A) ，原来的每个约束条件 ![g_k(x)=0](https://www.zhihu.com/equation?tex=g_k%28x%29%3D0) 都是一个通过 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A) 的曲面， ![x](https://www.zhihu.com/equation?tex=x) 被限定只能在该曲面内移动；当局部线性近似后，可以用原曲面在 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A) 处的切平面来代替，即认为 ![x](https://www.zhihu.com/equation?tex=x) 只能在切平面里移动
- 这就引入了 ![\nabla g_k(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+g_k%28x%5E%2A%29) ，它是原曲面 ![g_k(x)=0](https://www.zhihu.com/equation?tex=g_k%28x%29%3D0) 在 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A) 处的法向量（与切平面垂直）。因此 ![x](https://www.zhihu.com/equation?tex=x) 在切平面里运动，当且仅当移动方向 ![\Delta x = x - x^*](https://www.zhihu.com/equation?tex=%5CDelta+x+%3D+x+-+x%5E%2A) 与 ![\nabla g_k(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+g_k%28x%5E%2A%29) 垂直。
- 由于有 ![K](https://www.zhihu.com/equation?tex=K) 个约束条件，因此可行的移动方向 ![\Delta x=x-x^*](https://www.zhihu.com/equation?tex=%5CDelta+x%3Dx-x%5E%2A) 必须同时垂直于所有 ![K](https://www.zhihu.com/equation?tex=K) 个法向量。于是可行方向的全体就是 ![\nabla g_1(x^*), \nabla g_2(x^*), ..., \nabla g_K(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+g_1%28x%5E%2A%29%2C+%5Cnabla+g_2%28x%5E%2A%29%2C+...%2C+%5Cnabla+g_K%28x%5E%2A%29) 张成的线性子空间的正交子空间
- 同样，目标函数的等值面在局部也可以简化为一族平行的平面。下图是一个 ![K=2](https://www.zhihu.com/equation?tex=K%3D2) 的例子
![](https://pic4.zhimg.com/v2-d6f0df6a4899636e14ac044baeda1b27_b.jpg)
**第3步，从几何直观上快速论证**
- 有了前面的铺垫，就很容易从直观上论证拉格朗日乘子法了。
- 假设条件极值问题存在最优解 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A)，那么由最优性得知，在 ![x^*](https://www.zhihu.com/equation?tex=x%5E%2A) 处， 所有可行方向 ![\Delta x=x-x^*](https://www.zhihu.com/equation?tex=%5CDelta+x%3Dx-x%5E%2A) 必须平行于目标函数的等值面，否则就可以穿越等值面获得更高的目标函数值
- 这等价于所有可行方向必须垂直于目标函数等值面的法向量，即 ![\nabla f(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%5E%2A%29)
- 换言之， ![\nabla f(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%5E%2A%29) 必须垂直于所有可行方向
- 第2步中我们论证过，所有可行方向全体恰是 ![\nabla g_1(x^*), \nabla g_2(x^*), ..., \nabla g_K(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+g_1%28x%5E%2A%29%2C+%5Cnabla+g_2%28x%5E%2A%29%2C+...%2C+%5Cnabla+g_K%28x%5E%2A%29) 张成的线性子空间的正交子空间
- 于是 ![\nabla f(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%5E%2A%29) 必须落在 ![\nabla g_1(x^*), \nabla g_2(x^*), ..., \nabla g_K(x^*)](https://www.zhihu.com/equation?tex=%5Cnabla+g_1%28x%5E%2A%29%2C+%5Cnabla+g_2%28x%5E%2A%29%2C+...%2C+%5Cnabla+g_K%28x%5E%2A%29) 张成的线性子空间中，证毕！

## **单个约束情形的直观理解**![K=1](https://www.zhihu.com/equation?tex=K%3D1)

对仅有一个约束条件的情形，拉格朗日乘子法的直观含义就是：在最优点，目标函数等值面必须与约束函数等值面相切，否则可进一步改进目标函数值，造成矛盾。知乎上已有的两个非常精彩的回答，请直接参考：[拉格朗日乘子法如何理解？](https://www.zhihu.com/question/38586401/answer/105273125)[拉格朗日乘子法如何理解？](https://www.zhihu.com/question/38586401/answer/105588901)

