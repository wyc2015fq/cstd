# 神经网络P图新神器：摘墨镜戴美瞳都能搞定，加首饰换发型真假难分 | 代码开源 - 知乎
# 



城里新来了个AI修图师，可以说有求必应。

拍了一张美美的照片，但是我还不满意。想瘦脸，想按照我想要的弧线瘦脸；还想让眉毛俏皮上挑、鼻子也挺一点。
![](https://pic1.zhimg.com/v2-161b5d9b5025152b92a2502c48e35450_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='380' height='384'></svg>)



AI修图师，行不行？

行。

简单。把不满意的地方涂掉，接着想怎么改，就怎么简单勾勒一下线条。
![](https://pic2.zhimg.com/v2-75888a378e57b314f57034c8aec52905_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='376' height='380'></svg>)



然后，点一下按钮。效果你看看，行不行？



![](https://pic4.zhimg.com/v2-8b4d1bebda5ce4e61833344e5a7e1f4b_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='382' height='382'></svg>)



求大神帮忙：帮我P成咧嘴微笑，以及眼珠换个颜色。

行。
![](https://pic3.zhimg.com/v2-c5ec1af34dd8ae37feafdcd2f6754b3e_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='215'></svg>)
世间P图的要求不过尔尔，对于这个AI修图师来说，简直信手拈来。只要你提好需求，然后一键就能完美实现。

来个实战演示，譬如给美女加个刘海、画个眼影。也是轻轻松松快速完成。
![](https://pic2.zhimg.com/v2-1c7bbfe1d3f350200c56193085372f39_b.gif)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='364'></svg>)



给小伙去掉墨镜、露出眼睛。没问题，分分钟搞定。
![](https://pic3.zhimg.com/v2-f41622fe3213cfb357b03b61eee9d77a_b.gif)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='364'></svg>)



真的，这都不算难事儿。

## **加首饰、换发型、补全脸**

其实，过去我们也介绍过一些类似的神经网络P图大师。

不过这次的AI修图师，还有一些新本领。

例如，对于色彩的掌握。

可以根据要求，改变眼球的颜色，轻松告别美瞳或者红眼。
![](https://pic1.zhimg.com/v2-08532c794bc04bc69d7df0a4857b0ed8_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1080' height='359'></svg>)
还能改变发型。
![](https://pic1.zhimg.com/v2-8fad6534ac05ee5097697c234d005f78_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='215'></svg>)
甚至，给光头P上秀发，而且头发可以是不同颜色的混搭，直接生成一种挑染的风范~
![](https://pic2.zhimg.com/v2-2981647ec276b7de65ad30b597881871_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='272'></svg>)
不仅如此，这个AI还能按照需求，定制生成搭配的首饰。

耳坠啊什么的，全都不在话下。
![](https://pic4.zhimg.com/v2-ea787ea36e9b132f36470046e49d7533_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='846'></svg>)
当然，以上种种还都是小儿科。

这个AI能脑补的范围可不只是一点点，而是一大片。

即便你给它这样一张图片。
![](https://pic2.zhimg.com/v2-d233afbea17d2fd124de5e1a342307e5_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='636'></svg>)
只要给出要求。
![](https://pic1.zhimg.com/v2-8a7f1a44ffbf540e1800c7ab30a93714_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='320'></svg>)



AI修图师也能很好的重建出来。
![](https://pic1.zhimg.com/v2-64b098c0508b6e2da6ea4fadd2ae6cc8_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='322'></svg>)



左边是脑补的结果，右边是真实的照片，对比一下，你会点赞的……

再展示一组。
![](https://pic4.zhimg.com/v2-a76e01f90bbcdae068aafad7192224bf_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1080' height='357'></svg>)


![](https://pic3.zhimg.com/v2-e235ef7d57807c075b6859bc4eb57a7a_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='322'></svg>)



甚至，只给一个带颜色的简笔画，AI修图师也能生成接近原照片的结果。

你看：
![](https://pic3.zhimg.com/v2-63d23c2b2380d8dcff51f510e2ef70f2_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='454'></svg>)



这是怎么做到的？

## **原理解读**

其实这个最新出现的AI修图大师，来自韩国电子通信研究院（ETRI）。背后是一个名叫SC-FEGAN的模型，可以分为生成器、鉴别器两大部分。






![](https://pic2.zhimg.com/v2-eaab51ffcaec533652c5309afa8a371d_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='347'></svg>)

输入一张不完整的图片，加上蒙版、线稿或者颜色信息，生成器就能推断出编辑后的照片。然后，鉴别器来判断这张照片是不是P得天衣无缝。

生成器基于英伟达推出的图像修复模型U-net，一共有16个卷积层，所有卷积层都使用3x3大小的门控卷积（gated convolution）。

除了输入和输出之外，所有卷积层之后都应用英伟达在2017年提出的局部响应归一化（LRN）。

生成器中还引入了各种损失训练，包括每像素损失、感知损失、风格损失、总方差损失以及通用的GAN损失函数。

鉴别器，使用的是伊利诺伊大学厄巴纳-香槟分校（UIUC）和Adobe研究团队在2018年提出SN-PatchGAN中的架构。

使用了3x3大小的卷积核并应用了梯度惩罚损失项，并没有将ReLu函数应用到GAN损失之中。

**数据集**

在这项研究中，训练使用的是香港中文大学汤晓鸥组收集的人脸数据集CelebA-HQ数据集。

在其中随机选择两组共29000张图像用于训练，1000张图像用于测试。

将图像统一调整为了512x512像素之后，通过自由蒙版和加州大学联合Adobe推出的面部图像生成算法GFC创建对应的草图和颜色数据。

创建颜色数据时，使用直方图均衡化来避免光反射和阴影造成的颜色污染。

然后，使用加州大学HED边沿检测器，来生成与用户输入相对应的草图数据，修改面部图像，然后平滑曲线，并擦除修改图像产生的细小边缘。

## **效果怎么样？**

研究中，与伊利诺伊大学厄巴纳-香槟分校和Adobe研究团队的网络Deepfillv1进行了对比。
![](https://pic1.zhimg.com/v2-9bb5555cd4463ca7aaebdadb21670a70_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='676'></svg>)

在对人物面部进行了大面积胡抹乱画之后，Deepfillv1虽然对整体进行了复原，但是各种涂抹痕迹，以及细节处理，都远远不及新提出的SC-FEGAN。

此外，与其他的研究相比，SC-FEGAN对数据的依赖并没有那么高。

哪怕是是输入一幅完全涂抹掉的图像，也能生成一些头发丝出来。
![](https://pic2.zhimg.com/v2-198dd5fed98f1b294efc2e4d5f758d31_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='640' height='381'></svg>)
**传送门**

这篇论文，来自韩国电子通信研究院，作者是Youngjoo Jo和Jongyoul Park。
![](https://pic3.zhimg.com/v2-704d37bacd16308ad99c60a4116d3fb6_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1080' height='321'></svg>)


这项研究的模型代码，已经在GitHub上开源了，并且提供了带有图形界面的Demo，但需要下载安装。

如果你对这项研究感兴趣，请收好传送门：

SC-FEGAN: Face Editing Generative Adversarial Network with User’s Sketch and Color

[https://arxiv.org/pdf/1902.06838.pdf](https://link.zhihu.com/?target=https%3A//arxiv.org/pdf/1902.06838.pdf)

GitHub项目地址：

[https://github.com/JoYoungjoo/SC-FEGAN](https://link.zhihu.com/?target=https%3A//github.com/JoYoungjoo/SC-FEGAN)

> 来源：量子位

关注V信公众号：**七月在线实验室**，查看更多BAT面试题，干货资料等


![](https://pic3.zhimg.com/v2-24ae2ebcd1e0c3e40f8b726dd31aaa6e_b.jpg)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='258' height='258'></svg>)扫描二维码 获取更多信息
**今日学习推荐：**
为了让小伙伴们更好的学习，我们为你准备了**机器学习、OCR文字识别实战、CV就业、推荐系统就业、AI就业班**相关方面知识，可免费试听喔，详情点击下方学习~

[机器学习集训营 第八期「线上线下结合，线下在北上深广杭沈济郑成武西长十二城」- 七月在线​www.julyedu.com![图标](https://pic2.zhimg.com/v2-0d5b82db757beb2dcc9eb1c23938bf99_180x120.jpg)](https://link.zhihu.com/?target=http%3A//www.julyedu.com/weekend/train8%3Fv%3Dm1)[OCR文字识别实战 [国内首套全面公开OCR技术的实战课程] - 七月在线​www.julyedu.com![图标](https://pic3.zhimg.com/v2-a5f964d8f54e9a2a46dafeec421c6d12_ipico.jpg)](https://link.zhihu.com/?target=https%3A//www.julyedu.com/course/getDetail/138)[CV就业班 第一期「BAT大咖小班教学，保证就业」- 七月在线​www.julyedu.com![图标](https://pic2.zhimg.com/v2-4e6d94ebbf70294325a2e6e6a9f27d61_ipico.jpg)](https://link.zhihu.com/?target=http%3A//www.julyedu.com/Employment/gjob)[推荐系统就业班 第二期「BAT大咖小班教学，保证就业」- 七月在线​www.julyedu.com](https://link.zhihu.com/?target=http%3A//www.julyedu.com/employment/rs2)[AI就业班 四期「BAT大咖一对一高端私人定制」 - 七月在线​www.julyedu.com](https://link.zhihu.com/?target=https%3A//www.julyedu.com/weekend/aijiuye4)





