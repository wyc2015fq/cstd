# 10036 赌徒的长征(3)——鞅的停时定理 - 知乎
# 

　　在赌博界，阿笨的策略（输了就把赌注翻倍）早就有了一个专门的名字，叫martingale。这个词同时也指一种马具，这两种意思的关系扑朔迷离，直到现在都没有定论（参见[http://www.jehps.net/juin2009/Mansuy.pdf](https://link.zhihu.com/?target=http%3A//www.jehps.net/juin2009/Mansuy.pdf)）。而在汉语中，这种策略就也照搬了马具的名字，叫做“鞅”。

　　作为赌博策略的“鞅”的概念，也被引进到了数学中，用来指一类随机过程。它有许多种不同程度的推广，在本文中，下面这种定义就足够了。

> 鞅是一种离散时间的随机过程![X_0, X_1, X_2, \ldots](https://www.zhihu.com/equation?tex=X_0%2C+X_1%2C+X_2%2C+%5Cldots)，满足：
★ ![E(|X_t|) < \infty, \quad \forall\, t \ge 0](https://www.zhihu.com/equation?tex=E%28%7CX_t%7C%29+%3C+%5Cinfty%2C+%5Cquad+%5Cforall%5C%2C+t+%5Cge+0)
★ ![E(X_{t+1} - X_t|X_0, \ldots, X_t) = 0, \quad \forall\, t > 0, \forall\, X_0, \ldots, X_t](https://www.zhihu.com/equation?tex=E%28X_%7Bt%2B1%7D+-+X_t%7CX_0%2C+%5Cldots%2C+X_t%29+%3D+0%2C+%5Cquad+%5Cforall%5C%2C+t+%3E+0%2C+%5Cforall%5C%2C+X_0%2C+%5Cldots%2C+X_t)

　　用通俗的语言来解释一下这个定义。![X_t](https://www.zhihu.com/equation?tex=X_t)可以看成是赌完![t](https://www.zhihu.com/equation?tex=t)局之后的赌本。第一条说的是，在任意**有限**时刻，赌本的绝对值的期望都是有限的。需要注意，这并不是说在任意时刻，赌本的绝对值的期望都要小于**同一个界**。事实上第一个条件基本是废话：赌完![t](https://www.zhihu.com/equation?tex=t)局之后只有有限种可能的结果，每种结果中赌本的绝对值都是有限的，期望当然也有限。

　　第二条说的是，不管前![t](https://www.zhihu.com/equation?tex=t)局结果如何，第![t+1](https://www.zhihu.com/equation?tex=t%2B1)局赌完后，赌本的期望跟赌完![t](https://www.zhihu.com/equation?tex=t)局后相等。换句话说，就是不管前![t](https://www.zhihu.com/equation?tex=t)局结果如何，第![t+1](https://www.zhihu.com/equation?tex=t%2B1)局的期望收益为0。注意“不管前![t](https://www.zhihu.com/equation?tex=t)局结果如何”这个条件是不能省略的，否则条件会变弱：假设硬币具有记忆，第1局赌完后，以后硬币永远是同一面朝上，那么整体来看每一局的期望收益确实为0，但给定第1局的结果之后，第2局的期望收益就不是0了。由![E(X_{t+1} - X_t|X_0, \ldots, X_t) = 0](https://www.zhihu.com/equation?tex=E%28X_%7Bt%2B1%7D+-+X_t%7CX_0%2C+%5Cldots%2C+X_t%29+%3D+0)能够推出![E(X_{t+1} - X_t) = 0](https://www.zhihu.com/equation?tex=E%28X_%7Bt%2B1%7D+-+X_t%29+%3D+0)，但反之则不然。

　　在鞅的定义中，随机过程![X_0, X_1, X_2, \ldots](https://www.zhihu.com/equation?tex=X_0%2C+X_1%2C+X_2%2C+%5Cldots)是无限进行下去的，但我们研究的各种策略，都有停止条件。没关系，我们可以认为触发停止条件后，赌博仍在进行，只不过每局的赌注都是0，赌本不再变化而已。

　　显然，阿笨、阿聪、小白、大白的策略都满足“不管前![t](https://www.zhihu.com/equation?tex=t)局结果如何，第![t+1](https://www.zhihu.com/equation?tex=t%2B1)局的期望收益为0”（因为硬币是均匀的嘛），所以，他们的赌本变化都是鞅。他们的初始赌本都是确定的，所以![X_0](https://www.zhihu.com/equation?tex=X_0)是一个确定的数，而不是随机变量。容易证明，对于任意**有限**时刻![t](https://www.zhihu.com/equation?tex=t)，赌本的期望都等于初始赌本，即![E(X_t) = X_0, \forall\, t > 0](https://www.zhihu.com/equation?tex=E%28X_t%29+%3D+X_0%2C+%5Cforall%5C%2C+t+%3E+0)。然而我们感兴趣的，是赌博停止时赌本的期望![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)，其中停止时间![T](https://www.zhihu.com/equation?tex=T)是随机变量，且可能没有上界。![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)可不能随随便便地说等于![X_0](https://www.zhihu.com/equation?tex=X_0)。
![](https://pic1.zhimg.com/00efd76c785593c29ccc7863b18e8588_b.jpg)
　　鞅过程有一个**停时定理**。针对不同广度的鞅的定义，停时定理的叙述也有不同。其中[维基百科英文版页面](https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Optional_stopping_theorem)的叙述用到了filtration的概念，顺藤摸瓜下去很快就涉及了σ-algebra等等非常底层的数学概念，我也没有看懂。但是[意大利语页面](https://link.zhihu.com/?target=https%3A//it.wikipedia.org/wiki/Teorema_di_arresto_opzionale_di_Doob)的叙述居然通俗易懂（哈哈，又一个会多种语言有什么好处的例子，尽管我其实并不会意大利语）。[@Jack Diamond](https://www.zhihu.com/people/ce43350682495256bf0220e728ab0f2e)给出的一份[英文讲义](https://link.zhihu.com/?target=http%3A//dept.stat.lsa.umich.edu/~ionides/620/notes/martingales.pdf)的第8页中，也有一样的通俗叙述，摘录如下：

> **鞅的停时定理：**设![T](https://www.zhihu.com/equation?tex=T)是鞅过程![X_t](https://www.zhihu.com/equation?tex=X_t)的停止时间，则当下面三个条件之一成立时，有![E(X_T) = X_0](https://www.zhihu.com/equation?tex=E%28X_T%29+%3D+X_0)：
- ![T](https://www.zhihu.com/equation?tex=T)几乎一定有界；
- 赌注![|X_{t+1} - X_t|](https://www.zhihu.com/equation?tex=%7CX_%7Bt%2B1%7D+-+X_t%7C)一致有界，且![T](https://www.zhihu.com/equation?tex=T)的期望有限；
- 赌本![X_t](https://www.zhihu.com/equation?tex=X_t)一致有界，且![T](https://www.zhihu.com/equation?tex=T)几乎一定有限。

　　还是要解释一下定理中的术语。“几乎一定”，指的是概率为1，如果理解困难，可以忽略这个词组。“有限”指是的不能取无穷，但取多大都可以；“有界”比“有限”强一些，取值必须在一个有限的范围内。“一致有界”指的是，不管![t](https://www.zhihu.com/equation?tex=t)取多少，赌本和赌注都必须在一个**与![t](https://www.zhihu.com/equation?tex=t)无关**的有限范围内。停时定理的三个条件，对![X_t](https://www.zhihu.com/equation?tex=X_t)的要求则越来越强，对停止时间![T](https://www.zhihu.com/equation?tex=T)的要求则越来越弱。“![T](https://www.zhihu.com/equation?tex=T)几乎一定有限”这个条件是最弱的：如果![T](https://www.zhihu.com/equation?tex=T)取无穷的概率非零，那么![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)就无法定义了。

　　既然阿笨、阿聪、小白、大白的策略都是鞅，那么就来小试牛刀一下吧：
- 阿笨的策略（输则赌注翻倍），必然在有限局内结束，满足条件1。事实上，它满足全部三个条件。
- 小白的策略（赢到5则见好就收），可能进行任意多局，![T](https://www.zhihu.com/equation?tex=T)并不是有界的，不满足条件1。但上一篇中计算了![E(T) = 4](https://www.zhihu.com/equation?tex=E%28T%29+%3D+4)，故满足条件2中的“![T](https://www.zhihu.com/equation?tex=T)的期望有限”，当然也满足条件3中的“![T](https://www.zhihu.com/equation?tex=T)几乎一定有限”。在![X_t](https://www.zhihu.com/equation?tex=X_t)方面，因为赌注一直为1，赌本最少为0，最多为5，所以“赌注一致有界”和“赌本一致有界”都成立。这样，小白策略就满足条件2和条件3。
- 大白的策略（三连胜则见好就收），跟小白策略一样不满足条件1。它也不满足条件3，因为“赢、赢、输”的循环可以无限进行下去，每次赌本加1，赌本做不到一致有界。条件2的前一半“赌注一致有界”是成立的，因为赌注始终为1，后一半“![T](https://www.zhihu.com/equation?tex=T)的期望有限”则需要检验。用上一篇文章中的递推法，加上![6E(T)-14 = 2E(T)](https://www.zhihu.com/equation?tex=6E%28T%29-14+%3D+2E%28T%29)这个隐藏条件，可以求出![E(T) = 3.5](https://www.zhihu.com/equation?tex=E%28T%29+%3D+3.5)，的确是有限的，满足条件2。
![](https://pic3.zhimg.com/5d790830899dfdfd35a87cf4fa79306a_b.jpg)- 阿聪的策略就复杂了。显然条件1不满足，所以需要寻找关于![X_t](https://www.zhihu.com/equation?tex=X_t)的条件。![X_t](https://www.zhihu.com/equation?tex=X_t)不满足条件3——因为一输一赢可以使赌本增加1块钱，赌本不一致有界。![X_t](https://www.zhihu.com/equation?tex=X_t)甚至都不满足条件2——赌本越多，阿聪就越有资本一输到底，而输的过程中赌注也在不断增加，并不一致有界。

　　我们又一次认识到，阿聪策略比大白策略更复杂，复杂到连鞅的停时定理都不能证明阿聪策略的期望收益为0。但是，鞅的停时定理，说的是“期望收益为0”的**充分条件**而不是**必要条件**，不满足这3个条件的情况下，期望收益也可能为0。阿聪策略，会不会正好属于这种情况呢？要如何放宽停时定理的条件，既能使得阿聪策略满足它们，又依然能得出期望收益为0呢？这个线索，要到停时定理的证明过程中去找。
![](https://pic1.zhimg.com/00efd76c785593c29ccc7863b18e8588_b.jpg)
　　前面说过，一个鞅过程在任意有限时刻![t](https://www.zhihu.com/equation?tex=t)的期望等于初始值：![E(X_t) = X_0, \forall\, t > 0](https://www.zhihu.com/equation?tex=E%28X_t%29+%3D+X_0%2C+%5Cforall%5C%2C+t+%3E+0)。这其实已经证明了条件1（![T](https://www.zhihu.com/equation?tex=T)有界）成立时的停时定理：只要把![t](https://www.zhihu.com/equation?tex=t)取为![T](https://www.zhihu.com/equation?tex=T)的上界就可以了，因为这样![X_T = X_t](https://www.zhihu.com/equation?tex=X_T+%3D+X_t)。而当![T](https://www.zhihu.com/equation?tex=T)无界时，![X_T](https://www.zhihu.com/equation?tex=X_T)和![X_t](https://www.zhihu.com/equation?tex=X_t)只有在![T>t](https://www.zhihu.com/equation?tex=T%3Et)时才不同。把![t](https://www.zhihu.com/equation?tex=t)取得足够大，![T>t](https://www.zhihu.com/equation?tex=T%3Et)的概率就足够小，如果![X_T](https://www.zhihu.com/equation?tex=X_T)和![X_t](https://www.zhihu.com/equation?tex=X_t)的差距不大，那么![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)和![E(X_t)](https://www.zhihu.com/equation?tex=E%28X_t%29)的差距就可以忽略。这正是证明条件2、3成立时的停时定理的思路。

　　先来推一下![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)和![E(X_t)](https://www.zhihu.com/equation?tex=E%28X_t%29)的差距：

> ★ ![E(X_T) - E(X_t) = P(T \le t) E(X_T - X_t | T \le t) + P(T > t) E(X_T - X_t | T > t)](https://www.zhihu.com/equation?tex=E%28X_T%29+-+E%28X_t%29+%3D+P%28T+%5Cle+t%29+E%28X_T+-+X_t+%7C+T+%5Cle+t%29+%2B+P%28T+%3E+t%29+E%28X_T+-+X_t+%7C+T+%3E+t%29)

这里面，右边第一个期望为0，所以只需关注右边第二项。现在看条件3：“![T](https://www.zhihu.com/equation?tex=T)几乎一定有限”，说明随着![t](https://www.zhihu.com/equation?tex=t)的增大，![P(T>t)](https://www.zhihu.com/equation?tex=P%28T%3Et%29)是趋于0的；而“赌本一致有界”，就说明了![E(X_T - X_t | T>t)](https://www.zhihu.com/equation?tex=E%28X_T+-+X_t+%7C+T%3Et%29)一致有界。这样，![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)和![E(X_t)](https://www.zhihu.com/equation?tex=E%28X_t%29)的差距随着![t](https://www.zhihu.com/equation?tex=t)的增大就趋于0，而![E(X_t)](https://www.zhihu.com/equation?tex=E%28X_t%29)一直等于![X_0](https://www.zhihu.com/equation?tex=X_0)，故![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)也等于![X_0](https://www.zhihu.com/equation?tex=X_0)。条件3的情形证毕。

　　与条件3相比，在条件2对![X_t](https://www.zhihu.com/equation?tex=X_t)的要求“赌注一致有界”变弱了。这样就不再能把![E(X_T - X_t | T>t)](https://www.zhihu.com/equation?tex=E%28X_T+-+X_t+%7C+T%3Et%29)限制在一个固定范围内了，而只能把![E(X_\tau - X_t)](https://www.zhihu.com/equation?tex=E%28X_%5Ctau+-+X_t%29)限制在一个随![\tau-t](https://www.zhihu.com/equation?tex=%5Ctau-t)线性增长的范围内，即![|E(X_\tau - X_t)| \le C(\tau-t)](https://www.zhihu.com/equation?tex=%7CE%28X_%5Ctau+-+X_t%29%7C+%5Cle+C%28%5Ctau-t%29)，![C](https://www.zhihu.com/equation?tex=C)为常数。我们来限定一下右边的第二项的范围。

![\begin{align} & |P(T>t) E(X_T - X_t | T>t)| \\ =\,& P(T>t) \sum_{\tau = t+1}^\infty |E(X_\tau - X_t)| P(T = \tau | T>t) \\ =\,& \sum_{\tau = t+1}^\infty |E(X_\tau - X_t)| P(T = \tau) \\ \le\,& \sum_{\tau = t+1}^\infty C(\tau-t) P(T = \tau) \\ \le\,& C \sum_{\tau = t+1}^\infty \tau P(T = \tau) \end{align} \\](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%7D+%26+%7CP%28T%3Et%29+E%28X_T+-+X_t+%7C+T%3Et%29%7C+%5C%5C+%3D%5C%2C%26+P%28T%3Et%29+%5Csum_%7B%5Ctau+%3D+t%2B1%7D%5E%5Cinfty+%7CE%28X_%5Ctau+-+X_t%29%7C+P%28T+%3D+%5Ctau+%7C+T%3Et%29+%5C%5C+%3D%5C%2C%26+%5Csum_%7B%5Ctau+%3D+t%2B1%7D%5E%5Cinfty+%7CE%28X_%5Ctau+-+X_t%29%7C+P%28T+%3D+%5Ctau%29+%5C%5C+%5Cle%5C%2C%26+%5Csum_%7B%5Ctau+%3D+t%2B1%7D%5E%5Cinfty+C%28%5Ctau-t%29+P%28T+%3D+%5Ctau%29+%5C%5C+%5Cle%5C%2C%26+C+%5Csum_%7B%5Ctau+%3D+t%2B1%7D%5E%5Cinfty+%5Ctau+P%28T+%3D+%5Ctau%29+%5Cend%7Balign%7D+%5C%5C)

条件2的另一部分“![E(T)](https://www.zhihu.com/equation?tex=E%28T%29)有限”，意思就是级数![\sum_{\tau=1}^\infty \tau P(T=\tau)](https://www.zhihu.com/equation?tex=%5Csum_%7B%5Ctau%3D1%7D%5E%5Cinfty+%5Ctau+P%28T%3D%5Ctau%29)收敛。而上式中的求和是这个级数的余项和，随着![t](https://www.zhihu.com/equation?tex=t)的增大是趋于0的。![E(X_T)](https://www.zhihu.com/equation?tex=E%28X_T%29)和![E(X_t)](https://www.zhihu.com/equation?tex=E%28X_t%29)的差距趋于0，故![E(X_T) = X_0](https://www.zhihu.com/equation?tex=E%28X_T%29+%3D+X_0)。

　　回顾一下条件2的证明过程，我们发现，“赌注一致有界”这个条件，可以放宽为“赌本线性增长”。阿聪的策略中，尽管赌注并不一致有界，但赌本确实是线性增长的——在“赢”的一端，由于赢的次数不能超过输的次数（否则游戏就结束了），赌本增长的最快方式也就是不停重复“一输一赢”的循环，而每次循环赌本固定增长1块钱；在“输”的一端，最终输光时欠的债也不会超过一次赌注，也就不会超过赌的总局数。这样就有![|E(X_\tau)| \le C\tau](https://www.zhihu.com/equation?tex=%7CE%28X_%5Ctau%29%7C+%5Cle+C%5Ctau)，上面的证明过程依然成立。

　　这样，要证明阿聪策略的期望收益为0，就只需证明停止时间的期望![E(T)](https://www.zhihu.com/equation?tex=E%28T%29)有限了。然而这个证明依然不简单，留待下回分解。
![](https://pic1.zhimg.com/00efd76c785593c29ccc7863b18e8588_b.jpg)
**更新日志：**
- 2015/12/15：经[@玩儿的就是心跳归来](https://www.zhihu.com/people/af8c40e9e5c724ad37f903b864fae113)指正，修改了鞅的停时定理的三个条件的顺序。

