# 量化策略系列教程：14海龟策略 - 知乎
# 



**天天跟小哥要策略，你们也不怕累着小哥~不过我愿意！哈哈哈~今儿给大家来个新策略，这几天策略更新的慢一些，因为要做python教程视频，大家不要太着急哈~**[证经社量化社区 - 证经社](https://link.zhihu.com/?target=http%3A//zjshe.cn/q/forum.php)

**PS：悟空传还挺好看的嘿！倪妮的这个紫霞也挺好美的哈~**




**1. 策略原理：**

海龟交易系统作为一个著名的交易系统，具备三个特征：第一，是一个完整的交易系统，覆盖 了交易的每个环节；第二，是一个机械化的交易系统，不给交易者留下任何主观想象决策的空间和 余地；第三，是一个已经被验证可以盈利的交易系统，在多个期货品种中都可以获得稳定性的收益。 

海龟交易系统涵盖了成功交易中的每一个必要环节：买卖市场（买卖什么）；头寸规模（买卖 多少）；入市（何时买卖）；止损（什么时候放弃一个亏损的头寸）；退出（什么时候退出一个赢利 的头寸）；战术（怎么进行买卖）。




**海龟交易入市法则：**系统 1：以 20 日突破为基础的短期 系统；系统 2：以 55 日突破为基础的中长期系统；     海龟交易退出法则：系统 1 采用 10 日突破退出法则： 对于多头头寸而言，在价格跌破过去 10 日最低点时退出；对 空头头寸而言，在价格超过 10 日最高点时退出。总之，如果 价格发生了不利于头寸的 10 日突破，所有单位头寸都要退出。 系统 2 采用 20 日突破退出法则：对多头头寸而言，是 20 日向 下突破，对空头头寸而言，是 20 日向上突破。只要价格发生 了不利于头寸的 20 日突破，所有头寸都会退出。

    本策略只是海龟策略的框架：采用20日突破原则，20日向上突破时进行开仓，20日向下突破时进行平仓。

**2. 代码解读：**

**   2.1****turtle.ini**


```
[strategy]
username=
password=
;模拟状态
mode=4
td_addr=localhost:8001
strategy_id=
;订阅代码注意及时更新
subscribe_symbols=

[backtest]
start_time=2016-08-22 09:00:00
end_time=2016-08-26 16:00:00
;策略初始资金
initial_cash=1000000
;委托量成交比率，默认=1（每个委托100%成交）
transaction_ratio=1
;手续费率，默认=0（不计算手续费）
commission_ratio=0
;滑点比率，默认=0（无滑点）
slippage_ratio=0

[para]
csv_file=stocks.csv
period=20
hop=0.1


##############################################################
# logger settings
##############################################################
[loggers]
keys=root

[logger_root]
level=DEBUG
handlers=console,file

[handlers]
keys=console,file

[handler_file]
class=handlers.RotatingFileHandler
args=('strategy_turtle.log','a',1000,5)
formatter=simple

[handler_console]
class=StreamHandler
args = (sys.stdout,)
formatter=simple

[formatters]
keys = simple

[formatter_simple]
format=%(asctime)s - %(name)s - %(levelname)s - %(message)s
datefmt=
```


**2.2 **[turtle.py](https://link.zhihu.com/?target=http%3A//turtle.py)


```
# encoding: utf8

import logging
import logging.config
import pandas as pd
import numpy as np
from gmsdk import *

class TurtleStrategy(StrategyBase):
    def __init__(self, *args, **kwargs):
        super(TurtleStrategy, self).__init__(*args, **kwargs)
        self.__get_param__()
        self.__init_data__()
;读取参数
    def __get_param__(self):
        self.csv_file = self.config.get('para', 'csv_file')
        self.period = self.config.getint('para', 'period')
        self.hop = self.config.get('para', 'hop') or 0.1
；读取CSV文件
    def __init_data__(self):
        '''
        read stocks from csv file
        :return:
        '''
        self.sec_ids = []
        self.hist_data = dict()
        self.positions = dict()

        subscribe_symbols = []

        stocks = pd.read_csv(self.csv_file, sep=',')
        for r in stocks.iterrows():
            exchange = r[1][0]
            sec_id = r[1][1]
            buy_amount = r[1][2]
            t = "{0}.{1}".format(exchange, sec_id)

            hl = self.get_highest_lowest_price(t)
            #print (hl)
            self.hist_data[t] = hl + (buy_amount,)   ## high, low, buy_amount


            self.sec_ids.append("{0}".format(sec_id))
            subscribe_symbols.append(t + ".tick")

        self.subscribe(",".join(subscribe_symbols))

；获取近20日的最高价及最低价
    def get_highest_lowest_price(self, symbol):
        #print(symbol)
        ## get last N dailybars
        hd = self.get_last_n_dailybars(symbol, self.period)

        high_prices = [b.high for b in hd]
        #high_prices.reverse()

        low_prices = [b.low for b in hd]
        #low_prices.reverse()

        return np.max(high_prices), np.min(low_prices)


    def on_tick(self, tick):

        if not tick.sec_id in self.sec_ids:
            pass
            #self.logger.info( "received tick: %s %s %s %s" % (tick.exchange, tick.sec_id, round(tick.last_price,2), tick.last_volume))
        else:
            #self.logger.info( "received tick: %s %s, A: %s B: %s" % (tick.sec_id, round(tick.last_price,2), round(tick.asks[0][0],2), round(tick.bids[0][0],2)))
            symbol = ".".join([tick.exchange, tick.sec_id])

            data = self.hist_data.get(symbol)
            self.hop = float(self.hop)
            #print (data)
            pa = self.get_positions()
            #int pa
;开仓及平仓
            if data and tick.last_price > data[0]  :  ## check high
                volume = int(data[2]/(tick.last_price+self.hop)/100)*100  ## get slots, then shares
                if bool(self.get_position(tick.exchange,tick.sec_id,1)) == 0:
                #print (to_dict(aaa[0]))
                    self.open_long(tick.exchange, tick.sec_id, tick.last_price + self.hop, volume)
                #print (tick.exchange, tick.sec_id, tick.last_price + self.hop, volume)

                #print (tick.sec_id)
            elif data and tick.last_price < data[1]:  ## check low

                #p = self.get_position(tick.exchange, tick.sec_id, OrderSide_Bid)
                ps = self.get_positions()
                for p in ps:
                    sym = ".".join([p.exchange, p.sec_id])
                    self.positions[sym] = p
                    #print (p)

                    ## if not in stock list, close long position
                    if p.sec_id in self.sec_ids:
                        self.close_long(p.exchange, p.sec_id, 0, p.volume)

if __name__ == '__main__':
    ini_file = sys.argv[1] if len(sys.argv) > 1 else 'turtle.ini'
    logging.config.fileConfig(ini_file)
    st = TurtleStrategy(config_file=ini_file)
    st.logger.info("Strategy turtle ready, waiting for data ...")
    ret = st.run()
st.logger.info("Strategy turtle message %s" % st.get_strerror(ret))
```


**2.3 stocks.csv**
![](https://pic4.zhimg.com/v2-150fd042eacfd009d704ea36aaa11fdf_b.png)![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='420'></svg>)
**如果想了解相关的python函数和掘金接口函数，走下方通道：**

[http://zjshe.cn/q/forum.php?mod=viewthread&tid=61&extra=page%3D1](https://link.zhihu.com/?target=http%3A//zjshe.cn/q/forum.php%3Fmod%3Dviewthread%26tid%3D61%26extra%3Dpage%253D1)


**有不了解的可以给小编留言哦，小编会细心为大家解答~**


