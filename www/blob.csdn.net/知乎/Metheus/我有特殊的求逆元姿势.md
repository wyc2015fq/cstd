# 我有特殊的求逆元姿势 - 知乎
# 

        在OI中，由于大多数题目都要要求对答案取模，这样一来求模意义下的乘法逆元成了地球人（划去）都会的一个基本操作。给定整数 ![x](https://www.zhihu.com/equation?tex=x) 以及模数 ![P](https://www.zhihu.com/equation?tex=P) ，如果 ![x\not \perp P](https://www.zhihu.com/equation?tex=x%5Cnot+%5Cperp+P) ，则不存在 ![x](https://www.zhihu.com/equation?tex=x) 在模 ![P](https://www.zhihu.com/equation?tex=P) 意义下的逆元；反之逆元一定存在。一般来讲，求逆元有以下几种基本操作：

## **快速幂：利用欧拉定理**

        由欧拉定理 ![x^{\phi(P)}\equiv 1\ (\text{mod }P)](https://www.zhihu.com/equation?tex=x%5E%7B%5Cphi%28P%29%7D%5Cequiv+1%5C+%28%5Ctext%7Bmod+%7DP%29) 可以得到 ![x*x^{\phi(P)-1}\equiv 1\ (\text{mod }P)](https://www.zhihu.com/equation?tex=x%2Ax%5E%7B%5Cphi%28P%29-1%7D%5Cequiv+1%5C+%28%5Ctext%7Bmod+%7DP%29) ，那么逆元即为 ![x^{\phi(P)-1}](https://www.zhihu.com/equation?tex=x%5E%7B%5Cphi%28P%29-1%7D) ,快速幂 ![O(\log P)](https://www.zhihu.com/equation?tex=O%28%5Clog+P%29) 求出。

## **扩展欧几里得**

        由于 ![x*y \equiv 1\ (\text{mod } P)\Leftrightarrow xy+kP=1(k\in \text{Z})](https://www.zhihu.com/equation?tex=x%2Ay+%5Cequiv+1%5C+%28%5Ctext%7Bmod+%7D+P%29%5CLeftrightarrow+xy%2BkP%3D1%28k%5Cin+%5Ctext%7BZ%7D%29) ,则满足方程 ![ax+by=1](https://www.zhihu.com/equation?tex=ax%2Bby%3D1) 的 ![x](https://www.zhihu.com/equation?tex=x) 即为 ![a](https://www.zhihu.com/equation?tex=a) 模 ![b](https://www.zhihu.com/equation?tex=b) 的逆元（同时 ![y](https://www.zhihu.com/equation?tex=y) 为 ![b](https://www.zhihu.com/equation?tex=b) 模 ![a](https://www.zhihu.com/equation?tex=a) 的逆元）。那么只需要使用扩展欧几里得求解，时间复杂度 ![O(\log P)](https://www.zhihu.com/equation?tex=O%28%5Clog+P%29) 。

## **同时求得 ![1\text ~ n](https://www.zhihu.com/equation?tex=1%5Ctext+~+n) 的逆元：**

        由 ![\lfloor P/x\rfloor x+P\%x\equiv0(\text{mod }P)](https://www.zhihu.com/equation?tex=%5Clfloor+P%2Fx%5Crfloor+x%2BP%5C%25x%5Cequiv0%28%5Ctext%7Bmod+%7DP%29) 推出![ x^{-1}\equiv-(P\%x)^{-1}\lfloor P/x\rfloor(\text{mod }P)](https://www.zhihu.com/equation?tex=+x%5E%7B-1%7D%5Cequiv-%28P%5C%25x%29%5E%7B-1%7D%5Clfloor+P%2Fx%5Crfloor%28%5Ctext%7Bmod+%7DP%29) 因为 ![P\%x\lt x](https://www.zhihu.com/equation?tex=P%5C%25x%5Clt+x) ，所以 ![(P\%x)^{-1}](https://www.zhihu.com/equation?tex=%28P%5C%25x%29%5E%7B-1%7D) 一定早于 ![x^{-1}](https://www.zhihu.com/equation?tex=x%5E%7B-1%7D) 被计算出，边界条件 ![1^{-1}=1](https://www.zhihu.com/equation?tex=1%5E%7B-1%7D%3D1) 。时间复杂度 ![O(n)](https://www.zhihu.com/equation?tex=O%28n%29) 。

忘了递推公式？不想思考？没事你还可以如下线性求逆元（划重点）：

## 线性筛：

        由于 ![f(x)=x^{-1}](https://www.zhihu.com/equation?tex=f%28x%29%3Dx%5E%7B-1%7D) 显然是个积性函数，且 ![x](https://www.zhihu.com/equation?tex=x) 是素数时的逆元可以用上面的方法 ![O(logP)](https://www.zhihu.com/equation?tex=O%28logP%29) 求得，素数密度 ![O(n/\ln n)](https://www.zhihu.com/equation?tex=O%28n%2F%5Cln+n%29) ，故线性筛出 ![n](https://www.zhihu.com/equation?tex=n) 以内所有数的逆元时间复杂度 ![O(n)](https://www.zhihu.com/equation?tex=O%28n%29) 。

## 强行阶乘：

        不想写线性筛？没事，还有办法：

 相信地球人（划去）都会求阶乘的逆元：

```cpp
fact[]=;
for(int i=;i<=n;++i) fact[i]=fact[i-]*i%P；
factinv[n]=Inverse(fact[n]);
for(int i=n-;i>=;--i) factinv[i]=factinv[i+]*(i+)%P;
```

那么，我们不就有整数的逆元了吗（雾

`inv[x]=fact[x-1]*factinv[x]%P`

（来自某位把递推逆元写成阶乘逆元老哥的脑洞）

时间复杂度 ![O(n+\log P)](https://www.zhihu.com/equation?tex=O%28n%2B%5Clog+P%29)

更新一些其他东西的逆元求法：

多项式乘法逆元

给定多项式 ![P(x)](https://www.zhihu.com/equation?tex=P%28x%29) ，要求多项式 ![Q(x)](https://www.zhihu.com/equation?tex=Q%28x%29) 使得 ![P(x)Q(x)\equiv 1(\text{mod } R(x))](https://www.zhihu.com/equation?tex=P%28x%29Q%28x%29%5Cequiv+1%28%5Ctext%7Bmod+%7D+R%28x%29%29)。

1.若 ![R(x)](https://www.zhihu.com/equation?tex=R%28x%29) 为只有一项（形式为 ![x^n](https://www.zhihu.com/equation?tex=x%5En) ）

多项式基本操作 ![\begin{equation} \left\{ \begin{array} AA(x)B(x)\equiv 1(\text{mod } x^{n})&(1)\\ A(x)B'(x)\equiv 1(\text{mod } x^{n/2})&(2) \end{array} \right. \end{equation}\\ (1)-(2)\Rightarrow B(x)-B'(x)\equiv 0(\text{mod } x^{n/2})\\ B^2(x)+B'^2(x)-2B(x)B'(x)\equiv 0(\text{mod } x^{n})\\ B(x)\equiv 2B(x)-A(x)B'^2(x)(\text{mod } x^{n})](https://www.zhihu.com/equation?tex=%5Cbegin%7Bequation%7D+%5Cleft%5C%7B+%5Cbegin%7Barray%7D+AA%28x%29B%28x%29%5Cequiv+1%28%5Ctext%7Bmod+%7D+x%5E%7Bn%7D%29%26%281%29%5C%5C+A%28x%29B%27%28x%29%5Cequiv+1%28%5Ctext%7Bmod+%7D+x%5E%7Bn%2F2%7D%29%26%282%29+%5Cend%7Barray%7D+%5Cright.+%5Cend%7Bequation%7D%5C%5C+%281%29-%282%29%5CRightarrow+B%28x%29-B%27%28x%29%5Cequiv+0%28%5Ctext%7Bmod+%7D+x%5E%7Bn%2F2%7D%29%5C%5C+B%5E2%28x%29%2BB%27%5E2%28x%29-2B%28x%29B%27%28x%29%5Cequiv+0%28%5Ctext%7Bmod+%7D+x%5E%7Bn%7D%29%5C%5C+B%28x%29%5Cequiv+2B%28x%29-A%28x%29B%27%5E2%28x%29%28%5Ctext%7Bmod+%7D+x%5E%7Bn%7D%29)

根据初始条件 ![B(x)=([x^0]A(x))^{-1}(\text{mod } x)](https://www.zhihu.com/equation?tex=B%28x%29%3D%28%5Bx%5E0%5DA%28x%29%29%5E%7B-1%7D%28%5Ctext%7Bmod+%7D+x%29) 递推计算，时间复杂度 ![O(n\log n)](https://www.zhihu.com/equation?tex=O%28n%5Clog+n%29) 。

2. ![R(x)](https://www.zhihu.com/equation?tex=R%28x%29) 为任意多项式

扩展欧几里得在多项式情形下也成立。

