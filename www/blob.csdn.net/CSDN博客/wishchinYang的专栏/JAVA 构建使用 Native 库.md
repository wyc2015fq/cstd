# JAVA  构建使用 Native 库 - wishchinYang的专栏 - CSDN博客
2017年11月01日 11:38:30[wishchin](https://me.csdn.net/wishchin)阅读数：209
个人分类：[人形机器人](https://blog.csdn.net/wishchin/article/category/5597059)
       Java 使用Native文件，一般分解为下面几个步骤：
- 在Java代码中使用native关键字声明一个本地方法
- 运行javah，获得包含该方法声明的C语言头文件（使用jni编程中的C函数名通常是相关于Java方法有一定的命名规则的，稍后会介绍，我们使用javah来帮助我们获得该方法名）
- 用C语言或C++实现我们所需要的功能
- 生成共享库文件，共享库文件可以是windows风格的.dll文件，也可以是UNIX风格的.so文件
- 为了确保虚拟机在第一次使用该类之前就会装载这个库，使用静态初始化块来加载
操作步骤：
1.CMD 切换到目录
```java
cd D:\Works\Android\WorkspaceUnify\rsPolylabel\bin
D:
```
2.编译头文件
javah -jni -classpath . -d ./jni rsPolylabel.Polylabel
结果：生成h文件 rsPolylabel_Polylabel.h 到jni文件夹
3.头文件代码描述
```cpp
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class rsPolylabel_Polylabel */
#ifndef _Included_rsPolylabel_Polylabel
#define _Included_rsPolylabel_Polylabel
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     rsPolylabel_Polylabel
 * Method:    helloWishchinJni
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_rsPolylabel_Polylabel_helloWishchinJni
  (JNIEnv *, jclass);
#ifdef __cplusplus
}
#endif
#endif
```
5.利用Vs生成工程
使用VS建立一个Dll工程，根据头文件编写相应的CPP文件，在包含目录中添加目录：
C:\Program Files\Java\jdk1.8.0_152\include 
和
C:\Program Files\Java\jdk1.8.0_152\include
7.载入动态库
网上的方法，把储存dll文件的目录加入到系统目录Path，然并卵！！！
在Eclipse程序中，运行System.out.println( System.getProperty("java.library.path"));
此行运行完成，输出目录
D:\Works\Android\WorkspaceUnify\rsPolylabel\lib\x64;
D:\Works\Android\WorkspaceUnify\rsPolylabel\lib\hdf5
因此把dll文件放入 lib\x64 目录，载入成功。
6.编写代码
在CPP文件中添加头文件包含和JNI包含
```cpp
#include <jni.h>
/* Header for class rsPolylabel_Polylabel */
#include "rsPolylabel_Polylabel.h"
```
此后按照一般的方法生成动态库即可
7.引入动态库
测试成功！
