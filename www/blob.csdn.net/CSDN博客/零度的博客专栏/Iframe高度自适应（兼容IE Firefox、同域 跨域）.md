# Iframe高度自适应（兼容IE/Firefox、同域/跨域） - 零度的博客专栏 - CSDN博客
2016年05月20日 16:33:40[零度anngle](https://me.csdn.net/zmx729618)阅读数：460
                
在实际的项目进行中，很多地方可能由于历史原因不得不去使用iframe，包括目前正火热的应用开发也是如此。
随之而来的就是在实际使用iframe中，会遇到iframe高度的问题，由于被嵌套的页面长度不固定而显示出来的滚动条，不仅影响美观，还会对用户操作带来不便。于是自动调整iframe的高度就成为本文的重点。
采用JavaScript来控制iframe元素的高度是iframe高度自适应的关键，同时由于JavaScript对不同域名下权限的控制，引发出同域、跨域两种情况。
同域时Iframe高度自适应
下面的代码兼容IE/Firefox浏览器，控制id为“iframeid”的iframe的高度，通过JavaScript取得被嵌套页面最终高度，然后在主页面进行设置来实现。
代码如下，可复制。另外，请注意此解决方案仅供同域名下使用。
<table class="prettyprint-table   " style="margin: 0px; padding: 2px; outline: 0px; border: 1px solid rgb(0, 0, 0); width: 984px; color: rgb(238, 238, 238); line-height: 1.5; font-size: 14px; vertical-align: middle; border-spacing: 0px; background-color: rgb(34, 34, 34);"><tbody style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><script
 type="text/javascript"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">function
 SetCwinHeight(){</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">var
 iframeid=document.getElementById("iframeid"); //iframe id</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">if
 (document.getElementById){</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">if
 (iframeid && !window.opera){</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">if
 (iframeid.contentDocument && iframeid.contentDocument.body.offsetHeight){</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">iframeid.height
 = iframeid.contentDocument.body.offsetHeight;</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">}else
 if(iframeid.Document && iframeid.Document.body.scrollHeight){</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">iframeid.height
 = iframeid.Document.body.scrollHeight;</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">}</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">}</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">}</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">}</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></script></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><iframe
 width="100%" id="iframeid" onload="Javascript:SetCwinHeight()" height="1" frameborder="0" src="kimi.php"></iframe></td></tr></tbody></table>
跨域时Iframe高度自适应
在主页面和被嵌套的iframe为不同域名的时候，就稍微麻烦一些，需要避开JavaScript的跨域限制。
原理：现有iframe主页面main.html、被iframe嵌套页面iframe.html、iframe中介页面agent.html三个，通过main.html（域名为http://www.ccvita.com）嵌套iframe.html（域名为：http://www.phpq.net），当用户浏览时执行iframe.html中的JavaScript代码设置iframeC的scr地址中加入iframe页面的高度，agent.html（域名为：http://www.ccvita.com）取得传递的高度，通过JavaScript设置main.html中iframe的高度。最终实现预期的目标。
演示地址：http://www.ccvita.com/usr/uploads/demo/iframe/main.html
代码下载：http://www.ccvita.com/usr/uploads/demo/iframe/iframe.zip
iframe主页面main.html
<table class="prettyprint-table   " style="margin: 0px; padding: 2px; outline: 0px; border: 1px solid rgb(0, 0, 0); width: 1676px; color: rgb(238, 238, 238); line-height: 1.5; font-size: 14px; vertical-align: middle; border-spacing: 0px; background-color: rgb(34, 34, 34);"><tbody style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><
 !DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><html
 xmlns="http://www.w3.org/1999/xhtml"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><head><title>iframe主页面</title></head></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><body></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"> </td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><div
 style="border:1px solid #ccc;padding:10px;"><iframe id="frame_content" name="frame_content" src="iframe.html" width="100%" height="0" scrolling="no" frameborder="0"></iframe></div><br />尾部<br /></body></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></html></td></tr></tbody></table>
iframe嵌套页面iframe.html
<table class="prettyprint-table   " style="margin: 0px; padding: 2px; outline: 0px; border: 1px solid rgb(0, 0, 0); width: 2808px; color: rgb(238, 238, 238); line-height: 1.5; font-size: 14px; vertical-align: middle; border-spacing: 0px; background-color: rgb(34, 34, 34);"><tbody style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><
 !DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><html
 xmlns="http://www.w3.org/1999/xhtml"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><head><title>被iframe嵌套页面</title></head></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><body></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"> </td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">文字<br
 /><br /><br /><br /><br /><br /><br /><br /><br /><br />文字<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />文字<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />文字<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><iframe id="iframeC"
 name="iframeC" src="" width="0" height="0" style="display:none;" ></iframe></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"> </td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><script
 type="text/javascript"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">function
 sethash(){</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">hashH
 = document.documentElement.scrollHeight;</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">urlC
 = "agent.html";</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">document.getElementById("iframeC").src=urlC+"#"+hashH;</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">}</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">window.onload=sethash;</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></script></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"> </td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></body></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></html></td></tr></tbody></table>
iframe中介页面agent.html
<table class="prettyprint-table   " style="margin: 0px; padding: 2px; outline: 0px; border: 1px solid rgb(0, 0, 0); width: 984px; color: rgb(238, 238, 238); line-height: 1.5; font-size: 14px; vertical-align: middle; border-spacing: 0px; background-color: rgb(34, 34, 34);"><tbody style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><
 !DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><html
 xmlns="http://www.w3.org/1999/xhtml"></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><head><title>iframe中介页面</title></head></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"> </td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><body></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"> </td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"><script></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">function
 pseth() {</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">var
 iObj = parent.parent.document.getElementById('frame_content');</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">iObjH
 = parent.parent.frames["frame_content"].frames["iframeC"].location.hash;</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">iObj.style.height
 = iObjH.split("#")[1]+"px";</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">}</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;">pseth();</td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></script></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"> </td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></body></td></tr><tr style="margin: 0px; padding: 0px; outline: 0px; border: 0px currentColor; vertical-align: baseline; background-color: transparent;"><td class="source" style="margin: 0px; padding: 2px 4px; outline: 0px; border: 0px currentColor; font-size: 14px; vertical-align: middle; background-color: transparent;"></html></td></tr></tbody></table>
UPDATE：长期以来一直有网友说方案不能跨域，今天我重新又测试了下，确定在IE6、IE7、IE8、IE9、Firefox全系列、Chrome全系列均可以成功跨域控制高度。请注意以下要点
> - 
第一，修改main.html文件中iframe的src地址为需要跨域的域名（比如ccvita.sinaapp.com）
- 
第二，修改iframe.html文件中的urlC值为源域名（比如www.ccvita.com）这点最重要
