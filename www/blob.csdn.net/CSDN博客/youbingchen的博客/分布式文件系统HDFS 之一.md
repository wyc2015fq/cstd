# 分布式文件系统HDFS 之一 - youbingchen的博客 - CSDN博客





2016年06月16日 22:52:36[youbingchen](https://me.csdn.net/youbingchen)阅读数：2585








分布式文件系统在物理结构上是由计算机集群中的多个节点构成的。

# HDFS实现的目标
- 兼容廉价的硬件设备
- 流数据读写
- 大数据集
- 简单的文件模型
- 强大的跨平台兼容性

# HDFS自身的局限性
- 不适合低延时数据访问
- 无法高效存储大量的小文件
- 不支持多用户写入及任意修改文件（只允许追加，不允许修改）

> 
HDFS默认一个块64MB，一个文件被分成多个块，以块作为存储单位，块的大小远远大于普通文件系统，可以最小化寻址开销。 

  + 支持大规模文件存储：文件以块为单位存储，一个大规模文件可以被拆分成若干个文件块，一个文件的大小不会受到单个节点的存储容量的限制，可以远远大于网络中任意节点的存储容量。 

  + 简化系统设计 文件块的大小是固定的，这样就可以很容易计算出一个节点可以存储多少块，方便了元数据的管理，元数据不需要和文件一起存储，可以由其他系统负责管理元数据 

  + 适合数据备份 每个文件块都可以冗余存储到多少个节点，大大提高了系统的容错性和可用性。
# HDFS名称节点和数据节点
|名称节点|数据节点|
|----|----|
|存储元数据|存储文件内容|
|元数据保存在内存中|文件内容保存在磁盘|
|保存文件block，datanode之间的映射关系|维护了block id到datanote本地文件的映射关系|

### HDFS 名称节点
- 在HDFS中，名称节点（NameNode)负责管理分布式系统的命名空间(Namespace),保存了两个核心的数据结构，即是FsImage和EditLog 
- FsImage 用于维护文件系统树以及文件树中所有的文件和文件夹的元数据
- 操作日志文件EditLog中记录了所有针对文件创建、删除、重命名等操作

- 名称节点记录了每个文件中各个块所在的数据节点位置信息。 
![这里写图片描述](https://img-blog.csdn.net/20160616225118905)
#### FsImage文件
- FsImage文件包含文件系统中所有的目录和文件inode的序列化形式，每个 

Inode是一个文件或目录的元数据的内部表示，并包含此类信息：文件的复制等级、修改和访问时间、访问权限、块大小以及组成文件的块，对于目录、则存储修改时间、权限和配额元数据
- FsImage文件没有记录块存储在哪个数据节点，而是由名称节点把这些映射保留在内存中，当数据节点加入HDFS集群中，数据节点会把自己所包含的块列表告知名称节点，此后会定期执行这种告知操作，以确保名称节点的映射是最新的。

#### 名称节点的启动
- 名称节点启动的时候，它会将FsImage文件中的内容加载到内存中。之后再执行EditLog文件各项操作，使得内存中的元数据和实际的同步，存在内存中的元数据支持客户端的读操作
- 一旦内存中成功创建文件系统元数据的映射，则创建一个新的FsImage文件和一个空的EditLog文件
- 名称节点起来之后，HDFS中的更新操作会重新写到EditLog文件中，FsImage文件一般都很大（GB），如果所有的更新操作都往FsImage文件中添加，这样会导致系统运行的十分 缓慢，但是如果往EditLog文件里面添加就不会这样，因为EditLog要小的多，每次执行操作之后，且在向客户端发送成功的代码之前，edits文件都需要同步更新。

##### EditLog不断变大的问题
- 在名称节点运行期间，HDFS的所有更新操作都是直接到EditLog，一段时间之后，EditLog文件会变得很大
- 虽然这对名称节点运行时候没有什么明显影响，但是，当名称节点重启时候，名称节点需要先将FsImage里面的所有内容映象到内存，然后一条一条地执行EditLog中的记录，当EditLog文件非常大的时候，会导致名称节点启动操作会非常的慢。 
**解决方案:secondaryNameNode 第二名称节点**

#### 第二名称节点如何工作的
- 第二名称节点会定期和NameNode通信，请求其停止使用EditLog,暂时将新的写操作到一个新的文件edit.new上来，这个操作是瞬间完成的。
- SecondaryNameNode 通过HTTP Get方式从NameNode上获取到FsImage和EditLog文件并下载到本地目录
- 将下载下来的FsImage 和EditLog加载到内存中这个过程就是FsImage和EditLog的合并
- 执行完上一步操作，会通过post方式将新的FsImage文件发送NameNode上。
- secondaryNamenode 会将新接收到的FsImage替换掉旧的，同时将edit.new替换EditLog，这样EditLog就会变小。 
![这里写图片描述](https://img-blog.csdn.net/20160616225149998)
![这里写图片描述](https://img-blog.csdn.net/20160616225159483)






