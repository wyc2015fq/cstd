# 视频会议系统——多分屏 - yixianfeng41的专栏 - CSDN博客
2016年09月13日 17:48:52[第2梦](https://me.csdn.net/yixianfeng41)阅读数：3971
2*2屏幕：
![](https://img-blog.csdn.net/20160913170059070)
3*3屏幕：
![](https://img-blog.csdn.net/20160913170104994)
4*4屏幕：
![](https://img-blog.csdn.net/20160913170109382)
布局可以按照自己个性岁意思设计，你可以设计成1*2,1*5或者其他你喜欢的样式.
系统页面开发用的是QT,这个多分屏主要数据类型有两个VideoFerame,MeetingPlaceWidget,这是我简化后，保留的两个主要数据类型，通过整两个类就可以实现如上面的效果，但是在实际运用中，涉及到多屏幕，多分屏，以及数据流等，肯定还需要封装以及定义其他类结构。 
1、VideoFrame
图片中每一个小块是一个VideoFrame,这个VideoFrame继承自QFrame.,他的属性应该包含所在屏幕，所在屏幕位置，视频流实际高度，视频流实际宽度，视频流大小，没接收东西显示的图片等。
2、MeetingPlaceWidget
接着需要定义一个代表每一个屏幕的类，比如定义为MeetingPlaceWidget，这个各个画面的布局显示，也就是决定到底是以2*2,还是3*3等。
一些主要代码如下：
定义布局格式数据结构
```cpp
enum ConfRoomDisplayModel
{
    CF_DM_UNKNOWN = -1,     //未知布局
    CF_DM_1X1,
    CF_DM_2X2,
    CF_DM_3X3,
    CF_DM_L3X3,				//采用3X3的布局，左上角为大屏
    CF_DM_ALL,
    CF_DM_L4X4,				//采用4X4的布局，左上角为大屏
    CF_DM_L5X5,				//采用5X5的布局，左上角为大屏
    CF_DM_L1_5,				//采用3X3的布局，左上角为大屏
    CF_DM_L1_20,			//在1_5的基础上将第一个屏幕之外的所有窗口改成4个
    CF_DM_1X1_REAL,			//仍然采用的是1X1布局，但是根据视频流的实际大小显示视频窗口
    CF_DM_DOC,				//文档阅读布局
    CF_DM_AUTO,             //采用自动布局
    CF_DM_TOP_1_2,          //在屏幕的上半部显示1X2的布局
    CF_DM_4X4,              //采用4X4的布局，共16路
    CF_DM_AIRPLAY,
    CF_DM_3X1,
};
```
接下来实现各个布局,我们用一个类型为VideoFrame的链表保存各个块，然后进行布局。
2*2：
```cpp
void MeetingPlaceWidget::size2And2()
{
    if (_displayModel == CF_DM_2X2) return;
	if (MeetingPlaceWidget::_displayModel != CF_DM_2X2)
	{
        for (int i=0;i<memberFrames.size();i++)
        {
            memberFrames[i]->hide();
        }
		int i;
		for (i=0;i<4;i++)
		{
            int r = i/2;
            int c = i%2;
            mainLayout->addWidget(memberFrames[i],r,c);
            memberFrames[i]->show();
		}
        widget->setLayout(mainLayout);
		_ui->scrollArea->setWidget(widget);
	}
	_displayModel = CF_DM_2X2;
}
```
3*3：
```cpp
void MeetingPlaceWidget::size3And3()
{
    if (_displayModel == CF_DM_3X3) return;
    for (int i=0;i<memberFrames.size();i++)
    {
        memberFrames[i]->setHidden(true);
    }
    int i;
    for (i=0;i<9;i++)
    {
        memberFrames[i]->setVisible(true);
        int r = i/3;
        int c = i%3;
        mainLayout->addWidget(memberFrames[i],r,c);
    }
    widget->setLayout(mainLayout);
    _ui->scrollArea->setWidget(widget);
    _displayModel = CF_DM_3X3;
}
```
4*4：
```cpp
void QtMeetingPlaceWidget::sizeL4And4()
{
    if (_displayModel == CF_DM_L4X4) return;
	int i;
	for (i=0;i<8;i++)
	{
		memberFrames[i]->setVisible(true);
	}
	for (i=8;i<memberFrames.size();i++)
	{
		memberFrames[i]->setHidden(true);
	}
	mainLayout->addWidget(memberFrames[0],0,0,3,3);
	mainLayout->addWidget(memberFrames[1],0,3);
	mainLayout->addWidget(memberFrames[2],1,3);
	mainLayout->addWidget(memberFrames[3],2,3);
	mainLayout->addWidget(memberFrames[4],3,0);
	mainLayout->addWidget(memberFrames[5],3,1);
	mainLayout->addWidget(memberFrames[6],3,2);
	mainLayout->addWidget(memberFrames[7],3,3);
    widget->setLayout(mainLayout);
    _ui->scrollArea->setWidget(widget);
    _displayModel = CF_DM_L4X4;
}
```

