# java多线程并发编程之一synchronized - A784586的专栏：任何事都存在 Plan B ！ - CSDN博客





2017年04月02日 23:51:24[QuJack](https://me.csdn.net/A784586)阅读数：398








java多线程并发编程之一synchronized


本文总结适合有一定基础的读者。

java多线程---synchronized同步方法

1.方法内的变量不存在非线程安全问题；因为方法内的变量都是私有的；

2.两个线程同时操作业务对象中的实例变量，可能出现非线程安全问题；

3.两个线程分别访问两个实例的相同名称的同步方法时，效果是异步执行的，因为两个对象拥有两个对象锁；

4.A持有某个对象的锁，B可以访问该对象中的其他非同步方法，B如果访问该对象中的其他同步方法则阻塞；

5.脏读：由于赋值的时候进行了同步，读取的时候没有同步；

6.synchronized锁支持重入：synchronized修饰的方法中调用另外个synchronized修饰的方法或者递归的synchronized修饰的方法；

7.出现异常的时候，锁会自动释放；

8.同步不具有继承性，继承的子类中的同名方法任然需要些synchronized关键字；

-----------------------------------------------------------------------------------------------------------------------

java多线程---synchronized同步语句块

synchronized同步方法的弊端：同步方法若任务太长，另外个线程必须等很久。锁的粒度较大。

1.多个并发线程同时访问一个对象中的同步代码块的时候，一个时刻只能执行一个；

2.一个线程访问对象的一个同步块的时候（同步），另外个线程可以访问该对象的非同步块（异步）；

3.同步块synchronized使用的对象监视器是同一个：一个线程访问某个对象的同步代码块，其他线程访问该对象的同步代码块会被阻塞等待；

4.synchronized同步方法和synchronized(this)代码块锁定的都是当前对象，也就是说synchronized方法和synchronized(this)代码块可以同步；

5.将任意对象【实例变量以及方法参数】作为对象监视器：不同对象监视器之间可以异步，更灵活；

6.synchronized加到static静态方法上是给Class类上锁，加到非静态方法上是给对象上锁；

7.synchronized+static效果跟dsynchronized(Object.class){ }一致；

8.一个类A的两个对象，分别调用非静态同步方法A（），B（）。肯定是异步的。因为这个时候是两把锁，如果类A里面这两个同步的方法同时是静态的，那么纵使是两个对象分别调用方法A
 （），B（），任然可以达到同步的效果；对象锁范围更小，类锁跟对象锁异步。

精简实例：一个对象的三个同步方法。三个线程分别调用其中的一个方法；

A：Class锁 依次输出A1 A2 -----------synchronized+static方法

B：Class锁 依次输出B1 B2 -----------synchronized+static方法

C： 对象锁 依次输出C1 C2 -----------synchronized 方法

输出：A1 C1 C2 A2 B1 B2





9.synchronized代码块都不使用String作为锁对象，JVM具有String类的常量池缓存功能；

10.两个同步方法，其中一个无限循环，另外个就没有机会再执行了。用同步块用不同对象锁，就不会阻塞另外个方法块处理。

11.实现死锁：嵌套获交叉取锁实现死锁的状态；

synchronized(object1){synchronized(object2){...} }

synchronized(object2){synchronized(object1){...} }

查看：

jps

jstack -l 3244(Run的id)

12.内置类；

PrivateClass pc=PublicClass.new PrivateClass();

静态内置类；

PrivateClass pc=new PrivateClass();

使用同一个锁同步，使用不同的锁异步；

13.多个线程同时持有相同锁对象那就是同步，如果分别获得锁就是异步，注意锁对象的改变。锁对象仅仅是属性改变，不影响。



----------------------------------------------------------------------------------

多线程的程序一般框架：

一个类A，用于生成对象a，a中包含多个的同步方法或者同步块；

线程类ThreadA，线程类ThreadB；含有一个A类型的私有变量,构造函数中对其赋值；Run中调用a中的同步方法；

测试程序：将类A的对象a通过构造函数给ThreadA/ThreadB的A类型的成员，启动线程。






