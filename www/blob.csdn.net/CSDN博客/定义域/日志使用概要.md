# 日志使用概要 - 定义域 - CSDN博客
2015年09月10日 12:38:18[定义域](https://me.csdn.net/u010278882)阅读数：255标签：[bug																[facility](https://so.csdn.net/so/search/s.do?q=facility&t=blog)](https://so.csdn.net/so/search/s.do?q=bug&t=blog)
个人分类：[架构](https://blog.csdn.net/u010278882/article/category/5804917)
> 
说明：下文仅是从整体上描述程序的通用基础设施——“日志”，具体使用时应用文中描述的规则。
# 作用
提供分析问题的必要信息。
bug分析，异常分析，性能统计，数据分析等。
# 记录日志
```
记录要解决的问题是记录什么以及如何记录。
```
因为日志的主要用途是分析issue（问题），需要为读者提供必要的信息以解决问题，并且仅提供**必要**的信息。此外，过度的日志会降低系统性能。所以，日志内容要做到“**必要、可理解、可执行**”。
- 仅对必要的信息（详见日志分级）进行日志，如果能不记录就不记，防止日志信息量过大。
- 日志内容必须可被理解，所以需要提供必要的上下文。比如记录分析常常用到的 ThreadId、UserId。
- 日志内容不仅是提供信息，更重要的是引发读者修复问题的行为。
```bash
不要使用 "FileNotFoundException caught"
使用 "FileNotFoundException caught while attempting to open config file:/usr/local/app/somefile.txt UserId = 123 ThreadId = 123"
(说明了发生的操作内容、引发操作的主体)
```
为了达到 1 的要求，工程中使用信息分类的方式（即日志分级） 
通常采用五级分类：error（错误）、warn（警告）、info（信息）、debug（调试）、trace（跟踪）。
## 日志分级
**error**
> 
发生的事件是错误（程序逻辑错误或者商业逻辑错误）
事件结果 
  从用户的角度看，影响用户使用，用户无法完成预期的任务 
  从程序本身看，程序导致数据丢失，并进入不可恢复状态 
  从程序员的角度看，该事件需要立即修复，并且修复需要人工干预
典型场景 
- 卸载应用错误 
- 手机重置错误 
- 邮件无法发送 
- 页面无法渲染 
- 数据保存失败 
- 数据库连接超时
> 
说明
在采用分层架构的架构方法中，对于不同层次的边界访问，比如数据库访问，决定了系统的工作状态。所以，对于该类信息的日志，无论正常与否均进行记录。异常是使用warn 级别，正常使用 info 级别。
**warn**
> 
发生的事件是错误（程序逻辑错误或者商业逻辑错误）
事件结果 
  从用户的角度看，用户仍然能够使用 
  从程序本身看，程序数据没有丢失，程序状态在没有人工干预情况下恢复 
  从程序员的角度看，该事件可能演变为error，所以需要修复
典型场景 
- 配置文件丢失，但仍然可以使用默认配置 
- 页面没有找到，但是有默认页面显示（404并回到主界面） 
- 价格计算为负值，但是最终计算结果为0
**info**
> 
发生的事件是系统正常流程 
  记录的事件是能够在应用范围内产生较广影响的事件 
  记录的信息从较高层面上反映系统状态
典型场景 
- 系统生命周期事件：系统的启动、关闭 
- 会话生命周期事件：登录、登出 
- 边界事件（系统不同层次间的访问）：数据库调用、远程API调用 
- 登录失败（由于非法授权）
**debug**
> 
发生的事件是正常且重要的 
  （代码级别）通常的做法是在重要方法的首行（和执行完成行）添加日志
典型场景 
- 用户来到站点 
- 页面渲染成功 
- 订单下单完成 
- 价格更新成功
**trace**
记录程序流程，通常不使用
### 比较
- error 和 warn 记录的都是系统错误情况，通常与异常相关（程序异常和商业逻辑异常） 
其中，error 会影响用户使用，warn 不影响用户使用。
- info 和 debug 记录的都是系统正常工作情况，并且记录的不是非常详尽的信息，而是较高层面上能够反映系统状态的信息。 
其中，info 比 debug 的信息更加全局，debug 的信息会更加详细，但也还是全局的和重要的。
# 使用日志
使用日志要解决的问题是如何利用日志。
- 
我们会如何使用不同级别的日志信息： 
a. error 级别的错误将驱动bug修复 
b. warn 级别的错误很可能演变成 error 级别的错误，需要考虑修复 
c. info 级别的错误作为issue（问题）分析的主要上下文数据 
d. debug 级别的错误可能系统性能分析或者其他分析行为，比如用户行为分析
- 
日志信息应该如何使用： 
a. 保存：日志信息保存在文件中 
b. 显示：error 和 warn 的信息由于需要即时分析，所以通常还需要显示在 console中 
c. 上传：error 和 warn 的信息需要上传到数据分析服务器中以进行分析
