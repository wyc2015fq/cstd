# 以非泛型方式调用泛型方法 - weixin_33985507的博客 - CSDN博客
2007年02月28日 23:35:00[weixin_33985507](https://me.csdn.net/weixin_33985507)阅读数：5
通过泛型方法定义具有特定类型意义的方法是常用的手段。但在某些特定情况下，例如在一些通用的框架中，直到运行时才能确定泛型类型参数，就必须通过非泛型方式来调用泛型方法。
假定有这样一个方法：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)publicstaticvoid Add<T>(T obj, IList<T> list)
![ExpandedBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)![ContractedBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)      list.Add(obj);
![ExpandedBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif)}
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)
如果想换成这样调用：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)Add(Type type, object obj, object list)；
通常的方法是这样的：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)void Add(Type type, object obj, object list)
![ExpandedBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)![ContractedBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)    MethodInfo mi =typeof(MyType).GetMethod("Add");
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)    MethodInfo gmi = mi.MakeGenericMethod(type);
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)    gmi.Invoke(newobject[] ![dot.gif](https://www.cnblogs.com/Images/dot.gif){ obj, list });
![ExpandedBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif)}
当然，除了性能上的问题，这个方案是完全可行的。但是经过测试，通过这种包装后的耗时比直接的泛型调用相差将近1000倍。因此还需要一些折中一点的方案。为此，我请教了装配脑袋。他给出了一个非常好的方案：
先定义一个泛型包装委托：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)publicdelegatevoid GM<T>(T obj, IList<T> list);
然后再定义一个非泛型包装的接口：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)interface ING
![ExpandedBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)![ContractedBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)void NGM(object obj, object list);
![ExpandedBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif)}
然后再实现这个接口，在实现类中直接调用传入的泛型委托：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)publicclass GClass<T> : ING
![ExpandedBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)![ContractedBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)private GM<T> m_gmd;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)public GClass(GM<T> gmd)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)        m_gmd = gmd;
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)INGClass 成员#region INGClass 成员
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)publicvoid NGM(object obj, object list)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)        m_gmd((T)obj, (IList<T>)list);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)#endregion
![ExpandedBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif)}
然后就可以非常简单地使用已有的泛型方法来获得一个非泛型接口实现了：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)static ING GetNGC(Type genericType, Type methodType, string methodName)
![ExpandedBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)![ContractedBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)    MethodInfo mi = methodType.GetMethod(methodName);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)    MethodInfo gmi = mi.MakeGenericMethod(genericType);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)    Delegate gmd = Delegate.CreateDelegate(typeof(GM<>).MakeGenericType(genericType), gmi);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)return Activator.CreateInstance(typeof(GClass<>).MakeGenericType(genericType), gmd) as ING;
![ExpandedBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif)}
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)
通过执行所返回接口的非泛型方法来达到调用泛型方法的目的：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)ING ng = GetNGC(typeof(int), typeof(MyType), "Add");
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)ng.NGM(i, list);
比对一下，耗时大约是直接泛型调用耗时的三倍。显然这个方案是一个非常实用的方案。归纳一下，一共需要四步：
- 定义泛型委托；
    
- 定义非泛型接口；
    
- 实现这个接口；
    
- 通过泛型委托获取非泛型接口的实现。 
其中前两步比较简单，后两部稍嫌麻烦。于是，我们再进一步实现一个通用的接口实现及其输出。
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System.Collections.Generic;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System.Reflection;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System.Reflection.Emit;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System.Text;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)namespace GenericMethodTest
![ExpandedBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)![ContractedBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)/**////<summary>
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)/// 接口生成器
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)///</summary>
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)internalstaticclass InterfaceGenerator
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)privatestatic Random _Random =new Random();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)privatestaticchar GetRandomLetter()
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)int i = (_Random.Next() %26) +97;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)byte[] b = BitConverter.GetBytes(i);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)return BitConverter.ToChar(b, 0);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)privatestaticstring GetRandomString(int n)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)char[] chars =newchar[n];
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)for (int i =0; i < n; i++)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                chars[i] = GetRandomLetter();
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)returnnewstring(chars);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)privatestaticvoid LoadArg(ILGenerator gen, int index)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)switch (index)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)case0:
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                    gen.Emit(OpCodes.Ldarg_0);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)break;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)case1:
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                    gen.Emit(OpCodes.Ldarg_1);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)break;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)case2:
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                    gen.Emit(OpCodes.Ldarg_2);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)break;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)case3:
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                    gen.Emit(OpCodes.Ldarg_3);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)break;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)default:
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (index <128)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                        gen.Emit(OpCodes.Ldarg_S, index);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                    }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)else
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                        gen.Emit(OpCodes.Ldarg, index);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                    }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)break;
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)publicstatic T GetInterface<T>(Delegate GM)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (typeof(T).IsInterface)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                Type delegateType = GM.GetType();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (delegateType.IsGenericType)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (typeof(MulticastDelegate).IsAssignableFrom(delegateType.GetGenericTypeDefinition()))
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                        Type[] genericTypes = delegateType.GetGenericArguments();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (genericTypes.Length ==1)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            Type genericType = genericTypes[0];
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#if SAVE
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)string theFilename ="InterfaceGenerator.Attachments.dll";
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#endif
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            AssemblyName aname =new AssemblyName();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            aname.Name =string.Format("InterfaceGenerator.Attachments.{0}", GetRandomString(16));
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            aname.Version =new Version("2.0.0.0");
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            AssemblyBuilder assembly = AppDomain.CurrentDomain.DefineDynamicAssembly(aname,
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#if SAVE
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif) AssemblyBuilderAccess.RunAndSave
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#else
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif) AssemblyBuilderAccess.Run
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#endif
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif));
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            ModuleBuilder module = assembly.DefineDynamicModule(GetRandomString(8)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#if SAVE
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif), theFilename
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#endif
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif));
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            TypeBuilder builder = module.DefineType(GetRandomString(16), TypeAttributes.Sealed | TypeAttributes.Class | TypeAttributes.Public);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            builder.AddInterfaceImplementation(typeof(T));
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)// 先定义成员域，用于保存传入的委托。
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            FieldBuilder field = builder.DefineField(GetRandomString(8), delegateType, FieldAttributes.Private);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)// 定义构造器。
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)                            ConstructorBuilder ctor = builder.DefineConstructor(MethodAttributes.Public, CallingConventions.Standard, new Type[] ![dot.gif](https://www.cnblogs.com/Images/dot.gif){ delegateType });
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            ILGenerator ctorGen = ctor.GetILGenerator();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            ctorGen.Emit(OpCodes.Ldarg_0);
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)                            ctorGen.Emit(OpCodes.Call, typeof(object).GetConstructor(new Type[] ![dot.gif](https://www.cnblogs.com/Images/dot.gif){ }));
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            ctorGen.Emit(OpCodes.Ldarg_0);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            ctorGen.Emit(OpCodes.Ldarg_1);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            ctorGen.Emit(OpCodes.Stfld, field);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            ctorGen.Emit(OpCodes.Ret);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)// 虽然这么写，但事实上接口只有一个方法。
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)foreach (MethodInfo bmi intypeof(T).GetMethods())
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                ParameterInfo[] paramInfos = bmi.GetParameters();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                Type[] argTypes =new Type[paramInfos.Length];
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)int i =0;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)foreach (ParameterInfo pi in paramInfos)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                    argTypes[i++] = pi.ParameterType;
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                                }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                MethodAttributes attributes = MethodAttributes.HideBySig | MethodAttributes.Virtual | MethodAttributes.ReuseSlot | MethodAttributes.Public;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                MethodBuilder method = builder.DefineMethod(bmi.Name, attributes, bmi.ReturnType, argTypes);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                builder.DefineMethodOverride(method, bmi);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                MethodInfo dmi = delegateType.GetMethod("Invoke");
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                ILGenerator methodGen = method.GetILGenerator();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)bool hasReturn =false;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (dmi.ReturnType !=typeof(void))
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                    methodGen.DeclareLocal(dmi.ReturnType);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                    hasReturn =true;
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                                }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                methodGen.Emit(OpCodes.Ldarg_0);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                methodGen.Emit(OpCodes.Ldfld, field);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                i =0;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)foreach (ParameterInfo pi in dmi.GetParameters())
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                    LoadArg(methodGen, i +1);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (!pi.ParameterType.IsAssignableFrom(argTypes[i]))
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (argTypes[i].IsClass)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                            methodGen.Emit(OpCodes.Castclass, pi.ParameterType);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                                        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)else
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                            methodGen.Emit(OpCodes.Unbox, pi.ParameterType);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                                        }
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                                    }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                    i++;
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                                }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                methodGen.Emit(OpCodes.Callvirt, dmi);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)if (hasReturn)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                    methodGen.Emit(OpCodes.Stloc_0);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                    methodGen.Emit(OpCodes.Ldloc_0);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                                }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                                methodGen.Emit(OpCodes.Ret);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            Type target = builder.CreateType();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#if SAVE
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                            assembly.Save(theFilename);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)#endif
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)                            ConstructorInfo ci = target.GetConstructor(new Type[] ![dot.gif](https://www.cnblogs.com/Images/dot.gif){ delegateType });
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)return (T) ci.Invoke(newobject[] ![dot.gif](https://www.cnblogs.com/Images/dot.gif){ GM });
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                        }
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                    }
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)                }
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)returndefault(T);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![ExpandedBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif)}
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)
结论：
以下是测试代码：
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System.Collections.Generic;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System.Reflection;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)using System.Text;
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)namespace GenericMethodTest
![ExpandedBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)![ContractedBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)// 为泛型方法定义的委托
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)publicdelegatevoid GM<T>(T obj, IList<T> list);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)// 为非泛型方法定义的接口
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)publicinterface ING
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)void NGM(object obj, object list);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)class Program
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)staticvoid Main(string[] args)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            List<int> list =new List<int>();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            System.Diagnostics.Stopwatch watch =new System.Diagnostics.Stopwatch();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Reset();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Start();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)for (int i =0; i <1000000; i++)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                list.Add(i);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Stop();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)long l1 = watch.ElapsedMilliseconds;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Reset();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Start();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            GM<int> gm =new GM<int>(Program.Add);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)for (int i =0; i <1000000; i++)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                gm(i, list);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Stop();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)long l2 = watch.ElapsedMilliseconds;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Reset();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Start();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            MethodInfo mi =typeof(Program).GetMethod("Add");
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            MethodInfo gmi = mi.MakeGenericMethod(typeof(int));
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)for (int i =0; i <1000000; i++)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)                gmi.Invoke(null, newobject[] ![dot.gif](https://www.cnblogs.com/Images/dot.gif){ i, list });
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Stop();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)long l3 = watch.ElapsedMilliseconds;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Reset();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Start();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            ING ng1 = GetNGC(typeof(int), typeof(Program), "Add");
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)for (int i =0; i <1000000; i++)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                ng1.NGM(i, list);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Stop();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)long l4 = watch.ElapsedMilliseconds;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Reset();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Start();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            ING ng2 = InterfaceGenerator.GetInterface<ING>(new GM<int>(Program.Add));
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)for (int i =0; i <1000000; i++)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)                ng2.NGM(i, list);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            watch.Stop();
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)long l5 = watch.ElapsedMilliseconds;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            Console.WriteLine("{0}\n{1} vs {2} vs {3} vs {4} vs {5}", list.Count, l1, l2, l3, l4, l5);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            Console.ReadLine();
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)publicstaticvoid Add<T>(T obj, IList<T> list)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            list.Add(obj);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)static ING GetNGC(Type genericType, Type methodType, string methodName)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            MethodInfo mi = methodType.GetMethod(methodName);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            MethodInfo gmi = mi.MakeGenericMethod(genericType);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            Delegate gmd = Delegate.CreateDelegate(typeof(GM<>).MakeGenericType(genericType), gmi);
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)return Activator.CreateInstance(typeof(GClass<>).MakeGenericType(genericType), gmd) as ING;
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)publicclass GClass<T> : ING
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)private GM<T> m_gmd;
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)public GClass(GM<T> gmd)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            m_gmd = gmd;
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)INGClass 成员#region INGClass 成员
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)publicvoid NGM(object obj, object list)
![ExpandedSubBlockStart.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif)![ContractedSubBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif)![dot.gif](https://www.cnblogs.com/Images/dot.gif){
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)            m_gmd((T)obj, (IList<T>)list);
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![InBlock.gif](https://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif)
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)#endregion
![ExpandedSubBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![ExpandedBlockEnd.gif](https://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif)}
![None.gif](https://www.cnblogs.com/Images/OutliningIndicators/None.gif)
测试结果：
|方案|耗时|比对|其他优点|
|----|----|----|----|
|直接调用|18|1|不通用|
|泛型委托包装|43|2.39|不通用|
|反射|16538|918.78|通用，不需额外定义|
|非泛型接口包装|60|3.33|通用，需要额外定义并实现|
|动态生成的非泛型接口包装|72|4|通用，需要额外定义|
