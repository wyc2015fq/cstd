# TCP的三次握手和四次挥手之三次握手真的能保证传输可靠吗？ - aiaiai010101的博客 - CSDN博客

2018年10月31日 15:15:43[aiaiai010101](https://me.csdn.net/aiaiai010101)阅读数：91


之前分析过为什么要三次握手，因为两次握手不可靠。

比如 

A告诉B打算建立连接，可能过了很久B才收到这个消息，B表示同意并发了个确认消息给A，这时两次握手了，倘若连接建立了，那么很可能A早已关闭连接，而B以为连接已经建立(遵循两次握手建立连接的原则)，B就傻等A，浪费资源(该例中A是客户端,B是服务器)。

这个例子常常用来说明两次握手不可靠，那么难道三次握手就可靠吗？

当A收到来自B的确认消息决定发个反馈，也就是第三次握手给B，倘若这时B的网络出了故障或者B关闭连接了或者这消息传输过程丢失了。那么根据三次握手原则，连接建立，对A来说，自是如此，然而对B只经历了两次握手，连接尚未建立。或者B收到了第三次握手，但此时已距离第二次握手过去很久了，那么B以为建立了连接，A却早已关闭连接。此时连接也没有建立成功。

看的出来，三次握手也不能保证连接就可靠，那么追加第四次握手呢？一样的，因为每次握手都是对收到上次握手的确认，却不能保证本次握手就能顺利到达。换句话说，握手发出的那一刻，只能说明上一次消息传递是顺畅的，却不能保证现在网络是畅通的。

所以陷入死循环，无论多少次握手，严格意义上来说都不能保证建立可靠连接。

那么三次握手的意义何在？

它的意义就在于让双方都知道“对方能收到自己的消息，同时自己能收到对方”的消息，也就是说线路是双向通顺的。当然了，这个双向通顺严格来说只限于之前的时间，接下来的时间就不能保证了。

四次乃至更多的握手也只能说明每次最新握手之前双方是通顺的，握手发出之后的时间也不能保证，本质上这与三次握手一样。

而两次握手只能让一方知道自己能收到消息，与三次乃至更多次握手不一样。

**所以，三次握手比两次更可靠，但也不是完全可靠，而追加更多次握手也不能使连接更可靠了。因此选择了三次握手。**

**总的来说：**

**世界上不存在完全可靠的通信协议。从通信时间成本空间成本以及可靠度来讲，选择了“三次握手”作为点对点通信的一般规则。**

**后记：**

**本篇纯粹是我自己对三次握手的看法，它是所能找到的最可靠的方案里代价最低的，尽管它也不能保证一定可靠，因为严格意义上来说，多少次握手都不能保证建立可靠连接。**

**之所以写此篇，是因为我始终感觉三次握手亦有缺陷，故上网查资料，看到知乎上一些回答，深得我心。贴上来：**

1.

作者：月迷津渡DaraW

链接：https://www.zhihu.com/question/24853633/answer/115379350

来源：知乎

著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

先来解释下题目中描述的问题，我想题主想问的应该是“**TCP建立握手时为什么是三次握手而不是二次握手或者四次握手**”，结论当然是二次握手和四次握手也都是可以的，那么为什么是三次呢？

这是个经典的“**两军通信**”问题，假设场景是这样的：

在山的两头是红军1和红军2，山上是蓝军，红军1和2都不是蓝军的对手，想打败蓝军只有一起动手。那么红军1和2如何通信才能确定双方在同一个时间动手呢？

红军1的传令军成功偷偷越过大山告诉红军2，明天早上中午十二点一起动手；

红军2表示赞同，但是红军1并不确定红军2是否收到了消息，贸然动手必定失败，所以红军2的传令军越过大山告诉红军1收到了消息；

但是这时候红军2并不确定传令军是否成功到达红军1告诉红军1收到了消息，不敢独自动手，所以红军1只好再次派出传令军，告诉红军2我们知道你们收到消息了；

问题又来了，红军1不知道传令是否成功，只有等待红军2的确认并不敢动手，红军2也只能再次派出传令军。。。

最后陷入了一个死循环，那么根本问题就暴露了：**永远都不能完美的达成协议，**而这正是一个一个重要的通信道理：**世界上不存在完全可靠的通信协议**。

从通信时间成本空间成本以及可靠度来讲，选择了“三次握手”作为点对点通信的一般规则。

2.

这个问题在谢希仁版《计算机网络》里说了。

三次是保证双方互相明确对方能收能发的最低值。

理论上讲不论握手多少次都不能确认一条信道是“可靠”的，但通过3次握手可以至少确认它是“可用”的，再往上加握手次数不过是提高“它是可用的”这个结论的可信程度。

3.

看了很多答案，只有一个答案提到“两军问题”，其他的答案，长篇累牍或者抖机灵感觉都没回答到点子上。

其实两次四次四十次，在工程上都是可以接受的。如果让我设计一个非常重要，对可靠性要求很高的通讯协议，我也完全可能采用更多次握手的设计。亦或者涉及对实时性要求很高的通讯，也完全可以设计成不握手（udp）的协议。

TCP之所以使用三次握手，完全是一种为了解决“两军问题”所采用的折衷的设计。

所谓“两军问题”，就是红军想告诉蓝军明天下午一起对敌开火，那么红军会派信使1号跑过去告诉蓝军，蓝军收到消息再派信使2号告诉红军收到，注意，这时蓝军并不知道红军是否收到蓝军的回复。因此需要红军收到回复再派信使3号告诉蓝军收到回复，而此时红军也不知道蓝军是否收到回复，因此蓝军收到信使3号的消息再派信使4号…

可以看到，由于信息有可能丢失，为了保证信息传达的确定性，我们需要进行很多次传递。互相通信的次数越多，那么这个信息传递到的概率就越大。tcp采用三次握手，就是为了尽可能可靠，然而，这也仅是一种选择。

作者：朋克雪球兔

链接：https://www.zhihu.com/question/24853633/answer/200721662

来源：知乎

著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。




