# C++中的函数重复定义问题 - aiaiai010101的博客 - CSDN博客

2017年10月08日 22:20:33[aiaiai010101](https://me.csdn.net/aiaiai010101)阅读数：1521



**本人注释:**

**头文件中直接写函数实现会出现重复定义的错误,但是如果是在类中直接写函数实现就不会出现此错误,原因是两个cpp都包含该头文件,相当于头文件中的同一个函数实现被编译了两次,那么就出现了二义性问题,即调用该函数的地方不知道应该使用哪个函数实现.**

**类中写函数实现就没这个问题,因为会被当成inline函数处理.**

**另外,这与函数重载不一样,函数重载由于特征标的存在编译器能够区分调用哪个实现,其实相当于两个不同的函数,而同一个函数两个实现(哪怕是完全一样的实现)在编译器看来是没法区分开来的,无法知道调用哪个实现,所以出现二义性错误.**

先来做一个实验，你在一个头文件中定义一个类，然后把内中的一个函数的实现写在这个头文件当中。

//A_test.h

#ifndefine _A_TEST_

#define _A_TEST_

class A

{

void test();

};

void A::test()

{

}

#endif

//A_test.cpp

#include A_test.h

//B_test.cpp

#include A_test.h

//C_test.cpp

#include A_test.h

然后在两个B.cpp,C.cpp包含这个头文件，请问能否编译通过。答案是不行的，会报错，所你重复定义函数test()

但是如果你把这个函数定义到class A里面，然后编译就不报错了。

另外如果你把这个函数定义在这个头文件类的外面，但是前面加上inline，也可以通过编译。

除此之外，如果你把这个函数的实现写在另外一个包含这个头文件的cpp文件中，也可以通过编译，这也是最规范的写法。

与此对应，如果你在这个头文件中声明了一个函数，如果直接就在这个头文件中实现，那么除非你把它定义为inline 函数，不然会发生二次定义的错误，当然把一个实现放到一个对应的cpp中，自然不会报错。

在常规理解中，.h只能写声明，cpp写实现。这是很规范 。但是为什么有些库的头文件也把一些类的实现写出来了，有些函数也直接定义在那个头文件中，在很多.cpp中也不断的被包含呢，结果并不报错。举个例子来时，complex.h这个头文件在很多数值.cpp中间都要包含，如果这个头文件中有些函数写了实现，就会报错。

那么究竟如何来理解这种现象呢：

有3点：

1是编译器的唯一命名规则，就是inline函数,class和模板类函数被多次包含的情况下，在编译的时候，编译器会自动把他们认为是同一个函数，不会发生二次定义的问题。前提是他们一模一样。

**2是编译器会把class里面定义的函数当做inline函数，所以直接在类里面实现函数的定义没有关系。由上面的说明，他不会发生二次定义的问题。**

3一般函数的声明和实现分开，在编译的时候，声明可以无数次，但是定义只能一份，只会生成一份函数的.obj，所以有函数调用的地方，编译器必须在调用的地方先保持现场，然后在花点时间去调用函数，然后回来，恢复现场。所以函数在头文件中实现，如果被包含二次。函数的实现就被编译了2次，如果单独写在一个.cpp中间，自然就编译成为一份.obj，不会产生二义性的问题。

3.inline函数在编译的时候直接复制在有该函数的地方，在空间上有消耗，但是在省去了时间上的消耗，是一个模板函数。也就是说在有这些函数的地方都不需要去调用函数，也就不涉及有2种函数可以调用产生的二义性问题。

因此，complex.h这个头文件要被反复包含，要么把所有函数都放到类里面定义，要么全面写在外面，前面加上inline。另外，写成模板类好像也是可以的。

**本文转载自:http://blog.csdn.net/dengm155/article/details/51692285**

