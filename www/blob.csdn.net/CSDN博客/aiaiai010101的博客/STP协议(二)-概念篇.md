# STP协议(二)-概念篇 - aiaiai010101的博客 - CSDN博客

2018年11月06日 16:40:25[aiaiai010101](https://me.csdn.net/aiaiai010101)阅读数：71


一、选举根桥、根端口、指定端口。(注意：不同VLAN的STP的根桥、根端口、指定端口等是分开选举的，即一个vlan一个选举）

1、  选举根桥：比较优先级，再比较MAC地址（为交换机默认VLAN1的MAC地址），最小MAC地址为根桥。根桥交换机所有接口永远不会出现阻塞状态。根桥的所有端口都是指定端口，指定端口被标记为转发端口。

2、选举根端口:按如下顺序选举，满足条件即停止。A、计算非根交换机到达根桥的链路开销；B、比较非根交换机的上行交换机桥ID（由优先级与MAC地址决定）；C、上行交换机的最小端口号所连接的非交换机的端口为根端口。

3、选举指定端口：非根交换机与非根交换机之间连接线的两个端口中必定有一个端口为指定端口，此时比较两个非根交换机的根端口到达根桥的最低链路开销，将最低开销的非根交换机为准，其所在的连接线（为上面非根交换机与非根交换机之间连接线）的端口为指定端口，如果链路开销一样最后比较各自的桥ID即可。指定端口被标记为转发端口。可通过比较发送的BPDU；

4、 选择根端口和指定端口的BPDU帧总是从根桥向外发；

--------------------- 

二、实验例子

![](https://img-blog.csdn.net/20141203232030669?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemFpbndlaTE3NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

1、  选举根桥。优先级一样，switch7的MAC最小，为根桥。

2、  选举根端口。很显然switch4的f0/1为根端口，switch6的f0/2为根端口。对于switch5而言，由于4个端口到达根桥的链路开销都一样，所以要进一步比较上行交换机的桥ID，对比switch4和switch6的桥ID可知，switch6桥ID比较小，那么可以确定switch5的根端口必定与switch6相连的，又由于switch5的f0/15与switch0/18到达根桥的链路开销与桥ID都一样，所以比较对应的上行交换机switch6的端口，f0/8端口号小于f0/15，所以f0/8对应连接端口f0/18为switch5的根端口。

3、  选举指定端口。首先看switch4的f0/12与switch5的f0/3的连接，由于switch4的根端口f0/1到达根桥开销为19，而switch5根端口f0/18达到根桥开销为19+19，可知在switch4的f0/12与switch5的f0/3的连接，以switch4的f0/12为指定端口，从而switch5的f0/3为阻塞端口。同理显然switch4的f0/10为指定端口，switch6的f0/15为指定端口。    再来看看switch4的f0/7与switch6的f0/9的连接，switch4的根端口到根桥开销为19，而switch6的根端口到达根桥开销也为19，所以要进一步比较switch4与switch6的桥ID，显然switch6的桥ID较小，因此switch6的f0/9为指定端口。


四、生成树的工作原理：

生成树协议的国际标准是IEEE802.1b.运行生成树算法的网桥/交换机在规定的间隔 （默认2秒）内通过网桥协议数据单元（BPDU）的组播帧与其他交换机交换配置信息 ，其工作的过程如下：

1、通过比较网桥优先级选取根网桥（给定广播域内只有一个根网桥）。

2、其余的非根网桥只有一个通向根交换机的端口称为根端口。

3、每个网段只有一个转发端口。

4、根交换机所有的连接端口均为转发端口。

注意：生成树协议在交换机上一般是默认开启的，不经人工干预即可正常工作。但这种自动生成的方案可能导致数据传输的路径并非最优化。因此，可以通过人工设 置网桥优先级的方法影响生成树的生成结果。

五、生成树接口的状态：

运行生成树协议的交换机上的端口，总是处于下面四个状态中的一个。在正常操作期间，端口处于转发或阻塞状态。当设备识别网络拓扑结构变化时，交换机自动进 行状态转换，在这期间端口暂时处于监听和学习状态。

阻塞：所有端口以阻塞状态启动以防止回路。由生成树确定哪个端口转换到转发状 态，处于阻塞状态的端口不转发数据但可接受BPDU.

监听：不发送接收数据，接收并发送bpdu，不进行地址学习 （临时状态）。

学习：不接收或转发数据，接收并发送bpdu，开始地址学习MAC地址表（临时状态）。

转发：端口能传送和接收数据。

--------------------- 

