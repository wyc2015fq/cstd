# 堆栈、堆等介绍 - nosmatch的专栏 - CSDN博客
2012年06月12日 21:50:03[nosmatch](https://me.csdn.net/HDUTigerkin)阅读数：534
### C++中，内存分为5个区：1.堆、2.栈、3.自由存储区4.全局/静态存储区和5.常量存储区。栈：是由编译器在需要时自动分配，不需要时自动清除的变量存储区。通常存放局部变量、函数参数等。堆：是由new分配的内存块，由程序员释放（编译器不管），一般一个new与一个delete对应，一个new[]与一个delete[]对应。如果程序员没有释放   掉，资源将由操作系统在程序结束后自动回收。自由存储区：是由malloc等分配的内存块，和堆十分相似，用free来释放。全局/静态存储区：全局变量和静态变量被分配到同一块内存中（在C语言中，全局变量又分为初始化的和未初始化的，C++中没有这一区分）。常量存储区：这是一块特殊存储区，里边存放常量，不允许修改。（注意：堆和自由存储区其实不过是同一块区域，new底层实现代码中调用了malloc，new可以看成是malloc智能化的高级版本）堆与栈的讨论： 管理方式：  堆中资源由程序员控制（容易产生memory leak）。  栈资源由编译器自动管理，无需手工控制。 系统响应：       对于堆，应知道系统有一个记录空闲内存地址的链表，当系统收到程序申请时，遍历该链表，寻找第一个空间大于申请空间的堆结点，删除空闲结点链表中的该结点，并将该结点空间分配给程序（大多数系统会在这块内存空间首地址记录本次分配的大小，这样delete才能正确释放本内存空间，另外系统会将多余的部分重新放入空闲链表中）。  对于栈，只要栈的剩余空间大于所申请空间，系统为程序提供内存，否则报异常提示栈溢出。空间大小：       堆是不连续的内存区域（因为系统是用链表来存储空闲内存地址，自然不是连续的），堆大小受限于计算机系统中有效的虚拟内存（32bit系统理论上是4G），所以堆的空间比较灵活，比较大。  栈是一块连续的内存区域，大小是操作系统预定好的，windows下栈大小是2M（也有是1M，在编译时确定，VC中可设置）。 碎片问题：  对于堆，频繁的new/delete会造成大量碎片，使程序效率降低。  对于栈，它是一个先进后出的队列，进出一一对应，不会产生碎片。生长方向：  堆向上，由低地址向高地址方向增长。  栈向下，由高地址向低地址方向增长。分配方式：      堆都是动态分配（没有静态分配的堆）。      栈有静态分配和动态分配，静态分配由编译器完成（如局部变量分配），动态分配由alloca函数分配，但栈的动态分配的资源由编译器进行释放，无需程序员实现。分配效率：  堆由C/C++函数库提供，机制很复杂。所以堆的效率比栈低很多。  栈是极其系统提供的数据结构，计算机在底层对栈提供支持，分配专门寄存器存放栈地址，栈操作有专门指令。
