# ARP协议 - 深之JohnChen的专栏 - CSDN博客

2007年08月01日 13:23:00[byxdaz](https://me.csdn.net/byxdaz)阅读数：2483


ARP与RARP　内容来源于enet.com

RFC 826 是A R P规范描述文档

ARP，全称Address Resolution Protocol，地址解析协议，它工作在数据链路层，在本层和硬件接口联系，同时对上层提供服务。 

IP数据包常通过以太网发送，以太网设备并不识别32位IP地址，它们是以48位以太网地址传输以太网数据包。因此，必须把IP目的地址转换成以太网目的地址。在以太网中，一个主机要和另一个主机进行直接通信，必须要知道目标主机的MAC地址。但这个目标MAC地址是如何获得的呢？它就是通过地址解析协议获得的。ARP协议用于将网络中的IP地址解析为的硬件地址（MAC地址），以保证通信的顺利进行。 

![](http://x5meghwa.onlyblog.com/UploadFiles/2007-7/70275.52412022.gif)

ARP报文被封装在以太网帧头部中传输:0X0806代表封装的上层协议是ARP协议.

![](http://x5meghwa.onlyblog.com/UploadFiles/2007-7/41553.48889570.jpg)

        硬件类型字段：指明了发送方想知道的硬件接口类型，以太网的值为1； 

　　协议类型字段：指明了发送方提供的高层协议类型，IP为0800（16进制）； 

　　硬件地址长度和协议长度：指明了硬件地址和高层协议地址的长度，这样ARP报文就可以在任意硬件和任意协议的网络中使用； 

　　操作字段：用来表示这个报文的类型，ARP请求为1，ARP响应为2，RARP请求为3，RARP响应为4； 

　　发送方的硬件地址（0-3字节）：源主机硬件地址的前3个字节； 

　　发送方的硬件地址（4-5字节）：源主机硬件地址的后3个字节； 

　　发送方IP（0-1字节）：源主机硬件地址的前2个字节； 

　　发送方IP（2-3字节）：源主机硬件地址的后2个字节； 

　　目的硬件地址（0-1字节）：目的主机硬件地址的前2个字节； 

　　目的硬件地址（2-5字节）：目的主机硬件地址的后4个字节； 

　　目的IP（0-3字节）：目的主机的IP地址。

ARP请求：如果你是这个I P地址的拥有者，请回答你的硬件地址.

ARP的工作原理如下： 

　　1. 首先，每台主机都会在自己的ARP缓冲区 (ARP Cache)中建立一个 ARP列表，以表示IP地址和MAC地址的对应关系。 

　　2. 当源主机需要将一个数据包要发送到目的主机时，会首先检查自己 ARP列表中是否存在该 IP地址对应的MAC地址，如果有﹐就直接将数据包发送到这个MAC地址；如果没有，就向本地网段发起一个ARP请求的广播包，查询此目的主机对应的 MAC地址。此ARP请求数据包里包括源主机的IP地址、硬件地址、以及目的主机的IP地址。 

　　3. 网络中所有的主机收到这个ARP请求后，会检查数据包中的目的IP是否和自己的IP地址一致。如果不相同就忽略此数据包；如果相同，该主机首先将发送端的 MAC地址和IP地址添加到自己的ARP列表中，如果ARP表中已经存在该IP的信息，则将其覆盖，然后给源主机发送一个 ARP响应数据包，告诉对方自己是它需要查找的MAC地址； 

　　4. 源主机收到这个ARP响应数据包后，将得到的目的主机的IP地址和MAC地址添加到自己的ARP列表中，并利用此信息开始数据的传输。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。

![](http://x5meghwa.onlyblog.com/UploadFiles/2007-7/41287.01153472.jpg)

当主机A要和主机B通信（如主机A Ping主机B）时。主机A会先检查其ARP缓存内是否有主机B的MAC地址。如果没有，主机A会发送一个ARP请求广播包，此包内包含着其欲与之通信的主机的IP地址，也就是主机B的IP地址。当主机B收到此广播后，会将自己的MAC地址利用ARP响应包传给主机A，并更新自己的ARP缓存，也就是同时将主机A的IP地址/MAC地址对保存起来，以供后面使用。主机A在得到主机B的MAC地址后，就可以与主机B通信了。同时，主机A也将主机B的IP地址 /MAC地址对保存在自己的ARP缓存内。
![](http://x5meghwa.onlyblog.com/UploadFiles/2007-7/44519.74219294.jpg)

ARP不能通过IP路由器发送广播，所以不能用来确定远程网络设备的硬件地址。对于目标主机位于远程网络的情况，IP利用ARP确定默认网关（路由器）的硬件地址，并将数据包发到默认网关，由路由器按它自己的方式转发数据包。

反向ARP（Reverse ARP，RARP）用于把物理地址（MAC地址）转换到对应的 IP 地址。例如，在无盘工作站启动的时候，因为无法从自身的操作系统获得自己的IP地址配置信息。这时，无盘工作站可发送广播请求获得自己的IP地址信息，而 RARP服务器则响应IP请求消息－为无盘工作站分配1个未用的IP地址（通过发送RARP应答包）。

　　反向ARP（RARP）在很大程度上已被BOOTP、DHCP所替代，后面这两种协议对RARP的改进是可以提供除了IP地址外的其它更多的信息，如默认网关、DNS服务器的IP地址等信息。

RARP的工作原理： 

　　1. 发送主机发送一个本地的RARP广播，在此广播包中，声明自己的MAC地址并且请求任何收到此请求的RARP服务器分配一个IP地址； 

　　2. 本地网段上的RARP服务器收到此请求后，检查其RARP列表，查找该MAC地址对应的IP地址； 

　　3. 如果存在，RARP服务器就给源主机发送一个响应数据包并将此IP地址提供给对方主机使用； 

　　4. 如果不存在，RARP服务器对此不做任何的响应； 

　　5. 源主机收到从RARP服务器的响应信息，就利用得到的IP地址进行通讯；如果一直没有收到RARP服务器的响应信息，表示初始化失败。

![](http://x5meghwa.onlyblog.com/UploadFiles/2007-7/40614.34324213.gif)

代理ARP

代理ARP（PROXY ARP）也被称作混杂ARP（Promiscuous ARP）（RFC 925、1027）一般被像路由器这样的设备使用--用来代替处于另一个网段的主机回答本网段主机的ARP请求。

