# 回调函数中调用类中的非静态成员变量或非静态成员函数 - xqhrs232的专栏 - CSDN博客
2013年11月14日 21:51:17[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：948
原文地址::[http://www.2cto.com/kf/201303/198554.html](http://www.2cto.com/kf/201303/198554.html)
相关网帖
1、[C++中使用成员函数作为函数参数的方法](http://www.cppblog.com/gaimor/archive/2010/02/23/108294.html)----[http://www.cppblog.com/gaimor/archive/2010/02/23/108294.html](http://www.cppblog.com/gaimor/archive/2010/02/23/108294.html)

回调函数中调用类中的非静态成员变量或非静态成员函数
【问题】如何在类中封装回调函数？
  a.回调函数只能是全局的或是静态的。
 b.全局函数会破坏类的封装性，故不予采用。
 c.静态函数只能访问类的静态成员，不能访问类中非静态成员。
 1. 如何让静态函数访问类的非静态成员。
     a.声明一静态函数a()，将类实例对象指针做为参数传入。如：
  class A()
  {
      static void a(A *); //静态函数
      void b();  //非静态函数
  } 
  void A::a(A * pThis)
  {
   pThis->b(); //静态函数中调用非静态函数
  }
     b.回调函数中访问非静态成员
  由于回调函数往往有固定定义，并不接受  A * pThis 参数
  如：CALLBACK MyTimerProc(HWND hwnd,UINT uMsg,UINT idEvent,DWORD dwTime);
        【解决方案1】：本方案当遇到有多个类实例对象时会有问题。原因是pThis指针只能指向一个对象。
  class A
{
    A();
    static void a();//静态函数
    void b();//非静态函数
    static A* pThis;//静态对象指针
};
A* A::pThis=NULL;
A::A()//构造函数中将this指针赋给pThis,使得回调函数能通过pThis指针访问对象
{
    pThis = this;
}
void A::a()//
{
    if(pThis==NULL)
        return ;
    pThis->b();//回调函数中调用非静态成员函数
}
void A::b()
{
}
  【解决方案2】：本方案解决多个类实例对象时方案1的问题。用映射表存所有对象地址，每个对象保存自己的ID号。
  typedef CMap<UINT,UINT,A*,A*> CAMap;
  class A()
  {
      static void a(); //静态回调函数
      void b();  //非静态函数
      int m_ID;  //本对象在列表中的ID号
      static int m_SID;   //静态当前对象ID        (需要时，将m_ID赋值给m_SID以起到调用本对象函数的功能)
      static CAMap m_Map; //静态对象映射表
  } 
  CAMap A::m_Map;
  int   A::m_SID=0;
  A::A()   //构造函数中将this指针赋给pThis，使得回调函数能通过pThis指针访问本对象
  {
      if(m_Map.IsEmpty())
      {
   m_ID=1;
      }
      else
      {
        m_ID=m_Map.GetCount()+1;
      }
      m_Map.SetAt( m_ID, this );
  }
  void A::a()
  {
      if (m_Map.IsEmpty()) return;
      A * pThis=NULL;
      if(m_Map.Lookup(m_SID,pThis))
      {
   pThis->b(); //回调函数中调用非静态函数
      };
  }
//注释：初始化和赋值有什么区别
初始化与赋值是不同的概念：静态变量的初始化是在编译时进行，变量的赋值是在函数或程序运行时进行。
静态变量只初始化一次，但可以通过赋值的方式多次修改静态变量的值。
全局变量和静态变量 在进入 main 前被初始化
静态成员变量在哪都可以赋值
