# Qt-在表格(QTableView)中插入喜好设置 - xqhrs232的专栏 - CSDN博客
2018年05月16日 13:50:54[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：193
个人分类：[X11/Qt/Qt quick/Qxml界面技术](https://blog.csdn.net/xqhrs232/article/category/6455019)
原文地址::[https://www.oschina.net/code/snippet_96486_4133](https://www.oschina.net/code/snippet_96486_4133)
相关文章
1、初学Qt——QTableView+QSqlqueryModel----[https://blog.csdn.net/qq_31117007/article/details/51169817](https://blog.csdn.net/qq_31117007/article/details/51169817)
### 1. [图片] Screenshot-无标题窗口.png
![](https://static.oschina.net/uploads/code/201105/02143456_AA48.png)
### 2. [文件] test.zip ~ 23KB     [下载](https://www.oschina.net/action/code/download?code=4133&id=6355)(813)[](https://www.oschina.net/code/piece_full?code=4133&piece=6355#6355)
### 3. [文件] main.cpp ~ 273B     [下载](https://www.oschina.net/action/code/download?code=4133&id=6453)(146)[](https://www.oschina.net/code/snippet_96486_4133#6453)[](https://www.oschina.net/code/snippet_96486_4133#6353)[](https://www.oschina.net/code/snippet_96486_4133#6354)[](https://www.oschina.net/code/piece_full?code=4133&piece=6453#6453)
[?](https://www.oschina.net/code/snippet_96486_4133#)
```
```cpp
/**
```
```cpp
```
```cpp
* @file main.cpp
```
```cpp
```
```cpp
* @brief
```
```cpp
```
```cpp
* @author xiangxw
```
```cpp
```
```cpp
* @version 0.0
```
```cpp
```
```cpp
* @date 2011年04月30日
```
```cpp
```
```cpp
*/
```
```cpp
#include<QApplication>
```
```cpp
#include"MyTableView.h"
```
```cpp
int
```
```cpp
main(
```
```cpp
int
```
```cpp
argc,
```
```cpp
char
```
```cpp
*argv[])
```
```cpp
{
```
```cpp
```
```cpp
QApplication app(argc,argv);
```
```cpp
```
```cpp
MyTableView table;
```
```cpp
```
```cpp
table.show();
```
```cpp
```
```cpp
return
```
```cpp
app.exec();
```
```cpp
}
```
```
### 4. [文件] MyTableView.h ~ 1KB     [下载](https://www.oschina.net/action/code/download?code=4133&id=6353)(100)[](https://www.oschina.net/code/snippet_96486_4133#6453)[](https://www.oschina.net/code/snippet_96486_4133#6353)[](https://www.oschina.net/code/snippet_96486_4133#6354)[](https://www.oschina.net/code/piece_full?code=4133&piece=6353#6353)
[?](https://www.oschina.net/code/snippet_96486_4133#)
```
```cpp
/**
```
```cpp
```
```cpp
* @file MyTableView.h
```
```cpp
```
```cpp
* @brief
```
```cpp
```
```cpp
* @author xiangxw
```
```cpp
```
```cpp
* @version 0.0
```
```cpp
```
```cpp
* @date 2011年04月30日
```
```cpp
```
```cpp
*/
```
```cpp
#ifndef MYTABLEVIEW_H
```
```cpp
#define MYTABLEVIEW_H
```
```cpp
#include<QTableView>
```
```cpp
#include<QItemDelegate>
```
```cpp
#include<QStandardItemModel>
```
```cpp
#include<QPixmap>
```
```cpp
class
```
```cpp
MyTableView;
```
```cpp
class
```
```cpp
MyItemDelegate;
```
```cpp
class
```
```cpp
MyStandardItemModel;
```
```cpp
class
```
```cpp
MyTableView:
```
```cpp
public
```
```cpp
QTableView
```
```cpp
{
```
```cpp
```
```cpp
public
```
```cpp
:
```
```cpp
```
```cpp
MyTableView(QWidget * parent=0);
```
```cpp
```
```cpp
virtual
```
```cpp
~ MyTableView(){}
```
```cpp
```
```cpp
protected
```
```cpp
:
```
```cpp
```
```cpp
void
```
```cpp
mouseMoveEvent(QMouseEvent * event);
```
```cpp
```
```cpp
private
```
```cpp
:
```
```cpp
```
```cpp
MyItemDelegate * delegate;
```
```cpp
```
```cpp
MyStandardItemModel * model;
```
```cpp
};
```
```cpp
class
```
```cpp
MyItemDelegate:
```
```cpp
public
```
```cpp
QItemDelegate
```
```cpp
{
```
```cpp
```
```cpp
public
```
```cpp
:
```
```cpp
```
```cpp
MyItemDelegate(QObject * parent=0);
```
```cpp
```
```cpp
virtual
```
```cpp
~ MyItemDelegate(){}
```
```cpp
```
```cpp
void
```
```cpp
paint(QPainter * painter,
```
```cpp
```
```cpp
const
```
```cpp
QStyleOptionViewItem & option,
```
```cpp
```
```cpp
const
```
```cpp
QModelIndex & index)
```
```cpp
const
```
```cpp
;
```
```cpp
```
```cpp
bool
```
```cpp
editorEvent(QEvent * event,
```
```cpp
```
```cpp
QAbstractItemModel * model,
```
```cpp
```
```cpp
const
```
```cpp
QStyleOptionViewItem & option,
```
```cpp
```
```cpp
const
```
```cpp
QModelIndex & index);
```
```cpp
```
```cpp
private
```
```cpp
:
```
```cpp
```
```cpp
QPixmap favouritePixmap;
```
```cpp
```
```cpp
QPixmap notFavouritePixmap;
```
```cpp
};
```
```cpp
class
```
```cpp
MyStandardItemModel:
```
```cpp
public
```
```cpp
QStandardItemModel
```
```cpp
{
```
```cpp
```
```cpp
public
```
```cpp
:
```
```cpp
```
```cpp
MyStandardItemModel(QObject * parent=0)
```
```cpp
```
```cpp
:QStandardItemModel(parent){}
```
```cpp
```
```cpp
virtual
```
```cpp
~ MyStandardItemModel(){}
```
```cpp
```
```cpp
```
```cpp
QVariant data(
```
```cpp
const
```
```cpp
QModelIndex & index,
```
```cpp
```
```cpp
int
```
```cpp
role=Qt::DisplayRole)
```
```cpp
const
```
```cpp
;
```
```cpp
```
```cpp
QVariant headerData(
```
```cpp
int
```
```cpp
section,
```
```cpp
```
```cpp
Qt::Orientation orientation,
```
```cpp
```
```cpp
int
```
```cpp
role=Qt::DisplayRole)
```
```cpp
const
```
```cpp
;
```
```cpp
};
```
```cpp
#endif
```
```
### 5. [文件] MyTableView.cpp ~ 3KB     [下载](https://www.oschina.net/action/code/download?code=4133&id=6354)(126)跳至[[3]](https://www.oschina.net/code/snippet_96486_4133#6453)[[4]](https://www.oschina.net/code/snippet_96486_4133#6353)[[5]](https://www.oschina.net/code/snippet_96486_4133#6354)[[全屏预览]](https://www.oschina.net/code/piece_full?code=4133&piece=6354#6354)
[?](https://www.oschina.net/code/snippet_96486_4133#)
```
```cpp
/**
```
```cpp
```
```cpp
* @file MyTableView.cpp
```
```cpp
```
```cpp
* @brief
```
```cpp
```
```cpp
* @author xiangxw
```
```cpp
```
```cpp
* @version 0.0
```
```cpp
```
```cpp
* @date 2011年04月30日
```
```cpp
```
```cpp
*/
```
```cpp
#include<QPainter>
```
```cpp
#include<QMouseEvent>
```
```cpp
#include"MyTableView.h"
```
```cpp
#ifndef NDEBUG
```
```cpp
#include<QDebug>
```
```cpp
#endif
```
```cpp
MyTableView::MyTableView(QWidget * parent)
```
```cpp
```
```cpp
:QTableView(parent)
```
```cpp
{
```
```cpp
```
```cpp
delegate=
```
```cpp
new
```
```cpp
MyItemDelegate;
```
```cpp
```
```cpp
model=
```
```cpp
new
```
```cpp
MyStandardItemModel;
```
```cpp
```
```cpp
model->setRowCount(6);
```
```cpp
```
```cpp
model->setColumnCount(8);
```
```cpp
```
```cpp
this
```
```cpp
->setModel(model);
```
```cpp
```
```cpp
this
```
```cpp
->setItemDelegate(delegate);
```
```cpp
```
```cpp
this
```
```cpp
->resizeColumnsToContents();
```
```cpp
```
```cpp
this
```
```cpp
->resizeRowsToContents();
```
```cpp
```
```cpp
this
```
```cpp
->setEditTriggers(QAbstractItemView::NoEditTriggers);
```
```cpp
```
```cpp
this
```
```cpp
->setSelectionBehavior(QAbstractItemView::SelectRows);
```
```cpp
```
```cpp
this
```
```cpp
->setMouseTracking(
```
```cpp
true
```
```cpp
);
```
```cpp
//important
```
```cpp
}
```
```cpp
void
```
```cpp
MyTableView::mouseMoveEvent(QMouseEvent * event)
```
```cpp
{
```
```cpp
```
```cpp
int
```
```cpp
column=
```
```cpp
this
```
```cpp
->columnAt(event->x());
```
```cpp
```
```cpp
int
```
```cpp
row=
```
```cpp
this
```
```cpp
->rowAt(event->y());
```
```cpp
```
```cpp
if
```
```cpp
(column==0 && row!=-1){
```
```cpp
```
```cpp
this
```
```cpp
->setCursor(Qt::PointingHandCursor);
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
else
```
```cpp
{
```
```cpp
```
```cpp
this
```
```cpp
->setCursor(Qt::ArrowCursor);
```
```cpp
```
```cpp
}
```
```cpp
}
```
```cpp
MyItemDelegate::MyItemDelegate(QObject * parent)
```
```cpp
```
```cpp
:QItemDelegate(parent)
```
```cpp
{
```
```cpp
```
```cpp
favouritePixmap=QPixmap(
```
```cpp
":/favourite.png"
```
```cpp
);
```
```cpp
```
```cpp
notFavouritePixmap=QPixmap(
```
```cpp
":/no-favourite.png"
```
```cpp
);
```
```cpp
}
```
```cpp
void
```
```cpp
MyItemDelegate::paint(QPainter * painter,
```
```cpp
```
```cpp
const
```
```cpp
QStyleOptionViewItem & option,
```
```cpp
```
```cpp
const
```
```cpp
QModelIndex & index)
```
```cpp
const
```
```cpp
{
```
```cpp
```
```cpp
if
```
```cpp
(index.column()!=0){
```
```cpp
```
```cpp
QItemDelegate::paint(painter,option,index);
```
```cpp
```
```cpp
return
```
```cpp
;
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
const
```
```cpp
QAbstractItemModel * model=index.model();
```
```cpp
```
```cpp
QVariant var=model->data(index,Qt::CheckStateRole);
```
```cpp
```
```cpp
if
```
```cpp
(var.isNull()) var=
```
```cpp
false
```
```cpp
;
```
```cpp
```
```cpp
const
```
```cpp
QPixmap & star=var.toBool()?
```
```cpp
```
```cpp
favouritePixmap:notFavouritePixmap;
```
```cpp
```
```cpp
int
```
```cpp
width=star.width();
```
```cpp
```
```cpp
int
```
```cpp
height=star.height();
```
```cpp
```
```cpp
QRect rect=option.rect;
```
```cpp
```
```cpp
int
```
```cpp
x=rect.x()+rect.width()/2-width/2;
```
```cpp
```
```cpp
int
```
```cpp
y=rect.y()+rect.height()/2-height/2;
```
```cpp
```
```cpp
painter->drawPixmap(x,y,star);
```
```cpp
}
```
```cpp
bool
```
```cpp
MyItemDelegate::editorEvent(QEvent * event,
```
```cpp
```
```cpp
QAbstractItemModel * model,
```
```cpp
```
```cpp
const
```
```cpp
QStyleOptionViewItem &
```
```cpp
/*option*/
```
```cpp
,
```
```cpp
```
```cpp
const
```
```cpp
QModelIndex & index)
```
```cpp
{
```
```cpp
```
```cpp
if
```
```cpp
(event->type()==QEvent::MouseButtonPress &&
```
```cpp
```
```cpp
index.column()==0){
```
```cpp
```
```cpp
QVariant var=model->data(index,Qt::CheckStateRole);
```
```cpp
```
```cpp
bool
```
```cpp
isFavourite=var.toBool();
```
```cpp
```
```cpp
if
```
```cpp
(var.isValid())
```
```cpp
```
```cpp
isFavourite=isFavourite?
```
```cpp
false
```
```cpp
:
```
```cpp
true
```
```cpp
;
```
```cpp
```
```cpp
else
```
```cpp
```
```cpp
isFavourite=
```
```cpp
true
```
```cpp
;
```
```cpp
```
```cpp
model->setData(index,isFavourite,Qt::CheckStateRole);
```
```cpp
```
```cpp
return
```
```cpp
true
```
```cpp
;
```
```cpp
//I have handled the event
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
return
```
```cpp
false
```
```cpp
;
```
```cpp
}
```
```cpp
QVariant MyStandardItemModel::data(
```
```cpp
```
```cpp
const
```
```cpp
QModelIndex & index,
```
```cpp
```
```cpp
int
```
```cpp
role)
```
```cpp
const
```
```cpp
{
```
```cpp
```
```cpp
int
```
```cpp
column=index.column();
```
```cpp
```
```cpp
if
```
```cpp
(role==Qt::DisplayRole && column!=0)
```
```cpp
```
```cpp
return
```
```cpp
column+1;
```
```cpp
```
```cpp
if
```
```cpp
(role==Qt::ToolTipRole && column==0)
```
```cpp
```
```cpp
return
```
```cpp
tr(
```
```cpp
"love"
```
```cpp
);
```
```cpp
```
```cpp
return
```
```cpp
QStandardItemModel::data(index,role);
```
```cpp
}
```
```cpp
QVariant MyStandardItemModel::headerData(
```
```cpp
int
```
```cpp
section,
```
```cpp
```
```cpp
Qt::Orientation orientation,
```
```cpp
```
```cpp
int
```
```cpp
role)
```
```cpp
const
```
```cpp
{
```
```cpp
```
```cpp
if
```
```cpp
(section==0 && orientation==Qt::Horizontal){
```
```cpp
```
```cpp
if
```
```cpp
(role==Qt::DecorationRole)
```
```cpp
```
```cpp
return
```
```cpp
QIcon(
```
```cpp
":/favourite.png"
```
```cpp
);
```
```cpp
```
```cpp
if
```
```cpp
(role==Qt::DisplayRole)
```
```cpp
```
```cpp
return
```
```cpp
""
```
```cpp
;
```
```cpp
```
```cpp
if
```
```cpp
(role==Qt::ToolTipRole)
```
```cpp
```
```cpp
return
```
```cpp
tr(
```
```cpp
"love"
```
```cpp
);
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
return
```
```cpp
QStandardItemModel::headerData(section,orientation,role);
```
```cpp
}
```
```
