# 使用LabVIEW开发STM32 USB HID驱动和上位机软件成功 - xqhrs232的专栏 - CSDN博客
2018年02月08日 18:01:07[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：282
原文地址::[http://blog.csdn.net/madrabbit1987/article/details/67692466](http://blog.csdn.net/madrabbit1987/article/details/67692466)
一直以来，USB驱动和[通信](http://bbs.elecfans.com/zhuti_wireless_1.html)开发是比较复杂的事情，一般使用C++开发，需要熟悉windows系统下的驱动开发。 STM32是近年流行的[ARM](http://bbs.elecfans.com/zhuti_arm_1.html) Cortex-M3[芯片](http://www.hqchip.com/?u=999)，已经集成了USB外设，所以硬件很简单，同时ST公司也提供了USB例程，其中也包括USB HID例程，但只有一个端点，数据只收不发，不是双向的USB通信。 最近以来，我一直在研究STM32的USB HID双向通信，并使用LabVIEW来开发USB HID驱动和上位机软件，已经成功，所以讲一下基本过程。 首先是USB HID驱动程序的开发。 默认来说，USB HID是免驱动的，windows系统已经有了USB HID驱动了，一般是调用usbhid.dll来通信。但这里我们不使用LabVIEW调用usbhid.dll来通信，而且是采用VISA来进行USB HID双向通信，所以我们要先用VISA开发USB HID驱动程序，就是inf文件。我们要先安装VISA驱动程序，我安装的是NI-VISA4.6.2，注意是完整版的安装：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174005cqfn3wcx1l31frfq.jpg.thumb.jpg)安装完成之后，重新启动电脑，打开“开始”，在“所有程序”的NI目录下，打开：driver wizard：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174042e888ug8azf38q0qz.jpg.thumb.jpg)打开driver wizard之后，选择USB：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174102ltngmsvnw3peptdw.jpg.thumb.jpg)下一步是填写VID和PID，以及USB HID设备名、厂家、是否USB复合设备等，需要和STM32 下位机程序对应起来：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174121d5x3zzxnkmgx3tbk.jpg.thumb.jpg)下一步是填写USB HID驱动名称，以及生成的inf文件的路径。驱动向导会同时生成XP和VISTA系统下的inf文件：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174142kmz4l0s7lesyt07e.jpg.thumb.jpg)点下一步，会问您目的路径下的inf文件不存在，是否创建？我们点YES，进入安装选项页面：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174202layawf4wr7g7awdk.jpg.thumb.jpg)我们选择第一项，安装生成的inf驱动程序。最后，我们点击“finish”之后，STM32 USB HID驱动程序就创建完成了，并已经安装到电脑中了。生成的inf文件有电脑的以下目录，同时有XP和VISTA系统的驱动，如下：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174215bmj2ejjiosmvdmn0.jpg.thumb.jpg)我们把STM32 USB HID下位机程序烧写到STM32中之后，插上USB线，电脑会提示新硬件，但XP系统默认安装的是系统自带的USB HID驱动，不是我们刚才生成的inf驱动程序，如下：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174226wmglalmlpo2holzb.jpg.thumb.jpg)这时候我们开始更新驱动程序：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174241fx7wdixidjisviek.jpg.thumb.jpg)选择“从列表或指定位置安装（高级）”：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174254ndkh2hnehadnzamp.jpg.thumb.jpg)下一步，不要搜索，如下：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174307oonpj6a66jo6pe2j.jpg.thumb.jpg)下一步，选择“STM32 USB HID”：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174318ibvmp6mv8bv3gxow.jpg.thumb.jpg)这样，我们就成功安装我们刚才生成的inf驱动程序了，如下：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174330slpgz5wnwiwzcynd.jpg.thumb.jpg)最后一步，我们打开LabVIEW的MAX，可以看到，我们的STM32硬件已经被MAX识别出来了：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174340i3je1afz5apl381i.jpg.thumb.jpg)我们做的STM32硬件能够被LabVIEW的MAX识别出来，就成功了一大半了。 接下来就是LabVIEW上位机软件的编写了。 LabVIEW给STM32发送数据，可以使用“VISA写”控件。 但LabVIEW接收STM32发送过来的数据，不能用“VISA读”控件了，需要使用USB中断控件来读，同时要启用USB中断事件。 最后，LabVIEW运行界面如下：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174352j9fuujiqii9jpjuj.jpg.thumb.jpg)总结：采用基于NI-VISA驱动的USB接口应用系统的设计非常容易，开发难度低，对开发者的要求不高；开发出的系统稳定可靠，即使对Windows编程不熟悉的人也可以开发出USB应用系统，它提供了另一种开发USB驱动应用程序的捷径。另外我发现Bus Hound这个工具挺好的，可以查看USB通信的细节：![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174407bnszszf90mc6ffm0.jpg.thumb.jpg)![](http://bbs.elecfans.com/data/attachment/forum/201410/18/174422ziajxwu3dwuyixne.jpg.thumb.jpg)
原贴地址： http://bbs.elecfans.com/forum.php?mod=viewthread&tid=454527&extra=

