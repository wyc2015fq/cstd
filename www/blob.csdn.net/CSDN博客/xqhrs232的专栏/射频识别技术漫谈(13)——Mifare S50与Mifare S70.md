# 射频识别技术漫谈(13)——Mifare S50与Mifare S70 - xqhrs232的专栏 - CSDN博客
2017年04月02日 16:20:37[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：2000
原文地址::[http://blog.sina.com.cn/s/blog_9ed067ad0100zyjx.html](http://blog.sina.com.cn/s/blog_9ed067ad0100zyjx.html)

 Mifare S50和Mifare S70又常被称为Mifare Standard、Mifare Classic、MF1，是遵守ISO14443A标准的卡片中应用最为广泛、影响力最大的的一员。而Mifare S70的容量是S50的4倍，S50的容量是1K字节，S70的容量为4K字节。读写器对卡片的操作时序和操作命令，二者完全一致。
    Mifare S50和Mifare S70的每张卡片都有一个4字节的全球唯一序列号，卡上数据保存期为10年，可改写10万次，读无限次。一般的应用中，不用考虑卡片是否会被读坏写坏的问题，当然暴力硬损坏除外。
    Mifare S50和Mifare S70的区别主要有两个方面。一是读写器对卡片发出请求命令，二者应答返回的卡类型(ATQA)字节不同。Mifare S50的卡类型(ATQA)是0004H，Mifare S70的卡类型(ATQA)是0002H。另一个区别就是二者的容量和内存结构不同。
    Mifare S50把1K字节的容量分为16个扇区(Sector0-Sector15)，每个扇区包括4个数据块(Block0-Block3，我们也将16个扇区的64个块按绝对地址编号为0~63)，每个数据块包含16个字节(Byte0-Byte15)，64*16=1024。
如下表所示：
|扇区号|块号||块类型|总块号|
|----|----|----|----|----|
|扇区0|块0|厂商代码|厂商块|0|
||块1||数据块|1|
||块2||数据块|2|
||块3|密码A   存取控制   密码B|控制块|3|
|扇区1|块0||数据块|4|
||块1||数据块|5|
||块2||数据块|6|
||块3|密码A   存取控制   密码B|控制块|7|
|...|...|...|...|...|
|扇区15|块0||数据块|60|
||块1||数据块|61|
||块2||数据块|62|
||块3|密码A    存取控制   密码B|控制块|63|
    Mifare S70把4K字节的容量分为40个扇区(Sector0-Sector39)，其中前32个扇区(Sector0-Sector31)的结构和Mifare S50完全一样，每个扇区包括4个数据块(Block0-Block3)，后8个扇区每个扇区包括16个数据块(Block0-Block15)。我们也将40个扇区的256个块按绝对地址编号为0~255)，每个数据块包含16个字节(Byte0-Byte15)，256*16=4096。如下表所示：
|扇区号|块号||块类型|总块号|
|----|----|----|----|----|
|扇区0|块0|厂商代码|厂商块|0|
||块1||数据块|1|
||块2||数据块|2|
||块3|密码A   存取控制   密码B|控制块|3|
|…|…|…|…|…|
|扇区31|块0||数据块|124|
||块1||数据块|125|
||块2||数据块|126|
||块3|密码A   存取控制   密码B|控制块|127|
|扇区32|块0||数据块|128|
||块1||数据块|129|
||…|…|数据块|…|
||块14||数据块|142|
||块15|密码A   存取控制   密码B|控制块|143|
|…|…|…|…|…|
|扇区39|块0||数据块|240|
||块1||数据块|241|
||…|…|数据块|…|
||块14||数据块|254|
||块15|密码A   存取控制   密码B|控制块|255|
    每个扇区都有一组独立的密码及访问控制，放在每个扇区的最后一个Block，这个Block又被称为区尾块，S50是每个扇区的Block3，S70的前32个扇区也是Block3，后8个扇区是Block15。
    S50和S70的0扇区0块（即绝对地址0块）用于存放厂商代码，已经固化，不可更改，卡片序列号就存放在这里。除了厂商块和控制块，卡片中其余的块都是数据块，可用于存贮数据。数据块可作两种应用：
    (1)用作一般的数据保存，可以进行**读、写**操作。
    (2)用作数据值，可以进行**初始化值、加值、减值、读值**操作。
    数据块和值块有什么区别呢？无论块中的内容是什么，你都可以把他看成普通数据，即使它是一个值块。但是并不是任何数据都可以看成是值，因为值块有一个比较严格的格式要求。值块中值的长度为4个字节的补码，其表示的范围(-2147483648～2147483647),值块的存储格式如下：
[](http://photo.blog.sina.com.cn/showpic.html#blogid=9ed067ad0100zyjx&url=http://s7.sinaimg.cn/orignal/9ed067adhc4adb1572e46)
|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0|
|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|
|addr|addr|addr|addr|VALUE|VALUE|VALUE| | | | | | | | | |
    带下划线表示取反。VALUE是值的补码，addr是块号(0-63).只有具有上述格式，才被认为是值块，否则就是普通的数据块。
    每个扇区的区尾块为**控制块**，包括了6字节密码A、4字节存取控制、6字节密码B。例如一张新出厂的卡片控制块内容如下：
       A0 A1 A2 A3 A4 A5   FF 07 80 69     B0 B1 B2 B3 B4 B5
       密码A               存取控制         密码B 
    新卡的出厂密码一般是密码A为A0A1A2A3A4A5，密码B为B0B1B2B3B4B5，或者密码A和密码B都是6个FF。存取控制用以设定扇区中各个块(包括控制块本身)的存取条件，这部分有点复杂，后面将专文介绍。
    读写器与S50和S70的通讯流程如下图所示：
![射频识别技术漫谈(13)——Mifare <wbr>S50与Mifare <wbr>S70](http://s10.sinaimg.cn/middle/9ed067adh7a0bc7dbcdd9&690)
[卡片选择](http://blog.sina.com.cn/s/blog_9ed067ad0100z47e.html)和[三次相互认证](http://blog.sina.com.cn/s/blog_9ed067ad0100zyjv.html)在前面已经介绍过。其他操作如下：
 (1)**读** (Read)：读取一个块的内容，包括普通数据块和值块；
 (2)**写 (**Write）：写数据到一个块，包括普通数据块和值块，值块中写入了非法格式的数据，值块就变成了普通数据块；
 (3)**加**（Increment）：对值块进行加值，只能对值块操作；
 (4)**减**（Decrement）：对值块进行减值，只能对值块操作；
　　 (5)**中止**（Halt）：将卡置于睡眠工作状态，只有使用WAKE-UP命令才能唤醒。
     事实上加值和减值操作并不是直接在Mifare的块中进行的。这两个命令先把Block中的值读出来，然后进行加或减，加减后的结果暂时存放在卡上的易失性数据寄存器(RAM)中，然后再利用另一个命令**传输**（Transfer）将数据寄存器中的内容写入块中。与**传输**（Transfer）相对应的命令是**存储**（Restore），作用是将块中的内容存到数据寄存器中，不过这个命令很少用到。
