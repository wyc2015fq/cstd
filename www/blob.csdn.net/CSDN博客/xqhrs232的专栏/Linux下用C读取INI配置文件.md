# Linux下用C读取INI配置文件 - xqhrs232的专栏 - CSDN博客
2016年12月29日 16:20:53[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：3154
原文地址::[http://www.oschina.net/question/54100_33939](http://www.oschina.net/question/54100_33939)
相关文章
1、[linux内核ini文件读取](http://blog.chinaunix.net/uid-338794-id-2131842.html) ----[http://blog.chinaunix.net/uid-338794-id-2131842.html](http://blog.chinaunix.net/uid-338794-id-2131842.html)
在Windows下可以用GetPrivateProfileString或GetPrivateProfileInt方便读取.ini配置文件内容，但是在Linux平台上就一筹莫展了。为了解决该问题，打算用C来读取.ini，即可不受平台的限制了。
[?](http://www.oschina.net/question/54100_33939#)
```
```cpp
#define
 CONF_FILE_PATH  "Config.ini"
```
```cpp
#include
 <string.h>
```
```cpp
#ifdef
 WIN32
```
```cpp
#include
 <Windows.h>
```
```cpp
#include
 <stdio.h>
```
```cpp
#else
```
```cpp
#define 
 MAX_PATH 260
```
```cpp
#include
 <unistd.h>
```
```cpp
#include
 <fcntl.h>
```
```cpp
#include
 <stdio.h>
```
```cpp
#include
 <stdlib.h>
```
```cpp
#include
 <stdarg.h>
```
```cpp
#endif
```
```cpp
char
```
```cpp
g_szConfigPath[MAX_PATH];
```
```cpp
//获取当前程序目录
```
```cpp
int
```
```cpp
GetCurrentPath(
```
```cpp
char
```
```cpp
buf[],
```
```cpp
char
```
```cpp
*pFileName)
```
```cpp
{
```
```cpp
#ifdef
 WIN32
```
```cpp
```
```cpp
GetModuleFileName(NULL,buf,MAX_PATH);
```
```cpp
#else
```
```cpp
```
```cpp
char
```
```cpp
pidfile[64];
```
```cpp
```
```cpp
int
```
```cpp
bytes;
```
```cpp
```
```cpp
int
```
```cpp
fd;
```
```cpp
```
```cpp
sprintf
```
```cpp
(pidfile,
```
```cpp
"/proc/%d/cmdline"
```
```cpp
,
 getpid());
```
```cpp
```
```cpp
fd
 = open(pidfile, O_RDONLY, 0);
```
```cpp
```
```cpp
bytes
 = read(fd, buf, 256);
```
```cpp
```
```cpp
close(fd);
```
```cpp
```
```cpp
buf[MAX_PATH]
 =
```
```cpp
'\0'
```
```cpp
;
```
```cpp
#endif
```
```cpp
```
```cpp
char
```
```cpp
* p = &buf[
```
```cpp
strlen
```
```cpp
(buf)];
```
```cpp
```
```cpp
do
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
*p
 =
```
```cpp
'\0'
```
```cpp
;
```
```cpp
```
```cpp
p--;
```
```cpp
#ifdef
 WIN32
```
```cpp
```
```cpp
}
```
```cpp
while
```
```cpp
(
```
```cpp
'\\'
```
```cpp
!= *p );
```
```cpp
#else
```
```cpp
```
```cpp
}
```
```cpp
while
```
```cpp
(
```
```cpp
'/'
```
```cpp
!= *p );
```
```cpp
#endif
```
```cpp
```
```cpp
p++;
```
```cpp
```
```cpp
//配置文件目录
```
```cpp
```
```cpp
memcpy
```
```cpp
(p,pFileName,
```
```cpp
strlen
```
```cpp
(pFileName));
```
```cpp
```
```cpp
return
```
```cpp
0;
```
```cpp
}
```
```cpp
//从INI文件读取字符串类型数据
```
```cpp
char
```
```cpp
*GetIniKeyString(
```
```cpp
char
```
```cpp
*title,
```
```cpp
char
```
```cpp
*key,
```
```cpp
char
```
```cpp
*filename)
```
```cpp
{
```
```cpp
```
```cpp
FILE
```
```cpp
*fp;
```
```cpp
```
```cpp
char
```
```cpp
szLine[1024];
```
```cpp
```
```cpp
static
```
```cpp
char
```
```cpp
tmpstr[1024];
```
```cpp
```
```cpp
int
```
```cpp
rtnval;
```
```cpp
```
```cpp
int
```
```cpp
i = 0;
```
```cpp
```
```cpp
int
```
```cpp
flag = 0;
```
```cpp
```
```cpp
char
```
```cpp
*tmp;
```
```cpp
```
```cpp
if
```
```cpp
((fp
 =
```
```cpp
fopen
```
```cpp
(filename,
```
```cpp
"r"
```
```cpp
))
 == NULL)
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
printf
```
```cpp
(
```
```cpp
"have  
 no   such   file \n"
```
```cpp
);
```
```cpp
```
```cpp
return
```
```cpp
""
```
```cpp
;
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
while
```
```cpp
(!
```
```cpp
feof
```
```cpp
(fp))
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
rtnval
 =
```
```cpp
fgetc
```
```cpp
(fp);
```
```cpp
```
```cpp
if
```
```cpp
(rtnval
 == EOF)
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
break
```
```cpp
;
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
else
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
szLine[i++]
 = rtnval;
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
if
```
```cpp
(rtnval
 ==
```
```cpp
'\n'
```
```cpp
)
```
```cpp
```
```cpp
{
```
```cpp
#ifndef
 WIN32
```
```cpp
```
```cpp
i--;
```
```cpp
#endif
```
```cpp
```
```cpp
szLine[--i]
 =
```
```cpp
'\0'
```
```cpp
;
```
```cpp
```
```cpp
i
 = 0;
```
```cpp
```
```cpp
tmp
 =
```
```cpp
strchr
```
```cpp
(szLine,
```
```cpp
'='
```
```cpp
);
```
```cpp
```
```cpp
if
```
```cpp
((
 tmp != NULL )&&(flag == 1))
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
if
```
```cpp
(
```
```cpp
strstr
```
```cpp
(szLine,key)!=NULL)
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
//注释行
```
```cpp
```
```cpp
if
```
```cpp
(
```
```cpp
'#'
```
```cpp
== szLine[0])
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
else
```
```cpp
if
```
```cpp
(
```
```cpp
'\/'
```
```cpp
== szLine[0] &&
```
```cpp
'\/'
```
```cpp
== szLine[1] )
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
else
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
//找打key对应变量
```
```cpp
```
```cpp
strcpy
```
```cpp
(tmpstr,tmp+1);
```
```cpp
```
```cpp
fclose
```
```cpp
(fp);
```
```cpp
```
```cpp
return
```
```cpp
tmpstr;
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
else
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
strcpy
```
```cpp
(tmpstr,
```
```cpp
"["
```
```cpp
);
```
```cpp
```
```cpp
strcat
```
```cpp
(tmpstr,title);
```
```cpp
```
```cpp
strcat
```
```cpp
(tmpstr,
```
```cpp
"]"
```
```cpp
);
```
```cpp
```
```cpp
if
```
```cpp
(
```
```cpp
strncmp
```
```cpp
(tmpstr,szLine,
```
```cpp
strlen
```
```cpp
(tmpstr))
 == 0 )
```
```cpp
```
```cpp
{
```
```cpp
```
```cpp
//找到title
```
```cpp
```
```cpp
flag
 = 1;
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
}
```
```cpp
```
```cpp
fclose
```
```cpp
(fp);
```
```cpp
```
```cpp
return
```
```cpp
""
```
```cpp
;
```
```cpp
}
```
```cpp
//从INI文件读取整类型数据
```
```cpp
int
```
```cpp
GetIniKeyInt(
```
```cpp
char
```
```cpp
*title,
```
```cpp
char
```
```cpp
*key,
```
```cpp
char
```
```cpp
*filename)
```
```cpp
{
```
```cpp
```
```cpp
return
```
```cpp
atoi
```
```cpp
(GetIniKeyString(title,key,filename));
```
```cpp
}
```
```cpp
int
```
```cpp
main(
```
```cpp
int
```
```cpp
argc,
```
```cpp
char
```
```cpp
*
 argv[])
```
```cpp
{
```
```cpp
```
```cpp
char
```
```cpp
buf[MAX_PATH];
```
```cpp
```
```cpp
memset
```
```cpp
(buf,0,
```
```cpp
sizeof
```
```cpp
(buf));
```
```cpp
```
```cpp
GetCurrentPath(buf,CONF_FILE_PATH);
```
```cpp
```
```cpp
strcpy
```
```cpp
(g_szConfigPath,buf);
```
```cpp
```
```cpp
int
```
```cpp
iCatAge;
```
```cpp
```
```cpp
char
```
```cpp
szCatName[32];
```
```cpp
```
```cpp
```
```cpp
iCatAge
 = GetIniKeyInt(
```
```cpp
"CAT"
```
```cpp
,
```
```cpp
"age"
```
```cpp
,g_szConfigPath);
```
```cpp
```
```cpp
strcpy
```
```cpp
(szCatName,GetIniKeyString(
```
```cpp
"CAT"
```
```cpp
,
```
```cpp
"name"
```
```cpp
,g_szConfigPath));
```
```cpp
```
```cpp
return
```
```cpp
0;
```
```cpp
}
```
```
下边是配置文件：
[CAT]
age=2
name=Tom
文章出处：[http://blog.csdn.net/chexlong/article/details/6818017](http://blog.csdn.net/chexlong/article/details/6818017)
