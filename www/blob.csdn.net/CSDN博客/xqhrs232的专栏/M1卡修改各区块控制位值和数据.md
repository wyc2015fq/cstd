# M1卡修改各区块控制位值和数据 - xqhrs232的专栏 - CSDN博客
2018年10月07日 17:49:56[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：149
原文地址::[https://blog.csdn.net/sxdtzhp/article/details/80297455](https://blog.csdn.net/sxdtzhp/article/details/80297455)
相关文章
1、keyA的修改----[https://wenku.baidu.com/view/7f82bc9219e8b8f67c1cb978.html](https://wenku.baidu.com/view/7f82bc9219e8b8f67c1cb978.html)
2、MifareClassic卡通过Access Bits来控制keyA和keyB的读写权限----[https://blog.csdn.net/viviwen123/article/details/8712992](https://blog.csdn.net/viviwen123/article/details/8712992)
3、RFID的KeyA/KeyB和区读写控制位----[https://blog.csdn.net/android_xiaozhou/article/details/26727829](https://blog.csdn.net/android_xiaozhou/article/details/26727829)
4、MifareClassic卡自定义keyA和keyB----[https://blog.csdn.net/viviwen123/article/details/8665972](https://blog.csdn.net/viviwen123/article/details/8665972)
5、关于S50卡密钥A和密钥B----[https://blog.csdn.net/robinson_911/article/details/12783897](https://blog.csdn.net/robinson_911/article/details/12783897)
6、[NFC (二)读写MifareClassic协议的NFC卡](https://www.cnblogs.com/haoxinyue/archive/2012/05/03/2479599.html)----[http://www.cnblogs.com/haoxinyue/archive/2012/05/03/2479599.html](http://www.cnblogs.com/haoxinyue/archive/2012/05/03/2479599.html)
7、[http://www.orangetags.com/rfid-chip-datasheet/nxp-rfid-chip-datasheet/mifare/nxp-mifare-1k-datasheet/](http://www.orangetags.com/rfid-chip-datasheet/nxp-rfid-chip-datasheet/mifare/nxp-mifare-1k-datasheet/)
8、MIFARE Classic S50技术详解----[https://blog.csdn.net/supergame111/article/details/51633805/](https://blog.csdn.net/supergame111/article/details/51633805/)
(一)，以常用设置"08 77 8F 69"控制条件为例，先搞清楚它――具有的访问权限。
1、对"08 77 8F 69"值进行计算，该值定位于各区块3的6，7，8，9四个字节内，字节6=08，字节7=77， 字节8=8F，   字节9=69(默认值，不予计算)。
2、例如：字节6=08，对应其二进制值=00001000， 则对6，7，8这三个字节进行二进制转换结果见下表：
|字节6 = 0 0 0 0 1 0 0 0|字节7 = 0 1 1 1 0 1 1 1|字节8 = 1 0 0 0 1 1 1 1|
3、参照表2及表4算法,字节6的全部二进制值取反,字节7的低四位二进制值取反,字节8不变,得到：
|字节号|对应二进制值|位置|高4位|位置|低4位|
|----|----|----|----|----|----|
|字节6 			字节7 			字节8|0 0 0 0 1 0 0 0			0 1 1 1 0 1 1 1			1 0 0 0 1 1 1 1|C2Y			C1Y			C3Y|1 1 1 1			0 1 1 1			1 0 0 0|C1Y			C3Y			C2Y|0 1 1 1			1 0 0 0			1 1 1 1|
|所 属 块 位|块3 块2 块1 块0||块3 块2 块1 块0| | |
4、对以上6，7，8字节的存取/控制二进制已取反值，依照表2，表4块位转换为各块控制值，如下表：
|块3位|字节7，字节6，字节8 = C13，C23，C33 = C1Y，C2Y，C3Y = 0 1 1|
|----|----|
|块2位			块1位			块0位|字节7，字节6，字节8 = C12，C22，C32 = C1Y，C2Y，C3Y = 1 1 0			字节7，字节6，字节8 = C11，C21，C31 = C1Y，C2Y，C3Y = 1 1 0			字节7，字节6，字节8 = C10，C20，C30 = C1Y，C2Y，C3Y = 1 1 0|
注意： 高4位的各块值=低4位的各块值时，其值可用。高4位值≠低4位值时，其值不可用!
5、查对访问权限(数据存取控制依照表3，块3存取控制依照表5)，该例"08 77 8F 69"的访问权限为：
◆ 块3 = 011：权限为：KeyA，KeyB均不可读，验证KeyB正确后可改写KeyA和KeyB，验证KeyA或KeyB正确后可读"控制位"。在此可见密钥KeyB的重要性，KeyB不正确是无法看到块3控制值，更无法修改密钥。
◆ 块2 = 块1 = 块0 = 110：权限为：验证KeyA或KeyB后可读该块数据，减值以及初始化值，只有验证KeyB 正确后才可改写该块数据，在此可以看到密钥KeyB对改写数据块也起着关键性作用。
(二)、"08 77 8F 69" 控制条件设置步骤：
由(一)可知：KeyB设置后为不可读，并且改写数据和改写控制位都需要正确验证它，故KeyB设置后程序
操作员必须妥善保管KeyB值，否则以后改写数据和控制位时，不正确的KeyB值将无法实现卡的任何操作!!!
1、修改块3控制位的值：最初的各区块3内的KeyA，KeyB都是厂商12个"F"默认值(KeyA在任何条件下均为不可读，大部分读写机程序表现KeyA为未知的12个"0" )，在修改控制值时，先不要修改默认密码KeyA和KeyB，在控制位修改成功后，再去更改新密码值。即先对块3的控制位进行修改(默认值FF 07 80 69改为新值08 77 8F 69)并执行写操作。控制位写成功后，KeyB亦为12个"0"不可读了，但仍是隐藏的12个"f"默认值。
2、修改块3的KeyA和KeyB值：控制位08 77 8F 69值写成功后，验证KeyB正确后方可改写KeyA和KeyB新密码。在密码操作模式键入要改写区块之先前密码B(先前密码为默认值时，则不需改动和加载)，加载后反回数据操作模式，再进行读值，KeyA和KeyB值的改写。
3、修改块0～块2中数据：由新的控制条件08778F69可知，要修改数据，必须先验证KeyB，故先设置密码操作为KeyB认证方式，加载后再返回数据操作模式，对要修改的数据块进行值的改写操作。
4、上例中分析了"08 77 8F 69"的访问条件及其改写步骤，对用户的其它控制条件亦可参照应用。
转自：[M1卡修改各区块控制位值和数据 | 堕落的鱼](https://www.duoluodeyu.com/835.html)
--------------------- 本文来自 sxdtzhp 的CSDN 博客 ，全文地址请点击：https://blog.csdn.net/sxdtzhp/article/details/80297455?utm_source=copy
