# Android获取未安装的APK图标 - xqhrs232的专栏 - CSDN博客
2012年02月29日 15:21:45[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：779
原文地址::[http://blog.csdn.net/sodino/article/details/6215224](http://blog.csdn.net/sodino/article/details/6215224)
网上关于"获取未安装的APK图标"的文章满天飞,但都是转帖,运行后的效果却是获取到Android的默认小机器人图标.那个暴寒....
现提供解决方法如下,废话不说,上效果图,见代码:
![uninstall apk icon](http://hi.csdn.net/attachment/201103/1/7303_1298956403FWAq.jpg)
本方法需要使用到Java反射的知识,具体请参考:
[http://java.sun.com/developer/technicalArticles/ALT/Reflection/index.html](http://java.sun.com/developer/technicalArticles/ALT/Reflection/index.html)
借鉴的Android源码出处:
[XXoo这个链接好长ooXX](http://android.git.kernel.org/?p=platform/packages/apps/PackageInstaller.git;a=blob;f=src/com/android/packageinstaller/PackageUtil.java;h=45c428906e681b78a476d0142744dc987797e7cf;hb=HEAD)
**[java]**[view plain](http://blog.csdn.net/sodino/article/details/6215224#)[copy](http://blog.csdn.net/sodino/article/details/6215224#)[print](http://blog.csdn.net/sodino/article/details/6215224#)[?](http://blog.csdn.net/sodino/article/details/6215224#)
- package lab.sodino.fetchapkicon;  
- import java.io.File;  
- import java.lang.reflect.Constructor;  
- import java.lang.reflect.Field;  
- import java.lang.reflect.Method;  
- import android.app.Activity;  
- import android.content.Context;  
- import android.content.pm.ApplicationInfo;  
- import android.content.pm.PackageInfo;  
- import android.content.pm.PackageManager;  
- import android.content.res.Resources;  
- import android.graphics.drawable.Drawable;  
- import android.os.Bundle;  
- import android.util.DisplayMetrics;  
- import android.util.Log;  
- import android.view.View;  
- import android.widget.ImageView;  
- /**
-  * @author Sodino sodinoopen@hotmail.com
-  * @since 2011年3月1日13时00分41秒
-  * */
- publicclass FetchAPKIconAct extends Activity {  
- publicvoid onCreate(Bundle savedInstanceState) {  
- super.onCreate(savedInstanceState);  
-         setContentView(R.layout.main);  
-         showUninstallAPKIcon("/sdcard/APK/JarodYv.FishPool.apk");  
-         getUninatllApkInfo(this, "/sdcard/APK/JarodYv.FishPool.apk");  
-     }  
- /** 网传的方法,但获取不成功 */
- publicvoid getUninatllApkInfo(Context context, String archiveFilePath) {  
-         PackageManager pm = context.getPackageManager();  
-         PackageInfo info = pm.getPackageArchiveInfo(archiveFilePath, PackageManager.GET_ACTIVITIES);  
- if (info != null) {  
-             ApplicationInfo appInfo = info.applicationInfo;  
-             Drawable icon = pm.getApplicationIcon(appInfo);  
-             ImageView image = (ImageView) findViewById(R.id.apkIconByTradition);  
-             image.setVisibility(View.VISIBLE);  
-             image.setImageDrawable(icon);  
-         }  
-     }  
- // 
- privatevoid showUninstallAPKIcon(String apkPath) {  
-         String PATH_PackageParser = "android.content.pm.PackageParser";  
-         String PATH_AssetManager = "android.content.res.AssetManager";  
- try {  
- // apk包的文件路径 
- // 这是一个Package 解释器, 是隐藏的
- // 构造函数的参数只有一个, apk文件的路径 
- // PackageParser packageParser = new PackageParser(apkPath);
-             Class pkgParserCls = Class.forName(PATH_PackageParser);  
-             Class[] typeArgs = new Class[1];  
-             typeArgs[0] = String.class;  
-             Constructor pkgParserCt = pkgParserCls.getConstructor(typeArgs);  
-             Object[] valueArgs = new Object[1];  
-             valueArgs[0] = apkPath;  
-             Object pkgParser = pkgParserCt.newInstance(valueArgs);  
-             Log.d("ANDROID_LAB", "pkgParser:" + pkgParser.toString());  
- // 这个是与显示有关的, 里面涉及到一些像素显示等等, 我们使用默认的情况
-             DisplayMetrics metrics = new DisplayMetrics();  
-             metrics.setToDefaults();  
- // PackageParser.Package mPkgInfo = packageParser.parsePackage(new
- // File(apkPath), apkPath, 
- // metrics, 0); 
-             typeArgs = new Class[4];  
-             typeArgs[0] = File.class;  
-             typeArgs[1] = String.class;  
-             typeArgs[2] = DisplayMetrics.class;  
-             typeArgs[3] = Integer.TYPE;  
-             Method pkgParser_parsePackageMtd = pkgParserCls.getDeclaredMethod("parsePackage",  
-                     typeArgs);  
-             valueArgs = new Object[4];  
-             valueArgs[0] = new File(apkPath);  
-             valueArgs[1] = apkPath;  
-             valueArgs[2] = metrics;  
-             valueArgs[3] = 0;  
-             Object pkgParserPkg = pkgParser_parsePackageMtd.invoke(pkgParser, valueArgs);  
- // 应用程序信息包, 这个公开的, 不过有些函数, 变量没公开
- // ApplicationInfo info = mPkgInfo.applicationInfo;
-             Field appInfoFld = pkgParserPkg.getClass().getDeclaredField("applicationInfo");  
-             ApplicationInfo info = (ApplicationInfo) appInfoFld.get(pkgParserPkg);  
- // uid 输出为"-1"，原因是未安装，系统未分配其Uid。
-             Log.d("ANDROID_LAB", "pkg:" + info.packageName + " uid=" + info.uid);  
- // Resources pRes = getResources();
- // AssetManager assmgr = new AssetManager();
- // assmgr.addAssetPath(apkPath);
- // Resources res = new Resources(assmgr, pRes.getDisplayMetrics(),
- // pRes.getConfiguration());
-             Class assetMagCls = Class.forName(PATH_AssetManager);  
-             Constructor assetMagCt = assetMagCls.getConstructor((Class[]) null);  
-             Object assetMag = assetMagCt.newInstance((Object[]) null);  
-             typeArgs = new Class[1];  
-             typeArgs[0] = String.class;  
-             Method assetMag_addAssetPathMtd = assetMagCls.getDeclaredMethod("addAssetPath",  
-                     typeArgs);  
-             valueArgs = new Object[1];  
-             valueArgs[0] = apkPath;  
-             assetMag_addAssetPathMtd.invoke(assetMag, valueArgs);  
-             Resources res = getResources();  
-             typeArgs = new Class[3];  
-             typeArgs[0] = assetMag.getClass();  
-             typeArgs[1] = res.getDisplayMetrics().getClass();  
-             typeArgs[2] = res.getConfiguration().getClass();  
-             Constructor resCt = Resources.class.getConstructor(typeArgs);  
-             valueArgs = new Object[3];  
-             valueArgs[0] = assetMag;  
-             valueArgs[1] = res.getDisplayMetrics();  
-             valueArgs[2] = res.getConfiguration();  
-             res = (Resources) resCt.newInstance(valueArgs);  
-             CharSequence label = null;  
- if (info.labelRes != 0) {  
-                 label = res.getText(info.labelRes);  
-             }  
- // if (label == null) {
- // label = (info.nonLocalizedLabel != null) ? info.nonLocalizedLabel
- // : info.packageName;
- // } 
-             Log.d("ANDROID_LAB", "label=" + label);  
- // 这里就是读取一个apk程序的图标 
- if (info.icon != 0) {  
-                 Drawable icon = res.getDrawable(info.icon);  
-                 ImageView image = (ImageView) findViewById(R.id.apkIconBySodino);  
-                 image.setVisibility(View.VISIBLE);  
-                 image.setImageDrawable(icon);  
-             }  
-         } catch (Exception e) {  
-             e.printStackTrace();  
-         }  
-     }  
- }  

*本文内容归CSDN博客博主**Sodino** 所有*
*转载请注明出处:*[http://blog.csdn.net/sodino/archive/2011/03/01/6215224.aspx](http://blog.csdn.net/sodino/archive/2011/03/01/6215224.aspx)
