# STM32 GPIO输入输出方式详解 - xqhrs232的专栏 - CSDN博客
2014年04月29日 09:55:37[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：2589
原文地址::[http://blog.sina.com.cn/s/blog_a6f9bb340101hwpr.html](http://blog.sina.com.cn/s/blog_a6f9bb340101hwpr.html)
结构图就不上了
结构图的上半部分为输入模式结构。
接下来就遇到了两个开关和电阻，与 VDD相连的为上拉电阻，与VSS相连
的为下拉电阻。再连接到施密特触发器就把电压信号转化为 0、1的数字信号存
储在输入数据寄存器(IDR)。我们可以通过设置配置寄存器(CRL、CRH)，控制
这两个开关，于是就可以得到 GPIO的上拉输入(GPIO_Mode_IPU ) 和下拉输入
模式(GPIO_Mode_IPD )了。 
从它的结构我们就可以理解，若 GPIO引脚配置为上拉输入模式，在默认
状态下(GPIO引脚无输入)，读取得的 GPIO引脚数据为 1，高电平。而下拉模
式则相反，在默认状态下其引脚数据为 0，低电平。  
而 STM32的浮空输入模式(GPIO_Mode_IN_FLOATING)在芯片内部既没有
接上拉，也没有接下拉电阻，经由触发器输入。配置成这个模式直接用电压表
测量其引脚电压为 1点几伏，这是个不确定值。由于其输入阻抗较大，一般把
这种模式用于标准的通讯协议如 I2C、USART的接收端。
模拟输入模式(GPIO_Mode_AIN )则关闭了施密特触发器，不接上、下拉电
阻，经由另一线路把电压信号传送到片上外设模块。如传送至给 ADC模块，由
ADC采集电压信号。所以使用ADC外设的时候，必须设置为模拟输入模式。 
结构图的下半部分为输出模式结构。 
线路经过一个由 P-MOS和N-MOS管组成的单元电路。而所谓推挽输出模
式，则是根据其工作方式来命名的。在输出高电平时，P-MOS导通，低电平
时，N-MOS管导通。两个管子轮流导通，一个负责灌电流，一个负责拉电流，
使其负载能力和开关速度都比普通的方式有很大的提高。推挽输出的供电平为
0伏，高电平为 3.3伏。 
在开漏输出模式时，如果我们控制输出为 0，低电平，则使 N-MOS管导
通，使输出接地，若控制输出为 1 (无法直接输出高电平)，则既不输出高电
平，也不输出低电平，为高阻态。为正常使用时必须在外部接上一个上拉电
阻。它具“线与”特性，即很多个开漏模式 引脚连接到一起时，只有当所有引
脚都输出高阻态，才由上拉电阻提供高电平，此高电平的电压为外部上拉电阻
所接的电源的电压。若其中一个引脚为低电平，那线路就相当于短路接地，使
得整条线路都为低电平，0伏。 
STM32的GPIO输出模式就分为普通推挽输出(GPIO_Mode_Out_PP )、普
通开漏输出 (GPIO_Mode_Out_OD)及复用推挽输出(GPIO_Mode_AF_PP )、复
用开漏输出(GPIO_Mode_AF_OD )。 
普通推挽输出模式一般应用在输出电平为 0和3.3伏的场合。而普通开漏
输出一般应用在电平不匹配的场合，如需要输出 5伏的高电平，就需要在外部
接一个上拉电阻，电源为 5伏，把 GPIO设置为开漏模式，当输出高阻态时，
由上拉电阻和电源向外输出 5伏的电平。
对于相应的复用模式，则是根据 GPIO的复用功能来选择的，如 GPIO的引
脚用作串口的输出，则使用复用推挽输出模式。如果用在IC、SMBUS这些需要
线与功能的复用场合，就使用复用开漏模式。其它不同的复用场合的复用模式
引脚配置将在具体的例子中讲解。 
在使用任何一种开漏模式，都需要接上拉电阻。   
//===============================================================================================
备注::
1》GPIO设置成输入状态就是高阻态？这个还有待确认！
