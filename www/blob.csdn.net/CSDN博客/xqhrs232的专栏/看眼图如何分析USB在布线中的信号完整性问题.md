# 看眼图如何分析USB在布线中的信号完整性问题 - xqhrs232的专栏 - CSDN博客
2016年10月02日 17:03:25[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：1302
原文地址::[http://www.elecfans.com/instrument/400053.html](http://www.elecfans.com/instrument/400053.html)
[导读] 眼图作为数字设计的参考依据，图中的眼宽、眼高、过冲、单位间隔和门限交叉抖动为重要参数依据。峰-峰值抖动=门限交叉抖动/单位间隔×100%。为了使接收器能够正确地采样数据，眼图必须满足一定的高度和宽度，其具体参数由器件的特性决定，根据眼图，可以知道实际情况是否满足系统设计。
**关键词：**[眼图](http://www.elecfans.com/tags/%E7%9C%BC%E5%9B%BE/)[信号完整性](http://www.elecfans.com/tags/%E4%BF%A1%E5%8F%B7%E5%AE%8C%E6%95%B4%E6%80%A7/)[USB](http://www.elecfans.com/tags/USB/)
　　通用串行总线USB （Universal Serial Bus）协议从1.0版本发展到现在，由于数据传输速度快，接口方便，支持热插拔等优点使USB设备被越来越多人使用，目前，市场上以USB2.0为接口的产品越来越多，而绘制符合要求的PCB板在USB设备应用中起重要作用。但在实际生产设计中，由于USB的传输速率较高，而系统中电路板上元器件的分布、高速传输布局布线等各类参数，引起高速信号的完整性缺陷的，所以由PCB设计所引起的信号完整性问题是高速数字PCB（印制电路板）生产设计者必须关心的问题。本文通过Mentor信号完整性工具“Hyperlynx”
 进行仿真分析，总结了一套高速电路设计提供布局布线的分析方法，串行总线以及其它高速电路的布线设计提供了理论依据。
**1 通用串行总线**
　　通用串行总线（USB）技术是为了弥补传统微机外部总线的不足而设计的，随着应用的扩展，USB的传输速率不断提高，USB2.0传输速度为高速480Mb/s。
　　对于USB信号的传输，信号完整性是核心指标。USB总线应用差分信号传输数据，在传输过程采用NRZI编码。在上位机与USB设备的交互中，根据数据传输双工或半双工的状态不同，工作于差分态、静止态和单终端三种状态，其相应的电压或电压差也有所不同，传输协议以此判断设备速率和信号数据。
　　在高速系统中，差分线上高速信号的压制检测阈值、断开检测阈值和共模电压也都有一定的范围要求，如表1所示。其中，共模电压典型值为200mV，另外，其差分输入信号电平必须满足高速接收眼图的要求。
　　表1 高速信号的输入电平
![表1 高速信号的输入电平](http://www.elecfans.com/uploads/allimg/160118/10495a926-0.JPG)
**2 信号完整性分析**
**2.1 传输线基础**
　　USB总线采用差分方式传输信号，两条传输线分别由不同的驱动器来驱动，其中一条用来传输本身的信号，另一条用来传输相应的互补信号，接收端信号为两者的电位差，用以识别传输线上包含的信息，从理论上来讲，两条任意的传输线都可以用来实现差分对。
　　传输线内的信号在传输过程中，将即时信号外加电压与内通电流的比值称为信号的瞬态阻抗。当传输线沿途的瞬态阻抗为恒定值时，这个值就被称为传输线的特性阻抗，表达式为：
![信号完整性分析](http://image.ednchina.com/2015/xUSBsignalintegrityproblems02.JPG.pagespeed.ic.JL6YaWUAEg.jpg)
　　高频频率范围内，R和G对特性阻抗的影响很小，这种情况下，传输线的特性阻抗为一个实数，公式被简化为：
　　此时的传播速度则为：
　　特性阻抗是阻抗匹配的一个重要参数。阻抗匹配关系到信号完整性问题，如反射、振铃等参量的控制。差分对匹配一般采用两种方式：π型和T型。
**　2.2 高速USB信号的眼图**
　　眼图就是由多个周期的数字信号波形叠加而形成的图形，形状与眼睛类似，因此被称为眼图。数字信号的眼图能清楚反映互连设计是否导致不能容忍的误码率。在高速串行应用中，通行的做法是采用眼图验证串行链路是否满足系统的性能要求的。
　　对于高速USB信号的发送和接收，USB使用眼图来描述其各个位在传输时所需的电压幅值和时间安排。图1展示了高速USB系统的几个眼图测试点。其中，TP1和TP4对应USB接口芯片的相应管脚（D+和D-），它们分别被焊接在集线器和USB设备的电路板上；TP2对应A型连接器的D+和D-管脚；TP3对应B型连接器的D+和D-管脚（对于束缚电缆，其也可能是直接连接在电路板上）。
![图1 眼图测试点](http://www.elecfans.com/uploads/allimg/160118/10495941C-2.JPG)
　　图1 眼图测试点
　　USB定义了6种眼图模板，其中定义在集线器TP2点或在USB设备（使用非束缚电缆）TP3点处的眼图模板，表示接收高速USB信号时所需的电压分辨力，如图2所示。
![图2 眼图模板](http://www.elecfans.com/uploads/allimg/160118/1049591357-3.JPG)
　　图2 眼图模板
**3 信号完整性（SI）仿真**
　　利用LineSim搭建USB2.0仿真原理图，如图3所示，其中包括主机控制器和外围设备控制器，设置了从主机到外围设备使用最大允许传播延迟，模拟一个28AWG带状电缆和5米的USB电缆，以及外围设备的布线。
![图3 USB仿真结构模型](http://www.elecfans.com/uploads/allimg/160118/1049591238-4.JPG)
　　图3 USB仿真结构模型
　　仿真得出差分信号的波形以及USB2.0接收端的眼图，如图4、图5所示。其图中弱的信号质量是由于带状线的阻抗不连续产生，因此，将模型结构中带状线的差分阻抗变化范围为115 ohms~92ohms。调整之后差分信号波形如图6所示，眼图如图7所示。
　　由上图可以看出，经过调整带状线的特征阻抗，差分信号波形有了明显的改变，信号完整性问题得到了改善，眼图宽度和高度均有增大，平均上升时间、平均下降时间均减小，平均下降速率和上升速率即斜率均增大，但是就其仿真来看，所得到的结果仍和理想的结果有一段距离，继续改善模型结构图中其他相应模块的参数，最终仿真得出了满足USB2.0规范的眼图和差分信号，如图8和9所示。
![图4 差分信号波形](http://www.elecfans.com/uploads/allimg/160118/1049595350-5.JPG)
　　图4 差分信号波形
![图5 仿真结果](http://www.elecfans.com/uploads/allimg/160118/10495954T-6.JPG)
　　图5 仿真结果
![图6 差分信号波形](http://www.elecfans.com/uploads/allimg/160118/1049594394-7.JPG)
　　图6 差分信号波形
![图7 仿真眼图结果](http://www.elecfans.com/uploads/allimg/160118/10495935U-8.JPG)
　　图7 仿真眼图结果
![图8 差分信号波形](http://www.elecfans.com/uploads/allimg/160118/1049592549-9.JPG)
　　图8 差分信号波形
![图9 仿真眼图结果](http://www.elecfans.com/uploads/allimg/160118/10495915Q-10.JPG)
　　图9 仿真眼图结果
　　仿真数据结果为：
　　Peak-to-Peak Voltage:1.58V
　　Positive Overshoot： 229.4 mV；NegativeOvershoot： 198.2 mV
　　Avg fall time： 969.697ps；Avg rise time:960.398ps
　　Avg fall slew rate： 0.716 V/ns；Avg rise slewrate： 0.723 V/ns
　　Eye Width： 1.804ns；High level： 565.2mV；Low level： -592.2 mV
　　Eye Height： 862.6mV；High level： 565.2 mV；Low level： -592.2 mV
　　通过以上仿真过程及结果得出：眼图的各项数据可以体现信号分析的性能指标。最主要的是通过眼的宽度、眼的高度、平均上升时间、下降时间、平均上升速率和下降速率（即斜率）这些指标能够体现信号的优劣程度。
**4 结论**
　　眼图作为数字设计的参考依据，图中的眼宽、眼高、过冲、单位间隔和门限交叉抖动为重要参数依据。峰-峰值抖动=门限交叉抖动/单位间隔×100%。为了使接收器能够正确地采样数据，眼图必须满足一定的高度和宽度，其具体参数由器件的特性决定，根据眼图，可以知道实际情况是否满足系统设计。
　　特性阻抗通常由PCB的层叠结构和PCB走线宽度/间距决定的，首先明确好需要实现的信号的特性阻抗，确定关键信号的走线宽度/间距，选择好板材的层叠结构，通常微带线线宽、走线的铜皮厚度、微带线到最近参考平面的距离以及PCB板材料的介电常数共同影响其特性阻抗，而影响差分线阻抗的主要参数为微带线阻抗和两根微带线的线间距。当两根微带线的线间距增加时，差分线的耦合效应减弱，差分阻抗增大；线间距减少时，差分线的耦合效应增强，差分阻抗减小。这在实际布线中的到了验证，本文总结的USB电路布线设计方法可以为高速电路设计布局布线的分析方法，串行总线以及其它高速电路的布线设计提供理论依据。
