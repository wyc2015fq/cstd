# 深入理解.bin文件和.nb0文件的结构 - xqhrs232的专栏 - CSDN博客
2010年05月11日 14:23:00[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：883
 .bin文件是一个描述性质的映像文件，它由文件头(head)、镜像数据目的起始地址(ImageStart)、镜像数据长度(ImageLength)和多条相对独立的记录（record）构成。
  文件头(head)由7个字节组成，内容是：42 30 30 30 46 46 0A,即“B000FF/x0A”，这是判断镜像文件是.bin类型的依据。
  镜像数据目的起始地址(ImageStart)由4个字节组成，它定义了镜像文件解析后装载在内存中的起始地址。
  镜像数据长度(ImageLength)也由4个字节组成，它表示.bin镜像文件解析后在内存中占用的总的存储空间大小。
  每条记录（record）由4字节的起始存储地址（RecordStart）、4字节的数据长度(RecordLength)、4字节的校验码(RecordCheckSum)和RecordLength个字节的记录数据（RecordData）组成。
  由以上.bin的文件格式可知，.bin文件不是内存程序空间的一个简单的拷贝。所以它不能直接用串口烧写进内存或FLASH空间来直接运行，必须通过PB下载，通过EBOOT按照.bin文件的格式解析出来具体的内容并重新装载后才能运行。
  而.nb0文件就不一样，它是内存运行程序映像的一个硬拷贝，其数据内容和程序运行时在内存中的数据是一样的。鉴于此，.nb0可以通过串口下载到指定的位置直接运行。很明显，.nb0是一个不存在格式的映像文件。
  下面，我通过一个具体的.bin文件以及对应的nb0文件来帮助大家加深对以上概念的理解：
  用UltraEdit打开我们要分析的NK.bin文件和NK.nb0文件，为了方便分析，我分别截取了NK.bin和NK.nb0文件的一小部分：
           NK.bin文件的部分内容：
           00000000h: 42 30 30 30 46 46 0A 00 00 00 80 64 67 FA 00 00
           00000010h: 00 00 80 04 00 00 00 EB 01 00 00 FE 03 00 EA 40
           00000020h: 00 00 80 08 00 00 00 EE 02 00 00 45 43 45 43 1C
           00000030h: 48 FA 80 48 00 00 80 04 00 00 00 5E 01 00 00 1C
           00000040h: 48 FA 00 00 10 00 80 A0 3D 05 00 14 E3 F3 01 00
           00000050h: 00 0F E1 13 00 A0 E3 80 00 80 E3 40 00 80 E3 00
           ..................: ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...
           00053dd0h: F7 03 80 BC F7 03 80 A0 F7 03 80 01 00 00 00 84
           00053de0h: F2 04 80 A8 F2 04 80 EC F2 04 80 AC F2 04 80 A0
           ..................: ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...
           00f40960h: 12 00 00 00 12 00 00 64 AE 80 80 1C 36 FA 80 00
           00f40970h: 00 00 00 00 10 00 80 00 00 00 00
           对应的NK.nb0文件的部分内容：
           00000000h: FE 03 00 EA 00 00 00 00 00 00 00 00 00 00 00 00
           00000010h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
           00000020h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
           00000030h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
           00000040h: 45 43 45 43 1C 48 FA 80 1C 48 FA 00 00 00 00 00
           00000050h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
           ..................: ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...
           000000ff0h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
           00001000h: 00 00 0F E1 13 00 A0 E3 80 00 80 E3 40 00 80 E3 
           00001010h: 00 F0 23 E1 10 0F 11 EE 01 0A C0 E3 04 00 C0 E3
           ..................: ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...
           00054D90h: 84 F2 04 80 A8 F2 04 80 EC F2 04 80 AC F2 04 80
           ..................: ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...  ...
            00fa6760h: 1C 36 FA 80 00 00 00 00 00 00 00 00 00 00 00 00 
            00fa6770h: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
           ..................: ...  ...  ... 填充0一直到文件末尾...    ...  ...  ...  ...  ...  ...
           下面我们来分析上面的映像：
            首先看.bin映像：
            1.最开始是7字节的文件头42 30 30 30 46 46 0A;
            2.接下是4字节映像数据目的起始地址00 00 00 80，指出目的起始地址0x80000000;从而也告诉我们对应的.nb0文件运行时将装载到0x80000000去运行。
            3.接下来是4字节的映像数据长度64 67 FA 00，指出映像数据解析后所占的存储空间长度是0X00FA6764字节;我们再看.nb0文件地址0x00fa6760处的16字节的数据是1C 36 FA 80 00 00 00 00 00 00 00 00 00 00 00 00，而且从此以后的数据全部是00，由此可知0x00fa6764是最后的有效数据的地址。我想到这里朋友们已经知道.bin文件和.nb0文件之间的联系了。
            4.接下来4字节是第1条记录的起始地址00 00 00 80，指出第1条记录的起始地址是0x80000000;
            5.接下来4字节是第1条记录的长度 04 00 00 00，指出第1条记录的数据域长度是4个字节。
            6.接下来4字节是第1条记录的校验码EB 01 00 00；
            7.接下来4字节是第1条记录的数据内容FE 03 00 EA。到这里，我相信朋友们已经想起点什么。查看.nb0文件的起始4字节，正是我们刚才分析的第1条记录的数据内容。
            8.接下来4字节是第2条记录的起始地址40 00 00 80，指出第2条记录的起始地址是0x80000040;
            9.接下来4字节是第2条记录的长度 08 00 00 00，指出第2条记录的数据域长度是8个字节。
            10.接下来4字节是第2条记录的校验码EE 02 00 00；
            11.接下来8字节是第2条记录的数据内容45 43 45 43 1C 48 FA 80。再查看.nb0文件中0x00000040地址8字节内容：45 43 45 43 1C 48 FA 80，正是.bin文件中第2条记录的数据域内容。
            如此类推，我们采用同样的方法可以解析出.bin文件中的所有记录项。并能根据.bin的记录构造出对应的.nb0文件。
            到此，我相信朋友们已经很深入的了解了.bin文件的格式，并清楚了.bin文件和.nb0文件的区别和联系了。
本文来自CSDN博客，转载请标明出处：[http://blog.csdn.net/zengdebiao/archive/2009/04/06/4052487.aspx](http://blog.csdn.net/zengdebiao/archive/2009/04/06/4052487.aspx)
//========================================================================
延伸阅读：：
１＞[http://www.cevx.com/bbs/thread-26115-1-1.html](http://www.cevx.com/bbs/thread-26115-1-1.html)
２＞[http://blog.chinaunix.net/u2/63659/showart_572848.html](http://blog.chinaunix.net/u2/63659/showart_572848.html)
