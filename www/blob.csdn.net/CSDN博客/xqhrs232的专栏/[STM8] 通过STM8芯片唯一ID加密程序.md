# [STM8] 通过STM8芯片唯一ID加密程序 - xqhrs232的专栏 - CSDN博客
2017年06月28日 19:12:16[xqhrs232](https://me.csdn.net/xqhrs232)阅读数：2073
原文地址::[http://bbs.21ic.com/forum.php?mod=viewthread&tid=1635996&highlight=%E5%8A%A0%E5%AF%86](http://bbs.21ic.com/forum.php?mod=viewthread&tid=1635996&highlight=%E5%8A%A0%E5%AF%86)
程序加密
科研成果保护是每一个科研人员最关心的事情,为了不使自己的辛苦劳动付之东流，程序加密是十分有必要的。加密程序的方法有软件加密,硬件加密,软/硬件综合加密,时间加密,错误引导加密,专利保护等措施。有矛就有盾,有盾就有矛,有矛、有盾,才促进矛、盾质量水平的提高。好的加密算法可以更大程度的提高源程序的安全性。
44.2
 STM8单片机ID码
    STM8为每一片芯片都提供了一个世界唯一的ID码，相当于我们的身份证号码。我们可以通过唯一的ID码进行程序加密。
44.3
 实验目的
实验步骤：
    1.获取STM8芯片唯一ID码。
    2.通过STM8芯片的ID码实现简单的程序加密。
44.4
 程序文件设计44.4.1  main.c文件中的程序
主程序就实现初始化和调用驱动程序，这样主程序控制思路清晰，流程简单。要想了解全面详实的程序，请大家参考光盘（网盘）中程序及程序注释。
- 
/***********************************************************************
- 
*   说    明: 窗口看门狗实验电路
- 
*   开发平台: 剑齿虎STM8开发板        
- 
*   作    者: 刘洋 张殿东
- 
*   版    本: V1.0
- 
*   日    期: 2016-05-03   
- 
*
- 
*   IAR开发环境    版本 V2.20.1
- 
*   ST库函数       版本 V2.2.0
- 
***********************************************************************/
- 
#include "pbdata.h"//引入自定义公共头文件
- 
void BSP_Configuration(void);//硬件初始化函数声明
- 
/***********************************************************************
- 
*   函 数 名: main
- 
*   功能说明: c程序入口
- 
*   形    参：无
- 
*   返 回 值: 错误代码(无需处理)
- 
***********************************************************************/
- 
int main(void)
- 
{
- 
  BSP_Configuration();//硬件驱动初始化函数
- 
  printf("窗口看门狗测试程序\r\n");
- 
  while(1)//主程序循环，反复执行循环体里的语句
- 
  {
- 
    WWDG_Refresh();
- 
  }
- 
}
- 
/***********************************************************************
- 
*   函 数 名: BSP_Configuration
- 
*   功能说明: 初始化硬件设备。只需要调用一次。该函数配置CPU寄存器和外设的寄存器并初始化一些全局变量。
- 
*   形    参：无
- 
*   返 回 值: 无
- 
***********************************************************************/
- 
void BSP_Configuration(void)
- 
{  
- 
  CLK_HSIPrescalerConfig(CLK_PRESCALER_HSIDIV1);//时钟速度为内部16M，1分频，
- 
  UART1_Congfiguration();//调用RS232串口1初始化函数
- 
  LED_Init();//调用LED初始化函数
- 
  delay_ms(1000);
- 
  WWDG_Configuration();
- 
  rim();//打开总中断
- 
}
- 
/*断言函数：它的作用是在编程的过程中为程序提供参数检查*/
- 
#ifdef USE_FULL_ASSERT
- 
void assert_failed(u8* file,u32 line)
- 
{
- 
  while(1)
- 
  {
- 
  }
- 
}
- 
#endif
复制代码
pbdata.c文件中的程序
- 
#include "pbdata.h"   //引入自定义公共头文件
- 
/***************************************************************************
- 
*   函 数 名: delay_us
- 
*   功能说明: 微秒延时程序，注意此函数的运行环境为(16M时钟速度)
- 
*   形    参：nCount要延时的微秒数，输入nCount=1微妙
- 
*   返 回 值: 无
- 
***************************************************************************/
- 
void delay_us(u16 nCount)   //16M 晶振时  延时 1个微妙
- 
{
- 
    nCount*=3;//等同于 nCount=nCount*3  相当于把nCount变量扩大3倍
- 
    while(--nCount);//nCount变量数值先减一，再判断nCount的数值是否大于0，大于0循环减一，等于0退出循环。
- 
}
- 
/***************************************************************************
- 
*   函 数 名: delay_ms
- 
*   功能说明: 毫秒延时程序，注意此函数的运行环境为(16M时钟速度)
- 
*   形    参：nCount要延时的毫秒数，输入nCount=1毫秒
- 
*   返 回 值: 无
- 
***************************************************************************/
- 
void delay_ms(u16 nCount)  //16M 晶振时  延时 1个毫秒
- 
{
- 
    while(nCount--)//先判断while()循环体里的nCount数值是否大于0，大于0循环，减一执行循环体，等于0退出循环。
- 
    {
- 
        delay_us(1000);//调用微妙延时函数，输入1000等译演示1毫秒。
- 
    }
- 
}
- 
/***************************************************************************
- 
*   函 数 名: Get_decimal
- 
*   功能说明: 获得数值小数部分
- 
*   形    参：dt输入数据 deci小数位数,最多保留4位小数
- 
*   返 回 值: 放大后的小数部分
- 
***************************************************************************/
- 
u16 Get_decimal(double dt,u8 deci)   //获得数值小数部分
- 
{
- 
    long x1=0;
- 
    u16 x2=0,x3=0;
- 
    if(deci>4) deci=4;
- 
    if(deci<1) deci=1;
- 
    x3=(u16)pow(10, deci);
- 
    x1=(long)(dt*x3);
- 
    x2=(u16)(x1%x3);
- 
    return x2;
- 
}
复制代码
