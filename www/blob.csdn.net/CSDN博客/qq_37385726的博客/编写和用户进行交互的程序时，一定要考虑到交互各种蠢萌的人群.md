# 编写和用户进行交互的程序时，一定要考虑到交互各种蠢萌的人群~ - qq_37385726的博客 - CSDN博客





2017年03月28日 22:02:18[啧啧啧biubiu](https://me.csdn.net/qq_37385726)阅读数：172








**写在前面，在编写交互程序时，应事先预料到用户可能的输入错误，然后设计程序去处理用户的错误输入。**




错误版：




```
#include
#include
#include
void display(char cr, int lines, int width);
int main(void)
{
	int ch;
	int rows, cols;
	printf("输入一个字符两个数字：\n");
	while ((ch = getchar()) != '\n')
	{
		scanf("%d %d", &rows, &cols);
		display(ch, rows, cols);
		printf("输入一个字符两个数字：\n");
		printf("输入回车结束.\n");
	}
	printf("bye~");
	system("pause");
	return 0;
}

void display(char cr, int lines, int width)
{
	int row, col;
	for (row = 1; row <= lines; row++)
	{
		for (col = 1; col <= width; col++)
		{
			putchar(cr);
		}
		putchar('\n');
	}
}
```





正确版：




```
//程序的目的是输入一个字符，两个数字（前m行后n列），打印这个字符m行n列

#include
#include
#include
void display(char cr, int lines, int width);
int main(void)
{
	int ch;
	int rows, cols;
	printf("输入一个字符两个数字：\n");
	while ((ch = getchar()) != '\n')//交互1
	{
		if (scanf("%d %d", &rows, &cols) != 2)//交互2    //处理交互1的问题
			break;
		display(ch, rows, cols);
		while (getchar() != '\n')  //处理交互2的问题
			continue;
		printf("输入一个字符两个数字：\n");
		printf("输入回车结束.\n");
	}
	printf("bye~");
	system("pause");
	return 0;
}

void display(char cr, int lines, int width)
{
	int row, col;
	for (row = 1; row <= lines; row++)
	{
		for (col = 1; col <= width; col++)
		{
			putchar(cr);
		}
		putchar('\n');
	}
}
```








分析这个程序，与用户有两处进行了交互，那么也就是说有两处交互时发生错误的可能性。。。（绝望)




先来说说之前我想的。

1.本来我觉得错误版错误的原因是由于getchar的换行符导致的

2.本来我觉得这个改过的程序是错误的，因为我在scanf那里输入多个回车就会导致错误了



**但是，还是我太年轻。。。**




再来看正确的到底是什么样的：

1.getchar那里产生的换行符会在scanf那里%d那里的时候被跳过，这种跳过不是说我提取后又把它退回缓冲区，而是说我提取后就把它丢掉。所以由于getchar产生的换行符对于这个程序的影响是不存在的。但是这是否意味着在这一个交互的地方不存在可能发生问题的风险呢？不是。。。用户可能输入了多个字符，但是getchar只能提取一个字符，其他的才会被放到缓冲区里面，但是scanf又提取不了，所以会导致scanf这里读的的东西为0，所以为了规避这个问题，我们设计了**if (scanf("%d %d", &rows, &cols) != 2)  break;**这样的语句。

2.关于在scanf那里输入多个回车，当时我大概是傻掉了。。因为scanf在一次回车后就提取缓冲区里的东西，不存在说我再多输入几个回车的问题。

3.我们再来看scanf这里与用户交互会发生什么问题：①用户可能在中间输入了字符**if (scanf("%d %d", &rows, &cols) != 2)  break;**规避掉了  

**②用户可能在输入第二个数字和输入回车之间输入了很多奇奇怪怪的东西**



**我们重点来看看这个问题（许多奇怪字符+回车符），和它的解决方案，我个人现在觉得特别好**



**while (getchar() != '\n')  //处理交互2的问题continue;**



**这个在是许多奇怪字符的时候，将它们得到再接着进行拿奇怪字符的循环**

**在是回车符的时候，将其得到，然后继续往下运行**





**综上：**

**写在后面，在编写交互程序时，应事先预料到用户可能的输入错误，然后设计程序去处理用户的错误输入。**






