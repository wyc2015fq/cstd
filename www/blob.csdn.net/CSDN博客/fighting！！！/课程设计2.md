# 课程设计2 - fighting！！！ - CSDN博客
2015年05月22日 19:53:07[dujiahei](https://me.csdn.net/dujiahei)阅读数：303
个人分类：[汇编语言学习](https://blog.csdn.net/dujiahei/article/category/3259223)
1.在DOS 环境下进行调试的程序
assume cs:ks2
ks2 segment
ksstart2:jmp  chose 
table   dw g1,g2,g3,g4
table1  dw 16 dup (0)
s1:  db '1) reset pc',0
s2:  db '2) start system',0
s3:  db '3) clock',0
s4:  db '4) set clock',0
s: dw offset s1,offset s2,offset s3,offset s4
cs2   db '20yy/mm/dd hh:mm:ss ',0
s21: db 9,8,7,4,2,0
s22: dw 2,5,8,11,14,17
;显示选择界面
chose:
 ; push ds   此处是主程序！！！不需要入栈、出栈
 mov ax,cs
 mov ds,ax
 mov bx,offset s  
 mov dh,10
 mov dl,20 
 mov cx,4
sok:push cx 
 mov cl,1
 mov si,ds:[bx]
 call show_str
 inc dh
 add bx,2
 pop cx 
 loop sok 
;显示完毕 此处不能使用int 21h(由DOS环境提供)的9号功能
;计算功能号
g3r:
 ;in al,60h ;al的值为扫描码
     mov ah,0 
 int 16h  ;设计到功能选择的键盘输入，最好选择 int16h 的0号功能，避免键盘缓冲区的内容造成干扰
 cmp ah,10h
 je  chose_end ;按Q键退出
 cmp ah,5
 ja chose 
 cmp ah,1
 je chose 
 sub ah,2
 mov bl,ah
 mov bh,0
 add bx,bx 
 call word ptr table[bx]
 jmp g3r 
chose_end: mov ax,4c00h
 int 21h 
;重新启动计算机 用户输入“1”，跳转到ffff:0 单元
g1: push  ax
 mov ax,0 
 mov table1[0],ax
 mov ax,0ffffh  
 mov word ptr table1[2],ax 
 jmp dword ptr table1[0]
 pop  ax
 ret
g2: push ax 
 push bx
 push cx
 push dx 
 push es  
 mov ax,7c0h
 mov es,ax
 mov bx,0 
 ; mov byte ptr ds:[160*12+21],'e'
 ; mov cx,0ffh
; ss2e:nop
 ; loop ss2e
 mov al,1
 mov ch,0
 mov cl,1
 mov dl,80h
 mov dh,0 
 mov ah,2
 int 13h
 mov table1[0+7c00h],bx   
 mov table1[2+7c00h],es 
 jmp dword ptr table1[0+7c00h] 
 pop es 
 pop dx 
 pop cx
 pop bx 
 pop ax 
 ret 
 g3: ;push ax 
 ; push bx
 ; push cx
 ; push dx
 ; push di
 ; push si
 ; push ds
 mov bp,0
 mov cl,1
sg3:
    push cx
 mov ax,cs
    mov ds,ax
  mov bx,offset s21
 mov si,offset s22
 mov cx,6
clk_s:
 push cx 
 mov al,ds:[bx] ;端口单元
 mov di,ds:[si]  ;显示的位置 line
 out 70h,al
 in al,71h    
 mov ah,al
 mov cl,4
 shr ah,cl
 and al,0fh  
 add ah,30h
 add al,30h 
 mov cs2[di],ah
 mov cs2[di+1],al 
 inc bx
 inc si
 inc si
 pop cx 
 loop clk_s
 mov dh,15 
 mov dl,30 
 mov si,offset cs2
 pop cx
 call show_str
chr:     in al,60h
       ; mov ah,0 
       ;int 16h 
  cmp al,3Bh
  je change_color
  cmp al,1 
  je  return_mu
  jmp  sg3   ;动态显示时间,循环读取CMOS
 change_color:
 inc cl
        mov al,2
        out 60h,al   ;在虚拟机上添加此句，可以跳出改变颜色
 jmp short sg3
return_mu:
  ; pop ds 
  ; pop si 
  ; pop di 
  ; pop dx 
  ; pop cx 
  ; pop bx 
  ; pop ax 
 ret  
 ;显示以0结尾字符串的子程序
;参数 dh--行号（0~24） dl--列号（0~79） cl--颜色   ds:si 指向首地址    返回值无
show_str:push cx
 push dx 
 push es
 push di
 push bx
 push si 
 push ax 
 mov ax,0b800h
 mov es,ax
        mov al,dl
        dec al
        mov ah,0
        add ax,ax
        mov di,ax
 mov dl,dh  
 mov al,160
 mul dl
 add di,ax 
       mov bh,cl 
show: 
 mov cl,ds:[si]
 mov ch,0
        jcxz ok
 mov bl,ds:[si]
        mov es:[di],bx
        inc si
        add di,2
 jmp show
ok: pop ax
 pop si
 pop bx
 pop di
 pop es
 pop dx
 pop cx 
 ret 
g4:
  jmp getchars
 tableg4 dw charpush,charpop,charshow
 chars db 18 dup(0)
 addr1 db 9,8,7,4,2,0
 tip db 'please input time as: 150518200535',0 
 getchars:
 push cs
 pop ds
 mov si,offset tip 
 mov dh,18
 mov dl,30
 mov cl,2
 ;in al,60h 
 call show_str 
 ;show tip 
 mov si,offset chars
 mov dh,20
 mov dl,50
 call getstring
 mov si,offset chars
    mov di,offset addr1
 mov cx,6
deal:
 push cx
     mov ah,ds:[si]
  mov al,ds:[si+1]
  and al,0fh 
  and ah,0fh 
  mov cl,4
  shl ah,cl
  or ah,al
  mov al,ds:[di]
  out 70h,al
  mov al,ah
  out 71h,al   
  inc di
  add si,2
  pop cx
    loop deal  
 jmp chose 
getstring: 
 push ax 
getstrs:
 mov ah,0
 int 16h
 cmp al,20h
 jb nochar
 mov ah,0
 call charstack ;入栈
 mov ah,2 
 call charstack  ;显示 
 jmp getstrs
nochar:
 cmp ah,0eh
 je backspace
 cmp ah,1ch
 je ent
 jmp getstrs
backspace:
 mov ah,1
 call charstack   ;出栈
 mov ah,2 
 call charstack   ;显示 
 jmp getstrs
ent:
 mov al,0
 mov ah,0 
 call charstack  ;0入栈，字符串结束
 mov ah,2
 call charstack
 pop ax 
 ret 
charstack:
 jmp short charstart 
 table2 dw charpush,charpop,charshow
 top   dw 0 
charstart:
 push bx 
 push dx 
 push di 
 push es 
 cmp ah,2 
 ja sret
 mov bl,ah
 mov bh,0
 add bx,bx 
 jmp word ptr tableg4[bx]
charpush:        ;tip  "12/12/13 14:15:16"
 cmp top,17  
 ja sret  
 mov bx,top 
 mov [si][bx],al
 inc top
 jmp sret
charpop:
 cmp top,0
 je sret
 dec top 
 mov bx,top
 mov al,[si][bx]
 jmp sret 
charshow:
 mov bx,0b800h
 mov es,bx
 mov al,160
 mov ah,0
 mul dh
 mov di,ax
 add dl,dl
 mov dh,0
 add di,dx 
 mov bx,0 
charshows:
 cmp bx,top 
 jne noempty
 mov byte ptr es:[di],' '
 jmp sret 
noempty:
 mov al,[si][bx]
 mov es:[di],al 
 mov byte ptr es:[di+2],' '
 inc bx
 add di,2 
 jmp charshows
sret:
 pop es 
 pop di 
 pop dx 
 pop bx 
 ret 
 ks2 ends
end ksstart2
2.可以安装到软盘的程序
assume cs:ks1
ks1 segment 
ksstart1:jmp short ks11
 table2_ks1  dw 16 dup (0)
ks11: 
 mov ax,7e0h
 mov es,ax
 mov bx,0  ;类比第16章使偏移地址为零
 mov al,2
 mov ch,0
 mov cl,2
 mov dl,0 
 mov dh,0 
 mov ah,2 
 int 13h     ; 2扇区内容放到0:7e00h处
 mov table2_ks1[0+7c00h],bx   
 mov table2_ks1[2+7c00h],es 
 jmp dword ptr table2_ks1[0+7c00h] ;类似16章的错误，偏移地址的问题。
ks1 ends
;end ksstart1
assume cs:ks2
ks2 segment
ksstart2:jmp  chose 
table   dw g1,g2,g3,g4
table1  dw 16 dup (0)
s1:  db '1) reset pc',0
s2:  db '2) start system',0
s3:  db '3) clock',0
s4:  db '4) set clock',0
s: dw offset s1,offset s2,offset s3,offset s4
cs2   db '20yy/mm/dd hh:mm:ss ',0
s21: db 9,8,7,4,2,0
s22: dw 2,5,8,11,14,17
;显示选择界面
chose:
 ; push ds   此处是主程序！！！不需要入栈、出栈
 mov ax,cs
 mov ds,ax
 mov bx,offset s  
 mov dh,10
 mov dl,20 
 mov cx,4
sok:push cx 
 mov cl,1
 mov si,ds:[bx]
 call show_str
 inc dh
 add bx,2
 pop cx 
 loop sok 
;显示完毕 此处不能使用int 21h(由DOS环境提供)的9号功能
;计算功能号
g3r:
 ;in al,60h ;al的值为扫描码
     mov ah,0 
 int 16h  ;设计到功能选择的键盘输入，最好选择 int16h 的0号功能，避免键盘缓冲区的内容造成干扰
 cmp ah,10h
 je  chose_end ;按Q键退出
 cmp ah,5
 ja chose 
 cmp ah,1
 je chose 
 sub ah,2
 mov bl,ah
 mov bh,0
 add bx,bx 
 call word ptr table[bx]
 jmp g3r 
chose_end: mov ax,4c00h
 int 21h 
;重新启动计算机 用户输入“1”，跳转到ffff:0 单元
g1: push  ax
 mov ax,0 
 mov table1[0],ax
 mov ax,0ffffh  
 mov word ptr table1[2],ax 
 jmp dword ptr table1[0]
 pop  ax
 ret
g2: push ax 
 push bx
 push cx
 push dx 
 push es  
 mov ax,7c0h
 mov es,ax
 mov bx,0 
 ; mov byte ptr ds:[160*12+21],'e'
 ; mov cx,0ffh
; ss2e:nop
 ; loop ss2e
 mov al,1
 mov ch,0
 mov cl,1
 mov dl,80h
 mov dh,0 
 mov ah,2
 int 13h
 mov table1[0+7c00h],bx   
 mov table1[2+7c00h],es 
 jmp dword ptr table1[0+7c00h] 
 pop es 
 pop dx 
 pop cx
 pop bx 
 pop ax 
 ret 
 g3: ;push ax 
 ; push bx
 ; push cx
 ; push dx
 ; push di
 ; push si
 ; push ds
 mov bp,0
 mov cl,1
sg3:
    push cx
 mov ax,cs
    mov ds,ax
  mov bx,offset s21
 mov si,offset s22
 mov cx,6
clk_s:
 push cx 
 mov al,ds:[bx] ;端口单元
 mov di,ds:[si]  ;显示的位置 line
 out 70h,al
 in al,71h    
 mov ah,al
 mov cl,4
 shr ah,cl
 and al,0fh  
 add ah,30h
 add al,30h 
 mov cs2[di],ah
 mov cs2[di+1],al 
 inc bx
 inc si
 inc si
 pop cx 
 loop clk_s
 mov dh,15 
 mov dl,30 
 mov si,offset cs2
 pop cx
 call show_str
chr:     in al,60h
       ; mov ah,0 
       ;int 16h 
  cmp al,3Bh
  je change_color
  cmp al,1 
  je  return_mu
  jmp  sg3   ;动态显示时间,循环读取CMOS
 change_color:
 inc cl
        mov al,2
        out 60h,al   ;在虚拟机上添加此句，可以跳出改变颜色
 jmp short sg3
return_mu:
  ; pop ds 
  ; pop si 
  ; pop di 
  ; pop dx 
  ; pop cx 
  ; pop bx 
  ; pop ax 
 ret  
 ;显示以0结尾字符串的子程序
;参数 dh--行号（0~24） dl--列号（0~79） cl--颜色   ds:si 指向首地址    返回值无
show_str:push cx
 push dx 
 push es
 push di
 push bx
 push si 
 push ax 
 mov ax,0b800h
 mov es,ax
        mov al,dl
        dec al
        mov ah,0
        add ax,ax
        mov di,ax
 mov dl,dh  
 mov al,160
 mul dl
 add di,ax 
       mov bh,cl 
show: 
 mov cl,ds:[si]
 mov ch,0
        jcxz ok
 mov bl,ds:[si]
        mov es:[di],bx
        inc si
        add di,2
 jmp show
ok: pop ax
 pop si
 pop bx
 pop di
 pop es
 pop dx
 pop cx 
 ret 
g4:
  jmp getchars
 tableg4 dw charpush,charpop,charshow
 chars db 18 dup(0)
 addr1 db 9,8,7,4,2,0
 tip db 'please input time as: 150518200535',0 
 getchars:
 push cs
 pop ds
 mov si,offset tip 
 mov dh,18
 mov dl,30
 mov cl,2
 ;in al,60h 
 call show_str 
 ;show tip 
 mov si,offset chars
 mov dh,20
 mov dl,50
 call getstring
 mov si,offset chars
    mov di,offset addr1
 mov cx,6
deal:
 push cx
     mov ah,ds:[si]
  mov al,ds:[si+1]
  and al,0fh 
  and ah,0fh 
  mov cl,4
  shl ah,cl
  or ah,al
  mov al,ds:[di]
  out 70h,al
  mov al,ah
  out 71h,al   
  inc di
  add si,2
  pop cx
    loop deal  
 jmp chose 
getstring: 
 push ax 
getstrs:
 mov ah,0
 int 16h
 cmp al,20h
 jb nochar
 mov ah,0
 call charstack ;入栈
 mov ah,2 
 call charstack  ;显示 
 jmp getstrs
nochar:
 cmp ah,0eh
 je backspace
 cmp ah,1ch
 je ent
 jmp getstrs
backspace:
 mov ah,1
 call charstack   ;出栈
 mov ah,2 
 call charstack   ;显示 
 jmp getstrs
ent:
 mov al,0
 mov ah,0 
 call charstack  ;0入栈，字符串结束
 mov ah,2
 call charstack
 pop ax 
 ret 
charstack:
 jmp short charstart 
 table2 dw charpush,charpop,charshow
 top   dw 0 
charstart:
 push bx 
 push dx 
 push di 
 push es 
 cmp ah,2 
 ja sret
 mov bl,ah
 mov bh,0
 add bx,bx 
 jmp word ptr tableg4[bx]
charpush:        ;tip  "12/12/13 14:15:16"
 cmp top,17  
 ja sret  
 mov bx,top 
 mov [si][bx],al
 inc top
 jmp sret
charpop:
 cmp top,0
 je sret
 dec top 
 mov bx,top
 mov al,[si][bx]
 jmp sret 
charshow:
 mov bx,0b800h
 mov es,bx
 mov al,160
 mov ah,0
 mul dh
 mov di,ax
 add dl,dl
 mov dh,0
 add di,dx 
 mov bx,0 
charshows:
 cmp bx,top 
 jne noempty
 mov byte ptr es:[di],' '
 jmp sret 
noempty:
 mov al,[si][bx]
 mov es:[di],al 
 mov byte ptr es:[di+2],' '
 inc bx
 add di,2 
 jmp charshows
sret:
 pop es 
 pop di 
 pop dx 
 pop bx 
 ret 
 ks2 ends
assume cs:code 
code segment 
start:
         mov ax,ks1
         mov es,ax
  mov bx,0
   mov al,1
   mov ch,0
   mov cl,1
   mov dl,0
   mov dh,0
   mov ah,3
   int 13h      ;将内容写入0面0道1扇区  
   mov ax,ks2
   mov es,ax
  mov bx,0
   mov al,2
   mov ch,0
   mov cl,2 
   mov dl,0
   mov dh,0
   mov ah,3
   int 13h      ;将内容写入0面0道2、3扇区  
 mov ax,4c00h
 int 21h
code ends
end start
