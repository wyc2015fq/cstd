# 大型网站架构系列：电商网站架构案例(2) - 建建的博客 - CSDN博客
2017年03月10日 13:51:30[纪建](https://me.csdn.net/u013898698)阅读数：124
电网网站架构案例系列的第二篇文章。主要讲解网站架构分析，网站架构优化，业务拆分，应用集群架构，多级缓存，分布式Session。
## 五、网站架构分析
根据以上预估，有几个问题：
- 需要部署大量的服务器，高峰期计算，可能要部署30台Web服务器。并且这三十台服务器，只有秒杀，活动时才会用到，存在大量的浪费。
- 所有的应用部署在同一台服务器，应用之间耦合严重。需要进行垂直切分和水平切分。
- 大量应用存在冗余代码
- 服务器SESSION同步耗费大量内存和网络带宽
- 数据需要频繁访问数据库，数据库访问压力巨大。
大型网站一般需要做以下架构优化（优化是架构设计时，就要考虑的，一般从架构/代码级别解决，调优主要是简单参数的调整，比如JVM调优；如果调优涉及大量代码改造，就不是调优了，属于重构）：
- 业务拆分
- 应用集群部署（分布式部署，集群部署和负载均衡）
- 多级缓存
- 单点登录（分布式Session）
- 数据库集群（读写分离，分库分表）
- 服务化
- 消息队列
- 其他技术
## 六、网站架构优化
### 6.1业务拆分
根据业务属性进行垂直切分，划分为产品子系统，购物子系统，支付子系统，评论子系统，客服子系统，接口子系统（对接如进销存，短信等外部系统）。
根据业务子系统进行等级定义，可分为核心系统和非核心系统。核心系统：产品子系统，购物子系统，支付子系统；非核心：评论子系统，客服子系统，接口子系统。
业务拆分作用：提升为子系统可由专门的团队和部门负责，专业的人做专业的事，解决模块之间耦合以及扩展性问题；每个子系统单独部署，避免集中部署导致一个应用挂了，全部应用不可用的问题。
等级定义作用：用于流量突发时，对关键应用进行保护，实现优雅降级；保护关键应用不受到影响。
拆分后的架构图：
![](http://images2015.cnblogs.com/blog/820332/201511/820332-20151130073032968-1952416935.png)
参考部署方案2
![](http://images2015.cnblogs.com/blog/820332/201511/820332-20151130073047530-940494801.png)
（1）       如上图每个应用单独部署
（2）       核心系统和非核心系统组合部署
### 6.2应用集群部署（分布式，集群，负载均衡）
         分布式部署：将业务拆分后的应用单独部署，应用直接通过RPC进行远程通信；
         集群部署：电商网站的高可用要求，每个应用至少部署两台服务器进行集群部署；
         负载均衡：是高可用系统必须的，一般应用通过负载均衡实现高可用，分布式服务通过内置的负载均衡实现高可用，关系型数据库通过主备方式实现高可用。
集群部署后架构图：
![](http://images2015.cnblogs.com/blog/820332/201511/820332-20151130073058983-1408763899.png)
### 6.3 多级缓存
         缓存按照存放的位置一般可分为两类本地缓存和分布式缓存。本案例采用二级缓存的方式，进行缓存的设计。一级缓存为本地缓存，二级缓存为分布式缓存。（还有页面缓存，片段缓存等，那是更细粒度的划分）
一级缓存，缓存数据字典，和常用热点数据等基本不可变/有规则变化的信息，二级缓存缓存需要的所有缓存。当一级缓存过期或不可用时，访问二级缓存的数据。如果二级缓存也没有，则访问数据库。
缓存的比例，一般1:4，即可考虑使用缓存。（理论上是1:2即可）。
![](http://images2015.cnblogs.com/blog/820332/201511/820332-20151130073113483-523713370.png)
         根据业务特性可使用以下缓存过期策略：
（1）       缓存自动过期；
（2）       缓存触发过期；
### 6.4单点登录（分布式Session）
系统分割为多个子系统，独立部署后，不可避免的会遇到会话管理的问题。一般可采用Session同步，Cookies，分布式Session方式。电商网站一般采用分布式Session实现。
         再进一步可以根据分布式Session，建立完善的单点登录或账户管理系统。
![](http://images2015.cnblogs.com/blog/820332/201511/820332-20151130073125015-707498377.png)
         流程说明
（1）       用户第一次登录时，将会话信息（用户Id和用户信息），比如以用户Id为Key，写入分布式Session；
（2）       用户再次登录时，获取分布式Session，是否有会话信息，如果没有则调到登录页；
（3）       一般采用Cache中间件实现，建议使用Redis，因此它有持久化功能，方便分布式Session宕机后，可以从持久化存储中加载会话信息；
（4）       存入会话时，可以设置会话保持的时间，比如15分钟，超过后自动超时；
结合Cache中间件，实现的分布式Session，可以很好的模拟Session会话。
大型网站架构交流（架构之家）QQ群一466097527（已满）群二464527023 （已满）群三612849302（可加）；微信公众号：itfly8。以架构为核心的兴趣群，专注大型分布式网站架构，大数据，架构模式，设计模式。技术分享，经典电子书分享，欢迎加入！
