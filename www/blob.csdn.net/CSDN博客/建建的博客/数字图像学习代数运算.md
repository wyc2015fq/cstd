# 数字图像学习代数运算 - 建建的博客 - CSDN博客
2017年02月23日 13:42:57[纪建](https://me.csdn.net/u013898698)阅读数：648
个人分类：[视频编解码学习](https://blog.csdn.net/u013898698/article/category/6703370)
**第五章 代数运算**
**目录**
- [引言](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.htm#a1)
- [加法运算](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.htm#b1)
- [减法运算（差分）](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.htm#c1)
- [乘法运算及除法运算](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.htm#d1)
[作业](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.htm#homework)
**1. 引言**
　代数运算是指两幅输入图象之间进行点对点的加、减、乘、除运算得到输出图象的过程。如果记输入图象为A(x,y)和B(x,y)，输出图象为C(x,y)，则有如下四种简单形式：
C(x,y) = A(x,y)+B(x,y) (1)
C(x,y) = A(x,y)-B(x,y) (2)
C(x,y) = A(x,y)×B(x,y) (3)
C(x,y) = A(x,y)/ B(x,y) (4)
**2. 加法运算**
　图象相加一般用于对同一场景的多幅图象求平均，以便有效地降低加性（additive）随机噪声。通常图象采集系统中采集图象时有这样的参数可供选择。通常直接采集的图象品质较好，不需要这样的处理，但是对于经过长距离模拟通讯方式传送的图象（如太空航天器传回的星际图象）这种处理是不可缺少的。利用求平均的方法降低噪声信号提高信噪比的做法，只有当噪声可以用同一个独立分布的随机模型描述时才会有效。
**3. 减法运算（差分）**
图象相减是常用的图象处理方法，用于检测变化及运动物体。在可控制的条件下，如工业视觉环境下，这种称之为差分方法的简单处理与阈值化处理一道往往是建立机器视觉系统最有效的方法之一。在相对稳定的环境下，可以假设背景变化缓慢，且符合一定的分布规律，通过建立背景模型，实施差分方法来检测运动物体，可以获得很好的效果。因此，差分方法可以分为控制环境下的简单差分方法和基于背景模型的差分方法。
**3.1 简单的差分方法**
    在控制环境下，或者在很短的时间间隔内，可以认为背景是固定不变的，可以直接使用差分方法检测变化或直接分割出作为前景的物体。其流程图如下：
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image001.gif)
图1.变化（目标）检测流程图
详细的内容可以阅读如下的文献：[艾海舟、吕凤军 等，面向视觉监视的变化检测与分割（.\readings\chapter05\changesegment.pdf）](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/Readings/chapter05/changesegment.pdf)
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image002.gif)
图2. 变化检测示意图（左图：背景，右图：变化区域，中图：前景及分割结果，两块小区域被舍弃）
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image003.gif)![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image004.gif)![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image005.gif)
图3. 固定背景变化检测
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image006.gif)
图4. 动态变化检测
[变化检测演示播放（.\demo\chapter05\changedetect.avi）](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/Demos/chapter05/changedetect.avi)
**3.2 基于背景模型的差分方法**
对于不可控制的环境，如室外场景，在利用差分方法时需要考虑背景的更新机制，消除（补偿）因天气、光照等因素的造成的影响。
按照所处理背景的自身特性，背景模型可分为单模态和多模态两种。前者在每个背景点上的颜色分布比较集中，可以用单个概率分布模型来描述（即只有一个模态），后者的分布则比较分散，需要多个分布模型来共同描述（具有多个模态）。自然界中的许多景物和很多人造物体，如水面的波纹、摇摆的树枝、飘扬的旗帜、监视器荧屏等，都呈现出多模态的特性（参见[1]）。最常用的描述背景点颜色分布的概率分布是高斯分布（正态分布），分为单模态和多模态两种情况。
为叙述方便，用![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image008.gif)来表示均值为![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image010.gif)、协方差矩阵为![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image012.gif)的高斯分布的概率密度函数。由于背景模型中对各个图像点的处理是完全独立的，下文所有关于背景模型的描述都系针对同一图像点位置而言。
解释：
高斯分布即正态分布，是最常见概率分布模型，在图象处理、模式识别、计算机视觉中经常被用来刻画一些随机量的变化情况，如噪声、特征分布、象素灰度，此外正态分布函数还经常被选择为加窗函数用于局部化处理，如平滑滤波、Gabor变换等。这是因为一方面正态分布反映了自然界中普遍存在的有关变化量的一种统计规律，另一方面还因为正态分布函数具有非常好的数学性质，具有各阶连续的导数，在时域和频域具有相同的函数形式等等，非常便于分析。
基于高斯分布背景模型的差分方法，在原理上通过背景的分布模型判断一个象素点是否属于背景点，以此区分前景点和背景点，前景点就构成分割出来的物体。在实践上，就是对于每个象素考察其象素值与背景模型中的高斯分布的匹配程度，例如当象素值在一个高斯分布的1s以内时就认为它与该高斯分布匹配，则认为其属于背景点；而如果不与背景中任何一个高斯分布匹配，则认为其为前景点。背景模型的建立可以通过训练得到，并在处理中不断更新，这些过程除了需要人为的少量干预之外可以自动地实现。
### 3.2.1单高斯分布背景模型
单高斯分布背景模型[4]适用于单模态背景情形，它为每个图像点的颜色分布建立了用单个高斯分布表示的模型![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image014.gif)，其中下标*t*表示时间。设图像点的当前颜色度量为![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image016.gif)，若![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image018.gif)（这里![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image020.gif)为概率阈值），则该点被判定为前景点，否则为背景点（这时又称![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image021.gif)与![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image023.gif)相匹配）。在实际应用中，可以用等价的阈值替代概率阈值。如记![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image025.gif)，则可以根据![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image027.gif)的值设置相应的前景检测阈值。在常见的一维情形中，以![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image029.gif)表示均方差，则常根据![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image031.gif)的取值设置前景检测阈值：若![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image033.gif)，则该点被判定为前景点，否则为背景点。
单高斯分布背景模型的更新即指各图像点高斯分布参数的更新。引入一表示更新快慢的常数——更新率![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image035.gif)，则该点高斯分布参数的更新可表示为
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image037.gif)                                   (1)
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image039.gif)                                 (2)
### 3.2.2多高斯分布背景模型
多模态背景的情形则需要用多个分布来共同描述一个图像点上的颜色分布。Stauffer等[5]提出了一种自适应混合高斯模型，对每个图像点采用了多个高斯模型的混合表示。设用来描述每个点颜色分布的高斯分布共有*K*个，分别记为![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image041.gif)，![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image043.gif)。各高斯分布分别具有不同的权值![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image045.gif)（![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image047.gif)）和优先级![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image049.gif)，它们总是按照优先级从高到低的次序排序。取定适当的背景权值部分和阈值，只有在此阈值之内的前若干个分布才被认为是背景分布，其它则是前景分布。在检测前景点时，按照优先级次序将![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image050.gif)与各高斯分布逐一匹配，若没有表示背景分布的高斯分布与![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image051.gif)匹配，则判定该点为前景点，否则为背景点。
多高斯分布背景模型的更新较为复杂，因为它不但要更新高斯分布自身的参数，还要更新各分布的权重、优先级等。若检测时没有找到任何高斯分布与![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image052.gif)匹配，则将优先级最小的一个高斯分布去除，并根据![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image053.gif)引入一个新的高斯分布，并赋予较小的权值和较大的方差，然后对所有高斯分布重新进行权值归一化处理。若第*m*个高斯分布与![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image054.gif)匹配，则对第*i*个高斯分布的权值更新如下
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image056.gif)                (3)
其中![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image058.gif)是另一个表示背景更新快慢的常数——权值更新率。（3）表明只有与![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image059.gif)相匹配的高斯分布的权值才得到提高，其它分布的权值都被降低。另外，相匹配的高斯分布的参数也按照（1）、（2）被更新。在更新完高斯分布的参数和各分布权值后，还要对各个分布重新计算优先级和排序，并确定背景分布的数目。
### 3.2.3背景模型的更新
背景模型的更新策略是背景模型设计中最关键的技术。在模型更新时应当注意如下两条原则：
(A)    背景模型对背景变化的响应速度要足够快。背景的变化可能是①由光照变化等因素引起的背景本身颜色的变化，也可能是②背景区域的变化，如前景和背景的相互转化，即某个物体由运动转为静止或由静止转为运动（如停车场的汽车停下或开走）而导致前景物体被“融入”到背景中或背景的一部分“逃逸”而出转而成为前景。如果背景模型不能迅速跟上实际背景的变化，检测结果中就会出现大范围的噪声或不合理的长时间静止前景物体（如图5-a中静止的汽车启动后留下的“影子”）。
(B)    背景模型对运动目标要有较强的抗干扰能力。因为在背景模型的更新过程中，对背景模型上的每点而言都是受到了一个颜色序列的“训练”，不论实际场景中该点是处于静止背景上还是在运动目标上。静止的背景或目标的这种“训练”是我们所希望的，而运动目标的“训练”则是不希望看到的。特别是当运动物体尺度较大或运动较慢时，这种长时间的“训练”可能会引起错误的检测结果，如在运动目标的尾部产生“空洞”，特别是两个颜色相近的物体交错而过时更加明显（图5-b）。
![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image061.jpg)![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image063.gif)
        （a）汽车启动后留下的“影子             （b）行人对汽车的影响
图5  背景模型更新中的一些问题
在前文描述的单/多高斯分布背景模型中，更新率![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image065.gif)和权值更新率![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image067.gif)都反应了模型更新的速度快慢。在单高斯分布背景模型中，较大的![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image069.gif)符合原则（A）却不符合原则（B）的要求，较小的![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image071.gif)则刚好相反。实验表明，很多时候无法找到一个合适的![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image072.gif)能同时满足两方面的要求。一种比较容易想到的改进是赋予背景点较大的更新率，而赋予前景点较小的更新率。这种更新方式可以符合原则（B），但很多时候对（A）中情形②的效果很差，因为这时静止的前景点会由于更新率过小而很难被“融入”到背景中。为了解决这个问题，我们将背景模型更新与后面的跟踪结果相结合，赋予背景点和静止的前景点（静止目标）较大的更新率，而赋予运动的前景点（运动目标）较小的更新率。这实际上是用运动目标跟踪的结果来指导更新。经过这种改进可以在保护背景模型不受运动目标影响的同时迅速响应背景的变化。
多高斯分布的背景模型在这些问题上的表现要比单高斯分布背景模型好得多。因为它本身有多个高斯分布，判定前景/背景并不单单依赖于某个高斯分布，更依赖于各个分布的权值和优先级。对（A）中的情形②，它可以通过引入新的高斯分布解决；对（B），由于只有相匹配的高斯分布的高斯参数才得到更新，所以受运动物体的干扰也不是那么严重。但它的不足依然存在，因为它并没有对（A）中静止目标的情况作特别处理，也没有考虑到（B）中的不同“训练”之间的区别。在[测试](http://lib.csdn.net/base/softwaretest)实验中，它对背景变化的响应速度比较慢，大而慢的运动目标仍然容易带来“空洞”。我们对它的改进与对单高斯分布背景模型的改进相似，仍然是对背景点、静止前景点、运动前景点的更新率区别对待，只是作用的参数变成了权值更新率![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image073.gif)，而不是高斯分布参数的更新率![](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.files/image074.gif)。
以上3.2节的内容取自如下的文献：[背景模型及目标检测与跟踪（刘 亚 等，一种基于背景模型的运动目标检测与跟踪算法,.\readings\chapter05\bgm.pdf）](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/Readings/chapter05/BGM.pdf)，感兴趣的读者可以阅读该文的详细内容。
[目标跟踪演示播放(.\demo\chapter05\ TrackOcl_mpg4.avi)](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/Demos/chapter05/TrackOcl_mpg4.avi)
网上的相关资料[Image difference Sussex TEACH VISION6: Static camera
 and moving objects: image differencing](http://media.cs.tsinghua.edu.cn/~ahz/download_IPCVPR/motiontracking/Image%20difference%20Sussex%20TEACH%20VISION6.htm)
**4. 乘法运算及除法运算**
　乘法运算可以用来实现掩模处理，即屏蔽掉图象的某些部分。此外由于时域的卷积和相关运算与频域的乘积运算对应，因此乘法运算有时也被用来做为一种技巧来实现卷积或相关处理。
　除法运算可用于校正成像设备的非线性影响，在特殊形态的图象（如断层扫描等医学图象）处理中用到。
**参考文献**
[1]                   C. Stauffer, W. E. L. Grimson, “Learning Patterns of Activity Using Real-Time Tracking,” IEEE Trans. PAMI, vol.22, no.8, pp. 747-757, Aug. 2000
[2]                   C. Wren, A. Azarbayejani, T. Darrell, and A. Pentland, “Pfinder: Real-time Tracking of the Human Body”, IEEE Trans. PAMI, vol. 19, no. 7, pp. 780-785, Jul. 1997
[3]                   I. Haritaoglu, D. Harwood and L. S. Davis, “W4: Rea-Time Surveillance of People and Their Activities,” IEEE Trans. PAMI, vol. 22, no. 8, pp. 809-830, Aug. 2000
[4]                   R. T. Collins, A. J. Lipton and T. Kanade, “A System for Video Surveillance and Monitoring”, Proc. Am. Nuclear Soc.(ANS) Eighth Int’l Topical Meeting Robotic and Remote Systems, Apr. 1999
**作业**
- 编制将两个灰度图象相减的程序，注意合理处理数值区间，以便显示差图象，例如取绝对值或适当平移等（输入输出图象格式bmp）。
- 编制将一灰度图象与将其少许平移后得到的图象相减的程序，观察其效果。
[返回主目录](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/CourseImageProcess.html)[返回本章目录](http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.htm#content)
清华大学计算机系 艾海舟
最近修改时间：2001年7月18日
http://media.cs.tsinghua.edu.cn/~ahz/digitalimageprocess/chapter05/chapt05_ahz.htm
