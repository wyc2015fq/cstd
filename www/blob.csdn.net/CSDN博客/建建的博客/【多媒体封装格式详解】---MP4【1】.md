# 【多媒体封装格式详解】---MP4【1】 - 建建的博客 - CSDN博客
2017年08月16日 17:34:44[纪建](https://me.csdn.net/u013898698)阅读数：223
**MP4**(MPEG-4 Part 14)是一种常见的多媒体容器格式，它是在“ISO/IEC 14496-14”标准文件中定义的。
## **1.最小组成单元 BOX**
像FLV的tag、MKV的EBML、ASF文件中的 ASF object.mp4 是由一系列的box组成，他的最小组成单元就是box.
![](https://img-my.csdn.net/uploads/201301/04/1357284253_2203.png)
**size;**指明了整个box所占用的大小，包括header部分.
**type;**表示这个box的类型。(附表1)
**largesize;**如果box很大超过了uint32的最大数值，size就被设置为1，并用接下来的 **largesize**来存放大小。
## 2.mp4文件整体结构
![](https://img-my.csdn.net/uploads/201301/07/1357526660_8318.jpg)
mp4文件说白了就是一系列box组成，大box里面有小box。
接下来会深入到具体的box里面，来具体分析mp4格式
未完待续.....
附表1
|**Code**|**Abstract**|**Defined in/by**|
|----|----|----|
|ainf|Asset information to identify, license and play|[DECE](http://mp4ra.org/specs.html#DECE10)|
|albm|Album title and track number (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|auth|Media author name (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|avcn|AVC NAL Unit Storage Box|[DECE](http://mp4ra.org/specs.html#DECE10)|
|bloc|Base location and purchase location for license acquisition|[DECE](http://mp4ra.org/specs.html#DECE10)|
|bpcc|Bits per component|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|buff|Buffering information|[AVC](http://mp4ra.org/specs.html#AVC)|
|bxml|binary XML container|[ISO](http://mp4ra.org/specs.html#ISO)|
|ccid|OMA DRM Content ID|[OMA DRM 2.1](http://mp4ra.org/specs.html#omadcf21)|
|cdef|type and ordering of the components within the codestream|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|clsf|Media classification (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|cmap|mapping between a palette and codestream components|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|co64|64-bit chunk offset|[ISO](http://mp4ra.org/specs.html#ISO)|
|colr|specifies the colourspace of the image|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|cprt|copyright etc. (user-data)|[ISO](http://mp4ra.org/specs.html#ISO)|
|crhd|reserved for ClockReferenceStream header|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|cslg|composition to decode timeline mapping|[ISO](http://mp4ra.org/specs.html#ISO)|
|ctts|(composition) time to sample|[ISO](http://mp4ra.org/specs.html#ISO)|
|cvru|OMA DRM Cover URI|[OMA DRM 2.1](http://mp4ra.org/specs.html#omadcf21)|
|dcfD|Marlin DCF Duration, user-data atom type|[OMArlin](http://mp4ra.org/specs.html#OMarlin)|
|dinf|data information box, container|[ISO](http://mp4ra.org/specs.html#ISO)|
|dref|data reference box, declares source(s) of media data in track|[ISO](http://mp4ra.org/specs.html#ISO)|
|dscp|Media description (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|dsgd|DVB Sample Group Description Box|[DVB](http://mp4ra.org/specs.html#DVBa121)|
|dstg|DVB Sample to Group Box|[DVB](http://mp4ra.org/specs.html#DVBa121)|
|edts|edit list container|[ISO](http://mp4ra.org/specs.html#ISO)|
|elst|an edit list|[ISO](http://mp4ra.org/specs.html#ISO)|
|feci|FEC Informatiom|[ISO](http://mp4ra.org/specs.html#ISO)|
|fecr|FEC Reservoir|[ISO](http://mp4ra.org/specs.html#ISO)|
|fiin|FD Item Information|[ISO](http://mp4ra.org/specs.html#ISO)|
|fire|File Reservoir|[ISO](http://mp4ra.org/specs.html#ISO)|
|fpar|File Partition|[ISO](http://mp4ra.org/specs.html#ISO)|
|free|free space|[ISO](http://mp4ra.org/specs.html#ISO)|
|frma|original format box|[ISO](http://mp4ra.org/specs.html#ISO)|
|ftyp|file type and compatibility|[JP2](http://mp4ra.org/specs.html#JPEG2000), [ISO](http://mp4ra.org/specs.html#ISO)|
|gitn|Group ID to name|[ISO](http://mp4ra.org/specs.html#ISO)|
|gnre|Media genre (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|grpi|OMA DRM Group ID|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|hdlr|handler, declares the media (handler) type|[ISO](http://mp4ra.org/specs.html#ISO)|
|hmhd|hint media header, overall information (hint track only)|[ISO](http://mp4ra.org/specs.html#ISO)|
|hpix|Hipix Rich Picture (user-data or meta-data)|[HIPIX](http://mp4ra.org/specs.html#hum-mon)|
|icnu|OMA DRM Icon URI|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|ID32|ID3 version 2 container|[inline](http://mp4ra.org/specs.html#id3v2)|
|idat|Item data|[ISO](http://mp4ra.org/specs.html#ISO)|
|ihdr|Image Header|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|iinf|item information|[ISO](http://mp4ra.org/specs.html#ISO)|
|iloc|item location|[ISO](http://mp4ra.org/specs.html#ISO)|
|imif|IPMP Information box|[ISO](http://mp4ra.org/specs.html#ISO)|
|infu|OMA DRM Info URL|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|iods|Object Descriptor container box|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|iphd|reserved for IPMP Stream header|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|ipmc|IPMP Control Box|[ISO](http://mp4ra.org/specs.html#ISO)|
|ipro|item protection|[ISO](http://mp4ra.org/specs.html#ISO)|
|iref|Item reference|[ISO](http://mp4ra.org/specs.html#ISO)|
|jP$20$20|JPEG 2000 Signature|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|jp2c|JPEG 2000 contiguous codestream|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|jp2h|Header|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|jp2i|intellectual property information|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|kywd|Media keywords (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|loci|Media location information (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|lrcu|OMA DRM Lyrics URI|[OMA DRM 2.1](http://mp4ra.org/specs.html#omadcf21)|
|m7hd|reserved for MPEG7Stream header|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|mdat|media data container|[ISO](http://mp4ra.org/specs.html#ISO)|
|mdhd|media header, overall information about the media|[ISO](http://mp4ra.org/specs.html#ISO)|
|mdia|container for the media information in a track|[ISO](http://mp4ra.org/specs.html#ISO)|
|mdri|Mutable DRM information|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|meco|additional metadata container|[ISO](http://mp4ra.org/specs.html#ISO)|
|mehd|movie extends header box|[ISO](http://mp4ra.org/specs.html#ISO)|
|mere|metabox relation|[ISO](http://mp4ra.org/specs.html#ISO)|
|meta|Metadata container|[ISO](http://mp4ra.org/specs.html#ISO)|
|mfhd|movie fragment header|[ISO](http://mp4ra.org/specs.html#ISO)|
|mfra|Movie fragment random access|[ISO](http://mp4ra.org/specs.html#ISO)|
|mfro|Movie fragment random access offset|[ISO](http://mp4ra.org/specs.html#ISO)|
|minf|media information container|[ISO](http://mp4ra.org/specs.html#ISO)|
|mjhd|reserved for MPEG-J Stream header|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|moof|movie fragment|[ISO](http://mp4ra.org/specs.html#ISO)|
|moov|container for all the meta-data|[ISO](http://mp4ra.org/specs.html#ISO)|
|mvcg|Multiview group|[AVC](http://mp4ra.org/specs.html#AVC)|
|mvci|Multiview Information|[AVC](http://mp4ra.org/specs.html#AVC)|
|mvex|movie extends box|[ISO](http://mp4ra.org/specs.html#ISO)|
|mvhd|movie header, overall declarations|[ISO](http://mp4ra.org/specs.html#ISO)|
|mvra|Multiview Relation Attribute|[AVC](http://mp4ra.org/specs.html#AVC)|
|nmhd|Null media header, overall information (some tracks only)|[ISO](http://mp4ra.org/specs.html#ISO)|
|ochd|reserved for ObjectContentInfoStream header|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|odaf|OMA DRM Access Unit Format|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|odda|OMA DRM Content Object|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|odhd|reserved for ObjectDescriptorStream header|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|odhe|OMA DRM Discrete Media Headers|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|odrb|OMA DRM Rights Object|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|odrm|OMA DRM Container|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|odtt|OMA DRM Transaction Tracking|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|ohdr|OMA DRM Common headers|[OMA DRM 2.0](http://mp4ra.org/specs.html#OMADCF)|
|padb|sample padding bits|[ISO](http://mp4ra.org/specs.html#ISO)|
|paen|Partition Entry|[ISO](http://mp4ra.org/specs.html#ISO)|
|pclr|palette which maps a single component in index space to a multiple- component image|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|pdin|Progressive download information|[ISO](http://mp4ra.org/specs.html#ISO)|
|perf|Media performer name (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|pitm|primary item reference|[ISO](http://mp4ra.org/specs.html#ISO)|
|res$20|grid resolution|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|resc|grid resolution at which the image was captured|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|resd|default grid resolution at which the image should be displayed|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|rtng|Media rating (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|sbgp|Sample to Group box|[AVC,](http://mp4ra.org/specs.html#AVC)[ISO](http://mp4ra.org/specs.html#ISO)|
|schi|scheme information box|[ISO](http://mp4ra.org/specs.html#ISO)|
|schm|scheme type box|[ISO](http://mp4ra.org/specs.html#ISO)|
|sdep|Sample dependency|[AVC](http://mp4ra.org/specs.html#AVC)|
|sdhd|reserved for SceneDescriptionStream header|[MP4V1](http://mp4ra.org/specs.html#MP4V1)|
|sdtp|Independent and Disposable Samples Box|[AVC,](http://mp4ra.org/specs.html#AVC)[ISO](http://mp4ra.org/specs.html#ISO)|
|sdvp|SD Profile Box|[SDV](http://mp4ra.org/specs.html#SDV)|
|segr|file delivery session group|[ISO](http://mp4ra.org/specs.html#ISO)|
|senc|Sample specific encryption data|[DECE](http://mp4ra.org/specs.html#DECE10)|
|sgpd|Sample group definition box|[AVC,](http://mp4ra.org/specs.html#AVC)[ISO](http://mp4ra.org/specs.html#ISO)|
|sidx|Segment Index Box|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|sinf|protection scheme information box|[ISO](http://mp4ra.org/specs.html#ISO)|
|skip|free space|[ISO](http://mp4ra.org/specs.html#ISO)|
|smhd|sound media header, overall information (sound track only)|[ISO](http://mp4ra.org/specs.html#ISO)|
|srmb|System Renewability Message|[DVB](http://mp4ra.org/specs.html#DVBa121)|
|srmc|System Renewability Message container|[DVB](http://mp4ra.org/specs.html#DVBa121)|
|srpp|STRP Process|[ISO](http://mp4ra.org/specs.html#ISO)|
|stbl|sample table box, container for the time/space map|[ISO](http://mp4ra.org/specs.html#ISO)|
|stco|chunk offset, partial data-offset information|[ISO](http://mp4ra.org/specs.html#ISO)|
|stdp|sample degradation priority|[ISO](http://mp4ra.org/specs.html#ISO)|
|sthd|Subtitle Media Header Box|[DECE](http://mp4ra.org/specs.html#DECE10)|
|stsc|sample-to-chunk, partial data-offset information|[ISO](http://mp4ra.org/specs.html#ISO)|
|stsd|sample descriptions (codec types, initialization etc.)|[ISO](http://mp4ra.org/specs.html#ISO)|
|stsh|shadow sync sample table|[ISO](http://mp4ra.org/specs.html#ISO)|
|stss|sync sample table (random access points)|[ISO](http://mp4ra.org/specs.html#ISO)|
|stsz|sample sizes (framing)|[ISO](http://mp4ra.org/specs.html#ISO)|
|stts|(decoding) time-to-sample|[ISO](http://mp4ra.org/specs.html#ISO)|
|styp|Segment Type Box|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|stz2|compact sample sizes (framing)|[ISO](http://mp4ra.org/specs.html#ISO)|
|subs|Sub-sample information|[ISO](http://mp4ra.org/specs.html#ISO)|
|swtc|Multiview Group Relation|[AVC](http://mp4ra.org/specs.html#AVC)|
|tfad|Track fragment adjustment box|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|tfhd|Track fragment header|[ISO](http://mp4ra.org/specs.html#ISO)|
|tfma|Track fragment media adjustment box|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|tfra|Track fragment radom access|[ISO](http://mp4ra.org/specs.html#ISO)|
|tibr|Tier Bit rate|[AVC](http://mp4ra.org/specs.html#AVC)|
|tiri|Tier Information|[AVC](http://mp4ra.org/specs.html#AVC)|
|titl|Media title (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|tkhd|Track header, overall information about the track|[ISO](http://mp4ra.org/specs.html#ISO)|
|traf|Track fragment|[ISO](http://mp4ra.org/specs.html#ISO)|
|trak|container for an individual track or stream|[ISO](http://mp4ra.org/specs.html#ISO)|
|tref|track reference container|[ISO](http://mp4ra.org/specs.html#ISO)|
|trex|track extends defaults|[ISO](http://mp4ra.org/specs.html#ISO)|
|trgr|Track grouping information|[ISO](http://mp4ra.org/specs.html#ISO)|
|trik|Facilitates random access and trick play modes|[DECE](http://mp4ra.org/specs.html#DECE10)|
|trun|track fragment run|[ISO](http://mp4ra.org/specs.html#ISO)|
|tsel|Track selection (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
|udta|user-data|[ISO](http://mp4ra.org/specs.html#ISO)|
|uinf|a tool by which a vendor may provide access to additional information associated with a UUID|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|UITS|Unique Identifier Technology Solution|[Universal Music](http://mp4ra.org/specs.html#UMG)|
|ulst|a list of UUID’s|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|url$20|a URL|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|uuid|user-extension box|[ISO, JP2](http://mp4ra.org/specs.html#ISO)|
|vmhd|video media header, overall information (video track only)|[ISO](http://mp4ra.org/specs.html#ISO)|
|vwdi|Multiview Scene Information|[AVC](http://mp4ra.org/specs.html#AVC)|
|xml$20|a tool by which vendors can add XML formatted information|[JP2](http://mp4ra.org/specs.html#JPEG2000)|
|xml$20|XML container|[ISO](http://mp4ra.org/specs.html#ISO)|
|yrrc|Year when media was recorded (user-data)|[3GPP](http://mp4ra.org/specs.html#3GPP)|
**QuickTime Codes**
|**Code**|**Abstract**|**Defined in/by**|
|----|----|----|
|clip|Visual clipping region container|[QT](http://mp4ra.org/specs.html#QT)|
|crgn|Visual clipping region definition|[QT](http://mp4ra.org/specs.html#QT)|
|ctab|Track color-table|[QT](http://mp4ra.org/specs.html#QT)|
|elng|Extended Language Tag|[QT](http://mp4ra.org/specs.html#QT)|
|imap|Track input map definition|[QT](http://mp4ra.org/specs.html#QT)|
|kmat|Compressed visual track matte|[QT](http://mp4ra.org/specs.html#QT)|
|load|Track pre-load definitions|[QT](http://mp4ra.org/specs.html#QT)|
|matt|Visual track matte for compositing|[QT](http://mp4ra.org/specs.html#QT)|
|pnot|Preview container|[QT](http://mp4ra.org/specs.html#QT)|
|wide|Expansion space reservation|[QT](http://mp4ra.org/specs.html#QT)|
