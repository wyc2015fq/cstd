# CRC32校验原理及实现 - 建建的博客 - CSDN博客
2017年12月21日 15:20:44[纪建](https://me.csdn.net/u013898698)阅读数：8290
CRC即循环冗余校验(Cyclic Redundancy Check)：是数据通信领域中最常用的一种差错校验码，其特征是信息字段和校验字段的长度可以任意选定。
CRC校验实用程序库：在数据存储和数据通讯领域，为了保证数据的正确性，就不得不采用检错的手段。
CRC码校验原理：
发送端：发送端根据信息字段与生成多项式生产呢个CRC码，CRC码作为数据发送给接收端，同时也会把计算出的校验字段的数据一同发送(注：目的是如果接受端检测到发送的数据是正确的，接收端能够从CRC码中提取出信息字段的数据)。
接收端：接收到CRC码数据后，检测接收到的数据是否正确，方法：将CRC码数据与生成多项式进行模2除，如果余数为0，则说明接收到的数据是正确的。然后，从CRC码中提取出信息字段的数据。
实现方法：
1、发送端生成CRC码方法：
CRC码是由两部分组成的，前部分是信息字段，就是需要校验的信息，后部分是校验字段，如果CRC码共长n个bit，信息字段长k个bit，就称为(n，k)码。它的编码规则是：
- 首先将信息字段值(k bit)左移r位(k+r=n)
- 运用一个生成多项式g(x) (也可看成二进制数) 模2除上面的式子，得到的余数就是校验字段值。
- 生成的CRC码值为：信息字段值+校验字段值(单位：位bit，次序：高位到低位)，例如字段值为1001，校验字段值为110，则CRC码为1001110
2、接收端验证过程：略；
CRC32校验算法-C实现：
[html][view
 plain](http://blog.csdn.net/liudewen3/article/details/17925479#)[copy](http://blog.csdn.net/liudewen3/article/details/17925479#)
- /*****************************************************  
- ** Name         : crc32.c   
- ** Author       : gzshun  
- ** Version      : 1.0  
- ** Date         : 2011-12  
- ** Description  : CRC32 Checking  
- ******************************************************/  
- #include <stdio.h>
- #include <stdlib.h>
- #include <string.h>
- #include <errno.h>
- #include <unistd.h>
- #include <fcntl.h>
- #include <sys/stat.h>
- 
- #define BUFSIZE     1024*4  
- 
- static unsigned int crc_table[256];  
- const static char * program_name = "crc32";  
- 
- static void usage(void);  
- static void init_crc_table(void);  
- static unsigned int crc32(unsigned int crc, unsigned char * buffer, unsigned int size);  
- static int calc_img_crc(const char * in_file, unsigned int * img_crc);  
- 
- static void usage(void)  
- {  
-     fprintf(stderr, "Usage: %s input_file\n", program_name);  
- }  
- 
- /*  
- **初始化crc表,生成32位大小的crc表  
- **也可以直接定义出crc表,直接查表,  
- **但总共有256个,看着眼花,用生成的比较方便.  
- */  
- static void init_crc_table(void)  
- {  
-     unsigned int c;  
-     unsigned int i, j;  
- 
-     for (i = 0; i <256; i++) {  
- c = (unsigned int)i;  
-         for (j = 0; j <8; j++) {  
-             if (c & 1)  
- c = 0xedb88320L ^ (c >> 1);  
-             else  
- c = c>> 1;  
-         }  
-         crc_table[i] = c;  
-     }  
- }  
- 
- /*计算buffer的crc校验码*/  
- static unsigned int crc32(unsigned int crc,unsigned char *buffer, unsigned int size)  
- {  
-     unsigned int i;  
-     for (i = 0; i <size; i++) {  
- crc = crc_table[(crc ^ buffer[i]) & 0xff] ^ (crc >> 8);  
-     }  
-     return crc ;  
- }  
- 
- /*  
- **计算大文件的CRC校验码:crc32函数,是对一个buffer进行处理,  
- **但如果一个文件相对较大,显然不能直接读取到内存当中  
- **所以只能将文件分段读取出来进行crc校验,  
- **然后循环将上一次的crc校验码再传递给新的buffer校验函数,  
- **到最后，生成的crc校验码就是该文件的crc校验码.(经过测试)  
- */  
- static int calc_img_crc(const char *in_file, unsigned int *img_crc)  
- {  
-     int fd;  
-     int nread;  
-     int ret;  
-     unsigned char buf[BUFSIZE];  
-     /*第一次传入的值需要固定,如果发送端使用该值计算crc校验码,  
-     **那么接收端也同样需要使用该值进行计算*/  
-     unsigned int crc = 0xffffffff;   
- 
- fd = open(in_file, O_RDONLY);  
-     if (fd <0) {  
-         printf("%d:open %s.\n", __LINE__, strerror(errno));  
-         return -1;  
-     }  
- 
-     while ((nread = read(fd, buf, BUFSIZE)) > 0) {  
- crc = crc32(crc, buf, nread);  
-     }  
-     *img_crc = crc;  
- 
-     close(fd);  
- 
-     if (nread <0) {  
-         printf("%d:read %s.\n", __LINE__, strerror(errno));  
-         return -1;  
-     }  
- 
-     return 0;  
- }  
- 
- int main(int argc, char **argv)  
- {  
-     int ret;  
-     unsigned int img_crc;  
-     const char *in_file = argv[1];  
- 
-     if (argc <2) {  
-         usage();  
-         exit(1);  
-     }  
- 
-     init_crc_table();  
- 
- ret = calc_img_crc(in_file, &img_crc);  
-     if (ret <0) {  
-         exit(1);  
-     }  
- 
-     printf("The crc of %s is:%u\n", in_file, img_crc);  
- 
-     return 0;  
- }  
- 
- /*  
- **测试程序  
- **环境:  
- **Linux ubuntu 2.6.32-24-generic-pae #39-Ubuntu SMP Wed Jul 28 07:39:26 UTC 2010 i686 GNU/Linux  
- **gcc version 4.4.3 (Ubuntu 4.4.3-4ubuntu5)  
- **  
- gzshun@ubuntu:~/apue/crc32$ ls  
- crc32.c  
- gzshun@ubuntu:~/apue/crc32$ gcc crc32.c -o crc32  
- gzshun@ubuntu:~/apue/crc32$ ./crc32 crc32.c  
- The crc of crc32.c is:3892136086  
- */  
- 
