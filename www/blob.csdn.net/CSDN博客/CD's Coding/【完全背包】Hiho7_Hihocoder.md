# 【完全背包】Hiho7_Hihocoder - CD's Coding - CSDN博客





2014年11月02日 00:14:00[糖果天王](https://me.csdn.net/okcd00)阅读数：525









且说之前的故事里，小Hi和小Ho费劲心思终于拿到了茫茫多的奖券！而现在，终于到了小Ho领取奖励的时刻了！


等等，这段故事为何似曾相识？这就要从平行宇宙理论说起了………总而言之，在另一个宇宙中，小Ho面临的问题发生了细微的变化！


小Ho现在手上有M张奖券，而奖品区有N种奖品，分别标号为1到N，其中第i种奖品需要need(i)张奖券进行兑换，并且可以兑换无数次，为了使得辛苦得到的奖券不白白浪费，小Ho给每件奖品都评了分，其中第i件奖品的评分值为value(i),表示他对这件奖品的喜好值。现在他想知道，凭借他手上的这些奖券，可以换到哪些奖品，使得这些奖品的喜好值之和能够最大。

[提示一： 切，不就是0~1变成了0~K么](http://hihocoder.com/contest/hiho7/problem/1#)




令人欣慰的是，在这个平行世界里小Ho已经学习了一般的01背包问题，所以他并没有思考太久，便提出了自己的想法。


“我们的首要目标仍然是将问题抽象化！在我看来，这个问题其实和01背包问题很像，我们在解决01背包问题的时候是按照奖品的标号从1到N依次决定每件奖品是否选取，那么对于每种奖品有无数件的这个问题，我可以按照奖品的标号从1到N依次决定每种奖品选取的件数！”


小Hi点了点头表示赞同。


小Ho于是继续说道：“那么按照01背包的想法，我可以使用best(i, x)表示已经决定了前i件物品每件物品选择多少件，当前已经选取的物品的所需奖券数总和不超过x时，能够获取的最高的喜好值的和，那么最终的答案便是best(N, M)。”


小Hi道：”的确可以这样，那么你准备如何转移呢？”


小Ho道：“仍然是根据01背包的做法，对于一个问题best(i, x)，考虑最后一步——即第i件物品选择多少件，不妨就假设选择k件吧，那么k的取值范围肯定是在0~(x / need(i))这个范围内。这个时候我们可以知道best(i - 1, x - need(i) * k) + value(i) * k将会是一种可能的方案。”


小Hi挠了挠头，问道：”你所说的‘可能的方案’是什么意思？”


小Ho笑道：“就是说best(i, x)的求解满足这个公式~”


说罢，拿过纸笔，列出了一个式子。
![](http://media.hihocoder.com/problem_images/20140816/14081705839783.png)

小Hi接过纸来，看完说道：“的确没错，总共就是这些可能~那你是否求解这个问题也是用与01背包类似的方法进行求解呢？”


“是的，我会使用这样的方法来做！”小Ho刷刷刷又在纸上写下来几行伪代码。
![](http://media.hihocoder.com/problem_images/20140816/14081705839425.png)

“应该没有问题，时间复杂度也很不错了~~但是我看着总有点难受！”小Hi点了点头又摇头。


“怎么说？”


[提示二：强迫症患者总是会将状态转移方程优化一遍又一遍](http://hihocoder.com/contest/hiho7/problem/1#)




小Hi嘻嘻笑了两声，说道：“我们不妨换一种问题定义的方式：用best(i, x)表示已经决定了前i件物品每件物品选择多少件，当前已经选取的物品的所需奖券数总和不超过x时，能够获取的最高的喜好值的和！”


小Ho仔仔细细回忆了下，确认小Hi所说和自己先前并无区别，怒道：“你这和我的定义方法有什么区别呀？”


小Hi道：“别急别急，这部分的确没有区别，有区别的在后头~”


小Ho撇了撇嘴：“那你就说呗~”


小Hi继续道：“我们还是考虑最后一步——要不要再选一件第i种奖品！”


小Ho有点不能理解，道：“什么叫再选一件？”


“你想想，在你的状态转移方程（即问题求解公式）中是否满足这样两个公式？”小Hi问道。
![](http://media.hihocoder.com/problem_images/20140816/14081705833649.png)

小Ho低头想了想，点了点头表示赞同。


小Hi于是继续问道：“那你有没有意识到这样一个等式？”
![](http://media.hihocoder.com/problem_images/20140816/1408170583316.png)

“似乎……是的！”小Ho惊道：“这么说，其实best(i, x)的大部分计算都在best(i, x - need(i))中已经计算过了！”


小Hi问出了最后一个问题：“所以你的公式是不是就可以变成这样子呢？”


“是的！所以……代码就可以这么写了~是么！”
![](http://media.hihocoder.com/problem_images/20140816/14081705839467.png)

“是的嗯~”


[提示三：同样不要忘了优化空间哦！](http://hihocoder.com/contest/hiho7/problem/1#)


转到Hiho6提示二：




且说小Ho搞清楚了计算方法，正在埋头苦写代码，在一旁看他写代码的小Hi是在看不下去了，决定再指点指点小Ho：“小Ho啊！”


“怎么了？”小Ho眼睛盯着屏幕，望都没望小Hi一眼。


“你现在是不是需要开一个N * M大小的二维数组best，来记录求解出的best值呀？”


小Ho终于有了点反应，抬起头来说道：“是啊，怎么了？“


“我有办法不用开这么大空间哦~”小Hi笑嘻嘻道：”可我就是不告诉你！”


“诶，别这样，我请你吃雪糕！”小Ho一听就急了，连忙许下了报酬。


“开玩笑啦~”小Hi也是随便逗了逗乐子就没继续：“你想想，在i已经是10以上的时候，best(5, j)这样的值还有用么？”


“没有用了……你是说，我并不需要在内存中存下来所有的best(i, j)，没有用了的值都可以不进行保存……也就是说，实际上只要开一个2*M大小的数组就可以了，然后像这样的方式进行来回的计算，是不是就可以了？”
![](http://media.hihocoder.com//problem_images/20140809/14075630284798.png)


“是的呢！但是还可以更少哦~让我来写这个程序的话，我只需要开一个M大小的一维数组就可以了”小Hi自信的说道：“你想想，如果我按照j从M到1的顺序，也就是跟之前相反的顺序来进行计算的话。另外根据我们的状态转移方程，可以显然得出如果状态(iA, jA)依赖于状态(iB, jB)，那么肯定有iA = iB+1, jA>=jB。所以不难得出一个结论：我在计算best(i, j)的时候，因为best(i, j+1..M)这些状态已经被计算过了，所以意味着best(i - 1, k)，k=j..M这些值都没有用了——所有依赖于他们的值都已经计算完了。于是它们原有的存储空间都可以用来存储别的东西，所以我不仿直接就将best(i,
 j)的值存在best(i-1, j)原有的位置上，就像这样。”
![](http://media.hihocoder.com/problem_images/20140811/14077497148201.png)


“原来还可以这样！这样一处理，不仅空间复杂度小了很多，代码也很好看了呢！”小Ho开心道。


“那你还不去写？”




