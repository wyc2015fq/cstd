# 隐马尔可夫模型 - 算法与数学之美 - CSDN博客
2018年08月01日 20:51:00[算法与数学之美](https://me.csdn.net/FnqTyr45)阅读数：1758
在讲隐马尔可夫模型前，先介绍一下什么是马尔可夫链。
**马尔可夫链**(Markovchain)，又称**离散时间马尔可夫链**，因俄国数学家安德烈·马尔可夫得名，为状态空间中经过从一个状态到另一个状态转换的随机过程。该过程要求具备“无记忆”的性质：下一状态 S*t +1*的概率分布只能由当前状态 S*t *决定，与之前的状态无关。
即：*P*(S*t +1*| *S**1*, *S*2,   , S*t*) =*P*(S*t*+1| S*t*) 。
这种特定类型的“无记忆性”称作马尔可夫性质。符合该性质的随机过程则称为马尔可夫过程，也称为马尔可夫链。
**马尔可夫过程——“程序猿心情状态”案例**
假设有一只程序猿，它每天心情状态有三种：心情舒畅good、心情一般normal、心情糟糕bad。状态间的转移是存在某个概率的。如下图所示：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwI0KF81ymlggWPefz38ic3D9fbydZCuxRupwUjqrC0S3tw5PkTjm3Thg/640?wx_fmt=png)
图1  程序猿心情状态图
- 
*Sgood*代表心情舒畅状态、S*normal*代表心情一般状态、S*bad*代表心情糟糕状态。
上图表示从当前状态*Sgood*转移到下一时刻状态S*normal*的概率为0.9，当前状态*Sgood*转移到下一时刻状态S*bad*的概率为0.1，当前状态S*normal*转移到下一时刻还是自身的概率为0.7，当前状态S*normal*转移到下一时刻状态S*bad*的概率为0.3，当前状态S*bad*转移到下一时刻状态 S*normal*的概率为 1。
即为：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwknloibGiayvKOzYF6AWUqvAMCnic7eQQpAuicxajE3G6kWQ4LYHicx3rHYA/640?wx_fmt=png)
一个含有N 个状态的马尔可夫链有*N *2 个状态转移。这所有的*N *2 个概率可以用一个状态转移矩阵 A 来表示：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwwNzJRhasYFdOvgyzsJms7WSmoBLXkpyYnjrDrMIoEsgVxbNITROylw/640?wx_fmt=png)
这个状态转移矩阵 A 表示，如果在t 时刻该程序猿的心情状态是舒畅，则在 t+1 时刻的心情状态是舒畅、一般、糟糕的概率分别为(0,0.9,0.1)。
**隐马尔可夫模型**
隐马尔可夫模型(Hidden Markov Models，简称HMM)的出现，是为了弥补马尔可夫模型的不足，在某些较为复杂的随机过程中，任一时刻t 的状态*S**t *是不可见的。所以观察者没法观察到状态序列 S*1*,S2, L , *S**t *，但是隐马尔可夫模型在每个时刻 t 会输出一个观测状态*O**t *，而且*O**t *仅和 *S**t *相关。这个被称为独立输出假设。由此可生成一个观测序列*O*1 , *O*2 , L , *O**t *。
独立输出假设可记为：
*P*(*O**t *| *O*1, *O*2 ,L, *O**t *-1, *S*1, *S*2 ,L, *S**t *) =*P*(*O**t *| *S**t *)
隐马尔可夫模型的结构如下： 
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwaX3rRxI9zFRYJoz2zQWmLaHheXZMdn0qSIP0NHddFyPiciaLHLy8DicHw/640?wx_fmt=png)
图2 隐马尔可夫模型结构图
隐马尔可夫模型是由初始概率分布、状态转移概率分布以及观测概率分布确定。隐马尔可夫模型的形式定义如下：
设Q是所有可能的状态的集合，V是所有可能的观测的集合。记为：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwMnicUVgDGYYfhv5ib3BSwoHG4tlA7IWXoKKPx1FwmbLG1qiaGibDMXEA2w/640?wx_fmt=png)
S是长度为T的状态序列，O是对应的观测序列。记为：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dw8dDBpLOaS7jQYsoOcTCOUeS81Fia4a6KbM4ppcKGNuO0DTL6XQibFkKg/640?wx_fmt=png)
A 是状态转移概率矩阵：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwVJvvStbSNym04TIJp2LIicCRgxXpZiaUN3IIibiau9ncMRCicQnQWsm8RgQ/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwF9ns9ibItib0VP3qm5UfaTRgKedFgchZrcNda5sMccuicDPnic5putos3g/640?wx_fmt=png)
是在时刻t 处于状态*q**i *的条件下，在时刻t+1 转移到状态*q**j *的概率。
B 是观测概率矩阵：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwxdEgibVlQd9vxZaibtlBQ62iauPnkdbSqOTrmbaZnv6JegojqmoWJODwg/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwrhoDQBQiaTPaJALiabic95fdcSEo1oc1zlrfFcFmE0PhIu8PsQ8ZMGCXA/640?wx_fmt=png)
是在时刻t 处于状态*q**j*的条件下，生成观测值*V**k*的概率。
π是初始状态概率向量：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwfZZVUUgwvibhCEnC4cbN9AJneEwr7uibx57g1tNE3Kj3ASYmNl92qtZQ/640?wx_fmt=png)
其中，
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwq2xUekFb6mzt6MTVOycGGEzKvibO6EmTJSoqZQgqWANjBnRGk1qrB6g/640?wx_fmt=png)
是时刻t=1 处于状态*q**j*的概率。
隐马尔可夫模型由初始状态概率向量π、状态转移概率矩阵A 和观测概率矩阵B 决定。π和A 决定了状态序列，B 决定观测序列。因此，隐马尔可夫模型λ可以用三元符号表示，即：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwG7FQlJxIgT9ZXCmyZcP3IxT114NbGP9dEkFAiaSz5m48vuNFeUswAxA/640?wx_fmt=png)
围绕着隐马尔可夫模型通常有3 个基本问题需要解决：
**1、模型评估问题（概率计算问题）**
给定模型参数，计算某一观测序列输出的概率。
**2、解码问题（预测问题）**
给定模型参数和某一观测序列，计算得到最有可能输出这一观测序列的状态序列。
**3、参数估计问题（属于非监督学习算法）**
给定足够的观测序列集，如何计算得到模型的所有参数。
讲到这，隐马尔可夫模型的理论定义和三个问题都介绍完毕。
可能有朋友会问，这个模型到底有什么用？
先假设我们已经解决了以上的3 个问题，接下来请看一下典型的通信系统是什么样子的，想必“隐马尔可夫模型有什么用”这个问题便不攻自破了。
典型的通信系统（该案例参考自吴军《数学之美》第二版，P51）
l 发送者（人或者机器）发送信息时，需要采用一种能在媒体中（比如空气、电线）传播的信号，比如语音或者电话线的调制信号，这个过程就是广义上的编码。
l 然后通过媒体传播到接收方，这个过程是信道传输。
l 在接收方，接收者（人或者机器）根据事先约定好的方法，将这些信号还原成发送者的信息，这个过程是广义上的解码。
下图表示了一个典型的通信系统。
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwatnqJianOPXNE0XxmTu2kwVuNYggDZictB6IibzcOps6r3PicZzWTuZAxg/640?wx_fmt=png)
图3  通信模型
其中*S*1 , *S*2 ,, *S**n *表示信息源发出的信号，比如手机发送的信号。*O*1 , *O*2 ,*O**m *是接收器（比如另一部手机）接收到的信号。通信中的解码就是根据接收到的信号*O*1 , *O*2 ,L*O**m *，还原出发送的信号*S*1 , *S*2 ,L, *S**n *。
这跟自然语言处理又有什么关系？不妨换个角度来考虑这个问题，所谓的语音识别，就是听者（机器）去猜测说话者要表达的意思。这就像通信系统中，接收端根据收到的信号去还原出发送端发出的信号。
在通信中，如何根据接收端的观测信号*O*1 , *O*2 ,*O**m *来推测信号源发送的信息*S*1 , *S*2 , L , *S**n *呢？只需要从所有的源信息中找到最可能产生出观测信号的那一个信息。即：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwwgcYAjvqlibBDOd4weaRPWFFmqRM5NN9IoNXTW6YeonPhvtfrCLV9FQ/640?wx_fmt=png)
这个公式的意思是，找到一个信息*S*1 , *S*2 ,, *S**n *，可以使得
*P*(*S*1 , *S*2 ,, *S**n *| *O*1 , *O*2 ,*O**m *) 
达到最大值。
这个问题其实就是隐马尔可夫模型所提出的第2 个问题，即解码问题：给定模型参数和某一观测序列，计算得到最有可能输出这一观测序列的状态序列。
接下来我们逐一解决以上3 个问题，为了计算方便，上述的“程序猿心情状态案例”进行了简化，并修改成了符合隐马尔可夫模型的案例。
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dw9LGpESPuo0T5NrlRO6phicIohGmBEuWyccAe5HmqNCc9hQ83pwx5oZQ/640?wx_fmt=png)
图4 隐马尔可夫模型“程序猿心情状态”案例升级版
**问题求解**
在该模型中，初始状态概率向量*p*= {*S**good *= 0.8, *S**bad *= 0.2}，隐藏状态 N=2，可观测状态 M=3，状态转移概率矩阵 A 和观测概率矩阵 B 分别为：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwz07oMQZGES1xCsicPSkTtPDWZAv3Td6rM0UrHXjm7pg6r0h9qEUWnxA/640?wx_fmt=png)
在状态转移概率矩阵A 中，第1 行代表t 时刻心情舒畅状态，t+1 时刻心情状态分别是舒畅、糟糕的概率为（0.7,0.3）。第2 行同理。
在观测概率矩阵B 中，第1 行代表t 时刻心情为舒畅状态，t 时刻观测到的程序猿行为状态分别为出门旅游、在实验室写代码、回寝室睡觉的概率分别为（0.3,0.5,0.2）。第2 行同理。
现在开始解决上述的3 个问题。
**1、模型评估问题（概率计算问题）**
模型的各个参数现在已全部知道，假设连续3 天该程序猿的行为分别是出门旅游→在实验写代码→回寝室睡觉，计算产生这些行为的概率是多少？
**解**：
求解该问题可以使用遍历法，即把所有可能的情况都计算出来，然后将概率相加。在该
案例中共有3 种可观测状态，2 种隐藏状态，所以共有23 = 8 种可能的情况。由于该算法较为笨拙且计算繁琐，在此我就计算第一种情况，后面同理可得。其中一种：
第1 天心情舒畅→第 1 天出门旅游→第 2 天心情舒畅→第 2 天在实验室写代码→第 3 天心情舒畅→第 3 天回寝室睡觉。用符号表达即：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwwvE5E9hFQpqk3Odm29D5dFTCTONkke9cOia6EUL0ZrptTGneDQAYtMA/640?wx_fmt=png)
计算过程如下：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwOesGDjBkiaHmGRvQYSQHsyH1Cicr56MT4O0ArtcpbNhWdDsgDruMknIA/640?wx_fmt=png)
通常求解该问题，使用前向或后向算法，这样计算复杂度会比遍历法有所降低。以前向算法为例求解：
**   t=1 时，发生trip 这一行为的概率为：**
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwpY2FiaJCtklvxBX9ZxqvHsPXjZ3nj9JhYokkictiayEK8JJQxsEfNxePA/640?wx_fmt=png)
**t=2 时，根据上述的独立输出假设，发生lab 这一行为的概率为：**
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwwRSRrOiaR8JDrelkvm1ZCpEdicYPBcZx4QrZdHL0hZcDTUykLPw8dU4w/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwicibCKAj0fBticua7V0ibffVWyibgiaWrmjMSvLUAyISLePxj0MiaEz4kuoEQ/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dw2kZWkDLhQSeJ4XzQuXZpgicSwMIzjwwalDZ6fkicgXQ9C1dX7ZURGPHA/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwsvHGQGfTic5s2A0EsDKbvOJh2e6IR7tRURAvspUwcfCj4gaPeaHGnzA/640?wx_fmt=png)
**  t=3 时，根据上述的独立输出假设，发生sleep 这一行为的概率为：**
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwFD6wB5N8iasZoYQUiaAibAohtvKyJfW2LoJmjsFhBFHGVXTC7f5eJT3Vg/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwHA5fg8bcnDIuxpnyZlufj9rVicwFaPe88CeCLgZJLPZ2iaLeOL8GziaIA/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwNY6gpNgt9MpQLOE7SlGr6jNFE1mZr8jG8RGBKlic3su5JvT3y9aG2Xw/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwSvvv99DyyzzWyTib5VTibibkqD5e97VBUEQIroq2ATAF73Swr7iacLcMYA/640?wx_fmt=png)
综上，
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dw0nCV5TPxvoW5mnq24meWYMhiaaG0rVvCkB9PkQTJuAFTvCibXs7u8dLg/640?wx_fmt=png)
**2、解码问题（预测问题）**
解决该类问题，通常使用维特比算法。维特比算法是一种动态规划算法，它用于寻找最有可能产生观测序列的隐藏状态序列。
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwfDqH1icJeKeLzXMdjwIpZh4fJs1maVbicNN5ZGvuoWCLVvz5HjpB7U3g/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwiaP0NpNpPsmZJxvibxuESpJLgzFH5DHkov6qNatJ6yR09WVicLdUQnClw/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dw4TSXDCUHsEp4JsRqadhZLNn6nE6tiaLH4F0S3hjDAGlLia8ugL4Dem6A/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwSbKJhs2SA8LguWocXUZiabFXYUOstaqE9EmSIODEfLOCcIlvssLia2Aw/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwksS4KIib87qlz0MsJf07bxibP1DRNo1XEj2CMEUrMxM1bOCdT2WYoBhA/640?wx_fmt=png)
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dwhgcvTCiaLu8OibxqvaAFd7vgBQrRq4RpcBpRpwkGbnMNwvFbt3PatlgQ/640?wx_fmt=png)
回溯每一步的最大概率：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/CSKkwx0Pug1UTBBYIib8ATuXmBymu00dw8JAHTcxWLjZNVg8k8Lo2IGvicRMqCC5I0ICpGicabs1HS3Xnib5PfD7Ow/640?wx_fmt=png)
**3、参数估计问题（属于非监督学习算法）参数估计时，有两种不同的估计情况。**
**第一种**是，我们已知大量的隐藏状态集和观测状态集，并且知道它们之间的对应关系，这样在训练参数时，直接计算各个参数的相对频度即可代替概率。这种情况的数据属于人工标记数据，成本较高，现实中没有这么多的人力和物力去一一标注数据之间的对应关系。
**第二种**是，我们仅仅可得大量的观测状态集，不知隐藏状态集以及它们之间的对应关系。仅仅通过大量的观测状态集去推测各个参数的方法，称为无监督的训练方法，其中主要使用的是鲍姆-韦尔奇算法。
**鲍姆-韦尔奇算法的思想是这样的：**
“
首先初始化各个参数的值，值的大小不重要，重要的是要保证这些参数在模型中时，可以输出观测序列。有了初始化的各个参数后，隐马尔可夫模型就算初步齐全了，这时使用该模型输出所有可能的观测序列以及产生这些观测序列的概率。有了这些初步得到的观测序列和概率后，其实就相当于有了一定的人工标注数据，此时再去计算模型的参数， 一步步迭代，直到模型收敛到一个局部最优点。
”
**文章参考自：**
吴军《数学之美》；
李航《统计学习方法》； 周志华《机器学习》；
博客园，我是 8 位的，隐马尔可夫模型（一）
http://www.cnblogs.com/bigmonkey/p/7230668.html；
博客园，bonelee，隐形马尔可夫模型——前向算法就是条件概率
https://www.cnblogs.com/bonelee/p/7059082.html
![640?wx_fmt=gif](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/cZkI8M0nbClYCYIkqfrY3jKxllBevUDdTo5rZgTEHsHNCqHOyz5AkA2rMdNy2jmYGpKQjaWMebLuKyhE7ytCHg/640?wx_fmt=gif)
![640?wx_fmt=gif](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/CSKkwx0Pug0Fv584PEYvyKyjt0UuXTXqLCAIY0gKA1ia1mZqnVRBux3qlcNTpG9RFIaqyhyIHVt4F91lNexPnCQ/640?wx_fmt=gif)
