# DMA数据传输过程 - maopig的专栏 - CSDN博客
2013年05月22日 09:16:23[maopig](https://me.csdn.net/maopig)阅读数：8863
                
DMA方式具有如下特点：
　　1、 外部设备的输入输出请求直接发给主储存器。
主存储器既可以被CPU访问，也可以被外围设备访问。因此，在主存储器中通常要有一个存储管理部件来为各种访问主存储器的申请排队，一般计算机系统把外围设备的访问申请安排在最高优先级。
　　2、 不需要做保存现场和恢复现场等工作，从而使DMA方式的工作速度大大加快。
由于在外围设备与主存储器之间传送数据不需要执行程序，因此，也不动用CPU中的数据寄存器和指令计数器等。
　　3、在DMA控制器中，除了需要设置数据缓冲寄存器、设备状态寄存器或控制寄存器之外，还要设置主存储器地址寄存器，设备地址寄存器和数据交换个数计数器。
外围设备与主存储器之间的整个数据交换过程全部要在硬件控制下完成。另外，由于外围设备一般是以字节为单位传送的，而主存储器是以字为单位访问的，因此，在DMA控制器中还要有从字节装配成字和从字拆卸成字节的硬件。
　　4、在DMA方式开始之前要对DMA控制器进行初始化，包括向DMA控制器传送主存缓冲区首地址、设备地址、交换的数据块的长度等，并启动设备开始工作。在DMA方式结束之后，要向CPU申请中断，在中断服务程序中对主存储器中数据缓冲区进行后处理。如果需要继续传送数据的话，要再次对DMA控制器进行初始化。
　　5、在DMA方式中，CPU不仅能够与外围设备并行工作，而且整个数据的传送过程不需要CPU的干预。如果主存储器的频带宽度足够的话，外围设备的工作可以丝毫不影响CPU运行它自身的程序。
　　DMA方式的工作流程如下：
　　对于输入设备：
　　从输入介质上读一个字节或字到DMA控制器中的数据缓冲寄存器BD中，如果输入设备是面向字符的，则要把读入的字符装配成字。
　　若一个字还没有装配满，则返回到上面；若校验出错，则发中断申请；若一个字已经装配满，则将BD中的数据送入主存数据寄存器。
　　把主存地址寄存器BA（在DMA控制器中）中的地址送入主存地址寄存器，并且将BA中的地址增值至下一个字地址。
　　把DMA控制器内的数据交换个数计数器BC中的内容减"1"。
　　若BC中的内容为"0"，则整个DMA数据传送过程全部结束，否则返回到最上面继续进行。
　　对于输出设备：
　　把主存地址寄存器BA（在DMA控制器中）中的地址送入主存地址寄存器，并启动主存储器，同时将BA中的地址增值至下一个字地址。
　　将主存储器数据寄存器中的数据送入DMA控制器的数据缓冲寄存器BD中。如果输出设备是面向字符的，则要把BD中的数据拆卸字符。
　　把BD中数据逐个字符（对于面向字符的设备）或整个字写到输出介质上。
　　把DMA控制器内的数据交换个数计数器BC中的内容减"1"。
　　若BC中的内容为"0"，则整个DMA数据传送过程全部结束，否则返回到最上面继续进行。
　　目前使用的DMA方式实际上有如下三种：
　　1、周期窃取方式
　　在每一条指令执行结束时，CPU测试有没有DMA服务申请，如果有，则CPU进入一个DMA周期。在DMA周期中借用CPU完成上面所列出的DMA工作流程。包括数据和主存地址的传送，交换个数计数器中的内容减"1"，主存地址的增值及一些测试判断等。
采用周期窃取方式时，主存储器可以不与外围设备直接相连接，而只与CPU连接，即仍然可以采用如图4.4那样的连接方式，因为外围设备与主存储器的数据交换与程序控制输入输出方式和中断输入输出方式一样都是要经过CPU的。
　　周期窃取方式与程序控制输入输出方式和中断输入输出方式的不同处主要在：它不需要使用程序来完成数据的输入或输出，只是借用了一个CPU的周期来完成DMA流程。因此，其工作速度是很快的。
　　周期窃取方式的优点是硬件结构很简单，比较容易实现。缺点是在数据输入或输出过程种实际上占用了CPU的时间。
　　2、直接存取方式
　　这是一种真正的DMA方式。DMA控制器的数据传送申请不是发向CPU，而是直接发往主存储器。在得到主存储器的响应之后，整个DMA工作流程全部在DMA控制器中用硬件完成。
　　直接存取方式的优点与缺点正好与周期窃取方式相反。
　　目前的多数计算机系统均采用直接存取方式工作。
　　3、数据块传送方式
　　在设备控制器中设置一个比较大的数据缓冲存储器，一般要能够存放下一个数据块，如在软磁盘存储器中通常设置512个字节的数据缓冲存储器。与设备介质之间的数据交换在数据缓冲存储器中进行。设备控制器与主存储器之间的数据交换以数据块为单位，并采用程序中断方式进行。
　　数据块传送方式实际上并不是DMA方式，只是它在每次中断输入输出过程中是以数据块为单位获得或发送数据的，这一点与上面两种DMA方式相同，因此，通常也把这种输入输出方式归入DMA方式。
采用数据块传送方式的外围设备还有行式打印机，激光打印机，卡片阅读机，部分绘图仪等。
