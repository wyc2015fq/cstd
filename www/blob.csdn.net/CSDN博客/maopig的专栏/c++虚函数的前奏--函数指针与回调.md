# c++虚函数的前奏--函数指针与回调 - maopig的专栏 - CSDN博客
2011年09月06日 18:51:03[maopig](https://me.csdn.net/maopig)阅读数：1172标签：[c++](https://so.csdn.net/so/search/s.do?q=c++&t=blog)
个人分类：[c/C++](https://blog.csdn.net/maopig/article/category/847675)
                
声明函数指针并实现回调
程序员常常需要实现回调。本文将讨论函数指针的基本原则并说明如何使用函数指针实现回调。注意这里针对的是普通的函数，不包括完全依赖于不同语法和语义规则的类成员函数（类成员指针将在另文中讨论）。
声明函数指针
回调函数是一个程序员不能显式调用的函数；通过将回调函数的地址传给调用者从而实现调用。要实现回调，必须首先定义函数指针。尽管定义的语法有点不可思议，但如果你熟悉函数声明的一般方法，便会发现函数指针的声明与函数声明非常类似。请看下面的例子：
void f()；// 函数原型
上面的语句声明了一个函数，没有输入参数并返回void。那么函数指针的声明方法如下：
void (*) ();
让我们来分析一下，左边圆括弧中的星号是函数指针声明的关键。另外两个元素是函数的返回类型（void）和由边圆括弧中的入口参数（本例中参数是空）。注意本例中还没有创建指针变量-只是声明了变量类型。目前可以用这个变量类型来创建类型定义名及用sizeof表达式获得函数指针的大小：
// 获得函数指针的大小
unsigned psize = sizeof (void (*) ()); 
// 为函数指针声明类型定义
typedef void (*pfv) ();
pfv是一个函数指针，它指向的函数没有输入参数，返回类行为void。使用这个类型定义名可以隐藏复杂的函数指针语法。
指针变量应该有一个变量名：
void (*p) (); //p是指向某函数的指针
p是指向某函数的指针，该函数无输入参数，返回值的类型为void。左边圆括弧里星号后的就是指针变量名。有了指针变量便可以赋值，值的内容是署名匹配的函数名和返回类型。例如：
void func() 
{
/* do something */
} 
p = func; 
p的赋值可以不同，但一定要是函数的地址，并且署名和返回类型相同。
传递回调函数的地址给调用者
现在可以将p传递给另一个函数（调用者）- caller()，它将调用p指向的函数，而此函数名是未知的：
void caller(void(*ptr)())
{
ptr(); /* 调用ptr指向的函数 */ 
}
void func();
int main()
{
p = func; 
caller(p); /* 传递函数地址到调用者 */
}
如果赋了不同的值给p（不同函数地址），那么调用者将调用不同地址的函数。赋值可以发生在运行时，这样使你能实现动态绑定。
回调函数，就是由你自己写的。你需要调用另外一个函数，而这个函数的其中一个参数，就
是你的这个回调函数名。这样，系统在必要的时候，就会调用你写的回调函数，这样你就可
以在回调函数里完成你要做的事。
模块A有一个函数foo，它向模块B传递foo的地址，然后在B里面发生某种事件（event）时，通过从A里面传递过来的foo的地址调用foo，通知A发生了什么事情，让A作出相应反应。 那么我们就把foo称为回调函数。
