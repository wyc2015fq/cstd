# R Sys.setenv - 三少GG - CSDN博客
2014年03月12日 16:33:54[三少GG](https://me.csdn.net/scut1135)阅读数：2102

[http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs)
# [Failed to remotely execute R script which loads library “rhdfs”](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs)
![](http://engine.adzerk.net/i.gif?e=eyJhdiI6Nzg5NSwiYXQiOjQsImNtIjo3NjcwNywiY2giOjExNzgsImNyIjoyMTEwMzQsImRpIjoiMzk5MzBhNmJkODJiNGU1ZmI5YTM0Y2FlNGYwNzQ2Y2QiLCJkbSI6MSwiZmMiOjI2NTM0MSwiZmwiOjEzNjkxNSwia3ciOiJyLHJlbW90ZS1hY2Nlc3MscmVtb3RlLXNlcnZlcixqc2NoLHJoYWRvb3AiLCJtayI6InJlbW90ZS1hY2Nlc3MscmVtb3RlLXNlcnZlciIsIm53IjoyMiwicGMiOjcuMjUsInByIjo3NjUsInJ0IjoyLCJyZiI6Imh0dHA6Ly93d3cuZ29vZ2xlLmNvbS5oay91cmw_c2E9dCZyY3Q9aiZxPXJoZGZzICZzb3VyY2U9d2ViJmNkPTcmdmVkPTBDRnNRRmpBRyZ1cmw9aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNzU4Mzg0Ni9mYWlsZWQtdG8tcmVtb3RlbHktZXhlY3V0ZS1yLXNjcmlwdC13aGljaC1sb2Fkcy1saWJyYXJ5LXJoZGZzJmVpPUZJSWVVX0h0SUtHNGlRZngyb0NZRGcmdXNnPUFGUWpDTkc1XzVSSzZkN3VENmtMWnE3alY3VnJWeWl1M2cmYnZtPWJ2LjYyNzg4OTM1LGQuYUdjJmNhZD1yanQiLCJzdCI6ODI3Nywiem4iOjQzLCJ0cyI6MTM5NDUwODM0ODkxNH0&s=yAXc-g2jsdo2yhF_0TTZ5SA2-SM)
|up vote1down vote[favorite](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#)|I'm working on a project using R-Hadoop, and got this problem.I'm using JSch in JAVA to ssh to remote hadoop pseudo-cluster, and here are part of Java code to create connection.```/* Create a connection instance */Connection conn = new Connection(hostname);/* Now connect */conn.connect();/* Authenticate */boolean isAuthenticated = conn.authenticateWithPassword(username, password);if (isAuthenticated == false)throw new IOException("Authentication failed.");/* Create a session */Session sess = conn.openSession();//sess.execCommand("uname -a && date && uptime && who");sess.execCommand("Rscript -e 'args1 <- \"Dell\"; args2 <- 1; source(\"/usr/local/R/mytest.R\")'");//sess.execCommand("ls");sess.waitForCondition(ChannelCondition.TIMEOUT, 50);```I tried several simple R scripts, and my codes worked fine. But when it comes to R-Hadoop, the R script will stop running. But if I run`Rscript -e 'args1 <- "Dell"; args2 <- 1; source("/usr/local/R/mytest.R")'` directly in remote server, everything works fine.**Here is what I got after taking Hong Ooi's suggestion:**Instead of using Rscript, I used following command:`sess.execCommand("R CMD BATCH --no-save --no-restore '--args args1=\"Dell\" args2=1' /usr/local/R/mytest.R /usr/local/R/whathappened.txt");`And in the whathappened.txt, I got following error:```> args=(commandArgs(TRUE))> for(i in 1:length(args)){+      eval(parse(text=args[[i]]))+ }> source("/usr/local/R/main.R")> main(args1,args2)Loading required package: rJavaError : .onLoad failed in loadNamespace() for 'rhdfs', details:  call: fun(libname, pkgname)  error: Environment variable HADOOP_CMD must be set before loading package rhdfsError: package/namespace load failed for 鈥榬hdfs鈥?Execution halted```Well, now the problem is much clearer. Unfortunately, I'm pretty new to linux, and have no idea how to solve this.[r](http://stackoverflow.com/questions/tagged/r)[remote-access](http://stackoverflow.com/questions/tagged/remote-access)[remote-server](http://stackoverflow.com/questions/tagged/remote-server)[jsch](http://stackoverflow.com/questions/tagged/jsch)[rhadoop](http://stackoverflow.com/questions/tagged/rhadoop)|[share](http://stackoverflow.com/q/17583846)|[improve this question](http://stackoverflow.com/posts/17583846/edit)|[editedJul 11 '13 at 18:30](http://stackoverflow.com/posts/17583846/revisions)|asked Jul 11 '13 at 1:57[](http://stackoverflow.com/users/2502879/hao-huang)![](https://www.gravatar.com/avatar/91067fdd161fa99b2aad0ce772d6f0f9?s=32&d=identicon&r=PG)[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)348||[share](http://stackoverflow.com/q/17583846)|[improve this question](http://stackoverflow.com/posts/17583846/edit)|[editedJul 11 '13 at 18:30](http://stackoverflow.com/posts/17583846/revisions)|asked Jul 11 '13 at 1:57[](http://stackoverflow.com/users/2502879/hao-huang)![](https://www.gravatar.com/avatar/91067fdd161fa99b2aad0ce772d6f0f9?s=32&d=identicon&r=PG)[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)348| | | | | | | | | | | | | |
|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|
|[share](http://stackoverflow.com/q/17583846)|[improve this question](http://stackoverflow.com/posts/17583846/edit)|[editedJul 11 '13 at 18:30](http://stackoverflow.com/posts/17583846/revisions)|asked Jul 11 '13 at 1:57[](http://stackoverflow.com/users/2502879/hao-huang)![](https://www.gravatar.com/avatar/91067fdd161fa99b2aad0ce772d6f0f9?s=32&d=identicon&r=PG)[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)348| | | | | | | | | | | | | | | |
|||||||||What error message(s) do you get with RHadoop? Are they Java or R errors?–[Hong Ooi](http://stackoverflow.com/users/474349/hong-ooi)[Jul 11 '13 at 4:53](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25589700_17583846)||----|----|----|----|||| | ||||||||@HongOoi The R script will automatically run in background in remote server, which means the command line user interface in remote server remains unchanged, thus I can't even know what exactly happened in remote server. Even if I add cat("blabla") to the R script, I'll not get any printed information in remote server. So I used a tricky method, generating txt files with name like "Inside xxx function" to see how far the script goes, which turns out it will stop every time when it  try to execute "library("whatever")"–[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul 11 '13 at 17:02](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25613598_17583846)|||| | ||||||||You can use`sink` to redirect output to a file. That might help you diagnose what's going on.–[Hong Ooi](http://stackoverflow.com/users/474349/hong-ooi)[Jul 11 '13 at 17:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25613675_17583846)|||| | ||||||||@HongOoi Thanks for your advice! Check my question update, it shows more information. But I'm so new to linux, and I really don't know how to handle problems related to namespace things.–[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul 11 '13 at 18:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25615623_17583846)|||| | |@HongOoi Thanks for your advice! Check my question update, it shows more information. But I'm so new to linux, and I really don't know how to handle problems related to namespace things.–[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul 11 '13 at 18:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25615623_17583846)add comment|||||||What error message(s) do you get with RHadoop? Are they Java or R errors?–[Hong Ooi](http://stackoverflow.com/users/474349/hong-ooi)[Jul 11 '13 at 4:53](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25589700_17583846)|||||||@HongOoi The R script will automatically run in background in remote server, which means the command line user interface in remote server remains unchanged, thus I can't even know what exactly happened in remote server. Even if I add cat("blabla") to the R script, I'll not get any printed information in remote server. So I used a tricky method, generating txt files with name like "Inside xxx function" to see how far the script goes, which turns out it will stop every time when it  try to execute "library("whatever")"–[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul 11 '13 at 17:02](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25613598_17583846)|||||||You can use`sink` to redirect output to a file. That might help you diagnose what's going on.–[Hong Ooi](http://stackoverflow.com/users/474349/hong-ooi)[Jul 11 '13 at 17:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25613675_17583846)|||||||@HongOoi Thanks for your advice! Check my question update, it shows more information. But I'm so new to linux, and I really don't know how to handle problems related to namespace things.–[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul 11 '13 at 18:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25615623_17583846)|
|||||||What error message(s) do you get with RHadoop? Are they Java or R errors?–[Hong Ooi](http://stackoverflow.com/users/474349/hong-ooi)[Jul 11 '13 at 4:53](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25589700_17583846)| | | | | | | | | | | | | | |
||| | | | | | | | | | | | | | | | |
|||||||@HongOoi The R script will automatically run in background in remote server, which means the command line user interface in remote server remains unchanged, thus I can't even know what exactly happened in remote server. Even if I add cat("blabla") to the R script, I'll not get any printed information in remote server. So I used a tricky method, generating txt files with name like "Inside xxx function" to see how far the script goes, which turns out it will stop every time when it  try to execute "library("whatever")"–[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul 11 '13 at 17:02](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25613598_17583846)| | | | | | | | | | | | | | |
||| | | | | | | | | | | | | | | | |
|||||||You can use`sink` to redirect output to a file. That might help you diagnose what's going on.–[Hong Ooi](http://stackoverflow.com/users/474349/hong-ooi)[Jul 11 '13 at 17:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25613675_17583846)| | | | | | | | | | | | | | |
||| | | | | | | | | | | | | | | | |
|||||||@HongOoi Thanks for your advice! Check my question update, it shows more information. But I'm so new to linux, and I really don't know how to handle problems related to namespace things.–[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul 11 '13 at 18:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25615623_17583846)| | | | | | | | | | | | | | |
||| | | | | | | | | | | | | | | | |
@HongOoi Thanks for your advice! Check my question update, it shows more information. But I'm so new to linux, and I really don't know how to handle problems related to namespace things.–
[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)[Jul
 11 '13 at 18:05](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#comment25615623_17583846)
add comment
## 2 Answers 
[active](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs?answertab=active#tab-top)[oldest](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs?answertab=oldest#tab-top)[votes](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs?answertab=votes#tab-top)
|up vote2down vote|Well, I solved this problem like this:`sess.execCommand("source /etc/profile; R CMD BATCH --no-save --no-restore '--args args1=\"Dell\" args2=1' /usr/local/R/mytest.R /usr/local/R/whathappened.txt");`The problem was caused by environment. SSH to the remote Hadoop cluster actually uses a different environment, so variables like $HADOOP_CMD will not be discovered. There are multiple ways to let the SSH session know how to pick the environment variables.In my method, the `"source /etc/profile"` can tell the sshed environment where to find the environment virables.|[share](http://stackoverflow.com/a/17711700)|[improve this answer](http://stackoverflow.com/posts/17711700/edit)|answered Jul 17 '13 at 22:57[](http://stackoverflow.com/users/2502879/hao-huang)![](https://www.gravatar.com/avatar/91067fdd161fa99b2aad0ce772d6f0f9?s=32&d=identicon&r=PG)[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)348||[share](http://stackoverflow.com/a/17711700)|[improve this answer](http://stackoverflow.com/posts/17711700/edit)|answered Jul 17 '13 at 22:57[](http://stackoverflow.com/users/2502879/hao-huang)![](https://www.gravatar.com/avatar/91067fdd161fa99b2aad0ce772d6f0f9?s=32&d=identicon&r=PG)[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)348|
|----|----|----|----|
|[share](http://stackoverflow.com/a/17711700)|[improve this answer](http://stackoverflow.com/posts/17711700/edit)|answered Jul 17 '13 at 22:57[](http://stackoverflow.com/users/2502879/hao-huang)![](https://www.gravatar.com/avatar/91067fdd161fa99b2aad0ce772d6f0f9?s=32&d=identicon&r=PG)[Hao Huang](http://stackoverflow.com/users/2502879/hao-huang)348| | |
|||||add comment|||
||| | |
add comment

No problem. We won't show you that ad again. Why didn't you like it?- Uninteresting
- Misleading
- Offensive
- Repetitive
[Oops! I didn't mean to do this.](http://stackoverflow.com/questions/17583846/failed-to-remotely-execute-r-script-which-loads-library-rhdfs#)
![](http://engine.adzerk.net/i.gif?e=eyJhdiI6Nzg5NSwiYXQiOjQsImNtIjo3NjcwNywiY2giOjExNzgsImNyIjoyMTExMTMsImRpIjoiNjVkZmMzYzJmN2MxNDdjMjg3NGYzNDI3MTc2ZmNmYTYiLCJkbSI6MSwiZmMiOjI2NTQ0OSwiZmwiOjEzNjk5Mywia3ciOiJyLHJlbW90ZS1hY2Nlc3MscmVtb3RlLXNlcnZlcixqc2NoLHJoYWRvb3AiLCJtayI6InJlbW90ZS1hY2Nlc3MscmVtb3RlLXNlcnZlciIsIm53IjoyMiwicGMiOjAsInByIjo3NjUsInJ0IjoxLCJyZiI6Imh0dHA6Ly93d3cuZ29vZ2xlLmNvbS5oay91cmw_c2E9dCZyY3Q9aiZxPXJoZGZzICZzb3VyY2U9d2ViJmNkPTcmdmVkPTBDRnNRRmpBRyZ1cmw9aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNzU4Mzg0Ni9mYWlsZWQtdG8tcmVtb3RlbHktZXhlY3V0ZS1yLXNjcmlwdC13aGljaC1sb2Fkcy1saWJyYXJ5LXJoZGZzJmVpPUZJSWVVX0h0SUtHNGlRZngyb0NZRGcmdXNnPUFGUWpDTkc1XzVSSzZkN3VENmtMWnE3alY3VnJWeWl1M2cmYnZtPWJ2LjYyNzg4OTM1LGQuYUdjJmNhZD1yanQiLCJzdCI6ODI3Nywiem4iOjQ0LCJ0cyI6MTM5NDUwODM0ODkxOH0&s=FURN0J_NY6MpECfmA6EBBeN1ZPA)
|up vote2down voteaccepted|Well, I just found another solution by myself:Instead of caring about env from outside Hadoop cluster, can set env in R scripts like:`**Sys.setenv(HADOOP_HOME="put your HADOOP_HOME path here")Sys.setenv(HADOOP_CMD="put your HADOOP_CMD path here")library(rmr2)library(rhdfs)**`[share](http://stackoverflow.com/a/17983231)|[improve this answer](http://stackoverflow.com/posts/17983231/edit)|[share](http://stackoverflow.com/a/17983231)|[improve this answer](http://stackoverflow.com/posts/17983231/edit)|
|----|----|----|
|[share](http://stackoverflow.com/a/17983231)|[improve this answer](http://stackoverflow.com/posts/17983231/edit)| | |
