# 利用AT和shutdown命令实现自动关机任务||远程桌面关闭重启电脑 - 三少GG - CSDN博客
2011年03月04日 11:23:00[三少GG](https://me.csdn.net/scut1135)阅读数：3065
利用两个命令:
1、shutdown
2、at
----------------------------------
主要命令：shutdown -s -f
该命令表示，-s关闭计算机，-f强制关闭正在运行的程序而不出现警告
为了实现定时关机，可使用at命令
组合起来之后应该是
at 00:15 shutdown -s -f
这表示在00:15分执行shutdown -s -f操作。如果当前时间大于任务执行时间，则默认为明日执行。
----------------------------------
如果要重复执行一个任务，则可以使用every参数。该参数支持日期和星期的表示方式
例如at 00:15 /every:M,T,W,Th,F,S,Su shutdown -s -f
该命令表示每个周一到周五都执行该命令
也可以使用/evert:1,3,5,7,9等日期方式
-----------------------------------
任务的查看
如果要查看已经设定的任务，可直接执行at命令不带任何参数。
该命令返回两个结果。
1、列表是空的
       表示没有任何任务
2、状态 ID     日期                     时间           命令行
------------------------------------------------------------------
         1   明天                     0:18           shutdown -s -f
         2   每月执行日期:...         0:18           shutdown -s -f
   显示所有已经有的任务列表。
如果使用at 2的命令，则可以得到
C:/Users/Administrator>at 2
任务 ID:       2
状态:           OK
计划:           每月执行日期: 星期一 星期二 星期三
时间:   0:18
交互:           No
命令:           shutdown -s -f
这可以看到该任务的详情
--------------------------------------
任务的输出
cmd /c at > c:/a.txt
也就是说，通过cmd /c 命令 > 路径/文件名
可以把指定命令的执行结果输出为指定文件
体验Windows XP系统内置的AT命令 
AT命令是Windows XP中内置的命令，它也可以媲美Windows中的“计划任务”，而且在计划的安排、任务的管理、工作事务的处理方面，AT命令具有更强大更神通的功能。AT命令可在指定时间和日期、在指定计算机上运行命令和程序。
我们可以在“开始→运行”中输入AT命令，下面就来看看AT命令的一些实例分析。 
1、定时关机 
命令：at 21:00 ShutDown –S –T30 
该命令运行后，到了21:00点，电脑会出现“系统关机”对话框，并默认30秒延时自动关机。 
2、定时提醒 
命令：at 12:00 Net Send 10.10.36 
.122与朋友约会的时间到了，快点准备出发吧! 
其中Net Send是Windows内部程序，可以发送消息到网络上的其他用户、计算机。10.10.36.122是本机电脑的IP地址。这个功能在Windows中也称作“信使服务”。
3、自动运行批处理文件 
如果公司的数据佷重要，要求在指定的日期/时间进行备份，那么运行： 
命令：at 1:00AM /Every:Saturday My_BackUp.bat 
这样，在每个Saturday（周六）的早上1:00点，电脑定时启动My_BackUp.bat批处理文件。My_BackUp.bat是一个你自行编制的批处理文件，它包含能对系统进行数据完全备份的多条命令。
4、取消已经安排的计划 
命令：at 5 /Delete 
有时候，你已经安排好的计划可能临时变动，这样你可以及时地用上述命令删除该计划（5为指派给已计划命令的标识编号），当然，删除该计划后，可以重新安排。
(以上文章转自 [http://cddspj.blog.163.com/blog/static/334589820087311315723/](http://cddspj.blog.163.com/blog/static/334589820087311315723/))
==========================供参考=================================
用at配合shutdown命令非常方便。
比如要在晚上22:00关机,可以使用at 22:00** shutdown -s -f**
附ShutDown用法及参数
用法: shutdown [-i | -l | -s | -r | -a] [-f] [-m /computername] [-t xx] [-c "comment"] [-d up:xx:yy]
没有参数 显示此消息(与 ? 相同)
-i 显示 GUI 界面，必须是第一个选项
-l 注销(不能与选项 -m 一起使用)
-s 关闭此计算机
-r 关闭并重启动此计算机
-a 放弃系统关机
-m /computername 远程计算机关机/重启动/放弃
-t xx 设置关闭的超时为 xx 秒
-c "comment" 关闭注释(最大 127 个字符)
-f 强制运行的应用程序关闭而没有警告
-d [u][p]:xx:yy 关闭原因代码
u 是用户代码
p 是一个计划的关闭代码
xx 是一个主要原因代码(小于 256 的正整数)
yy 是一个次要原因代码(小于 65536 的正整数)
-f：强行关闭应用程序
-m /计算机名：控制远程计算机
-i：显示图形用户界面，但必须是Shutdown的第一个选项
-l：注销当前用户
-r：关机并重启
-t时间：设置关机倒计时
-c "消息内容"：输入关机对话框中的消息内容(不能超127个字符)
举例：
关闭计算机 shutdown –s （方法：”开始”->”运行”->”shutdown -s”->”确定”）
延迟3秒关闭计算机 shutdown –s –t 3（方法：”开始”->”运行”->”shutdown –s –t 3”->”确定”）
取消关闭计算机 shutdown –a （方法：”开始”->”运行”->”shutdown –a”->”确定”）
应用：
(1)您如果想在1小时后自动关闭计算机，比如：您正在下载一个软件或一部电影，而您有急事要去丽水，您会怎么办？停止下载？太可惜了！继续？下载完后电脑怎么关闭？不用愁！您可以使用该命令解决：
shutdown –s –t 3600 (系统在3600秒后关闭计算机，时间自定)
您就放心地走，而不用担心您的计算机长期开着了。
(2)出现RPC漏洞而导致倒计时自动关机，使用该命令取消倒计时自动关机：
shutdown –a （方法：”开始”->”运行”->”shutdown –a”->”确定”）
前一段时间的网络病毒非常猖獗，如震荡波、冲击波等就是针对WindowsXP的RPC(远程过程调用)漏洞设计的，它导致系统倒计时自动关机，很多同学、老师头痛不已。
(3)利用Shutdown命令 实现网络统一关机
笔者所在单位下班后常有很多老师不关电脑，领导发现后要求解决这个问题。我想如果到各办公室去查看，这很费时，于是就想能否通过一台电脑把所有的机器都关掉。因为所有的办公用机安装的都是Windows XP系统，就想到了使用远程关机“Shutdown”命令。具体方法如下：
步骤1 单击“开始→运行”，在对话框中输入“Gpedit.msc”，单击[确定]，打开“组策略编辑器”。
步骤2 在“组策略编辑器”窗口的左边打开“计算机配置→Windows设置→安全设置→本地策略→用户权利指派”，在右边的窗口选择“从远端系统强制关机”。在弹出的对话框中显示目前只有“Administrators”组的成员才有权远程关机；单击对话框下方的[添加用户或组]按钮，然后在弹出的对话框中输入 “Heyongsheng”(管理员账号)，再单击[确定]。
步骤3 这时在“从远端系统强制关机”的属性中便添加了一个“Heyongsheng”用户，单击[确定]，最后关闭“组策略编辑器”窗口。
对各办公室的电脑进行上述操作后，我们便给每台计算机的“Heyongsheng”用户授予了远程关机的权限。到下班时，我只要在自己的机器上进行以下操作：
步骤4单击“开始→运行”，在对话框中输入“Shutdown -I”，屏幕上将显示“远程关机”对话框。
(4)用XP的ShutDown.exe实现服务器定时重启
Windows XP的关机是由Shutdown.exe程序来控制的，位于WindowsSystem32文件夹中。如果想让Windows 2000也实现同样的效果，可以把Shutdown.exe复制到系统目录System32下。
首先当然要求主板必须支持软件关机功能，否则你还得亲自去按电源开关才能关机，现在的主板一般都支持软件关机。操作步骤：单击“开始”/程序/附件/系统工具中"计划任务"，弹出计划任务窗口，然后双击"添加已计划的任务"，运行“计划任务向导”，按“浏览”，找到WINDOWS目录中的 Rundll32.exe 文件，单击"打开"按钮，在出现的对话框中键入该任务的名字(如"定时关机")，执行方式选择“每天” ，然后按“下一步”选择定时关机时间(可以先试一下比现在机器上显示的时间晚1分钟)，下一步选中“当单击完成打开该任务的高级属性”，单击"完成"，最后右击"定时关机"来打开属性，在运行栏输入“C:WINNTsystem32shutdown.exe -r -t 1”，单击"确定"不久，OK了。
结论：
WindowsXP中的shutdown命令功能很强大，你可以去尝试使用，挖掘出功能，为我们服务。创建个快截方式 地址里输入 shutdown -t -s 3600 
然后把他复制到 开始 程序 启动里 
或者 在 注册表的 run 项目下 加入 这个快截方式的 地址 
你也可以放在boot．inf里的lood 语句中 
还可以用批 处理 
vbs 文件 
用vbs文件的好处是可以后台运行控制时间不向你的破语句 
输入shutdown -a 就结束了 
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
远程桌面关闭重启电脑的方法  
如果一台XP打开远程桌面连接,你从其它的PC上用mstsc命令登录.登录当需要关机时显示“注销”和“断开”
一.在桌面上单一下,然后用Alt+F4键
二.使用命令:
使用命令方式,进入CLI(command Line interface),在运行命令前,请正确保存你现在所做的信息.使用:
shutdown -s -f -t 0(关闭)
**shutdown -r -f -t 0(重启)**
三.
   难道当我们想要重新启动该计算机或者关闭系统时该如何操作呢？实际上我们只需要在远程桌面操作界面上同时按住CTRL和SHIFT键，接下来在按ESC键，这样将呼出远程系统的“Windows 任务管理器”，接下来点菜单中的“关机”，你会发现在这个选项中有“重新启动”和“关闭”选项，对应的是将系统重启和关闭远程计算机。我们可以根据需要进行操作即可。
