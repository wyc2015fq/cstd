# LocalSocket / LocalServerSocket - 三少GG - CSDN博客
2012年03月22日 09:49:44[三少GG](https://me.csdn.net/scut1135)阅读数：1796
### [Android LocalSocket / LocalServerSocket sample code](http://all4dev.blogspot.com.sixxs.org/2009/02/android-localsocket-localserversocket.html)
Abstract: This short code sample demonstrates how one can to use LocalSocket (LocalServerSocket) in Android SDK.
Platforms: Android SDK 1.0 (Eclipse 3.4.1 + ADT 0.8.0)
Add one button into your layout (main.xml):
<Buttonandroid:id="@+id/send_1_button"android:layout_width="fill_parent"android:layout_height="wrap_content"android:text="send 1 request"/>
And this simple code for your activity
import java.io.IOException;import java.io.InputStream;import android.app.Activity;import android.net.LocalServerSocket;import android.net.LocalSocket;import android.net.LocalSocketAddress;import android.os.Bundle;import android.os.Handler;import android.util.Log;import android.view.View;import android.view.View.OnClickListener;import android.widget.Button;import android.widget.Toast;/**** @author Denis Migol**/publicclassDemoActivityextendsActivity{publicstaticString SOCKET_ADDRESS ="your.local.socket.address";// background threads use this Handler to post messages to// the main application threadprivatefinalHandler handler =newHandler();publicclassNotificationRunnableimplementsRunnable{privateString message =null;publicvoid run(){if(message !=null&& message.length()>0){                showNotification(message);}}/**        * @param message the message to set        */publicvoid setMessage(String message){this.message = message;}}// post this to the Handler when the background thread notifiesprivatefinalNotificationRunnable notificationRunnable =newNotificationRunnable();publicvoid showNotification(String message){Toast.makeText(this, message,Toast.LENGTH_SHORT).show();}classSocketListenerextendsThread{privateHandler handler =null;privateNotificationRunnable runnable =null;publicSocketListener(Handler handler,NotificationRunnable runnable){this.handler = handler;this.runnable = runnable;this.handler.post(this.runnable);}/**        * Show UI notification.        * @param message        */privatevoid showMessage(String message){this.runnable.setMessage(message);this.handler.post(this.runnable);}@Overridepublicvoid run(){//showMessage("DEMO: SocketListener started!");try{LocalServerSocket server =newLocalServerSocket(SOCKET_ADDRESS);while(true){LocalSocket receiver = server.accept();if(receiver !=null){InputStream input = receiver.getInputStream();// simply for java.util.ArrayListint readed = input.read();int size =0;int capacity =0;byte[] bytes =newbyte[capacity];// readingwhile(readed !=-1){// java.util.ArrayList.Add(E e);                            capacity =(capacity *3)/2+1;//bytes = Arrays.copyOf(bytes, capacity);byte[] copy =newbyte[capacity];System.arraycopy(bytes,0, copy,0, bytes.length);                            bytes = copy;                            bytes[size++]=(byte)readed;// read next byte                            readed = input.read();}                        showMessage(newString(bytes,0, size));}}}catch(IOException e){Log.e(getClass().getName(), e.getMessage());}}}publicstaticvoid writeSocket(String message)throwsIOException{LocalSocket sender =newLocalSocket();        sender.connect(newLocalSocketAddress(SOCKET_ADDRESS));        sender.getOutputStream().write(message.getBytes());        sender.getOutputStream().close();}@Overridepublicvoid onCreate(Bundle savedInstanceState){super.onCreate(savedInstanceState);        setContentView(R.layout.main);newSocketListener(this.handler,this.notificationRunnable).start();Button send1 =(Button)findViewById(R.id.send_1_button);        send1.setOnClickListener(newOnClickListener(){@Overridepublicvoid onClick(View v){try{                    writeSocket("hello");}catch(IOException e){Log.e(getClass().getName(), e.getMessage());}}});}}
