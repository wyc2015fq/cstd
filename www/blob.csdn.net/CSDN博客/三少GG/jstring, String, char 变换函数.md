# jstring, String, char* 变换函数 - 三少GG - CSDN博客
2012年07月31日 20:34:13[三少GG](https://me.csdn.net/scut1135)阅读数：1373
### [jstring, String, char* 变换函数](http://dncsoft.iteye.com/blog/1010213)
[JNI](http://www.iteye.com/blogs/tag/JNI)
Cpp代码  ![收藏代码](http://dncsoft.iteye.com/images/icon_star.png)
- #include <malloc.h>
- #include <string.h>
- #include <stdlib.h>
- #include <vcclr.h>
- 
- usingnamespace System;  
- usingnamespace System::Text;  
- 
- // jstring To String
- String^ jstringToStr(JNIEnv* env, jstring jstr)  
- {  
- char* str = jstringTostring(env, jstr);  
-     String^ value = gcnew String(str);  
-     free(str);  
- return value;  
- }  
- 
- // jstring To char*
- char* jstringTostring(JNIEnv* env, jstring jstr)  
- {  
- char* rtn = NULL;  
-     jclass clsstring = env->FindClass("java/lang/String");  
-     jstring strencode = env->NewStringUTF("utf-8");  
-     jmethodID mid = env->GetMethodID(clsstring, "getBytes", "(Ljava/lang/String;)[B");  
-     jbyteArray barr = (jbyteArray)env->CallObjectMethod(jstr, mid, strencode);  
-     jsize alen = env->GetArrayLength(barr);  
-     jbyte* ba = env->GetByteArrayElements(barr, JNI_FALSE);  
- if (alen > 0)  
-     {  
-         rtn = (char*)malloc(alen + 1);  
-         memcpy(rtn, ba, alen);  
-         rtn[alen] = 0;  
-     }  
-     env->ReleaseByteArrayElements(barr, ba, 0);  
- return rtn;  
- }  
- 
- // String To jstring
- jstring strTojstring(JNIEnv* env, String^ rtn)  
- {  
-     pin_ptr<constwchar_t> wch = PtrToStringChars(rtn);  
- size_t convertedChars = 0;  
- size_t sizeInBytes = ((rtn->Length + 1) * 2);  
- char *ch = (char *)malloc(sizeInBytes);  
-     errno_t err = wcstombs_s(&convertedChars,   
-         ch, sizeInBytes,  
-         wch, sizeInBytes);  
-     jstring js = stringTojstring(env, ch);  
-     free(ch);  
- return js;  
- }  
- 
- **// char* To jstring   本人用过，非常好用之推荐！！！**
- jstring stringTojstring(JNIEnv* env, constchar* pat)  
- {   
-     jclass strClass = env->FindClass("Ljava/lang/String;");   
-     jmethodID ctorID = env->GetMethodID(strClass, "<init>", "([BLjava/lang/String;)V");   
-     jbyteArray bytes = env->NewByteArray(strlen(pat));   
-     env->SetByteArrayRegion(bytes, 0, strlen(pat), (jbyte*)pat);   
-     jstring encoding = env->NewStringUTF("utf-8");   
- return (jstring)env->NewObject(strClass, ctorID, bytes, encoding);   
- }  
