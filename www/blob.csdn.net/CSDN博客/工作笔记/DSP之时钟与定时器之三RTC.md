# DSP之时钟与定时器之三RTC - 工作笔记 - CSDN博客





2012年08月15日 10:50:39[Eason.wxd](https://me.csdn.net/App_12062011)阅读数：8434








实时时钟RTC提供一个时间基准，并且可以定时中断DSP。

1. 实时时钟RTC概述


**TMS320VC5509****实时时钟有如下功能：**

**可以到****2099****年的长达****100****年的日历；**

**同****DSP****内部****CPU****连接的外设总线；**

**32****位配置****/****状态寄存器；**

**独立的秒、分钟、小时、星期、天、月和带闰年补偿的计数器； **

**支持****12****小时和****24****小时模式；**

**可以按秒、分、小时或天输出报警中断； **

**周期更新中断； **

**可以连接外部****32.768kHz****振荡器；**

**独立的电源供应。**

**1.1 **实时时钟基本结构 ****

**![](https://img-my.csdn.net/uploads/201208/15/1345011454_2460.jpg)**


**          给出的实时时钟模块图中的****RTCX1****和****RTCX2****分别是振荡器输入和输出引脚，****TCLK****是测试时钟输入，这个信号只在测试时起作用，****DI[7:0]****和****DO[7:0]****分别是****数据输入和输出，****IRQ****是中断请求信号，实时时钟的所有中断申请都是通过该****信号发出的，****NRESET****是实时时钟复位信号，当****NRESET****信号发出复位信号时****，这个信号并不影响时钟、日历，而会把配置和状态寄存器中的一些值置成****0****，****这些位包括周期中断使能位、报警中断使能位、更新结束中断使能位、中断申****请状态标志位、周期中断标志位、报警中断标志位、更新结束中断标志位，并****将****IRQ****信号置成高。**

**实时时钟的****RTCX1****和****RTCX2****脚供外部振荡器使用，外部振荡器的频率为****32.768KHz****，如果信号消失实时时钟将进入等待状态。实时时钟由独立的电源****供电引脚****RCVDD****和****RDVDD****供电。当实时时钟监测到****TMS320C55x DSP****处于电****源关闭状态时，实时时钟将使连接****DSP****核心的信号进入高阻态，而由****DSP****输入****的信号则进入总线保持状态，以确保输入、输出信号都不处在浮动状态。**



    1、RTC为运行在DSP上的应用程序提供了一个时间基准。当前的日期和时间由一组时间寄存器提供，每秒更新一次。时间可用12小时模式，或者24小时模式。日期和时间寄存器为读写操作设置了缓冲区，因此读写过程不会影响时间和日期的准确性。

    2、RTC时钟来源于一个外部频率为32768Hz的晶振，连接在RTCINX1和RTCINX2信号之间，或一个同频率的外部时钟源。该时钟源分频2Hz的内部时钟，用于更新日期和时间寄存器。还分频13个独立的时钟源，用于周期中断。晶体振荡器可用外部的同频率时钟源代替。这时时钟源连接到RTCINX1,RTCINX2断开.

    3、RTC有单独电源，与DSP的其他部分分开。所以，即使DSP没有上电，RTC也能保存当前的时间和日期信息。但在这种情况下，不能引起DSP中断。

    4、提供三个类型的中断： Periodic interrupt 周期性中断

                                                   
 Single interrupt to the DSP CPU 闹钟中断

                                                    Update cycle interrupt 更新结束中断

2.RTC时间和日期寄存器

   RTC中，时间和日期数据以二进制编码的十进制BCD格式存放。

   配置RTC中断使能寄存器（RTCINTEN）的TM bit。可以设置12小时模式和24小时模式。TM = 0,12小时。1 24小时模式。TM = 0时，上午下午用RTCHOUR中的AMPM 位来设置，0 上午， 1 下午。 TM= 1时，AMPM不起作用。

   对于RTC时间和日期寄存器的读写，由于有缓冲区，保证了显示时间和请求时间是一直的，高度准确。如果设置RTCINTEN中SET位为0，表示直接连接缓冲区到寄存器，这种情况无法保护更新周期内的数据，因此set 位设为1，起到保护缓冲区数据

3.RTC中断请求

   中断使能和标志位

   中断使能寄存器RTCINTEN用3个bit（PIE,AIE,UIE）作为中断信号使能控制。PIE使能周期中断，AIE使能闹钟信号中断，UIE使能更新结束中断.

    注意：

    对于C5509/C5509A，RTC中断与外部中断4（INT4）共用中断标志寄存器1（共享IFR1的第3bit）。通过RTCINTFL，可以区别那类中断。

   1.周期性中断请求，其速率由中断选择寄存器RTCPINTR中的RATE字段来选择。

   2.通过设置RTC闹钟寄存器里的闹钟时间，与当前时间匹配，就会发生闹钟中断。

   3.RTC更新结束中断，发生于每次时间和日期寄存器更新后，触发



   RTC中断使用:

     配置相关中断位，周期中断为配置中断频率，闹钟中断为闹钟寄存器

    设置中断类型位， PIE,AIE,UIE

     在CPU中断使能寄存器里，使能RTC中断。

RTC不受任何DSP Idle域影响，不管仿真调试软件的状态，DSP复位只复位某些寄存器字段，时间和日期以及闹钟寄存器不受影响。
            


