# 汇编学习--7.16--端口 - 工作笔记 - CSDN博客





2012年07月16日 14:01:22[Eason.wxd](https://me.csdn.net/App_12062011)阅读数：5403








1.我们前面讲过，cpu的地址线，数据线，控制线与存储器打交道时，都是将它们看成是若干连续的存储单元组成的逻辑存储器，俗称：内存地址空间。

Cpu除了与存储器打交道外，还与哪些芯片进行访问呢：

        1.接口卡上的芯片。（比如网卡，显卡）上的接口芯片。

        2.主板上的接口芯片。Cpu通过它们对部分外设进行访问。

        3.其它芯片。

每个芯片都有很多寄存器，都可以由cpu读取。

可见，从cpu的角度，将这些寄存器都看作端口，对它们进行统一编址，从而建立一个统一的地址空间。


CPU可以直接读写3 个地方的数据：

（1）CPU 内部的寄存器；

（2）内存单元；

（3）端口。

对端口的读写不能用mov、push、pop等内存读写指令。

端口的读写指令只有两条：

       in和out，

 分别用于从端口读取数据和往端口写入数据。



2. 端口的读写

访问内存：

mov ax,ds:[8];假设执行前(ds)=0

执行时，与总线相关的操作：

① CPU通过地址线将地址信息8发出；

② CPU通过控制线发出内存读命令，选中存储器芯片，并通知它，将要从中读取数据；

③ 存储器将 8号单元中的数据通过数据线送入CPU。



n访问端口：

n in al,60h;从60h号端口读入一个字节

n执行时与总线相关的操作：

 ① CPU通过地址线将地址信息60h发出；

 ② CPU通过控制线发出端口读命令，选中端口所在的芯片，并通知它，将要从中读取数据；

 ③ 端口所在的芯片将60h端口中的数据通过数据线送入CPU。



n对0～255以内的端口进行读写：

   in al,20h            ;从20h端口读入一个字节

   out 20h,al ;往20h端口写入一个字节

n对256～65535的端口进行读写时，端口号放在dx中：

   mov dx,3f8h     ;将端口号3f8送入dx

   in al,dx             ;从3f8h端口读入一个字节

   out dx,al           ;向3f8h端口写入一个字节



3. CMOS RAM 芯片

nPC机中有一个CMOS RAM芯片，其有如下特征：

n（1）包含一个实时钟和一个有128个存储单元的RAM存储器。

 （早期的计算机为64个字节）

n（2）该芯片靠电池供电。

所以，关机后其内部的实时钟仍可正常工作， RAM 中的信息不丢失

n（3） 128 个字节的 RAM 中，内部实时钟占用 0～0dh单元来保存时间信息，其余大部分分单元用于保存系统配置信息，供系统启动时BIOS程序读取。

   BIOS也提供了相关的程序，使我们可以在开机的时候配置CMOS RAM 中的系统信息。

n（4）该芯片内部有两个端口，端口地址为70h和71h。

 CPU 通过这两个端口读写CMOS RAM。

n（5）70h为地址端口，存放要访问的CMOS RAM单元的地址；

   71h为数据端口，存放从选定的CMOS RAM 单元中读取的数据，或要写入到其中的数据。

n可见，CPU对CMOS RAM的读写分两步进行。

n比如：读CMOS RAM的2号单元：

n1、将2送入端口70h

n2、从71h读出2号单元的内容

mov al,2 

out 70h,al 

in al,71h

"in al,71h "就是CMOS--> CPU。“out 71h,al”是CPU--> CMOS。将0存入rom的02单元。接下来in al,71h读取02单元的内容。

向CMOS RAM的2号单元写入0

mov al,2 

out 70h,al 

mov al,0 

out 71h,al 

in al,71h



4. shl和shr指令

shl和shr 是逻辑移位指令，后面的课程中我们要用到移位指令，这里进行一下讲解。 

nshl逻辑左移指令，功能为：

n（1）将一个寄存器或内存单元中的数据向左移位；

n（2）将最后移出的一位写入CF中；

n（3）最低位用0补充。

nshl al,1的操作过程

n（1）左移：

原数据： 01001000

左移后：01001000

n（2）最后移出一位写入CF中：

原数据： 01001000

左移后： 1001000    CF=0

n（3）最低为用0补充：

原数据： 01001000

左移后： 10010000

n如果接着上面，继续执行一条shl al,1指令？

执行后：(al)=00100000b，CF=1 



n如果移动位数大于1时，必须将移动位数放在cl中。

比如，指令：

 mov al,01010001b

 mov cl,3

 shl al,cl

执行后(al)=10001000b，因为最后移出

一位是0，所以CF=0。



可以看出，将X逻辑左移一位，相当于执行X=X*2。

nshr逻辑右移指令，它和shl所进行的操作刚好相反：

n（1）将一个寄存器或内存单元中的数据向右移位；

n（2）将最后移出的一位写入CF中；

n（3）最高位用0补充。

n指令： 

        mov al,10000001b

    shr al,1 ;将al中的数据右移一位

n执行后(al)=01000000b，CF=1。

n如果接着上面，继续执行一条shr al,1指令，则执行后：(al)=00100000b，CF=0。

5. 14.4 CMOS RAM中存储的时间信息

n编程：在屏幕中间显示当前的月份。

分析：这个程序主要做两部分工作：

n（1）从CMOS RAM的8号单元读出当前月份的BCD码；

要读取 CMOS RAM的信息，我们首先要向地址端口70h写入要访问的单元的地址：

      mov al,8 

      out 70h,al

然后从数据端口71h中取得指定单元中的数据：

      in al,71h

n（2）将用BCD码表示的月份以十进制的形式显示到屏幕上。

 我们可以看出 ，BCD 码值＝十进制数码值，则BCD码值＋30h＝十进制数对应的ASCII码。



