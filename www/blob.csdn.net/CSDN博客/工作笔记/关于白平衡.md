# 关于白平衡 - 工作笔记 - CSDN博客





2014年01月26日 09:49:18[Eason.wxd](https://me.csdn.net/App_12062011)阅读数：6904
所属专栏：[机器视觉](https://blog.csdn.net/column/details/33959.html)









所谓白平衡（**White Balance**）：指在图像处理的过程中，**对原本材质为白色的物体的图像进行色彩还原，去除外部光源色温的影响，使其在照片上也显示白色**。也就是不管在任何光源下，都能将白色物体还原为白色。

     白色是指反射到人眼中的光线由于蓝、绿、红三种色光**比例相同**且具有一定的亮度所形成的视觉反应。我们都知道白色光是由赤、橙、黄、绿、青、蓝、紫七种色光组成的，而这七种色光又是由红、绿、蓝三原色按不同比例混合形成，**当一种光线中的三原色成分比例相同的时候，习惯上人们称之为消色**，黑、白、灰、金和银所反射的光都是消色。通俗的理解白色是不含有色彩成份的亮度。人眼所见到的白色或其他颜色同物体本身的固有色、光源的色温、物体的反射或透射特性、人眼的视觉感应等诸多因素有关（请参阅《色彩学原理》），举个简单的例子，当有色光照射到消色物体时，物体反射光颜色与入射光颜色相同，既红光照射下白色物体呈红色，两种以上有色光同时照射到消色物体上时，物体颜色呈加色法效应，如红光和绿光同时照射白色物体，该物体就呈黄色。当有色光照射到有色物体上时，物体的颜色呈减色法效应。如黄色物体在品红光照射下呈现红色，在青色光照射下呈现绿色，在蓝色光照射下呈现灰色或黑色。

那么，什么是色温呢？

所谓色温，简而言之，就是定量地以开尔文温度（K）来表示色彩。英国著名物理学家开尔文认为，假定某一黑体物质，能够将落在其上的所有热量吸收，而没有损失，同时又能够将热量生成的能量全部以“光”的形式释放出来的话，它便会因受到热力的高低而变成不同的颜色。例如，当黑体受到的热力相当于500—550℃时，就会变成暗红色，达到1050－1150℃时，就变成黄色，温度继续升高会呈现蓝色。光源的颜色成分与该黑体所受的热力温度是相对应的，任何光线的色温是相当于上述黑体散发出同样颜色时所受到的“温度”，这个温度就用来表示某种色光的特性以区别其它，这就是色温。从3300K~9300K的温度变化下，它所发出的光线的颜色分别是红色，白色，蓝色。打铁过程中，黑色的铁在炉温中逐渐变成红色，这便是黑体理论的最好例子。色温现象在日常生活中非常普遍，相信人们对它并不陌生。钨丝灯所发出的光（2900K）由于色温较低表现为黄色调，不同的路灯也会发出不同颜色的光，天然气的火焰是蓝色的，原因是色温较高。正午阳光直射下的色温约为5600
 K，阴天更接近室内色温3200K。日出或日落时的色温约为2000K，烛光的色温约为1930K。蓝天（18000K），这时我们不难发现一个规律：色温越高，光色越偏蓝；色温越低则偏红。某一种色光比其它色光的色温高时，说明该色光比其它色光偏蓝，反之则偏红；同样，当一种色光比其它色光偏蓝时说明该色光的色温偏高，反之偏低。所谓的冷暖色调，只是一种感性的叫法。

< 3300K 暖色 3300~6000K 白色  >6000K 冷色。

由于人眼具有独特的适应性，使我们有的时候不能发现色温的变化。比如在钨丝灯下呆久了，并不会觉得钨丝灯下的白纸偏红，如果突然把日光灯改为钨丝灯照明，就会觉查到白纸的颜色偏红了，但这种感觉也只能够持续一会儿。摄像机的CCD并不能像人眼那样具有适应性，所以如果摄像机的色彩调整同景物照明的色温不一致就会发生偏色。

而白平衡就是针对不同色温条件下，通过调整摄像机内部的色彩电路使拍摄出来的影像抵消偏色，更接近人眼的视觉习惯。因为摄像头没有人眼那么智能（人眼在看到物体的时候，自动做色彩矫正），所以相机设定了一个范围，如果拍摄到的照片色彩平均值落在该设定范围内，则无需修正，如果偏离出该范围，则需要调整参数让其落在该范围内。这就是WB白平衡修正过程。

     摄像机内部有三个CCD电子耦合元件，他们分别感受蓝色、绿色、红色的光线，在预置情况下这三个感光电路**电子放大比例是相同的，为1：1：1的关系**，白平衡的调整就是根据被调校的景物改变了这种比例关系。比如被调校景物的蓝、绿、红色光的比例关系是2：1：1（蓝光比例多，色温偏高），那么白平衡调整后的比例关系为1：2：2，调整后的电路放大比例中明显蓝的比例减少，增加了绿和红的比例，这样被调校景物通过白平衡调整电路到所拍摄的影像，蓝、绿、红的比例才会相同。也就是说如果被调校的白色偏一点蓝，那么白平衡调整就改变正常的比例关系减弱蓝电路的放大，同时增加绿和红的比例，使所成影像依然为白色。也就是说，对在特定光源下拍摄时出现的偏色现象，通过加强对应的补色来进行补偿。**各种白平衡下的照片所产生的偏色显示出补偿时的补色**。使用胶片相机时，为了对这些偏色进行补偿，拍摄时要用各种彩色滤镜。数码相机的基本原理与其类似，白平衡功能就相当于彩色滤镜。但在彩色滤镜中并没有类似自动白平衡的滤镜，在这一点上两者有很大区别。一般使用时选择自动白平衡（AWB）就足够了，但在特定条件下如果色调不理想，可以选择使用其他的各种白平衡选项。

      换一个思路来考虑白平衡调整的问题，摄像机在白平衡调整容度之内不会“拒绝”放在镜头前面的被调校景物，就是说镜头可以对着任何景物来调整白平衡。大多情况下使用白色的调白板（卡）来调整白平衡，是因为白色调白板（卡）可最有效地反映环境的色温，其实很多时候某种环境下白板（卡）并不是白色，多多少少会偏一点蓝或其它的颜色，经验丰富的摄像也会利用蓝天来调白平衡，从而得到偏红黄色调的画面。搞清楚白平衡的工作原理之后，再使用的时候就会大胆地尝试不同的效果，丰富了摄像创作。

    在生活中日光的色温是不断变化的，可以说没有两个地方的色温会完全一样，不同的地域、季节、地面环境、天气、早晚等等都会对色温造成影响，还有大量的人工光源，色温也不尽相同。摄像师调整白平衡的方法大体分粗调、精细调整和自动跟踪（ATW）三种：粗调指在预置情况下改变色温滤光片，使色温接近到到3200K的出厂设置；精细调整是指在色温滤光片的配合下通过摄像机白平衡调整功能，针对特定环境色温得到一个更为精确的调整结果；自动跟踪是指依靠摄像机的自动跟踪功能（ATW），摄像机自身根据画面的色温变化随时调整。

     白平衡是描述显示器中红（R）、绿（G）、蓝（B）三基色混合生成后白色精确度的一项指标。白平衡没有缺陷的显示器，在改变色彩及亮度时不会影响白色纯净度，也就是说不会出现偏色，更不会有其它的杂色掺杂其中，因为对于一台高档大屏幕专用显示器而言，哪怕是很微小的“偏色”都会影响画面的色彩质量。

那么如何修正白平衡呢？,首先 有两个很重要的理论需要知道：

灰度世界理论：认为任何一幅图像, 当有足够的色彩变化时, 其R, G, B分量均值会趋于平衡(即 RGB三个数值相等, 也就是说应当是黑白灰类型的颜色)。这个理论在全局白平衡中得到⼴泛应用, 特点是能够利用更多的图像信息来做判断, 但在面对⾊色彩较为单一的图像时就显得有些乏力了。

全反射理论：一幅图像中亮度最大的点就是白点, 即假设在 YCbCr 空间中Ｙ值最⼤的点为白色, 以此来校正整幅图像。特点是只考虑色彩最亮的那部分, 跟上面的灰度世界理论正好相反, 在处理色彩偏单调的图像时效果好些, 但面对颜色丰富的图片时,因为最亮的点不一定是⽩色的, 可能会出现偏色的情况。

这两个理论分别对应着两种色彩空间 RGB 和 YCbCr 调整白平衡的理论基础：判断一张图片白平衡是否准确, 如果不准确, 如何量化其偏离数值。

几种白平衡算法：

1.灰度世界算法：

根据灰度世界理论，将原始图的RGB均值分别调整到R= G = B即可。不完美的地方就是这个算法对颜色不丰富的图像敏感程度一般，处理起来效果也就不会很理想，局限性很大。

2.标准差加权灰度世界算法：

该算法是针对上面算法的改进，它的原理是把图像等分成几块，然后对每块利用统计学进行分析，看里面颜色的丰富程度，颜色多的加权，颜色少的就减少权重，最后求和得到一个均值，根据这个相对精确的数值来进行RGB数值的修正。

3.全反射算法：

该算法认为最亮的那个点就是白色，如果不是，就针对偏离白色的数值进行逆向修正。缺点是没有高亮点或者图像色彩复杂，它的修正效果就会比较乏力。

还有:亮度加权灰度世界算法与全反射算法的正交组合算法，该算法效果不错，但运算量巨大。不过它本身是收敛的，不会对图像造成损失。

以上算法，见《白平衡修正算法》。﻿﻿

﻿﻿

﻿﻿

﻿﻿

﻿﻿



