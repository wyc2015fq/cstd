# DSP之中断总结篇 - 工作笔记 - CSDN博客





2012年08月14日 13:15:04[Eason.wxd](https://me.csdn.net/App_12062011)阅读数：26279








#### 1 中断概述

中断定义:由硬件或软件驱动的信号，使DSP将当前的程序挂起，执行另一个称为中断服务子程序（ISR）的任务。

C55x支持32个ISR。有些ISR可以由软件或硬件触发，有些只能由软件触发。

当CPU同时收到多个硬件中断请求时，CPU会按照预先定义的优先级对它们做出响应和处理。

所有的软件中断都是不可屏蔽中断


 DSP处理中断的步骤：

（1）接收中断请求。软件和硬件都要求DSP将当前程序挂起。

（2）响应中断请求。CPU必须响应中断。如果是可屏蔽中断，响应必须满足某些条件。如果是不可屏蔽中断，则CPU立即响应。

（3）准备进入中断服务子程序。

      CPU要执行的主要任务有：
完成当前指令的执行，并冲掉流水线上还未解码的指令
自动将某些必要的寄存器的值保存到数据堆栈和系统堆栈

从用户实现设置好的向量地址获取中断向量，该中断向量指向中断服务子程序

（4）执行中断服务子程序。

CPU执行用户编写的ISR。ISR以一条中断返回指令结束，自动恢复步骤（3）中自动保存的寄存器值。
☼  注意：
 外部中断只能发生在CPU退出复位后的至少3个周期后，否则无效；
 在硬件复位后，不论INTM位的设置和寄存器IER0、IER1的值如何，所有的中断都被禁止，直到通过软件初始化堆栈后才开放中断。



#### 2  可屏蔽中断

所有的可屏蔽中断都是硬件中断。
无论硬件何时请求一个可屏蔽中断，在一个中断标志寄存器里就有相应的中断标志置位。该标志一旦置位，相应的中断还必须使能，否则不会得到处理。

当CPU在实时硬件仿真模式下暂停时，只能处理时间临界中断。



可屏蔽中断标准处理流程：

1. 向CPU发送中断请求。

2. 设置响应的IFR标志。CPU检测到一个有效的可屏蔽中断请求时，它设置并锁上某个中断标志寄存器的响应标志位，这个位保持锁定，直到该中断得到响应或者复位，才清楚

3. IER中断使能？根据中断使能寄存器是否使能，响应中断。

4. INTM = 0？全局开放中断，才响应

5. 跳转到ISR服务程序，

6. 执行ISR服务程序

7, 返回。



#### 3 不可屏蔽中断

当CPU接收到一个不可屏蔽中断请求时，立即无条件响应，并很快跳转到相应的中断服务子程序（ISR）
C55x的不可屏蔽中断有：
硬件中断/RESET。如果引脚/RESET为低电平，则触发了一个DSP硬件复位和一个中断（迫使执行复位ISR）。

硬件中断/NMI。如果引脚/NMI为低电平，则CPU必须执行相应的ISR。 /NMI提供了一种通用的无条件中断DSP的硬件方法。

软件中断。



#### 4 按键中断

    按键中断，属于可屏蔽中断，用户自定义硬件中断，当CPU响应按键后，检查相关引脚中断标记寄存器，若标志位为1，则响应该中断。同时，清除中断标志寄存器位.

#### 5 c_int00

     当C环境被初始化时，启动程序禁止中断。   如果系统使用中断，必须处理有关的中断使能或屏蔽。

## 关于中断的几个要点：

   中断程序会执行任何其它函数执行的工作，包括访问全局变量、为局部变量分配地址、调用其它函数。

   需要处理任何特殊中断屏蔽（通过IER0寄存器）。通过嵌入汇编语言语句可以使能或禁止中断，也可以修改IER0寄存器而不会破坏C环境或C指针。

   中断处理程序不能有参数，即使声明了参数也会被忽略

   中断处理程序不能被普通C代码调用。

   为了将中断程序和中断联系起来，需要将分支程序放在合适的中断向量中，通过.sect指令创建一个简单的分支指令表就可以实现此操作。

   在汇编语言中，需要在中断程序名前加下划线，如_c_int00。

   分配堆栈到偶地址。
   c_int00是系统复位中断。当进入c_int00中断时，运行时间堆栈并没有被建立起来，因此不能为局部变量分配地址，也不能在运行时间堆栈中保存任何信息。





通过interrupt关键字可以用C函数直接处理中断。
 interrupt关键字可以和定义为返回void并不含参数的函数一起使用。中断函数体可以有局部变量，可以自由使用堆栈。

c_int00是C程序入口。这个名字被保存为系统重启中断。这个特殊的中断程序初始化系统并调用了主函数。因为没有调用者，所以c_int00不保存任何寄存器。    

例，

interrupt void isr()

{     

       ...

}

#### 中断管理

    基于DSP/BIOS管理中的硬件中断，DSP/BIOS为中断提供了一个HWI调度程序，为ISR完成必要的开头和结尾部分。如果不使用，则在调用任何DSP/BIOS对象的API之前，必须调用HWI_enter和HWI_exit汇编宏来完成ISR的开头和结束。实际上，DSP/BIOS提供的调度程序，就包括这两个宏。

为了正确响应硬件中断，同时，也为了DSP/BIOS内核的稳定性，必须注意：

1 在一个硬件中断ISR中，不要调用SWI_disable和SWI_enable。

2 在NMI（不可屏蔽）中断中，不要调用硬件中断使能/禁止函数。

3 当使用DSP/BIOS调度程序时，不要使用HWI_exit和HWI_enter汇编宏

4 中断中，可以打开新中断。



我们可以在中断配置选项卡中，设置Interrupt Mask 来实现在DSP/BIOS调度程序执行前禁止某些中断。



