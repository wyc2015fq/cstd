# 如何创建私链 - PeterBishop - CSDN博客





2018年10月30日 22:46:05[PeterBishop0](https://me.csdn.net/qq_40061421)阅读数：22
个人分类：[区块链](https://blog.csdn.net/qq_40061421/article/category/8283925)









教程简介：

本教程描述了如何搭建Ethereum私链用于在以太坊链上进行开发实验。

创建私链的目的：

搭建私链的目的是方便在链上做实验。在日常区块链开发中当然可以使用公网主链，但是这样会造成不必要的金钱浪费。因为在以太坊链上干任何事都需要消耗gas。所以对于日常实验性开发，一般都是在自己的私链上做实验。

环境搭建：

本教程开发环境 

操作系统：Windows10

以太坊客户端：Windows版Geth 1.6.7 

可以从这里下载: 

https://gethstore.blob.core.windows.net/builds/geth-windows-amd64-1.7.0-6c6c7b2a.exe

如何创建私链:

创建创世配置文件:

首先需要创建一个“创世”json配置文件,此文件描述了创世区块的一些参数。下面就是文件中的内容:



```bash
{
       "coinbase": "0x0000000000000000000000000000000000000000",
       "config": {
              "homesteadBlock": 5
        },
       "difficulty": "0x20000",
       "extraData": "0x",
       "gasLimit": "0x2FEFD8",
       "mixhash": "0x00000000000000000000000000000000000000647572616c65787365646c6578",
       "nonce": "0x0",
       "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
       "timestamp": "0x00",
       "alloc": {
              "dbdbdb2cbd23b783741e8d7fcf51e459b497e4a6":
              {
                  "balance":"100000000000000000000000000000"
              }
       }
    }
```



将上面这段代码复制到一个文本文件里并起名为genesis.json 



创世！:

为了不和主链的数据冲突，这里建议建立自己的私链数据文件夹。在我的电脑上在E盘建了一个EthDBSpace作为以太坊实验工作区，并在里面创建了一个PrivChain文件夹作为我的第一个私链的数据存放文件夹 

这里为了方便管理将genesis.json放在了EthDBSpace文件夹下

![](https://img-blog.csdn.net/20170926151803042?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

打开Windows命令行 

![æå¼å½ä»¤è¡](https://img-blog.csdn.net/20170926150725645?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

键入如下命令

`​​geth --identity"mydev" --rpc --rpccoradomain "*" datadir "E:\EthDBSpace\PrivChain" --rpcapi "db,eth,net.web3" --network 99 init "E:\EthDBSpace\genesis.json" `



–datadir 选项用来指定我们私链的数据目录。在我的电脑上是E:\EthDBSpace\PrivChain 

init 命令为创世命令，后面紧跟着我们的创世配置文件路径。初始化改变network和identity就可以了，直接写成.bat文件

点击回车后执行结果如下 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926151117695?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

此时创世完成！

创建账户：

为了在私链上做实验，我们还需要在私链上建立自己的账户

Windows命令行键入

```
geth --datadir "E:\EthDBSpace\PrivChain" --port 30303  --identity "mydev"   --rpccorsdomain "*"   --networkid 99  console
```




我们由于已经创世成功所以第二次进入客户端时我们不用再次指定genesis.json文件路径，而是直接–datadir 指明私链数据路径即可。 

console命令用来开启geth的命令行。

点击回车后，客户端会先经过一阵初始化。在命令提示符出现后，说明已经进入geth console 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926151333303?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)



在geth命令行中键入

        personal.newAccount('Your Password')

personal.newAccount 函数用来创建账户，其中参数为账户密码

点击回车后会出现 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926151618028?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

账户创建成功后会在命令下方以绿色字符列明创建账户的地址，也即账户的公钥

我们可以先查下账户余额，在geth命令行中键入：

        my=eth.accounts[0]

        eth.getBalance(my)

my=eth.accounts[0]，此句的目的是将我们刚创建的账户地址赋值给my变量。这样可以简化后续账户地址输入。其中eth.accounts记录了本机上所有账户地址。由于我们第一次创建账户，所以目前电脑上只有一个账户。所以这里我们用eth.accounts[0]提取第一个账户地址。eth.getBalance函数用来获得账户余额，参数填入账户地址。这里的my变量记录的就是第一个账户的地址。

执行结果如下： 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926151952555?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

可以看到此时账户里没钱。在以太坊上转账、发布合约、执行合约都需要费钱。而钱来自挖矿，下面我们先挖矿赚些钱。

挖矿赚钱：

目前的以太坊使用POW(Proof of Work)共识机制来激励人们去维护账本记账。此机制的核心是系统出一道题，让全网有意记账节点来求解，第一个求解出题目答案的节点会获得新区块的记账权并获得eth作为奖励。其中有意记账的节点叫做矿工节点。下面我们在我们的私链上挖矿赚一些钱便于我们后续的转账实验。

继续在geth命令行键入如下命令开始挖矿：

        miner.start()

1

点击回车后会看见客户端开始挖矿，命令行里不断显示出块进度 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926152120392?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

第一次需要初始化时间比较长并且无法stop

由于是私链，目前就一个节点在挖矿不存在竞争。所以开挖若干秒即可停止挖矿，挖得得钱已经可以进行后续实现。

键入如下命令停止挖矿

        miner.stop()

此时再次查看我们的账户余额

    eth.getBalance(my)

会看到我们的余额多了一大笔钱，显示的余额以以太坊货币单位wei来计算。关于wei到eth的换算表参见http://www.ethdocs.org/en/latest/ether.html

转账实验：

下面我们尝试下在我们自己创建的私链上进行转账 

- 先创建第二账户，继续在geth命令行键入如下命令

        personal.newAccount('123')

        other=eth.accounts[1]

将第二账户地址赋值给other变量，便于后续输入

在转账前需要对转出账户进行解锁，继续在geth命令行键入如下命令

        personal.unlockAccount(my)

由于目前是my账户中有钱，other账户没钱，所以这里解锁我们的转出账户my

回车后会提示输入密码，我这个账户的密码为123，输入后回车即可解锁 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926152348440?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

开始转账，在geth命令行键入

        eth.sendTransaction({from:my, to:other, value:10000})

其中from为转出账户，这里我们输入记录了第一个账户地址的my变量 

to为转入账户，这里我们输入记录额第二个账户地址的other变量 

value指定了转出金额，单位为wei，这里我们转出10000wei

键入后结果如下 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926152537966?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

可以看到转账请求已经提交

此时我们再次查看两个账户的余额

        eth.getBalance(my)

        eth.getBalance(other)

查询余额结果如下: 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926152629574?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

此时会发现一个奇怪现象，前面的转账请求已经提交，为什么两个账户的余额没有发生任何变化?回想刚才我们讲到的，以太坊使用POW共识激励矿工记账，而由于我们创建的是私链目前只有我们一个节点，所以此时并没有其它节点参与记账。所以我们需要通过挖矿把这笔转账记录到块中。

继续挖矿,在geth 控制台中键入

        miner.start()

等待挖一会后停止挖矿

        miner.stop()

再次查询,发现转账已到位 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20170926152740934?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQwNDAxMjY0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

### 以上的也可以通过mist或者Ethereum直接交易



