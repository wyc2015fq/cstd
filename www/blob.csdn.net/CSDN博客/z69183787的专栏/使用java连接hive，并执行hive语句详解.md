# 使用java连接hive，并执行hive语句详解 - z69183787的专栏 - CSDN博客
2016年09月05日 19:58:23[OkidoGreen](https://me.csdn.net/z69183787)阅读数：6037
安装hadoop 和 hive我就不多说了，网上太多文章 自己看去
首先，在机器上打开hiveservice
**[html]**[view
 plain](http://blog.csdn.net/liuxiaochen123/article/details/11993909#)[copy](http://blog.csdn.net/liuxiaochen123/article/details/11993909#)
- hive --service hiveserver -p 50000 &  
打开50000端口，然后java就可以使用java连了，需要的jar包我发个图片
就这多jar包，必须的
不多说，直接上代码
**[java]**[view
 plain](http://blog.csdn.net/liuxiaochen123/article/details/11993909#)[copy](http://blog.csdn.net/liuxiaochen123/article/details/11993909#)
- package asia.wildfire.hive.service;  
- 
- import java.sql.*;  
- import java.sql.Date;  
- import java.text.SimpleDateFormat;  
- import java.util.*;  
- 
- /**
-  * User: liuxiaochen
-  * Date: 13-9-24
-  * Time: 下午5:47
-  * 修改描述
-  */
- publicclass HiveService {  
- privatestaticfinal String URLHIVE = "jdbc:hive://ip:50000/default";  
- privatestatic Connection connection = null;  
- 
- publicstatic Connection getHiveConnection() {  
- if (null == connection) {  
- synchronized (HiveService.class) {  
- if (null == connection) {  
- try {  
-                         Class.forName("org.apache.hadoop.hive.jdbc.HiveDriver");  
-                         connection = DriverManager.getConnection(URLHIVE, "", "");  
-                     } catch (SQLException e) {  
-                         e.printStackTrace();  
-                     } catch (ClassNotFoundException e) {  
-                         e.printStackTrace();  
-                     }  
-                 }  
-             }  
-         }  
- return connection;  
-     }  
- 
- publicstaticvoid createTable() throws SQLException {  
-         String tweetTableSql = "DROP TABLE IF EXISTS hive_crm_tweet2222";  
-         String createTable1 = "CREATE EXTERNAL TABLE hive_crm_tweet2222(tweet_id string, cuser_id string, created_at bigint, year bigint, month bigint, day bigint, hour bigint, text string, comments_count bigint, reposts_count bigint, source string, retweeted_id string, post_type string, sentiment string, positive_tags_string string, predict_tags_string string, tags_string string) STORED BY 'org.apache.hadoop.hive.dynamodb.DynamoDBStorageHandler' TBLPROPERTIES (\"dynamodb.table.name\" = \"crm_tweet\",\"dynamodb.column.mapping\" = \"tweet_id:tweet_id,cuser_id:cuser_id,created_at:created_at,year:year,month:month,day:day,hour:hour,text:text,comments_count:comments_count,reposts_count:reposts_count,source:source,retweeted_id:retweeted_id,post_type:post_type,sentiment:sentiment,positive_tags_string:positive_tags_string,predict_tags_string:predict_tags_string,tags_string:tags_string\")";  
-         String commentTableSql = "DROP TABLE IF EXISTS hive_tweet_comment2222";  
-         String createTable2 = "CREATE EXTERNAL TABLE hive_tweet_comment2222(tweet_id string,comment_id string, cuser_id string, user_id string, created_at bigint, year bigint, month bigint, day bigint, hour bigint, text string, comments_count bigint, reposts_count bigint, source string, topic_id string, post_type string, sentiment string) STORED BY 'org.apache.hadoop.hive.dynamodb.DynamoDBStorageHandler' TBLPROPERTIES (\"dynamodb.table.name\" = \"crm_tweet_comment\",\"dynamodb.column.mapping\" = \"tweet_id:tweet_id,comment_id:comment_id,cuser_id:cuser_id,user_id:user_id,created_at:created_at,year:year,month:month,day:day,hour:hour,text:text,comments_count:comments_count,reposts_count:reposts_count,source:source,topic_id:tweet_id,post_type:post_type,sentiment:sentiment\")";  
-         String retweetTableSql = "DROP TABLE IF EXISTS hive_tweet_retweet2222";  
-         String createTable3 = "CREATE EXTERNAL TABLE hive_tweet_retweet2222(tweet_id string, cuser_id string, user_id string, retweet_id string, created_at BIGINT, year BIGINT, month BIGINT, day BIGINT, hour BIGINT, text string, comments_count BIGINT, reposts_count BIGINT, source string, topic_id string, verified_type BIGINT, post_type string, sentiment string) STORED BY 'org.apache.hadoop.hive.dynamodb.DynamoDBStorageHandler' TBLPROPERTIES (\"dynamodb.table.name\" = \"crm_tweet_retweet\",\"dynamodb.column.mapping\" = \"tweet_id:tweet_id,cuser_id:cuser_id,user_id:user_id,retweet_id:retweet_id,created_at:created_at,year:year,month:month,day:day,hour:hour,text:text,comments_count:comments_count,reposts_count:reposts_count,source:source,topic_id:tweet_id,verified_type:verified_type,post_type:post_type,sentiment:sentiment\")";  
- 
-         Statement stmt = getHiveConnection().createStatement();  
-         stmt.executeQuery(tweetTableSql);  
-         stmt.executeQuery(createTable1);  
-         stmt.executeQuery(commentTableSql);  
-         stmt.executeQuery(createTable2);  
-         stmt.executeQuery(retweetTableSql);  
-         stmt.executeQuery(createTable3);  
-     }  
- 
- publicstaticvoid selectTweet() throws SQLException {  
- long aaa = System.currentTimeMillis();  
- long start = DateUtils.getNDaysAgo(DateUtils.getMidNight(), 15).getTime().getTime();  
- long end = DateUtils.getNDaysAgo(DateUtils.getMidNight(), 13).getTime().getTime();  
-         String sql = "select cuser_id, count(*) as tw_hour, year, month, day from hive_crm_tweet2222 where created_at > ? and created_at < ? and cuser_id = ? group by cuser_id, year, month, day, hour";  
-         PreparedStatement pstm = getHiveConnection().prepareStatement(sql);  
-         pstm.setLong(1, start);  
-         pstm.setLong(2, end);  
-         pstm.setString(3, "2176270443");  
-         ResultSet rss = pstm.executeQuery();  
- while (rss.next()) {  
-             System.out.println("1: " + rss.getString("cuser_id") + "   2: " + rss.getInt("tw_hour") + "   3: " + rss.getInt("year") + "   4: " + rss.getInt("month") + "   5: " + rss.getInt("day"));  
-         }  
- 
-         System.out.println(System.currentTimeMillis() - aaa);  
- 
-     }  
- 
- publicstaticvoid selectTweet22() throws SQLException {  
- long aaa = System.currentTimeMillis();  
- long start = DateUtils.getNDaysAgo(DateUtils.getMidNight(), 15).getTime().getTime();  
- long end = DateUtils.getNDaysAgo(DateUtils.getMidNight(), 13).getTime().getTime();  
-         String sql = "select cuser_id, created_at, tweet_id from hive_crm_tweet2222 where created_at > ? and created_at < ? and cuser_id = ?";  
-         PreparedStatement pstm = getHiveConnection().prepareStatement(sql);  
-         pstm.setLong(1, start);  
-         pstm.setLong(2, end);  
-         pstm.setString(3, "2176270443");  
-         ResultSet rss = pstm.executeQuery();  
-         SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH");  
- while (rss.next()) {  
- long cc = Long.valueOf(String.valueOf(rss.getInt("created_at")) + "000");  
-             java.util.Date date = new java.util.Date(cc);  
-             System.out.println(dateFormat.format(date));  
-             System.out.println(rss.getString("cuser_id") + " " + rss.getString("tweet_id"));  
-         }  
- 
-         System.out.println(System.currentTimeMillis() - aaa);  
- 
-     }  
- 
- publicstaticvoid main(String[] args) throws ClassNotFoundException, SQLException {  
- //        Class.forName("org.apache.hadoop.hive.jdbc.HiveDriver");
- //        String querySQL = "SELECT a.* FROM test_time a";
- //
- //        Connection con = DriverManager.getConnection(URLHIVE, "", "");
- //        Statement stmt = con.createStatement();
- //        ResultSet res = stmt.executeQuery(querySQL);   // 执行查询语句
- //
- //        while (res.next()) {
- //            System.out.println("Result: key:" + res.getString(1) + "  –>  value:" + res.getString(2));
- //        }
-         selectTweet22();  
- 
- //        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH");
- //        System.out.println(dateFormat.format(new java.util.Date()));
-     }  
- }  
代码如上，就这么多，当然复杂的逻辑，还需要你自己处理，谢谢
