# Spring 3之MVC & Security简单整合开发（二） - z69183787的专栏 - CSDN博客
2014年08月13日 20:47:10[OkidoGreen](https://me.csdn.net/z69183787)阅读数：1941
个人分类：[安全框架-SpringSecurity																[SpringMvc](https://blog.csdn.net/z69183787/article/category/2176803)](https://blog.csdn.net/z69183787/article/category/2175245)
原文链接：[http://sarin.iteye.com/blog/829738](http://sarin.iteye.com/blog/829738)
    现在来说Security部分。Spring Security框架是Acegi Security的升级，这个框架就是利用了多重过滤的机制对请求进行处理，将符合要求的请求放行，不符合要求的请求阻止下来，这是最大的原理。下面先来看看简单的url过滤吧。 
    先写一个用于验证身份的登录页面： 
```
```xml
<%@taglib
 prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
```
```xml
<
```
```xml
html
```
```xml
>
```
```xml
<
```
```xml
head
```
```xml
>
```
```xml
<
```
```xml
title
```
```xml
>Login</
```
```xml
title
```
```xml
>
```
```xml
</
```
```xml
head
```
```xml
>
```
```xml
<
```
```xml
body
```
```xml
>
```
```xml
<
```
```xml
c:if
```
```xml
test
```
```xml
=
```
```xml
"${not
 empty param.error}"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
font
```
```xml
color
```
```xml
=
```
```xml
"red"
```
```xml
>Login
 error.<
```
```xml
br
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
font
```
```xml
>
```
```xml
```
```xml
Reason:${sessionScope["SPRING_SECURITY_LAST_EXCEPTION"].message}
```
```xml
</
```
```xml
c:if
```
```xml
>
```
```xml
<
```
```xml
form
```
```xml
method
```
```xml
=
```
```xml
"POST"
```
```xml
action
```
```xml
=
```
```xml
"<c:url
 value="
```
```xml
/login"/>">
```
```xml
<
```
```xml
table
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
td
```
```xml
align
```
```xml
=
```
```xml
"right"
```
```xml
>Username</
```
```xml
td
```
```xml
>
```
```xml
```
```xml
<
```
```xml
td
```
```xml
><
```
```xml
input
```
```xml
type
```
```xml
=
```
```xml
"text"
```
```xml
name
```
```xml
=
```
```xml
"j_username"
```
```xml
/></
```
```xml
td
```
```xml
>
```
```xml
```
```xml
</
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
td
```
```xml
align
```
```xml
=
```
```xml
"right"
```
```xml
>Password</
```
```xml
td
```
```xml
>
```
```xml
```
```xml
<
```
```xml
td
```
```xml
><
```
```xml
input
```
```xml
type
```
```xml
=
```
```xml
"password"
```
```xml
name
```
```xml
=
```
```xml
"j_password"
```
```xml
/></
```
```xml
td
```
```xml
>
```
```xml
```
```xml
</
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
td
```
```xml
colspan
```
```xml
=
```
```xml
"2"
```
```xml
align
```
```xml
=
```
```xml
"right"
```
```xml
><
```
```xml
input
```
```xml
type
```
```xml
=
```
```xml
"submit"
```
```xml
value
```
```xml
=
```
```xml
"Login"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
input
```
```xml
type
```
```xml
=
```
```xml
"reset"
```
```xml
value
```
```xml
=
```
```xml
"Reset"
```
```xml
/></
```
```xml
td
```
```xml
>
```
```xml
```
```xml
</
```
```xml
tr
```
```xml
>
```
```xml
</
```
```xml
table
```
```xml
>
```
```xml
</
```
```xml
form
```
```xml
>
```
```xml
</
```
```xml
body
```
```xml
>
```
```xml
</
```
```xml
html
```
```xml
>
```
```
    做一些说明，使用Spring Security时，默认的登录验证地址是j_spring_security_check，验证的用户名是j_username，密码是j_password，对于用户名和密码我们不需要修改，使用其默认值即可，而验证路径通常我们想使用自定义地址，这就需要在security中进行配置，后面会看到，这里还会看到如果验证失败，会把失败信息打印出来，就是JSTL的c:if段的作用。下面来看最基本的Security框架作用，拦截URL请求。在board-security.xml配置如下： 
```
```xml
<?
```
```xml
xml
```
```xml
version
```
```xml
=
```
```xml
"1.0"
```
```xml
encoding
```
```xml
=
```
```xml
"UTF-8"
```
```xml
?>
```
```xml
<
```
```xml
beans
```
```xml
xmlns
```
```xml
=
```
```xml
"http://www.springframework.org/schema/beans"
```
```xml
```
```xml
xmlns:security
```
```xml
=
```
```xml
"http://www.springframework.org/schema/security"
```
```xml
```
```xml
xmlns:xsi
```
```xml
=
```
```xml
"http://www.w3.org/2001/XMLSchema-instance"
```
```xml
```
```xml
xsi:schemaLocation="http://www.springframework.org/schema/beans
```
```xml
http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
```
```xml
http://www.springframework.org/schema/security
```
```xml
http://www.springframework.org/schema/security/spring-security-3.0.xsd">
```
```xml
```
```xml
<
```
```xml
security:http
```
```xml
auto-config
```
```xml
=
```
```xml
"true"
```
```xml
>
```
```xml
<
```
```xml
security:intercept-url
```
```xml
pattern
```
```xml
=
```
```xml
"/messageList.htm"
```
```xml
```
```xml
access
```
```xml
=
```
```xml
"ROLE_ADMIN,ROLE_USER,ROLE_GUEST"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:intercept-url
```
```xml
pattern
```
```xml
=
```
```xml
"/messagePost.htm"
```
```xml
```
```xml
access
```
```xml
=
```
```xml
"ROLE_ADMIN,ROLE_USER"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:intercept-url
```
```xml
pattern
```
```xml
=
```
```xml
"/messageDelete.htm"
```
```xml
```
```xml
access
```
```xml
=
```
```xml
"ROLE_ADMIN"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:anonymous
```
```xml
username
```
```xml
=
```
```xml
"guest"
```
```xml
```
```xml
granted-authority
```
```xml
=
```
```xml
"ROLE_GUEST"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
security:http
```
```xml
>
```
```xml
```
```xml
<
```
```xml
security:authentication-manager
```
```xml
>
```
```xml
```
```xml
<
```
```xml
security:authentication-provider
```
```xml
>
```
```xml
```
```xml
<
```
```xml
security:user-service
```
```xml
>
```
```xml
```
```xml
<
```
```xml
security:user
```
```xml
name
```
```xml
=
```
```xml
"admin"
```
```xml
authorities
```
```xml
=
```
```xml
"ROLE_ADMIN,ROLE_USER"
```
```xml
password
```
```xml
=
```
```xml
"secret"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:user
```
```xml
name
```
```xml
=
```
```xml
"user1"
```
```xml
authorities
```
```xml
=
```
```xml
"ROLE_USER"
```
```xml
```
```xml
password
```
```xml
=
```
```xml
"1111"
```
```xml
/>
```
```xml
</
```
```xml
security:user-service
```
```xml
>
```
```xml
```
```xml
</
```
```xml
security:authentication-provider
```
```xml
>
```
```xml
```
```xml
</
```
```xml
security:authentication-manager
```
```xml
>
```
```xml
</
```
```xml
beans
```
```xml
>
```
```
    配置文件中首先是对http请求的拦截，这里使用了自动配置auto-config，那么当请求到达时，Security框架会让我们进行身份验证，我们拦截的url模式已经在其中配置出来，三个请求分别对应不同的权限，而且messageList.htm还开放了匿名访问功能，要提供匿名访问，就要配置<anonymous>，这里我们配置匿名用户名为guest，角色是ROLE_GUEST，这里的角色都是ROLE_开头，是Spring Security框架默认使用的，我们不用去更改，这也很清楚。首先我们启动应用，来访问唯一的匿名功能，之后我们看到如下效果： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_3.png)
 可以看到，现在的角色是ROLE_GUEST，那么就直接看到，没有验证身份，若我们要发布消息呢，点击Post链接，看看效果： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_4.png)
要求身份验证了，这就说明对url的拦截起作用了，想发布消息，权限不够了，要验证身份了，注意这里这个页面并不是我们前面写的那个页面，而是Security框架的默认验证页面，为什么没有使用我们所写的页面呢？因为我们还没有配置它啊，当然不会被识别到了。我们来看看默认的页面源码是什么样子的： 
```
```xml
<
```
```xml
html
```
```xml
><
```
```xml
head
```
```xml
><
```
```xml
title
```
```xml
>Login
 Page</
```
```xml
title
```
```xml
></
```
```xml
head
```
```xml
><
```
```xml
body
```
```xml
onload
```
```xml
=
```
```xml
'document.f.j_username.focus();'
```
```xml
>
```
```xml
<
```
```xml
h3
```
```xml
>Login
 with Username and Password</
```
```xml
h3
```
```xml
><
```
```xml
form
```
```xml
name
```
```xml
=
```
```xml
'f'
```
```xml
action
```
```xml
=
```
```xml
'/j_spring_security_check'
```
```xml
method
```
```xml
=
```
```xml
'POST'
```
```xml
>
```
```xml
```
```xml
<
```
```xml
table
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
><
```
```xml
td
```
```xml
>User:</
```
```xml
td
```
```xml
><
```
```xml
td
```
```xml
><
```
```xml
input
```
```xml
type
```
```xml
=
```
```xml
'text'
```
```xml
name
```
```xml
=
```
```xml
'j_username'
```
```xml
value
```
```xml
=
```
```xml
''
```
```xml
></
```
```xml
td
```
```xml
></
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
><
```
```xml
td
```
```xml
>Password:</
```
```xml
td
```
```xml
><
```
```xml
td
```
```xml
><
```
```xml
input
```
```xml
type
```
```xml
=
```
```xml
'password'
```
```xml
name
```
```xml
=
```
```xml
'j_password'
```
```xml
/></
```
```xml
td
```
```xml
></
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
><
```
```xml
td
```
```xml
colspan
```
```xml
=
```
```xml
'2'
```
```xml
><
```
```xml
input
```
```xml
name
```
```xml
=
```
```xml
"submit"
```
```xml
type
```
```xml
=
```
```xml
"submit"
```
```xml
/></
```
```xml
td
```
```xml
></
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
><
```
```xml
td
```
```xml
colspan
```
```xml
=
```
```xml
'2'
```
```xml
><
```
```xml
input
```
```xml
name
```
```xml
=
```
```xml
"reset"
```
```xml
type
```
```xml
=
```
```xml
"reset"
```
```xml
/></
```
```xml
td
```
```xml
></
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
</
```
```xml
table
```
```xml
>
```
```xml
</
```
```xml
form
```
```xml
></
```
```xml
body
```
```xml
></
```
```xml
html
```
```xml
>
```
```
    可以看到这里的默认请求路径就是/j_spring_security_check了，不过这里我们已经可以使用我们配置的用户来登录了，之前在配置文件中的admin和user1，它们拥有的权限不同，那么我们使用user1登录，来发布消息。验证通过，出现消息输入页面： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_5.png)
下面发布消息，之后能看到消息的列表了，这对ROLE_USER的角色都是可以查看的。 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_6.png)
    没有把Author的信息打印出来，为什么？我们在这里对这个自动进行了限制，来看一下页面是怎么写的： 
```
```xml
<
```
```xml
security:authorize
```
```xml
ifAllGranted
```
```xml
=
```
```xml
"ROLE_ADMIN,ROLE_USER"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
tr
```
```xml
>
```
```xml
```
```xml
<
```
```xml
td
```
```xml
>Author</
```
```xml
td
```
```xml
>
```
```xml
```
```xml
<
```
```xml
td
```
```xml
>${message.author}</
```
```xml
td
```
```xml
>
```
```xml
```
```xml
</
```
```xml
tr
```
```xml
>
```
```xml
</
```
```xml
security:authorize
```
```xml
>
```
```
    这里说的是拥有ROLE_ADMIN和ROLE_USER两种角色才能显示author信息，显然我们权限不够了，当然把这里修改为ifAnyGranted=”ROLE_ADMIN,ROLE_USER”就可以显示出来了，All和Any的区别嘛，很容易理解。还有一个属性是ifNotGranted，不用说你也会明白它是什么意思了，我们现在修改为ifAnyGranted=”ROLE_ADMIN,ROLE_USER”，刷新页面，就会看到如下内容了： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_7.png)
    其实这已经是在扩展Security框架的视图功能了，就是这么使用的，如果想了解security框架标签库其它标签，那么去参考官方文档吧，因为你已经知道该怎么去套用了。 
    该试试删除功能了，当前用户角色是ROLE_USER，想删除肯定是不可以的了，那么会是怎么样的效果呢，点击Delete链接，看一下吧： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_8.png)
    非常不幸，被拦截下来了，HTTP 403表示没有权限，那么就对了，Security框架起作用了，这就是我们想要的效果了。 
    Security框架的基本URL拦截到此就说完了，是不是很简单？下面就来定制一些操作吧，我们既然编写了自定义登录页面，得用上吧，还有Logout退出功能没用呢。下面就对这基本的配置进行第一次扩展，我们这样做： 
```
```xml
<
```
```xml
security:http
```
```xml
>
```
```xml
```
```xml
<
```
```xml
security:intercept-url
```
```xml
pattern
```
```xml
=
```
```xml
"/messageList.htm"
```
```xml
```
```xml
access
```
```xml
=
```
```xml
"ROLE_ADMIN,ROLE_USER,ROLE_GUEST"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:intercept-url
```
```xml
pattern
```
```xml
=
```
```xml
"/messagePost.htm"
```
```xml
```
```xml
access
```
```xml
=
```
```xml
"ROLE_ADMIN,ROLE_USER"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:intercept-url
```
```xml
pattern
```
```xml
=
```
```xml
"/messageDelete.htm"
```
```xml
```
```xml
access
```
```xml
=
```
```xml
"ROLE_ADMIN"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:form-login
```
```xml
login-page
```
```xml
=
```
```xml
"/login.jsp"
```
```xml
login-processing-url
```
```xml
=
```
```xml
"/login"
```
```xml
default-target-url
```
```xml
=
```
```xml
"/messageList.htm"
```
```xml
```
```xml
authentication-failure-url
```
```xml
=
```
```xml
"/login.jsp?error=true"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:logout
```
```xml
logout-success-url
```
```xml
=
```
```xml
"/login.jsp"
```
```xml
/>
```
```xml
</
```
```xml
security:http
```
```xml
>
```
```
    首先去掉auto-config，因为要定制，不让Security按它默认的执行。那么登录验证就配置吧，login-page属性配置的是登录页面，就是我们前面所写的，login-processing-url就是我们处理登录逻辑的请求地址，默认的是j_spring_security_check，前面也说过了，default_target_url就是默认的登录成功转向的目标地址，这里是消息列表页面。最后一个属性是authentication-failure-url，很明白了，就是验证失败转向的页面，这里我们附加一个参数error，页面里面也有体现，就是用它来控制失败信息的打印的。下面一个是配置退出，logout-success-url就是退出后转向的页面，这里是到登录页面，没错，退出后回到登录页面。下面来看看效果吧，修改完毕重启Jetty： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_9.png)
    由于去掉了匿名访问，那么直接请求messageList.htm就会为我们跳转到登录页面了，进行身份验证，此时我们输入一个错误的信息，看看能捕捉到什么： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_10.png)
    验证失败错误会出现Bad credentials，这里不判断是用户不存在还是密码错误，统一是登录凭据错误。输入正确的信息就可以重复上述操作了。使用admin登录成功，会出现： 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_result_11.png)
    至此基本的Security拦截操作已经说完了，是不是很简单呢。当然这是测试的，真实应用中我们的用户不可能这么配置，因为都是存放在数据库中的，那么Security能不能支持数据库用户验证呢？答案是肯定的。只是需要一些扩展配置，这里Security整合了一些数据库验证的操作，要符合Security的验证模式，那么要么我们重新设计数据库，要么在原有基础之上来修改一下数据库设计。这里我们先看一下Security框架默认支持的数据库设计吧，就是它默认SQL查询语句所支持的内容。 
![](http://www.chinasb.org/wp-content/uploads/2011/05/spring_mvc_demo_mysql.png)
    这两个表明是默认的，这么写Security会自己识别出来，不用我们书写SQL语句了。先来看看表设计吧，就这些信息就够Security进行验证了。 
```
`CREATE`
```
TABLE
```
```
`users` (
```
`  `
```
`USERNAME`
```
`varchar`
```
(10)
```
`NOT`
```
NULL
```
`,`
`  `````PASSWORD`
```
`
```
`varchar`
```
(32)
```
`NOT`
```
NULL
```
`,`
`  `
```
`ENABLED`
 tinyint(1)
```
`NOT`
```
NULL
```
`,`
`  ``PRIMARY`
```
KEY
```
```
(`USERNAME`)
```
```
)
 ENGINE=InnoDB
```
`DEFAULT`
```
CHARSET=utf8
```
`CREATE`
```
TABLE
```
```
`authorities` (
```
`  `
```
`USERNAME`
```
`varchar`
```
(10)
```
`NOT`
```
NULL
```
`,`
`  `
```
`AUTHORITY`
```
`varchar`
```
(10)
```
`NOT`
```
NULL
```
`,`
`  ``KEY`
```
`FK_USERNAME_AUTHORITY` (`USERNAME`),
```
`  ``CONSTRAINT`
```
`FK_USERNAME_AUTHORITY`
```
`FOREIGN`
```
KEY
```
```
(`USERNAME`)
```
`REFERENCES`
```
`users` (`USERNAME`)
```
`ON`
```
DELETE
```
```
NO
```
```
ACTION
```
```
ON
```
```
UPDATE
```
```
NO
```
```
ACTION
```
```
)
 ENGINE=InnoDB
```
`DEFAULT`
```
CHARSET=utf8
```
```
    两个表之间有一个外键的关联，是用户名关联，而且我们还进行了md5密码扩展，这也要在Security框架进行配置，在表中插入一些信息，就可以进行数据库验证了，此时Security框架的配置如下，修改认证管理器： 
```
```xml
<
```
```xml
security:authentication-manager
```
```xml
>
```
```xml
```
```xml
<
```
```xml
security:authentication-provider
```
```xml
>
```
```xml
```
```xml
<
```
```xml
security:password-encoder
```
```xml
ref
```
```xml
=
```
```xml
"md5Encoder"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
security:jdbc-user-service
```
```xml
data-source-ref
```
```xml
=
```
```xml
"dataSource"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
security:authentication-provider
```
```xml
>
```
```xml
</
```
```xml
security:authentication-manager
```
```xml
>
```
```
    这里我们配置了jdbc数据源和密码编码器，因为连MD5加密方式也是我们自定义的，这样安全系数更高。要使用自定义的加密器，别忘了编写加密器的bean。 
```
```xml
<
```
```xml
bean
```
```xml
id
```
```xml
=
```
```xml
"md5Encoder"
```
```xml
class
```
```xml
=
```
```xml
"org.ourpioneer.board.util.MD5Encoder"
```
```xml
/>
```
```
 加密器类需要实现PasswordEncoder接口，然后编写我们自己的加密方案，加密器很简单，如下设计： 
```
```xml
package
 org.ourpioneer.board.util;
```
```xml
import
 org.springframework.dao.DataAccessException;
```
```xml
import
 org.springframework.security.authentication.encoding.PasswordEncoder;
```
```xml
public
 class MD5Encoder implements PasswordEncoder {
```
```xml
```
```xml
public
 String encodePassword(String origPwd, Object salt)
```
```xml
```
```xml
throws
 DataAccessException {
```
```xml
```
```xml
return
 MD5.getMD5ofStr(origPwd);
```
```xml
```
```xml
}
```
```xml
```
```xml
public
 boolean isPasswordValid(String encPwd, String origPwd, Object salt)
```
```xml
```
```xml
throws
 DataAccessException {
```
```xml
```
```xml
return
 encPwd.equals(encodePassword(origPwd, salt));
```
```xml
```
```xml
}
```
```xml
}
```
```
其中使用到的MD5加密类为： 
```
```java
package
```
```java
org.ourpioneer.board.util;
```
```java
import
```
```java
java.security.MessageDigest;
```
```java
/**
```
```java
```
```java
*
 标准MD5加密方法，使用java类库的security包的MessageDigest类处理 <BR>
```
```java
```
```java
*
 也可变为非标准MD5，请修改下面的移位算法
```
```java
```
```java
*
```
```java
```
```java
*
 @author Nanlei
```
```java
```
```java
*
```
```java
```
```java
*/
```
```java
public
```
```java
class
```
```java
MD5 {
```
```java
```
```java
/**
```
```java
```
```java
*
 获得MD5加密密码的方法
```
```java
```
```java
*/
```
```java
```
```java
public
```
```java
static
```
```java
String getMD5ofStr(String origString) {
```
```java
```
```java
String
 origMD5 =
```
```java
null
```
```java
;
```
```java
```
```java
try
```
```java
{
```
```java
```
```java
MessageDigest
 md5 = MessageDigest.getInstance(
```
```java
"MD5"
```
```java
);
```
```java
```
```java
byte
```
```java
[]
 result = md5.digest(origString.getBytes());
```
```java
```
```java
origMD5
 = byteArray2HexStr(result);
```
```java
```
```java
}
```
```java
catch
```
```java
(Exception e) {
```
```java
```
```java
e.printStackTrace();
```
```java
```
```java
}
```
```java
```
```java
return
```
```java
origMD5;
```
```java
```
```java
}
```
```java
```
```java
/**
```
```java
```
```java
*
 处理字节数组得到MD5密码的方法
```
```java
```
```java
*/
```
```java
```
```java
private
```
```java
static
```
```java
String byteArray2HexStr(
```
```java
byte
```
```java
[]
 bs) {
```
```java
```
```java
StringBuffer
 sb =
```
```java
new
```
```java
StringBuffer();
```
```java
```
```java
for
```
```java
(
```
```java
byte
```
```java
b : bs) {
```
```java
```
```java
sb.append(byte2HexStr(b));
```
```java
```
```java
}
```
```java
```
```java
return
```
```java
sb.toString();
```
```java
```
```java
}
```
```java
```
```java
/**
```
```java
```
```java
*
 字节标准移位转十六进制方法
```
```java
```
```java
*/
```
```java
```
```java
private
```
```java
static
```
```java
String byte2HexStr(
```
```java
byte
```
```java
b) {
```
```java
```
```java
String
 hexStr =
```
```java
null
```
```java
;
```
```java
```
```java
int
```
```java
n = b;
```
```java
```
```java
if
```
```java
(n <
```
```java
0
```
```java
)
 {
```
```java
```
```java
//
 若需要自定义加密,请修改这个移位算法即可
```
```java
```
```java
n
 = b &
```
```java
0x7F
```
```java
+
```
```java
128
```
```java
;
```
```java
```
```java
}
```
```java
```
```java
hexStr
 = Integer.toHexString(n /
```
```java
16
```
```java
)
 + Integer.toHexString(n %
```
```java
16
```
```java
);
```
```java
```
```java
return
```
```java
hexStr.toUpperCase();
```
```java
```
```java
}
```
```java
```
```java
/**
```
```java
```
```java
*
 提供一个MD5多次加密方法
```
```java
```
```java
*/
```
```java
```
```java
public
```
```java
static
```
```java
String getMD5ofStr(String origString,
```
```java
int
```
```java
times) {
```
```java
```
```java
String
 md5 = getMD5ofStr(origString);
```
```java
```
```java
for
```
```java
(
```
```java
int
```
```java
i =
```
```java
0
```
```java
;
 i < times -
```
```java
1
```
```java
;
 i++) {
```
```java
```
```java
md5
 = getMD5ofStr(md5);
```
```java
```
```java
}
```
```java
```
```java
return
```
```java
getMD5ofStr(md5);
```
```java
```
```java
}
```
```java
```
```java
/**
```
```java
```
```java
*
 密码验证方法
```
```java
```
```java
*/
```
```java
```
```java
public
```
```java
static
```
```java
boolean
```
```java
verifyPassword(String inputStr, String MD5Code) {
```
```java
```
```java
return
```
```java
getMD5ofStr(inputStr).equals(MD5Code);
```
```java
```
```java
}
```
```java
```
```java
/**
```
```java
```
```java
*
 多次加密时的密码验证方法
```
```java
```
```java
*/
```
```java
```
```java
public
```
```java
static
```
```java
boolean
```
```java
verifyPassword(String inputStr, String MD5Code,
```
```java
```
```java
int
```
```java
times) {
```
```java
```
```java
return
```
```java
getMD5ofStr(inputStr, times).equals(MD5Code);
```
```java
```
```java
}
```
```java
```
```java
/**
```
```java
```
```java
*
 提供一个测试的主函数
```
```java
```
```java
*/
```
```java
```
```java
public
```
```java
static
```
```java
void
```
```java
main(String[] args) {
```
```java
```
```java
System.out.println(
```
```java
"123:"
```
```java
+ getMD5ofStr(
```
```java
"123"
```
```java
));
```
```java
```
```java
System.out.println(
```
```java
"123456789:"
```
```java
+ getMD5ofStr(
```
```java
"123456789"
```
```java
));
```
```java
```
```java
System.out.println(
```
```java
"pioneer:"
```
```java
+ getMD5ofStr(
```
```java
"pioneer"
```
```java
));
```
```java
```
```java
System.out.println(
```
```java
"123:"
```
```java
+ getMD5ofStr(
```
```java
"123"
```
```java
,
```
```java
4
```
```java
));
```
```java
```
```java
}
```
```java
}
```
```
加密工作已经准备好，之前配置的数据源是： 
```
```xml
<
```
```xml
bean
```
```xml
id
```
```xml
=
```
```xml
"dataSource"
```
```xml
```
```xml
class
```
```xml
=
```
```xml
"org.springframework.jdbc.datasource.DriverManagerDataSource"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"driverClassName"
```
```xml
value
```
```xml
=
```
```xml
"com.mysql.jdbc.Driver"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"url"
```
```xml
```
```xml
value
```
```xml
=
```
```xml
"jdbc:mysql://localhost:3306/board"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"username"
```
```xml
value
```
```xml
=
```
```xml
"root"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"password"
```
```xml
value
```
```xml
=
```
```xml
"123"
```
```xml
/>
```
```xml
</
```
```xml
bean
```
```xml
>
```
```
别忘了加入JDBC的驱动程序，之后我们就可以使用数据库用户验证了，剩下的步骤就和前面是一样的了。 
