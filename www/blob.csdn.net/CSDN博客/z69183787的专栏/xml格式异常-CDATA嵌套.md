# xml格式异常-CDATA嵌套 - z69183787的专栏 - CSDN博客
2014年09月03日 16:08:01[OkidoGreen](https://me.csdn.net/z69183787)阅读数：6199
今天代码解析一段XML时报错，经过检查发现里面有嵌套CDATA标志的情况，导致XML结构发生了变化，不能转换为xml对象了，百度下，找到下面的解决方案，测试下好使，分享下！
[http://hi.baidu.com/yin_xiaogang/blog/item/f0f4a4ce3ef0c50592457e78.html](http://hi.baidu.com/yin_xiaogang/blog/item/f0f4a4ce3ef0c50592457e78.html)
在CDATA内部的所有内容都会被解析器忽略。一个 CDATA 部件以"<![CDATA[" 标记开始，以"]]>"标记结束。但是要记住，CDATA是不能够嵌套的。但是现在，就是有人要求实现CDATA的嵌套。
比如，将下面这段XML加到另外一个XML的某个元素里面：
<?xml version="1.0" encoding="UTF-8" ?>
<System><id>library</id>
<name>Library Management</name>
<description><![CDATA[This is a sample library management subsystem for Signet.]]></description>
<Categories>
<System/>
将内部的CDATA的结尾转义？那就变成了"<![CDATA[" 和"]]>amp;"，这样不好吧，老师说，接收XML的那一方怎么会知道你在里面加上了转义？
那么，可以把CDATA的结尾的"]]>"破坏掉，把它分到两个CDATA中，然后调用Java的API读取该元素的数据时，实际上API同时读取两个CDATA块，然后合成一个。
那么，把上面的XML作为一个字符串来处理，将"]]>"替换为"]]]]><![CDATA["，千万要记住，不要包含空格进去。这样，结果应该是
<?xml version="1.0" encoding="UTF-8"?>
<Messages>
<Message type="data">
<code>1199242678515-176590595</code>
<date>2008/01/02</date>
<time>10:57:58</time>
<content><![CDATA[<?xml version="1.0" encoding="UTF-8" ?>
<System><id>library</id>
<name>Library Management</name>
<description><![CDATA[This is a sample library management subsystem for Signet.]]]]><![CDATA[></description>
<Categories>
<System/>]]></content>
</Message>
</Messages>
这样，利用Object org.dom4j.Element.getData()方法得到的数据才是原始的XML片段。
CDATA 在xml中使用比较频繁，当我们在给节点的值中有特殊字符时，就需要把值用CDATA括起来，这样就不解析里面的内容了。但是当遇到里面的值中已有CDATA时就出错了。它是不允许嵌套的。今天在使用soapUI时，发现它展示的xml中成功的使用了CDATA嵌套，自己写了个程序试了下，果然管用。
代码如下。
```
```java
package
```
```java
test;
```
```java
import
```
```java
java.io.StringReader;
```
```java
import
```
```java
org.jdom.*;
```
```java
import
```
```java
org.jdom.output.*;
```
```java
import
```
```java
org.jdom.input.*;
```
```java
/**
```
```java
```
```java
*
```
```java
```
```java
*
 @author Administrator
```
```java
```
```java
*/
```
```java
public
```
```java
class
```
```java
CDATATest
 {
```
```java
```
```java
/**
 Creates a new instance of CDATATest */
```
```java
```
```java
public
```
```java
CDATATest()
 {
```
```java
```
```java
}
```
```java
```
```java
public
```
```java
static
```
```java
void
```
```java
main(String[]
 args){
```
```java
```
```java
SAXBuilder
 saxb=
```
```java
new
```
```java
SAXBuilder();
```
```java
```
```java
Document
 doc=
```
```java
null
```
```java
;
```
```java
```
```java
Element
 element,childelement;
```
```java
```
```java
StringReader
 strreader=
```
```java
null
```
```java
;
```
```java
```
```java
Attribute
 attribute=
```
```java
null
```
```java
;
```
```java
```
```java
String
 xml=
```
```java
"<?xml
 version=\"1.0\" encoding=\"utf-8\" ?>"
```
```java
+
```
```java
```
```java
"<catalogs>"
```
```java
+
```
```java
```
```java
"<catalog1>"
```
```java
+
```
```java
```
```java
"<![CDATA[<?xml
 version=\"1.0\" encoding=\"UTF-8\"?><Request><Data><![CDATA[x>0]]]]>><![CDATA[</Data></Request>]]>"
```
```java
+
```
```java
```
```java
"</catalog1>"
```
```java
+
```
```java
```
```java
"</catalogs>"
```
```java
;
```
```java
//中间的"]]>"替换成了"]]]]>><![CDATA["
```
```java
```
```java
try
```
```java
{
```
```java
```
```java
strreader=
```
```java
new
```
```java
StringReader(xml);
```
```java
```
```java
doc=saxb.build(strreader);
```
```java
```
```java
element=doc.getRootElement();
```
```java
```
```java
System.out.println(
```
```java
"catalog1的值："
```
```java
+element.getChildText(
```
```java
"catalog1"
```
```java
));
```
```java
```
```java
}
```
```java
catch
```
```java
(Exception
 e){
```
```java
```
```java
e.printStackTrace();
```
```java
```
```java
}
```
```java
```
```java
}
```
```java
}
```
```
