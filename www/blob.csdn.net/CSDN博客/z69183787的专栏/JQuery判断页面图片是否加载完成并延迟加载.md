# JQuery判断页面图片是否加载完成并延迟加载 - z69183787的专栏 - CSDN博客
2015年02月16日 16:34:52[OkidoGreen](https://me.csdn.net/z69183787)阅读数：5319
个人分类：[Javascript-Jquery](https://blog.csdn.net/z69183787/article/category/2175111)

当页面图片很多、网络又不快时，图片显示会由上往下慢慢显示，这会让使用者观感很不好，故我希望在图片加载完成时，再将该图片显示，并用文字提示加载完成，虽然这个需求有很多JQuery的套件可以完成，且效果都还不错，如 Masonry、Lazy Load，但还是自己想亲手试试，当作给自己的一个小习题 :P
首先先找图片(找超久..)，因放localhost加载会很快，所以我去Google了一些图片，特别要注意的事，这些图片像素都很大，我在img标签指定大小，但这样实际传输的大小会跟原始图片一样大，并不会因为指定Size后而有所改变
<img src="http://figurehobbyclub.tw/forum/data/attachment/forum/201305/10/153647wfx1i5xc5a011rz0.jpg" id="Img1" width="300" height="451" />
<img src="http://img.miigii.com.tw/Files/Gonglue/20110201/3d524ac9ddcd45ffa73af674630ad079.jpg" id="Img2" width="300" height="451" />
<img src="http://figurehobbyclub.tw/forum/data/attachment/forum/201305/10/153647wfx1i5xc5a011rz0.jpg" id="Img3" width="300" height="451" />
<img src="http://img.miigii.com.tw/Files/Gonglue/20110201/3d524ac9ddcd45ffa73af674630ad079.jpg" id="Img4" width="300" height="451" />
<img src="http://figurehobbyclub.tw/forum/data/attachment/forum/201305/10/153647wfx1i5xc5a011rz0.jpg" id="Img5" width="300" height="451" />
<img src="http://img.miigii.com.tw/Files/Gonglue/20110201/3d524ac9ddcd45ffa73af674630ad079.jpg" id="Img6" width="300" height="451" />接着于<head></head>放入以下程序代码，当然请记得加载JQuery，程序大概逻辑是，先抓取每个图片的DOM，利用this.complete的语法来判断是否已加载完成，如果加载完成就将此图片显示，并印出此DOM的ID，至于GetRumdomStr函式则可忽略，我只是要在每个Src后面加入参数，让[浏览器](http://www.it165.net/edu/ewl/)认为这是一个未cache过的图片。
[view source](http://www.it165.net/pro/html/201305/5955.html#viewSource)[print](http://www.it165.net/pro/html/201305/5955.html#printSource)[?](http://www.it165.net/pro/html/201305/5955.html#about)
`01.``<script type=``"text/javascript"``>`
`02.``GetRumdomStr = ``function``() {`
`03.``var``str = ``""``;`
`04.``var``maxNum = 10;`
`05.``var``minNum = 0;`
`06.``var``n = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;`
`07.``for``(``var``i = 1; i <= 50; i++) {`
`08.``n = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;`
`09.``str += n.toString();`
`10.``}`
`11.``return``str;`
`12.``};`
`13.`
`14.``$(document).ready(``function``() {`
`15.``$(``'img'``).hide(); ``//先把所有图片先隐藏`
`16.``var``ImgCount = $(``'img'``).length; ``//取得图片的个数`
`17.``$(``'img'``).each(``function`
```
()
 {
```
`18.``var``str = GetRumdomStr(); ``//请忽略,让图片加随机随机数,视为模拟未曾下载过的图片`
`19.``var``url = $(``this``).attr(``"src"``);`
`20.``$(``this``).attr(``"src"`
```
,
 url +
```
`"?"``+ str);`
`21.`
`22.``function``ImageLoading() {`
`23.``msg = ``"Image ID : "``+ ``this`
```
.id
 +
```
`"....done"``;`
`24.``console.log(msg);`
`25.``$(``'#msg'``).append(``"<div>"`
```
+
 msg +
```
`"</div>"``);`
`26.``$(``this``).fadeIn(2000);`
`27.``ImgCount--;`
`28.``if``(ImgCount === 0) {`
`29.``console.log(``"All images Loaded.."``);`
`30.``}`
`31.``}`
`32.`
`33.``if``($(``this``).complete) {`
`34.``imageLoaded.call(``this``);`
`35.``} ``else``{`
`36.``$(``this``).one(``'load'`
```
,
 ImageLoading);
```
`37.``}`
`38.``});`
`39.``});`
`40.``</script>`
``
## [JavaScript判断图片是否加载完成的三种方式](http://www.cnblogs.com/snandy/p/3704938.html)
有时需要获取图片的尺寸，这需要在图片加载完成以后才可以。有三种方式实现，下面一一介绍。
### 一、load事件
```
```java
<!DOCTYPE
 HTML>
```
```java
<html>
```
```java
<head>
```
```java
```
```java
<meta
 charset=
```
```java
"utf-8"
```
```java
>
```
```java
```
```java
<title>img
 - load event</title>
```
```java
</head>
```
```java
<body>
```
```java
```
```java
<img
 id=
```
```java
"img1"
```
```java
src=
```
```java
"[http://pic1.win4000.com/wallpaper/f/51c3bb99a21ea.jpg](http://pic1.win4000.com/wallpaper/f/51c3bb99a21ea.jpg)"
```
```java
>
```
```java
```
```java
<p
 id=
```
```java
"p1"
```
```java
>loading...</p>
```
```java
```
```java
<script
 type=
```
```java
"text/javascript"
```
```java
>
```
```java
```
```java
img1.onload
 =
```
```java
function
```
```java
()
 {
```
```java
```
```java
p1.innerHTML
 =
```
```java
'loaded'
```
```java
```
```java
}
```
```java
```
```java
</script>
```
```java
</body>
```
```java
</html>
```
```
测试，所有浏览器都显示出了“loaded”，说明所有浏览器都支持img的load事件。
### 二、readystatechange事件
```
```java
<!DOCTYPE
 HTML>
```
```java
<html>
```
```java
<head>
```
```java
```
```java
<meta
 charset=
```
```java
"utf-8"
```
```java
>
```
```java
```
```java
<title>img
 - readystatechange event</title>
```
```java
</head>
```
```java
<body>
```
```java
```
```java
<img
 id=
```
```java
"img1"
```
```java
src=
```
```java
"[http://pic1.win4000.com/wallpaper/f/51c3bb99a21ea.jpg](http://pic1.win4000.com/wallpaper/f/51c3bb99a21ea.jpg)"
```
```java
>
```
```java
```
```java
<p
 id=
```
```java
"p1"
```
```java
>loading...</p>
```
```java
```
```java
<script
 type=
```
```java
"text/javascript"
```
```java
>
```
```java
```
```java
img1.onreadystatechange
 =
```
```java
function
```
```java
()
 {
```
```java
```
```java
if
```
```java
(img1.readyState==
```
```java
"complete"
```
```java
||img1.readyState==
```
```java
"loaded"
```
```java
){
```
```java
```
```java
p1.innerHTML
 =
```
```java
'readystatechange:loaded'
```
```java
```
```java
}
```
```java
```
```java
}
```
```java
```
```java
</script>
```
```java
</body>
```
```java
</html>
```
```
readyState为complete和loaded则表明图片已经加载完毕。测试IE6-IE10支持该事件，其它浏览器不支持。
### 三、img的complete属性
```
```java
<!DOCTYPE
 HTML>
```
```java
<html>
```
```java
<head>
```
```java
```
```java
<meta
 charset=
```
```java
"utf-8"
```
```java
>
```
```java
```
```java
<title>img
 - complete attribute</title>
```
```java
</head>
```
```java
<body>
```
```java
```
```java
<img
 id=
```
```java
"img1"
```
```java
src=
```
```java
"[http://pic1.win4000.com/wallpaper/f/51c3bb99a21ea.jpg](http://pic1.win4000.com/wallpaper/f/51c3bb99a21ea.jpg)"
```
```java
>
```
```java
```
```java
<p
 id=
```
```java
"p1"
```
```java
>loading...</p>
```
```java
```
```java
<script
 type=
```
```java
"text/javascript"
```
```java
>
```
```java
```
```java
function
```
```java
imgLoad(img,
 callback) {
```
```java
```
```java
var
```
```java
timer
 = setInterval(
```
```java
function
```
```java
()
 {
```
```java
```
```java
if
```
```java
(img.complete)
 {
```
```java
```
```java
callback(img)
```
```java
```
```java
clearInterval(timer)
```
```java
```
```java
}
```
```java
```
```java
},
 50)
```
```java
```
```java
}
```
```java
```
```java
imgLoad(img1,
```
```java
function
```
```java
()
 {
```
```java
```
```java
p1.innerHTML(
```
```java
'加载完毕'
```
```java
)
```
```java
```
```java
})
```
```java
```
```java
</script>
```
```java
</body>
```
```java
</html>
```
```
轮询不断监测img的complete属性，如果为true则表明图片已经加载完毕，停止轮询。该属性所有浏览器都支持。
![](http://images.cnitblog.com/i/114013/201405/031658070021163.png)

