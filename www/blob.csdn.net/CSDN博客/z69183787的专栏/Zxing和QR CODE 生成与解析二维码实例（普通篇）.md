# Zxing和QR CODE 生成与解析二维码实例（普通篇） - z69183787的专栏 - CSDN博客
2017年12月05日 18:24:23[OkidoGreen](https://me.csdn.net/z69183787)阅读数：900
[http://blog.csdn.net/gao36951/article/details/41148075](http://blog.csdn.net/gao36951/article/details/41148075)
首先下载对应的jar包，本实例用的是Zxing2.2jar
下载地址：[http://download.csdn.net/detail/gao36951/8161861](http://download.csdn.net/detail/gao36951/8161861)
Zxing是Google提供的关于条码（一维码、二维码）的解析工具，提供了二维码的生成与解析的方法，
## 下面看Zxing实例
### 代码：
[java][view
 plain](http://blog.csdn.net/gao36951/article/details/41148075#)[copy](http://blog.csdn.net/gao36951/article/details/41148075#)
- package com.zxing.create;  
- 
- import java.awt.image.BufferedImage;  
- import java.io.File;  
- import java.io.IOException;  
- import java.util.HashMap;  
- 
- 
- import java.util.Map;  
- 
- import javax.imageio.ImageIO;  
- 
- import com.google.zxing.BarcodeFormat;  
- import com.google.zxing.Binarizer;  
- import com.google.zxing.BinaryBitmap;  
- import com.google.zxing.EncodeHintType;  
- import com.google.zxing.LuminanceSource;  
- import com.google.zxing.MultiFormatReader;  
- import com.google.zxing.MultiFormatWriter;  
- import com.google.zxing.Result;  
- import com.google.zxing.WriterException;  
- import com.google.zxing.common.BitMatrix;  
- import com.google.zxing.common.HybridBinarizer;  
- import com.util.BufferedImageLuminanceSource;  
- 
- 
- /**  
-  * @Description: (普通二维码生成)     
-  * @author：Relieved  
-  * @date：2014-11-7 下午04:42:35     
-  */
- publicclass CreateParseCode {  
- publicstaticvoid  main(String [] args) throws IOException, WriterException{  
-         CreateParseCode cpCode = new CreateParseCode();  
- //      生成二维码
-         cpCode.createCode();  
- //      解析二维码
-         cpCode.parseCode(new File("D:/二维码生成/TDC-test.png"));  
- 
-     }  
- /**
-      * 二维码的生成
-      *
-      */
- publicvoid createCode(){  
-         String text = "http://blog.csdn.net/gao36951";  
- int width = 300;  
- int height = 300;  
- // 二维码的图片格式
-         String format = "png";  
- /**
-          * 设置二维码的参数
-          */
-         HashMap hints = new HashMap();  
- // 内容所使用编码
-         hints.put(EncodeHintType.CHARACTER_SET, "utf-8");  
- try {  
-             BitMatrix bitMatrix = new MultiFormatWriter().encode(text,BarcodeFormat.QR_CODE,width,height,hints);  
- // 生成二维码
-             File outputFile = new File("D:"+ File.separator +"二维码生成" + File.separator + "TDC-test.png");  
-             MatrixToImageWriter.writeToFile(bitMatrix, format, outputFile);  
- 
-         } catch (Exception e) {  
-             e.printStackTrace();  
-         }  
- 
-     }  
- /**
-      * 二维码的解析
-      *
-      * @param file
-      */
- publicvoid parseCode(File file)  
-     {  
- try
-         {  
-             MultiFormatReader formatReader = new MultiFormatReader();  
- 
- if (!file.exists())  
-             {  
- return;  
-             }  
- 
-             BufferedImage image = ImageIO.read(file);  
- 
-             LuminanceSource source = new BufferedImageLuminanceSource(image);  
-             Binarizer binarizer = new HybridBinarizer(source);  
-             BinaryBitmap binaryBitmap = new BinaryBitmap(binarizer);  
- 
-             Map hints = new HashMap();  
-             hints.put(EncodeHintType.CHARACTER_SET, "UTF-8");  
- 
-             Result result = formatReader.decode(binaryBitmap, hints);  
- 
-             System.out.println("解析结果 = " + result.toString());  
-             System.out.println("二维码格式类型 = " + result.getBarcodeFormat());  
-             System.out.println("二维码文本内容 = " + result.getText());  
-         }  
- catch (Exception e)  
-         {  
-             e.printStackTrace();  
-         }  
-     }  
- }  
### 生成和解析相关工具类代码：
[java][view
 plain](http://blog.csdn.net/gao36951/article/details/41148075#)[copy](http://blog.csdn.net/gao36951/article/details/41148075#)
- import com.google.zxing.common.BitMatrix;  
- 
- import javax.imageio.ImageIO;  
- import java.io.File;  
- import java.io.OutputStream;  
- import java.io.IOException;  
- import java.awt.image.BufferedImage;  
- 
- 
- publicfinalclass MatrixToImageWriter {  
- 
- privatestaticfinalint BLACK = 0xFF000000;  
- privatestaticfinalint WHITE = 0xFFFFFFFF;  
- 
- private MatrixToImageWriter() {}  
- 
- 
- publicstatic BufferedImage toBufferedImage(BitMatrix matrix) {  
- int width = matrix.getWidth();  
- int height = matrix.getHeight();  
-      BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);  
- for (int x = 0; x < width; x++) {  
- for (int y = 0; y < height; y++) {  
-          image.setRGB(x, y, matrix.get(x, y) ? BLACK : WHITE);  
-        }  
-      }  
- return image;  
-    }  
- 
- 
- publicstaticvoid writeToFile(BitMatrix matrix, String format, File file)  
- throws IOException {  
-      BufferedImage image = toBufferedImage(matrix);  
- if (!ImageIO.write(image, format, file)) {  
- thrownew IOException("Could not write an image of format " + format + " to " + file);  
-      }  
-    }  
- 
- 
- publicstaticvoid writeToStream(BitMatrix matrix, String format, OutputStream stream)  
- throws IOException {  
-      BufferedImage image = toBufferedImage(matrix);  
- if (!ImageIO.write(image, format, stream)) {  
- thrownew IOException("Could not write an image of format " + format);  
-      }  
-    }  
- 
-  }  

[java][view
 plain](http://blog.csdn.net/gao36951/article/details/41148075#)[copy](http://blog.csdn.net/gao36951/article/details/41148075#)
- package com.util;  
- 
- import com.google.zxing.LuminanceSource;  
- 
- import java.awt.Graphics2D;  
- import java.awt.geom.AffineTransform;  
- import java.awt.image.BufferedImage;  
- 
- publicfinalclass BufferedImageLuminanceSource extends LuminanceSource {  
- 
- privatefinal BufferedImage image;  
- privatefinalint left;  
- privatefinalint top;  
- 
- public BufferedImageLuminanceSource(BufferedImage image) {  
- this(image, 0, 0, image.getWidth(), image.getHeight());  
-   }  
- 
- public BufferedImageLuminanceSource(BufferedImage image, int left, int top, int width, int height) {  
- super(width, height);  
- 
- int sourceWidth = image.getWidth();  
- int sourceHeight = image.getHeight();  
- if (left + width > sourceWidth || top + height > sourceHeight) {  
- thrownew IllegalArgumentException("Crop rectangle does not fit within image data.");  
-     }  
- 
- for (int y = top; y < top + height; y++) {  
- for (int x = left; x < left + width; x++) {  
- if ((image.getRGB(x, y) & 0xFF000000) == 0) {  
-           image.setRGB(x, y, 0xFFFFFFFF); // = white
-         }  
-       }  
-     }  
- 
- this.image = new BufferedImage(sourceWidth, sourceHeight, BufferedImage.TYPE_BYTE_GRAY);  
- this.image.getGraphics().drawImage(image, 0, 0, null);  
- this.left = left;  
- this.top = top;  
-   }  
- 
- @Override
- publicbyte[] getRow(int y, byte[] row) {  
- if (y < 0 || y >= getHeight()) {  
- thrownew IllegalArgumentException("Requested row is outside the image: " + y);  
-     }  
- int width = getWidth();  
- if (row == null || row.length < width) {  
-       row = newbyte[width];  
-     }  
-     image.getRaster().getDataElements(left, top + y, width, 1, row);  
- return row;  
-   }  
- 
- @Override
- publicbyte[] getMatrix() {  
- int width = getWidth();  
- int height = getHeight();  
- int area = width * height;  
- byte[] matrix = newbyte[area];  
-     image.getRaster().getDataElements(left, top, width, height, matrix);  
- return matrix;  
-   }  
- 
- @Override
- publicboolean isCropSupported() {  
- returntrue;  
-   }  
- 
- @Override
- public LuminanceSource crop(int left, int top, int width, int height) {  
- returnnew BufferedImageLuminanceSource(image, this.left + left, this.top + top, width, height);  
-   }  
- 
- @Override
- publicboolean isRotateSupported() {  
- returntrue;  
-   }  
- 
- @Override
- public LuminanceSource rotateCounterClockwise() {  
- 
- int sourceWidth = image.getWidth();  
- int sourceHeight = image.getHeight();  
- 
-     AffineTransform transform = new AffineTransform(0.0, -1.0, 1.0, 0.0, 0.0, sourceWidth);  
- 
-     BufferedImage rotatedImage = new BufferedImage(sourceHeight, sourceWidth, BufferedImage.TYPE_BYTE_GRAY);  
- 
-     Graphics2D g = rotatedImage.createGraphics();  
-     g.drawImage(image, transform, null);  
-     g.dispose();  
- 
- int width = getWidth();  
- returnnew BufferedImageLuminanceSource(rotatedImage, top, sourceWidth - (left + width), getHeight(), width);  
-   }  
- 
- }  
### 生成的二维码如下图：
![](https://img-blog.csdn.net/20141116131153717?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2FvMzY5NTE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
解析结果如下：
![](https://img-blog.csdn.net/20141116131811390?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2FvMzY5NTE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
## 下面看QR CODE实例
[java][view
 plain](http://blog.csdn.net/gao36951/article/details/41148075#)[copy](http://blog.csdn.net/gao36951/article/details/41148075#)
- package com.qrcode.create;  
- 
- /** 
-  * @作者   Relieved
-  * @创建日期   2014年11月7日
-  * @描述  （利用QrCode生成二维码） 
-  * @版本 V 1.0
-  */
- import java.awt.Color;  
- import java.awt.Graphics2D;  
- import java.awt.image.BufferedImage;  
- import java.io.File;  
- 
- import javax.imageio.ImageIO;  
- 
- import com.swetake.util.Qrcode;  
- 
- /**
-  * 二维码生成器
-  */
- publicclass QRCodeEncoderHandler {  
- 
- /**
-      * 生成二维码(QRCode)图片
-      * @param content
-      * @param imgPath
-      */
- publicvoid encoderQRCode(String content, String imgPath,int version) {  
- try {  
- 
-             Qrcode qrcodeHandler = new Qrcode();  
- //设置二维码排错率，可选L(7%)、M(15%)、Q(25%)、H(30%)，排错率越高可存储的信息越少，但对二维码清晰度的要求越小  
-             qrcodeHandler.setQrcodeErrorCorrect('M');  
- //N代表数字,A代表字符a-Z,B代表其他字符
-             qrcodeHandler.setQrcodeEncodeMode('B');  
- //版本1为21*21矩阵，版本每增1，二维码的两个边长都增4；所以版本7为45*45的矩阵；最高版本为是40，是177*177的矩阵
-             qrcodeHandler.setQrcodeVersion(version);  
- int imgSize = 67 + 12 * (version- 1) ;  
-             System.out.println(content);  
- byte[] contentBytes = content.getBytes("gb2312");  
- 
-             BufferedImage bufImg = new BufferedImage(imgSize , imgSize ,BufferedImage.TYPE_INT_RGB);  
-             Graphics2D gs = bufImg.createGraphics();  
- 
-             gs.setBackground(Color.WHITE);  
-             gs.clearRect(0, 0, imgSize , imgSize );  
- 
- // 设定图像颜色 > BLACK
-             gs.setColor(Color.BLACK);  
- 
- // 设置偏移量 不设置可能导致解析出错
- int pixoff = 2;  
- // 输出内容 > 二维码
-             System.out.println(contentBytes.length);  
- if (contentBytes.length > 0 && contentBytes.length < 130) {  
- boolean[][] codeOut = qrcodeHandler.calQrcode(contentBytes);  
- for (int i = 0; i < codeOut.length; i++) {  
- for (int j = 0; j < codeOut.length; j++) {  
- if (codeOut[j][i]) {  
-                             gs.fillRect(j * 3 + pixoff, i * 3 + pixoff, 3, 3);  
-                         }  
-                     }  
-                 }  
-             } else {  
-                 System.err.println("QRCode content bytes length = "
-                         + contentBytes.length + " not in [ 0,130 ]. ");  
-             }  
- 
-             gs.dispose();  
-             bufImg.flush();  
- 
-             File imgFile = new File(imgPath);  
- 
- // 生成二维码QRCode图片
-             ImageIO.write(bufImg, "png", imgFile);  
- 
-         } catch (Exception e) {  
-             e.printStackTrace();  
-         }  
- 
-     }  
- 
- /**
-      * @param args the command line arguments
-      */
- publicstaticvoid main(String[] args) {  
-         String imgPath = "D:/二维码生成/Relieved_QRCode.png";  
- 
-         String content = "http://blog.csdn.net/gao36951";  
- 
-         QRCodeEncoderHandler handler = new QRCodeEncoderHandler();  
-         handler.encoderQRCode(content, imgPath,8);  
- 
-         System.out.println("encoder QRcode success");  
-     }  
- }  
### 生成二维码如下图
![](https://img-blog.csdn.net/20141115194338015?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2FvMzY5NTE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
### 解析代码如下：
[java][view
 plain](http://blog.csdn.net/gao36951/article/details/41148075#)[copy](http://blog.csdn.net/gao36951/article/details/41148075#)
- package com.qrcode.create.decreate;  
- 
- /** 
-  * @作者   Relieved
-  * @创建日期   2014年11月7日
-  * @描述  （解析QrCode二维码） 
-  * @版本 V 1.0
-  */
- import java.awt.image.BufferedImage;  
- import java.io.File;  
- import java.io.IOException;  
- 
- import javax.imageio.ImageIO;  
- 
- import jp.sourceforge.qrcode.QRCodeDecoder;  
- import jp.sourceforge.qrcode.data.QRCodeImage;  
- import jp.sourceforge.qrcode.exception.DecodingFailedException;  
- 
- publicclass QRCodeDecoderHandler {  
- 
- /**
-      * 解码二维码
-      * @param imgPath
-      * @return String
-      */
- public String decoderQRCode(String imgPath) {  
- 
- // QRCode 二维码图片的文件
-         File imageFile = new File(imgPath);  
- 
-         BufferedImage bufImg = null;  
-         String decodedData = null;  
- try {  
-             bufImg = ImageIO.read(imageFile);  
- 
-             QRCodeDecoder decoder = new QRCodeDecoder();  
-             decodedData = new String(decoder.decode(new J2SEImage(bufImg)),"gb2312");  
- 
-         } catch (IOException e) {  
-             System.out.println("Error: " + e.getMessage());  
-             e.printStackTrace();  
-         } catch (DecodingFailedException dfe) {  
-             System.out.println("Error: " + dfe.getMessage());  
-             dfe.printStackTrace();  
-         }  
- return decodedData;  
-     }  
- 
- /**
-      * @param args the command line arguments
-      */
- publicstaticvoid main(String[] args) {  
-         QRCodeDecoderHandler handler = new QRCodeDecoderHandler();  
-         String imgPath = "D:/二维码生成/Relieved_QRCode.png";  
-         String decoderContent = handler.decoderQRCode(imgPath);  
-         System.out.println("解析结果如下：");  
-         System.out.println(decoderContent);  
-         System.out.println("========decoder success!!!");  
-     }  
- 
- class J2SEImage implements QRCodeImage {  
-         BufferedImage bufImg;  
- 
- public J2SEImage(BufferedImage bufImg) {  
- this.bufImg = bufImg;  
-         }  
- 
- publicint getWidth() {  
- return bufImg.getWidth();  
-         }  
- 
- publicint getHeight() {  
- return bufImg.getHeight();  
-         }  
- 
- publicint getPixel(int x, int y) {  
- return bufImg.getRGB(x, y);  
-         }  
- 
-     }  
- }  
解析结果如下图:
![](https://img-blog.csdn.net/20141115194524761?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2FvMzY5NTE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
