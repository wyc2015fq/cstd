# JNDI+Tomcat配置数据源的两种方式 - z69183787的专栏 - CSDN博客
2014年03月16日 17:30:17[OkidoGreen](https://me.csdn.net/z69183787)阅读数：1157
**非全局jndi配置步骤** ：此种配置方式不需要在server.xml中配置数据源，而只在tomcat/conf/Catalina/localhost下的启动配置中配置即可。注意红色字体名称必须和相同。
0、需要在tomcat/common/lib下加入数据库连接的jar包
1、web.xml配置
```java
<resource-ref>
```
```java
```
```java
<description>my
 DB Connection</description>
```
```java
```
```java
<res-ref-name>mydataSource
 </res-ref-name>
```
```java
```
```java
<res-type>javax.sql.DataSource</res-type>
```
```java
```
```java
<res-auth>Container</res-auth>
```
```java
```
```java
</resource-ref>
```
2、applicationContext.xml下配置
```java
<bean
 id=
```
```java
"dataSource"
```
```java
```
```java
class
```
```java
=
```
```java
"org.springframework.jndi.JndiObjectFactoryBean"
```
```java
>
```
```java
```
```java
<property
 name=
```
```java
"jndiName"
```
```java
value=
```
```java
"java:comp/env/mydataSource
 "
```
```java
/>
```
```java
</bean>
```
3、在tomcat的conf下的localhost下的配置如下
```java
<?xml
 version=
```
```java
"1.0"
```
```java
encoding=
```
```java
"UTF-8"
```
```java
?>
```
```java
<Context
 docBase=
```
```java
"F:/workspace/cuapp/WebRoot"
```
```java
path=
```
```java
"cuapp"
```
```java
reloadable=
```
```java
"false"
```
```java
>
```
```java
<Resource
 name=
```
```java
"mydataSource"
```
```java
auth=
```
```java
"Container"
```
```java
type=
```
```java
"javax.sql.DataSource"
```
```java
```
```java
url=
```
```java
"jdbc:oracle:thin:@192.168.2.104:1521:ora10g"
```
```java
```
```java
driverClassName=
```
```java
"oracle.jdbc.driver.OracleDriver"
```
```java
```
```java
password=
```
```java
"aa"
```
```java
```
```java
username=
```
```java
"aa"
```
```java
```
```java
initialSize=
```
```java
"2"
```
```java
```
```java
maxActive=
```
```java
"3"
```
```java
```
```java
maxIdle=
```
```java
"1"
```
```java
```
```java
minIdle=
```
```java
"1"
```
```java
```
```java
maxWait=
```
```java
"10000"
```
```java
```
```java
removeAbandoned=
```
```java
"true"
```
```java
```
```java
logAbandoned=
```
```java
"true"
```
```java
```
```java
removeAbandonedTimeout=
```
```java
"60"
```
```java
```
```java
timeBetweenEvictionRunsMillis=
```
```java
"900000"
```
```java
```
```java
minEvictableIdleTimeMillis=
```
```java
"1800000"
```
```java
```
```java
numTestsPerEvictionRun=
```
```java
"100"
```
```java
```
```java
validationQuery=
```
```java
"select
 count(0) from dual"
```
```java
```
```java
poolPreparedStatements=
```
```java
"true"
```
```java
```
```java
maxOpenPreparedStatements=
```
```java
"100"
```
```java
/>
```
```java
</Context>
```
**全局jndi配置** ：此种配置需要在server.xml中配置数据源。 
0、需要在tomcat下加入数据库连接的jar包
1、web.xml配置
```java
<resource-ref>
```
```java
```
```java
<description>my
 DB Connection</description>
```
```java
```
```java
<res-ref-name>mydataSource
 </res-ref-name>   must be same as server.xml
```
```java
```
```java
<res-type>javax.sql.DataSource</res-type>
```
```java
```
```java
<res-auth>Container</res-auth>
```
```java
</resource-ref>
```
2、applicationContext.xml下配置
```java
<bean
 id=
```
```java
"dataSource"
```
```java
```
```java
class
```
```java
=
```
```java
"org.springframework.jndi.JndiObjectFactoryBean"
```
```java
>
```
```java
```
```java
<property
 name=
```
```java
"jndiName"
```
```java
value=
```
```java
"java:comp/env/mydataSource
 "
```
```java
/>
```
```java
</bean>
```
3、server.xml中配置为
```java
<!--
 Global JNDI resources -->
```
```java
```
```java
<GlobalNamingResources>
```
```java
```
```java
<!--
 Test entry
```
```java
for
```
```java
demonstration
 purposes -->
```
```java
```
```java
<Environment
 name=
```
```java
"simpleValue"
```
```java
type=
```
```java
"java.lang.Integer"
```
```java
value=
```
```java
"30"
```
```java
/>
```
```java
```
```java
<!--
 Editable user database that can also be used by
```
```java
```
```java
UserDatabaseRealm
 to authenticate users -->
```
```java
```
```java
<Resource
 name=
```
```java
"UserDatabase"
```
```java
auth=
```
```java
"Container"
```
```java
```
```java
type=
```
```java
"org.apache.catalina.UserDatabase"
```
```java
```
```java
description=
```
```java
"User
 database that can be updated and saved"
```
```java
```
```java
factory=
```
```java
"org.apache.catalina.users.MemoryUserDatabaseFactory"
```
```java
```
```java
pathname=
```
```java
"conf/tomcat-users.xml"
```
```java
/>
```
```java
```
```java
<Resource
 name=
```
```java
"mydataSource"
```
```java
auth=
```
```java
"Container"
```
```java
type=
```
```java
"javax.sql.DataSource"
```
```java
```
```java
url=
```
```java
"jdbc:oracle:thin:@192.168.2.104:1521:ora10g"
```
```java
```
```java
driverClassName=
```
```java
"oracle.jdbc.driver.OracleDriver"
```
```java
```
```java
password=
```
```java
"aa"
```
```java
```
```java
username=
```
```java
"aa"
```
```java
```
```java
initialSize=
```
```java
"5"
```
```java
```
```java
maxActive=
```
```java
"10"
```
```java
```
```java
maxIdle=
```
```java
"5"
```
```java
```
```java
minIdle=
```
```java
"2"
```
```java
```
```java
maxWait=
```
```java
"10000"
```
```java
```
```java
removeAbandoned=
```
```java
"true"
```
```java
```
```java
logAbandoned=
```
```java
"true"
```
```java
```
```java
removeAbandonedTimeout=
```
```java
"60"
```
```java
```
```java
timeBetweenEvictionRunsMillis=
```
```java
"900000"
```
```java
```
```java
minEvictableIdleTimeMillis=
```
```java
"1800000"
```
```java
```
```java
numTestsPerEvictionRun=
```
```java
"100"
```
```java
```
```java
validationQuery=
```
```java
"select
 count(0) from dual"
```
```java
```
```java
poolPreparedStatements=
```
```java
"true"
```
```java
```
```java
maxOpenPreparedStatements=
```
```java
"100"
```
```java
/>
```
```java
```
```java
</GlobalNamingResources>
```
4、tomcat/conf下localhost下的配置如下
```java
<?xml
 version=
```
```java
"1.0"
```
```java
encoding=
```
```java
"UTF-8"
```
```java
?>
```
```java
<Context
 docBase=
```
```java
"F:/workspace/cuapp/WebRoot"
```
```java
path=
```
```java
"xj-adminportal"
```
```java
reloadable=
```
```java
"false"
```
```java
>
```
```java
```
```java
<ResourceLink
 name=
```
```java
"mydataSource
 "
```
```java
global=
```
```java
"mydataSource
 "
```
```java
type=
```
```java
"javax.sql.DataSource"
```
```java
/>
```
```java
</Context>
```

