# kafka消息会不会丢失？为什么？看了这个你就清楚了 - z69183787的专栏 - CSDN博客
2018年04月11日 14:08:42[OkidoGreen](https://me.csdn.net/z69183787)阅读数：4816
[http://baijiahao.baidu.com/s?id=1583469327946027281&wfr=spider&for=pc](http://baijiahao.baidu.com/s?id=1583469327946027281&wfr=spider&for=pc)
消息发送方式
想清楚Kafka发送的消息是否丢失，需要先了解Kafka消息的发送方式。
Kafka消息发送分同步(sync)、异步(async)两种方式
默认是使用同步方式，可通过producer.type属性进行配置；
Kafka保证消息被安全生产，有三个选项分别是0,1,-1
通过request.required.acks属性进行配置：
0代表：不进行消息接收是否成功的确认(默认值)；
1代表：当Leader副本接收成功后，返回接收成功确认信息；
-1代表：当Leader和Follower副本都接收成功后，返回接收成功确认信息；
六种发送场景
两个维度相交，生成六种情况，如下图：
![](http://t12.baidu.com/it/u=3432172484,2220993678&fm=173&s=74F08374019F446908E475CB0300E0B8&w=412&h=279&img.JPEG)
![](http://t11.baidu.com/it/u=2399205775,2163966651&fm=173&s=F5F10B7003DF4069084450CE0200E0F2&w=412&h=276&img.JPEG)
消息丢失的场景
网络异常
acks设置为0时，不和Kafka集群进行消息接受确认，当网络发生异常等情况时，存在消息丢失的可能；
客户端异常
异步发送时，消息并没有直接发送至Kafka集群，而是在Client端按一定规则缓存并批量发送。在这期间，如果客户端发生死机等情况，都会导致消息的丢失；
缓冲区满了
异步发送时，Client端缓存的消息超出了缓冲池的大小，也存在消息丢失的可能；
Leader副本异常
acks设置为1时，Leader副本接收成功，Kafka集群就返回成功确认信息，而Follower副本可能还在同步。这时Leader副本突然出现异常，新Leader副本(原Follower副本)未能和其保持一致，就会出现消息丢失的情况；
以上就是消息丢失的几种情况，在日常应用中，我们需要结合自身的应用场景来选择不同的配置。
想要更高的吞吐量就设置：异步、ack=0；想要不丢失消息数据就选：同步、ack=-1策略
附：Kafka备份策略，不理解的可以看我的另一篇文章《Kafka消息的备份策略》
![](http://t11.baidu.com/it/u=2708547835,2625867853&fm=173&s=0A50EC160F2245280640C27D0300B077&w=640&h=251&img.JPEG)
