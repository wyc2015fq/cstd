# Java NIO Reactor模式 - z69183787的专栏 - CSDN博客
2014年04月14日 11:03:53[OkidoGreen](https://me.csdn.net/z69183787)阅读数：3519
Java代码  ![收藏代码](http://woming66.iteye.com/images/icon_star.png)
- package com.zzq.nio.reactor;  
- 
- import java.io.IOException;  
- import java.net.InetSocketAddress;  
- import java.nio.ByteBuffer;  
- import java.nio.channels.SelectionKey;  
- import java.nio.channels.Selector;  
- import java.nio.channels.ServerSocketChannel;  
- import java.nio.channels.SocketChannel;  
- import java.util.Iterator;  
- 
- publicclass Reactor implements Runnable {  
- 
- private ServerSocketChannel serverSocketChannel = null;  
- 
- private Selector            selector            = null;  
- 
- public Reactor() {  
- try {  
-             selector = Selector.open();  
-             serverSocketChannel = ServerSocketChannel.open();  
-             serverSocketChannel.configureBlocking(false);  
-             serverSocketChannel.socket().bind(new InetSocketAddress(8888));  
-             SelectionKey selectionKey = serverSocketChannel.register(selector,  
-                 SelectionKey.OP_ACCEPT);  
-             selectionKey.attach(new Acceptor());  
-             System.out.println("服务器启动正常!");  
-         } catch (IOException e) {  
-             System.out.println("启动服务器时出现异常!");  
-             e.printStackTrace();  
-         }  
-     }  
- 
- publicvoid run() {  
- while (true) {  
- try {  
-                 selector.select();  
- 
-                 Iterator<SelectionKey> iter = selector.selectedKeys().iterator();  
- while (iter.hasNext()) {  
-                     SelectionKey selectionKey = iter.next();  
-                     dispatch((Runnable) selectionKey.attachment());  
-                     iter.remove();  
-                 }  
-             } catch (IOException e) {  
-                 e.printStackTrace();  
-             }  
-         }  
-     }  
- 
- publicvoid dispatch(Runnable runnable) {  
- if (runnable != null) {  
-             runnable.run();  
-         }  
-     }  
- 
- publicstaticvoid main(String[] args) {  
- new Thread(new Reactor()).start();  
-     }  
- 
- class Acceptor implements Runnable {  
- publicvoid run() {  
- try {  
-                 SocketChannel socketChannel = serverSocketChannel.accept();  
- if (socketChannel != null) {  
-                     System.out.println("接收到来自客户端（"
-                                        + socketChannel.socket().getInetAddress().getHostAddress()  
-                                        + "）的连接");  
- new Handler(selector, socketChannel);  
-                 }  
- 
-             } catch (IOException e) {  
-                 e.printStackTrace();  
-             }  
-         }  
-     }  
- }  
- 
- class Handler implements Runnable {  
- 
- privatestaticfinalint READ_STATUS  = 1;  
- 
- privatestaticfinalint WRITE_STATUS = 2;  
- 
- private SocketChannel    socketChannel;  
- 
- private SelectionKey     selectionKey;  
- 
- privateint              status       = READ_STATUS;  
- 
- public Handler(Selector selector, SocketChannel socketChannel) {  
- this.socketChannel = socketChannel;  
- try {  
-             socketChannel.configureBlocking(false);  
-             selectionKey = socketChannel.register(selector, 0);  
-             selectionKey.interestOps(SelectionKey.OP_READ);  
-             selectionKey.attach(this);  
-             selector.wakeup();  
-         } catch (IOException e) {  
-             e.printStackTrace();  
-         }  
-     }  
- 
- publicvoid run() {  
- try {  
- if (status == READ_STATUS) {  
-                 read();  
-                 selectionKey.interestOps(SelectionKey.OP_WRITE);  
-                 status = WRITE_STATUS;  
-             } elseif (status == WRITE_STATUS) {  
-                 process();  
-                 selectionKey.cancel();  
-                 System.out.println("服务器发送消息成功!");  
-             }  
-         } catch (IOException e) {  
-             e.printStackTrace();  
-         }  
-     }  
- 
- publicvoid read() throws IOException {  
-         ByteBuffer buffer = ByteBuffer.allocate(1024);  
-         socketChannel.read(buffer);  
-         System.out.println("接收到来自客户端（" + socketChannel.socket().getInetAddress().getHostAddress()  
-                            + "）的消息：" + new String(buffer.array()));  
-     }  
- 
- publicvoid process() throws IOException {  
-         String content = "Hello World!";  
-         ByteBuffer buffer = ByteBuffer.wrap(content.getBytes());  
-         socketChannel.write(buffer);  
-     }  
- }  
