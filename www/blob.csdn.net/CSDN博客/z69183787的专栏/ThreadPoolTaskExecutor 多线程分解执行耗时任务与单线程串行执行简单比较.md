# ThreadPoolTaskExecutor 多线程分解执行耗时任务与单线程串行执行简单比较 - z69183787的专栏 - CSDN博客
2016年05月11日 12:03:55[OkidoGreen](https://me.csdn.net/z69183787)阅读数：6153
```
```java
import
```
```java
java.util.ArrayList;
```
```java
import
```
```java
java.util.List;
```
```java
import
```
```java
java.util.concurrent.Callable;
```
```java
import
```
```java
java.util.concurrent.ExecutionException;
```
```java
import
```
```java
java.util.concurrent.Future;
```
```java
import
```
```java
java.util.concurrent.ThreadPoolExecutor;
```
```java
import
```
```java
java.util.concurrent.TimeUnit;
```
```java
import
```
```java
org.apache.commons.lang.StringUtils;
```
```java
import
```
```java
org.apache.commons.lang.exception.ExceptionUtils;
```
```java
import
```
```java
org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
```
```java
/**
```
```java
```
```java
* <pre>
```
```java
```
```java
*
```
```java
```
```java
* @author tangxiaodong
```
```java
```
```java
* 创建日期: 2014年11月18日
```
```java
```
```java
* </pre>
```
```java
```
```java
*/
```
```java
public
```
```java
class
```
```java
TaskTest {
```
```java
```
```java
/**
```
```java
```
```java
* @param args
```
```java
```
```java
* @throws ExecutionException
```
```java
```
```java
* @throws InterruptedException
```
```java
```
```java
*/
```
```java
```
```java
public
```
```java
static
```
```java
void
```
```java
main(String[] args)
```
```java
throws
```
```java
InterruptedException, ExecutionException {
```
```java
```
```java
System.out.println(
```
```java
"testNoThreadTask begin ..."
```
```java
);
```
```java
```
```java
testNoThreadTask();
```
```java
```
```java
```
```java
FdfcUtil.sleep(
```
```java
1
```
```java
);
```
```java
```
```java
```
```java
System.out.println(
```
```java
"testThreadTask begin ..."
```
```java
);
```
```java
```
```java
testThreadTask();
```
```java
```
```java
}
```
```java
```
```java
```
```java
private
```
```java
static
```
```java
void
```
```java
testNoThreadTask() {
```
```java
```
```java
long
```
```java
t1 = System.currentTimeMillis();
```
```java
```
```java
for
```
```java
(
```
```java
int
```
```java
k =
```
```java
0
```
```java
; k <
```
```java
10
```
```java
; k++) {
```
```java
```
```java
// 这是一个耗时的工作
```
```java
```
```java
FdfcUtil.sleep((k +
```
```java
1
```
```java
) *
```
```java
500
```
```java
);
```
```java
```
```java
System.out.println(
```
```java
" k="
```
```java
+ k);
```
```java
```
```java
System.out.println(
```
```java
"k="
```
```java
+ k +
```
```java
" success"
```
```java
);
```
```java
```
```java
}
```
```java
```
```java
System.out.println(
```
```java
" times :"
```
```java
);
```
```java
```
```java
System.out.println(System.currentTimeMillis() - t1);
```
```java
```
```java
}
```
```java
```
```java
```
```java
```
```java
private
```
```java
static
```
```java
void
```
```java
testThreadTask(){
```
```java
```
```java
```
```java
// TODO Auto-generated method stub
```
```java
```
```java
ThreadPoolTaskExecutor executor =
```
```java
new
```
```java
ThreadPoolTaskExecutor();
```
```java
```
```java
executor.setCorePoolSize(
```
```java
2
```
```java
);
```
```java
```
```java
executor.setMaxPoolSize(
```
```java
4
```
```java
);
```
```java
```
```java
executor.setKeepAliveSeconds(
```
```java
120
```
```java
);
```
```java
```
```java
executor.setQueueCapacity(
```
```java
32
```
```java
);
```
```java
```
```java
executor.setRejectedExecutionHandler(
```
```java
new
```
```java
ThreadPoolExecutor.CallerRunsPolicy());
```
```java
```
```java
executor.initialize();
```
```java
```
```java
```
```java
List<Future<String>> taskResults =
```
```java
new
```
```java
ArrayList<Future<String>>();
```
```java
```
```java
long
```
```java
t1 = System.currentTimeMillis();
```
```java
```
```java
for
```
```java
(
```
```java
int
```
```java
k=
```
```java
0
```
```java
; k<
```
```java
10
```
```java
; k++){
```
```java
```
```java
taskResults.add(process(executor, k));
```
```java
```
```java
}
```
```java
```
```java
System.out.println(
```
```java
"task doing ..."
```
```java
);
```
```java
```
```java
while
```
```java
(
```
```java
true
```
```java
) {
```
```java
```
```java
boolean
```
```java
isAllDone =
```
```java
true
```
```java
;
```
```java
```
```java
for
```
```java
(Future<String> taskResult : taskResults) {
```
```java
```
```java
isAllDone &= ( taskResult.isDone() || taskResult.isCancelled() );
```
```java
```
```java
}
```
```java
```
```java
if
```
```java
(isAllDone) {
```
```java
```
```java
// 任务都执行完毕，跳出循环
```
```java
```
```java
break
```
```java
;
```
```java
```
```java
}
```
```java
```
```java
try
```
```java
{
```
```java
```
```java
System.out.println(
```
```java
"waiting and sleep 1000 ..."
```
```java
);
```
```java
```
```java
TimeUnit.MILLISECONDS.sleep(
```
```java
1000
```
```java
);
```
```java
```
```java
}
```
```java
catch
```
```java
(Exception e) {
```
```java
```
```java
System.out.println(e.toString());
```
```java
```
```java
break
```
```java
;
```
```java
```
```java
}
```
```java
```
```java
}
```
```java
```
```java
```
```java
for
```
```java
(Future<String> taskResult : taskResults){
```
```java
```
```java
String ex;
```
```java
```
```java
try
```
```java
{
```
```java
```
```java
ex = taskResult.get();
```
```java
```
```java
}
```
```java
catch
```
```java
(Exception e) {
```
```java
```
```java
ex = ExceptionUtils.getFullStackTrace(e);
```
```java
```
```java
}
```
```java
```
```java
if
```
```java
(StringUtils.isNotEmpty(ex)){
```
```java
```
```java
System.out.println(ex);
```
```java
```
```java
}
```
```java
```
```java
}
```
```java
```
```java
System.out.println(
```
```java
" times :"
```
```java
);
```
```java
```
```java
System.out.println(System.currentTimeMillis()-t1);
```
```java
```
```java
}
```
```java
```
```java
private
```
```java
static
```
```java
Future<String> process(
```
```java
final
```
```java
ThreadPoolTaskExecutor executor ,
```
```java
final
```
```java
int
```
```java
k) {
```
```java
```
```java
return
```
```java
executor.submit(
```
```java
new
```
```java
Callable<String>() {
```
```java
```
```java
@Override
```
```java
```
```java
public
```
```java
String call()
```
```java
throws
```
```java
Exception {
```
```java
```
```java
try
```
```java
{
```
```java
```
```java
FdfcUtil.sleep((k+
```
```java
1
```
```java
)*
```
```java
500
```
```java
);
```
```java
```
```java
System.out.println(
```
```java
" k="
```
```java
+ k);
```
```java
```
```java
}
```
```java
catch
```
```java
(Exception e) {
```
```java
```
```java
return
```
```java
ExceptionUtils.getFullStackTrace(e);
```
```java
```
```java
}
```
```java
```
```java
return
```
```java
"k="
```
```java
+ k +
```
```java
" success"
```
```java
;
```
```java
```
```java
}
```
```java
```
```java
});
```
```java
```
```java
}
```
```java
}
```
```
testNoThreadTask  耗时：
times : 27996 ms
testThreadTask 耗时：
times : 15239 ms
原文链接:[http://my.oschina.net/hotkit/blog/345839](http://my.oschina.net/hotkit/blog/345839)
