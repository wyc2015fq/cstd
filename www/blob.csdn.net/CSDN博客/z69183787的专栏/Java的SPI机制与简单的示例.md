# Java的SPI机制与简单的示例 - z69183787的专栏 - CSDN博客
2016年11月01日 18:05:44[OkidoGreen](https://me.csdn.net/z69183787)阅读数：1807
一、SPI机制
这里先说下SPI的一个概念，SPI英文为Service Provider Interface单从字面可以理解为Service提供者接口，正如从SPI的名字去理解SPI就是Service提供者接口；我对SPI的定义：提供给服务提供厂商与扩展框架功能的开发者使用的接口。
在我们日常开发的时候都是对问题进行抽象成Api然后就提供各种Api的实现，这些Api的实现都是封装与我们的Jar中或框架中的虽然当我们想要提供一种Api新实现时可以不修改原来代码只需实现该Api就可以提供Api的新实现，但我们还是生成新Jar或框架（虽然可以通过在代码里扫描某个目录已加载Api的新实现，但这不是Java的机制，只是hack方法），而通过Java SPI机制我们就可以在不修改Jar包或框架的时候为Api提供新实现。
     很多框架都使用了java的SPI机制，如java.sql.Driver的SPI实现（mysql驱动、oracle驱动等）、common-logging的日志接口实现、dubbo的扩展实现等等框架；
SPI机制的约定：
1)         在META-INF/services/目录中创建以接口全限定名命名的文件该文件内容为Api具体实现类的全限定名
2)         使用ServiceLoader类动态加载META-INF中的实现类
3)         如SPI的实现类为Jar则需要放在主程序classPath中
4)         Api具体实现类必须有一个不带参数的构造方法
![](http://images.cnitblog.com/blog2015/84976/201503/081719062588772.jpg)
SPI机制结构图
二、SPI机制示例
![](http://images.cnitblog.com/blog2015/84976/201503/081720341494423.png)
                        实例结构图
IOperation接口：
```
```java
/**
```
```java
```
```java
*
 Created by LX on 2015/3/8.
```
```java
```
```java
*/
```
```java
public
```
```java
interface
```
```java
IOperation
 {
```
```java
```
```java
public
```
```java
int
```
```java
operation(
```
```java
int
```
```java
numberA,
```
```java
int
```
```java
numberB);
```
```java
}
```
```
PlusOperationImpl实现：
```
```java
import
```
```java
co.solinx.demo.api.IOperation;
```
```java
/**
```
```java
```
```java
*
 Created by LX on 2015/3/8.
```
```java
```
```java
*/
```
```java
public
```
```java
class
```
```java
PlusOperationImpl
```
```java
implements
```
```java
IOperation
 {
```
```java
```
```java
@Override
```
```java
```
```java
public
```
```java
int
```
```java
operation(
```
```java
int
```
```java
numberA,
```
```java
int
```
```java
numberB)
 {
```
```java
```
```java
return
```
```java
numberA
 + numberB;
```
```java
```
```java
}
```
```java
}
```
```
SPI接口的实现类：DivisionOperationImpl
```
```java
import
```
```java
co.solinx.demo.api.IOperation;
```
```java
/**
```
```java
```
```java
*
 Created by LX on 2015/3/8.
```
```java
```
```java
*/
```
```java
public
```
```java
class
```
```java
DivisionOperationImpl
```
```java
implements
```
```java
IOperation
 {
```
```java
```
```java
@Override
```
```java
```
```java
public
```
```java
int
```
```java
operation(
```
```java
int
```
```java
numberA,
```
```java
int
```
```java
numberB)
 {
```
```java
```
```java
return
```
```java
numberA
 / numberB;
```
```java
```
```java
}
```
```java
}
```
```
META-INF/Services目录中的文件：
文件名：co.solinx.demo.api.IOperation，内容：co.solinx.demo.spi.DivisionOperationImpl
![](http://images.cnitblog.com/blog2015/84976/201503/081724207116906.png)
Main类：
```
```java
import
```
```java
co.solinx.demo.api.IOperation;
```
```java
import
```
```java
co.solinx.demo.impl.PlusOperationImpl;
```
```java
import
```
```java
co.solinx.demo.spi.DivisionOperationImpl;
```
```java
import
```
```java
java.util.Iterator;
```
```java
import
```
```java
java.util.ServiceLoader;
```
```java
/**
```
```java
```
```java
*
 Created by LX on 2015/3/8.
```
```java
```
```java
*/
```
```java
public
```
```java
class
```
```java
main
 {
```
```java
```
```java
public
```
```java
static
```
```java
void
```
```java
main(String[]
 args) {
```
```java
```
```java
IOperation
 plus =
```
```java
new
```
```java
PlusOperationImpl();
```
```java
```
```java
IOperation
 division =
```
```java
new
```
```java
DivisionOperationImpl();
```
```java
```
```java
System.out.println(plus.operation(
```
```java
5
```
```java
,
```
```java
3
```
```java
));
```
```java
```
```java
System.out.println(division.operation(
```
```java
9
```
```java
,
```
```java
3
```
```java
));
```
```java
```
```java
ServiceLoader<IOperation>
 operations = ServiceLoader.load(IOperation.
```
```java
class
```
```java
);
```
```java
```
```java
Iterator<IOperation>
 operationIterator = operations.iterator();
```
```java
```
```java
System.out.println(
```
```java
"classPath:"
```
```java
+System.getProperty(
```
```java
"java.class.path"
```
```java
));
```
```java
```
```java
while
```
```java
(operationIterator.hasNext())
 {
```
```java
```
```java
IOperation
 operation = operationIterator.next();
```
```java
```
```java
System.out.println(operation.operation(
```
```java
6
```
```java
,
```
```java
3
```
```java
));
```
```java
```
```java
}
```
```java
```
```java
}
```
```java
}
```
```
运行结果：
![](http://images.cnitblog.com/blog2015/84976/201503/081724487274498.png)
如把SPI实现打包为jar需要把jar放在classpath目录中，SPI jar包运行结果：
![](http://images.cnitblog.com/blog2015/84976/201503/081725137586046.png)
文章首发地址：[Solinx](http://www.solinx.co/archives/142)[](http://www.solinx.co/)
http://www.solinx.co/archives/142
