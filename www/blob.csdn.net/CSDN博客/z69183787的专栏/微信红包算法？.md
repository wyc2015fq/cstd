# 微信红包算法？ - z69183787的专栏 - CSDN博客
2016年08月31日 21:54:43[OkidoGreen](https://me.csdn.net/z69183787)阅读数：2881
作者：匿名用户
链接：https://www.zhihu.com/question/22625187/answer/40041558
来源：知乎
著作权归作者所有，转载请联系作者获得授权。
微信是采用什么样的算法做到的？简单百度了下，目前尚未有官方的说明，仅仅在知乎里有一个较为热门的讨论，链接戳这里 不过他们讨论的太过于深入，有掉坑之嫌。
我按照自己的逻辑尝试了下，这个算法需要满足以下几点要求
1、每个人都要能够领取到红包；2、每个人领取到的红包金额总和=总金额；3、每个人领取到的红包金额不等，但也不能差的太离谱，不然就没趣味；4、算法一定要简单，不然对不起腾讯这个招牌；
正式编码之前，先搭建一个递进的模型来分析规律
> 
```
设定总金额为10元，有N个人随机领取：
N=1 
则红包金额=X元； 
N=2 
为保证第二个红包可以正常发出，第一个红包金额=0.01至9.99之间的某个随机数 
第二个红包=10-第一个红包金额； 
N=3 
红包1=0.01至0.98之间的某个随机数 
红包2=0.01至(10-红包1-0.01)的某个随机数 
红包3=10-红包1-红包2 
……
```
至此，规律出现啦！开始编码！
> 
```
header("Content-Type: text/html;charset=utf-8");//输出不乱码，你懂的
$total=10;//红包总额
$num=8;// 分成8个红包，支持8人随机领取
$min=0.01;//每个人最少能收到0.01元
for ($i=1;$i<$num;$i++)
{
    $safe_total=$total-($num-$i)*$min;//随机安全上限
    $money=mt_rand($min*100,$safe_total*100)/100;
    $total=$total-$money;
    echo '第'.$i.'个红包：'.$money.' 元，余额：'.$total.' 元 <br/>';
}
echo '第'.$num.'个红包：'.$total.' 元，余额：0 元';
```
输入一看，波动太大，这数据太无趣了！
> 
```
第1个红包：7.48 元，余额：2.52 元 
第2个红包：1.9 元，余额：0.62 元 
第3个红包：0.49 元，余额：0.13 元 
第4个红包：0.04 元，余额：0.09 元 
第5个红包：0.03 元，余额：0.06 元 
第6个红包：0.03 元，余额：0.03 元 
第7个红包：0.01 元，余额：0.02 元 
第8个红包：0.02 元，余额：0 元
```
改良一下，将平均值作为随机安全上限来控制波动差
> 
```
header("Content-Type: text/html;charset=utf-8");//输出不乱码，你懂的
$total=10;//红包总额
$num=8;// 分成8个红包，支持8人随机领取
$min=0.01;//每个人最少能收到0.01元
for ($i=1;$i<$num;$i++)
{
    $safe_total=($total-($num-$i)*$min)/($num-$i);//随机安全上限
    $money=mt_rand($min*100,$safe_total*100)/100;
    $total=$total-$money;
    echo '第'.$i.'个红包：'.$money.' 元，余额：'.$total.' 元 <br/>';
}
echo '第'.$num.'个红包：'.$total.' 元，余额：0 元';
```
输出结果见下图
> 
```
第1个红包：0.06 元，余额：9.94 元 
第2个红包：1.55 元，余额：8.39 元 
第3个红包：0.25 元，余额：8.14 元 
第4个红包：0.98 元，余额：7.16 元 
第5个红包：1.88 元，余额：5.28 元 
第6个红包：1.92 元，余额：3.36 元 
第7个红包：2.98 元，余额：0.38 元 
第8个红包：0.38 元，余额：0 元
```
如果你有更好更简单的算法，欢迎与我讨论。
作者：Small
链接：[微信红包的算法实现探讨]()
﹣﹣﹣﹣﹣ java version ﹣﹣﹣﹣﹣
> 
```
/**
 * 微信红包分配算法
 * 
 * @author Michael282694
 * */
public class wechat_money {
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		double total_money; // 红包总金额
		int total_people; // 抢红包总人数
		double min_money; // 每个人最少能收到0.01元
		total_money = 10.0;
		total_people = 8;
		min_money = 0.01;
		for (int i = 0; i < total_people - 1; i++) {
			int j = i + 1;
			double safe_money = (total_money - (total_people - j) * min_money)
					/ (total_people - j);
			double tmp_money = (Math.random()
					* (safe_money * 100 - min_money * 100) + min_money * 100) / 100;
			total_money = total_money - tmp_money;
			System.out.format("第 %d 个红包： %.2f 元，剩下： %.2f 元\n", j, tmp_money,
					total_money);
		}
		System.out.format("第 %d 个红包： %.2f 元，剩下： 0 元\n", total_people,
				total_money);
	}
}
```
某一次的結果：
> 
```
第 1 个红包： 0.54 元，剩下： 9.46 元
第 2 个红包： 1.04 元，剩下： 8.42 元
第 3 个红包： 0.60 元，剩下： 7.83 元
第 4 个红包： 0.17 元，剩下： 7.66 元
第 5 个红包： 1.54 元，剩下： 6.11 元
第 6 个红包： 0.58 元，剩下： 5.53 元
第 7 个红包： 3.60 元，剩下： 1.93 元
第 8 个红包： 1.93 元，剩下： 0 元
```
**因为保留两位小数时存在四舍五入，有时候所有金额相加会存在0.01元的误差（实际并不存在）。**
