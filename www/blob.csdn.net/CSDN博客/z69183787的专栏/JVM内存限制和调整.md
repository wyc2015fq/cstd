# JVM内存限制和调整 - z69183787的专栏 - CSDN博客
2014年03月22日 20:19:50[OkidoGreen](https://me.csdn.net/z69183787)阅读数：4354
**今天用java -jar执行一个jar文件提示内存不够，需要设置虚拟机的堆大小。以下是参考资料：**
**堆(Heap)和非堆(Non-heap)内存　　按照官方的说法：“Java 虚拟机具有一个堆，堆是运行时数据区域，所有类实例和数组的内存均从此处分配。堆是在 Java 虚拟机启动时创建的。”“在JVM中堆之外的内存称为非堆内存(Non-heap memory)”。可以看出JVM主要管理两种类型的内存：堆和非堆。简单来说堆就是Java代码可及的内存，是留给开发人员使用的；非堆就是JVM留给 自己用的，所以方法区、JVM内部处理或优化所需的内存(如JIT编译后的代码缓存)、每个类结构(如运行时常数池、字段和方法数据)以及方法和构造方法 的代码都在非堆内存中。 堆内存分配　　JVM初始分配的内存由-Xms指定，默认是物理内存的1/64；JVM最大分配的内存由-Xmx 指定，默认是物理内存的1/4。默认空余堆内存小于40%时，JVM就会增大堆直到-Xmx的最大限制；空余堆内存大于70%时，JVM会减少堆直到- Xms的最小限制。因此服务器一般设置-Xms、-Xmx相等以避免在每次GC 后调整堆的大小。 非堆内存分配　　JVM使用-XX:PermSize设置非堆内存初始值，默认是物理内存的1/64；由XX:MaxPermSize设置最大非堆内存的大小，默认是物理内存的1/4。 JVM内存限制(最大值)　　首 先JVM内存限制于实际的最大物理内存(废话！呵呵)，假设物理内存无限大的话，JVM内存的最大值跟操作系统有很大的关系。简单的说就32位处理器虽然 可控内存空间有4GB,但是具体的操作系统会给一个限制，这个限制一般是2GB-3GB（一般来说Windows系统下为1.5G-2G，Linux系统 下为2G-3G），而64bit以上的处理器就不会有限制了。 　　通常，我们为了避免内存溢出等问题，需要设置环境变量 　　JAVA_OPTS    -Xms256M -Xmx512M 等，【对于服务器，一般都设置成一样的】 　　但是有的时候可能这样的设置还会不行(比如，当Server应用程序加载较多类时，即jvm加载类时，永久域中的对象急剧增加，从而使jvm不断调整永久域大小，为了避免调整)，你可以使用更多的参数配置， 　　如： java -Xms512m -Xmx512m -XX:PermSize=64m -XX:MaxPermSize=128m **
**　　其中，使用   -XX:MaxPerSize标志来增加永久域的大小，-XX:PerSize标志设置初始值 **
**参考：**
[**http://wallimn.javaeye.com/blog/505610**](http://wallimn.javaeye.com/blog/505610)
