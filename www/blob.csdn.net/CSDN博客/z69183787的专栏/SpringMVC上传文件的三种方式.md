# SpringMVC上传文件的三种方式 - z69183787的专栏 - CSDN博客
2016年08月15日 12:53:56[OkidoGreen](https://me.csdn.net/z69183787)阅读数：4783
直接上代码吧，大伙一看便知
这时：commonsmultipartresolver 的源码，可以研究一下 [http://www.verysource.com/code/2337329_1/commonsmultipartresolver.java.html](http://www.verysource.com/code/2337329_1/commonsmultipartresolver.java.html)
前台：
```
```java
<%@
 page language=
```
```java
"java"
```
```java
contentType=
```
```java
"text/html;
 charset=utf-8"
```
```java
```
```java
pageEncoding=
```
```java
"utf-8"
```
```java
%>
```
```java
<!DOCTYPE
 html PUBLIC
```
```java
"-//W3C//DTD
 HTML 4.01 Transitional//EN"
```
```java
"http://www.w3.org/TR/html4/loose.dtd"
```
```java
>
```
```java
<html>
```
```java
<head>
```
```java
<meta
 http-equiv=
```
```java
"Content-Type"
```
```java
content=
```
```java
"text/html;
 charset=utf-8"
```
```java
>
```
```java
<title>Insert
 title here</title>
```
```java
</head>
```
```java
<body>
```
```java
<form
 name=
```
```java
"serForm"
```
```java
action=
```
```java
"/SpringMVC006/fileUpload"
```
```java
method=
```
```java
"post"
```
```java
enctype=
```
```java
"multipart/form-data"
```
```java
>
```
```java
<h1>采用流的方式上传文件</h1>
```
```java
<input
 type=
```
```java
"file"
```
```java
name=
```
```java
"file"
```
```java
>
```
```java
<input
 type=
```
```java
"submit"
```
```java
value=
```
```java
"upload"
```
```java
/>
```
```java
</form>
```
```java
<form
 name=
```
```java
"Form2"
```
```java
action=
```
```java
"/SpringMVC006/fileUpload2"
```
```java
method=
```
```java
"post"
```
```java
enctype=
```
```java
"multipart/form-data"
```
```java
>
```
```java
<h1>采用multipart提供的file.transfer方法上传文件</h1>
```
```java
<input
 type=
```
```java
"file"
```
```java
name=
```
```java
"file"
```
```java
>
```
```java
<input
 type=
```
```java
"submit"
```
```java
value=
```
```java
"upload"
```
```java
/>
```
```java
</form>
```
```java
<form
 name=
```
```java
"Form2"
```
```java
action=
```
```java
"/SpringMVC006/springUpload"
```
```java
method=
```
```java
"post"
```
```java
enctype=
```
```java
"multipart/form-data"
```
```java
>
```
```java
<h1>使用spring
 mvc提供的类的方法上传文件</h1>
```
```java
<input
 type=
```
```java
"file"
```
```java
name=
```
```java
"file"
```
```java
>
```
```java
<input
 type=
```
```java
"submit"
```
```java
value=
```
```java
"upload"
```
```java
/>
```
```java
</form>
```
```java
</body>
```
```java
</html>
```
```
配置：
```
```java
<!--
 多部分文件上传 -->
```
```java
<bean
 id=
```
```java
"multipartResolver"
```
```java
class
```
```java
=
```
```java
"org.springframework.web.multipart.commons.CommonsMultipartResolver"
```
```java
>
```
```java
```
```java
<property
 name=
```
```java
"maxUploadSize"
```
```java
value=
```
```java
"104857600"
```
```java
/>
```
```java
```
```java
<property
 name=
```
```java
"maxInMemorySize"
```
```java
value=
```
```java
"4096"
```
```java
/>
```
```java
```
```java
<property
 name=
```
```java
"defaultEncoding"
```
```java
value=
```
```java
"UTF-8"
```
```java
></property>
```
```java
</bean>
```
```
后台：
方式一：
```
```java
/*
```
```java
```
```java
*
 通过流的方式上传文件
```
```java
```
```java
*
 @RequestParam("file") 将name=file控件得到的文件封装成CommonsMultipartFile 对象
```
```java
```
```java
*/
```
```java
```
```java
@RequestMapping
```
```java
(
```
```java
"fileUpload"
```
```java
)
```
```java
```
```java
public
```
```java
String 
 fileUpload(
```
```java
@RequestParam
```
```java
(
```
```java
"file"
```
```java
)
 CommonsMultipartFile file)
```
```java
throws
```
```java
IOException
 {
```
```java
```
```java
```
```java
```
```java
//用来检测程序运行时间
```
```java
```
```java
long
```
```java
startTime=System.currentTimeMillis();
```
```java
```
```java
System.out.println(
```
```java
"fileName："
```
```java
+file.getOriginalFilename());
```
```java
```
```java
```
```java
try
```
```java
{
```
```java
```
```java
//获取输出流
```
```java
```
```java
OutputStream
 os=
```
```java
new
```
```java
FileOutputStream(
```
```java
"E:/"
```
```java
+
```
```java
new
```
```java
Date().getTime()+file.getOriginalFilename());
```
```java
```
```java
//获取输入流
 CommonsMultipartFile 中可以直接得到文件的流
```
```java
```
```java
InputStream
 is=file.getInputStream();
```
```java
```
```java
int
```
```java
temp;
```
```java
```
```java
//一个一个字节的读取并写入
```
```java
```
```java
while
```
```java
((temp=is.read())!=(-
```
```java
1
```
```java
))
```
```java
```
```java
{
```
```java
```
```java
os.write(temp);
```
```java
```
```java
}
```
```java
```
```java
os.flush();
```
```java
```
```java
os.close();
```
```java
```
```java
is.close();
```
```java
```
```java
```
```java
}
```
```java
catch
```
```java
(FileNotFoundException
 e) {
```
```java
```
```java
//
 TODO Auto-generated catch block
```
```java
```
```java
e.printStackTrace();
```
```java
```
```java
}
```
```java
```
```java
long
```
```java
endTime=System.currentTimeMillis();
```
```java
```
```java
System.out.println(
```
```java
"方法一的运行时间："
```
```java
+String.valueOf(endTime-startTime)+
```
```java
"ms"
```
```java
);
```
```java
```
```java
return
```
```java
"/success"
```
```java
;
```
```java
```
```java
}
```
```
 方式二：
```
```java
/*
```
```java
```
```java
*
 采用file.Transto 来保存上传的文件
```
```java
```
```java
*/
```
```java
```
```java
@RequestMapping
```
```java
(
```
```java
"fileUpload2"
```
```java
)
```
```java
```
```java
public
```
```java
String 
 fileUpload2(
```
```java
@RequestParam
```
```java
(
```
```java
"file"
```
```java
)
 CommonsMultipartFile file)
```
```java
throws
```
```java
IOException
 {
```
```java
```
```java
long
```
```java
startTime=System.currentTimeMillis();
```
```java
```
```java
System.out.println(
```
```java
"fileName："
```
```java
+file.getOriginalFilename());
```
```java
```
```java
String
 path=
```
```java
"E:/"
```
```java
+
```
```java
new
```
```java
Date().getTime()+file.getOriginalFilename();
```
```java
```
```java
```
```java
File
 newFile=
```
```java
new
```
```java
File(path);
```
```java
```
```java
//通过CommonsMultipartFile的方法直接写文件（注意这个时候）
```
```java
```
```java
file.transferTo(newFile);
```
```java
```
```java
long
```
```java
endTime=System.currentTimeMillis();
```
```java
```
```java
System.out.println(
```
```java
"方法二的运行时间："
```
```java
+String.valueOf(endTime-startTime)+
```
```java
"ms"
```
```java
);
```
```java
```
```java
return
```
```java
"/success"
```
```java
;
```
```java
```
```java
}
```
```
 方式三：
```
```java
/*
```
```java
```
```java
*采用spring提供的上传文件的方法
```
```java
```
```java
*/
```
```java
```
```java
@RequestMapping
```
```java
(
```
```java
"springUpload"
```
```java
)
```
```java
```
```java
public
```
```java
String 
 springUpload(HttpServletRequest request)
```
```java
throws
```
```java
IllegalStateException,
 IOException
```
```java
```
```java
{
```
```java
```
```java
long
```
```java
startTime=System.currentTimeMillis();
```
```java
```
```java
//将当前上下文初始化给 
 CommonsMutipartResolver （多部分解析器）
```
```java
```
```java
CommonsMultipartResolver
 multipartResolver=
```
```java
new
```
```java
CommonsMultipartResolver(
```
```java
```
```java
request.getSession().getServletContext());
```
```java
```
```java
//检查form中是否有enctype="multipart/form-data"
```
```java
```
```java
if
```
```java
(multipartResolver.isMultipart(request))
```
```java
```
```java
{
```
```java
```
```java
//将request变成多部分request
```
```java
```
```java
MultipartHttpServletRequest
 multiRequest=(MultipartHttpServletRequest)request;
```
```java
```
```java
//获取multiRequest
 中所有的文件名
```
```java
```
```java
Iterator
 iter=multiRequest.getFileNames();
```
```java
```
```java
```
```java
while
```
```java
(iter.hasNext())
```
```java
```
```java
{
```
```java
```
```java
//一次遍历所有文件
```
```java
```
```java
MultipartFile
 file=multiRequest.getFile(iter.next().toString());
```
```java
```
```java
if
```
```java
(file!=
```
```java
null
```
```java
)
```
```java
```
```java
{
```
```java
```
```java
String
 path=
```
```java
"E:/springUpload"
```
```java
+file.getOriginalFilename();
```
```java
```
```java
//上传
```
```java
```
```java
file.transferTo(
```
```java
new
```
```java
File(path));
```
```java
```
```java
}
```
```java
```
```java
```
```java
}
```
```java
```
```java
```
```java
}
```
```java
```
```java
long
```
```java
endTime=System.currentTimeMillis();
```
```java
```
```java
System.out.println(
```
```java
"方法三的运行时间："
```
```java
+String.valueOf(endTime-startTime)+
```
```java
"ms"
```
```java
);
```
```java
```
```java
return
```
```java
"/success"
```
```java
;
```
```java
```
```java
}
```
```
我们看看测试上传的时间：
第一次我用一个4M的文件：
fileName：test.rar
方法一的运行时间：14712ms
fileName：test.rar
方法二的运行时间：5ms
方法三的运行时间：4ms
第二次：我用一个50M的文件
方式一进度很慢，估计得要个5分钟
方法二的运行时间：67ms
方法三的运行时间：80ms
从测试结果我们可以看到：用springMVC自带的上传文件的方法要快的多！
对于测试二的结果：可能是方法三得挨个搜索，所以要慢点。不过一般情况下我们是方法三，因为他能提供给我们更多的方法
