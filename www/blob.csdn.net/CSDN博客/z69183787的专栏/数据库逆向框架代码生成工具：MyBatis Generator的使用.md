# 数据库逆向框架代码生成工具：MyBatis Generator的使用 - z69183787的专栏 - CSDN博客
2015年06月19日 11:55:30[OkidoGreen](https://me.csdn.net/z69183787)阅读数：1915
摘要通过MyBatis
 Generator可逆向生成持久层的代码，与Spring实现无缝融合，本文是基于Intellij+Maven实现。
[Mybatis](http://www.oschina.net/search?scope=blog&q=Mybatis)[Generator](http://www.oschina.net/search?scope=blog&q=Generator)[Intellij](http://www.oschina.net/search?scope=blog&q=Intellij)[IDEA](http://www.oschina.net/search?scope=blog&q=IDEA)
目录[-]
- [1前言](http://my.oschina.net/lujianing/blog/200135#OSC_h2_1)
- [2搭建逆向工程](http://my.oschina.net/lujianing/blog/200135#OSC_h2_2)
- [3生成代码的使用](http://my.oschina.net/lujianing/blog/200135#OSC_h2_3)
- [4一些问题的解决方案](http://my.oschina.net/lujianing/blog/200135#OSC_h2_4)
MyBatis Generator的详细介绍[](http://mybatis.org/generator/)[http://mybatis.github.io/generator/index.html](http://mybatis.github.io/generator/index.html)
MyBatis Generator  With Maven [](http://mybatis.org/generator/running/runningWithMaven.html)[http://mybatis.github.io/generator/running/runningWithMaven.html](http://mybatis.github.io/generator/running/runningWithMaven.html)
## 1前言
前段时间根据工作需要，使用Spring+Mybatis完成了一个功能模块，领导推荐了MyBatis Generator(以下简称为MBG)，可以逆向生成持久层的基本代码，而且mybatis的实现方案比较好，可以自由组合完成比较复杂的查询，当然更复杂的就需要手动写了，下面整理下基本使用
## 2搭建逆向工程
1.创建一个Maven项目：File——New Project——Maven
2.在pom文件中，添加MBG插件，IDE会自动帮我们下载插件
（如果没反应，可以点开右侧Maven Project选项卡刷新以下）
（插件1.3.0有点小bug，不能去掉生成的注释）
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```xml
<
```
```xml
build
```
```xml
>
```
```xml
```
```xml
<
```
```xml
finalName
```
```xml
>mybatis_generator</
```
```xml
finalName
```
```xml
>
```
```xml
```
```xml
<
```
```xml
plugins
```
```xml
>
```
```xml
```
```xml
<
```
```xml
plugin
```
```xml
>
```
```xml
```
```xml
<
```
```xml
groupId
```
```xml
>org.mybatis.generator</
```
```xml
groupId
```
```xml
>
```
```xml
```
```xml
<
```
```xml
artifactId
```
```xml
>mybatis-generator-maven-plugin</
```
```xml
artifactId
```
```xml
>
```
```xml
```
```xml
<
```
```xml
version
```
```xml
>1.3.2</
```
```xml
version
```
```xml
>
```
```xml
```
```xml
</
```
```xml
plugin
```
```xml
>
```
```xml
```
```xml
</
```
```xml
plugins
```
```xml
>
```
```xml
</
```
```xml
build
```
```xml
>
```
```
![](http://static.oschina.net/uploads/space/2014/0216/125202_2TvY_140593.jpg)
3.在src/main/resource目录下创建generatorConfig.xml文件
（官方配置以及说明：[http://mybatis.github.io/generator/configreference/xmlconfig.html](http://mybatis.github.io/generator/configreference/xmlconfig.html)）
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```xml
<?
```
```xml
xml
```
```xml
version
```
```xml
=
```
```xml
"1.0"
```
```xml
encoding
```
```xml
=
```
```xml
"UTF-8"
```
```xml
?>
```
```xml
<!
```
```xml
DOCTYPE
```
```xml
generatorConfiguration
```
```xml
```
```xml
PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
```
```xml
```
```xml
"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
```
```xml
<
```
```xml
generatorConfiguration
```
```xml
>
```
```xml
```
```xml
<!--数据库驱动jar -->
```
```xml
```
```xml
<
```
```xml
classPathEntry
```
```xml
location
```
```xml
=
```
```xml
"E:\mysql-connector-java-5.1.7-bin.jar"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
context
```
```xml
id
```
```xml
=
```
```xml
"DB2Tables"
```
```xml
targetRuntime
```
```xml
=
```
```xml
"Ibatis2Java5"
```
```xml
>
```
```xml
```
```xml
<!--去除注释  -->
```
```xml
```
```xml
<
```
```xml
commentGenerator
```
```xml
>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"suppressAllComments"
```
```xml
value
```
```xml
=
```
```xml
"true"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
commentGenerator
```
```xml
>
```
```xml
```
```xml
<!--数据库连接 -->
```
```xml
```
```xml
<
```
```xml
jdbcConnection
```
```xml
driverClass
```
```xml
=
```
```xml
"com.mysql.jdbc.Driver"
```
```xml
```
```xml
connectionURL
```
```xml
=
```
```xml
"jdbc:mysql://localhost:3306/news"
```
```xml
```
```xml
userId
```
```xml
=
```
```xml
"root"
```
```xml
```
```xml
password
```
```xml
=
```
```xml
""
```
```xml
>
```
```xml
```
```xml
</
```
```xml
jdbcConnection
```
```xml
>
```
```xml
```
```xml
<!--默认false
```
```xml
```
```xml
Java type resolver will always use java.math.BigDecimal if the database column is of type DECIMAL or NUMERIC.
```
```xml
```
```xml
-->
```
```xml
```
```xml
<
```
```xml
javaTypeResolver
```
```xml
>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"forceBigDecimals"
```
```xml
value
```
```xml
=
```
```xml
"false"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
javaTypeResolver
```
```xml
>
```
```xml
```
```xml
<!--生成实体类 指定包名 以及生成的地址 （可以自定义地址，但是路径不存在不会自动创建  使用Maven生成在target目录下，会自动创建） -->
```
```xml
```
```xml
<
```
```xml
javaModelGenerator
```
```xml
targetPackage
```
```xml
=
```
```xml
"com.qianyan.model"
```
```xml
targetProject
```
```xml
=
```
```xml
"MAVEN"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"enableSubPackages"
```
```xml
value
```
```xml
=
```
```xml
"false"
```
```xml
/>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"trimStrings"
```
```xml
value
```
```xml
=
```
```xml
"true"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
javaModelGenerator
```
```xml
>
```
```xml
```
```xml
<!--生成SQLMAP文件 -->
```
```xml
```
```xml
<
```
```xml
sqlMapGenerator
```
```xml
targetPackage
```
```xml
=
```
```xml
"com.qianyan.persistence.ibatis"
```
```xml
targetProject
```
```xml
=
```
```xml
"MAVEN"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"enableSubPackages"
```
```xml
value
```
```xml
=
```
```xml
"false"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
sqlMapGenerator
```
```xml
>
```
```xml
```
```xml
<!--生成Dao文件 可以配置 type="XMLMAPPER"生成xml的dao实现  context id="DB2Tables" 修改targetRuntime="MyBatis3"  -->
```
```xml
```
```xml
<
```
```xml
javaClientGenerator
```
```xml
type
```
```xml
=
```
```xml
"SPRING"
```
```xml
targetPackage
```
```xml
=
```
```xml
"com.qianyan.persistence.dao"
```
```xml
targetProject
```
```xml
=
```
```xml
"MAVEN"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
property
```
```xml
name
```
```xml
=
```
```xml
"enableSubPackages"
```
```xml
value
```
```xml
=
```
```xml
"false"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
javaClientGenerator
```
```xml
>
```
```xml
```
```xml
<!--对应数据库表 mysql可以加入主键自增 字段命名 忽略某字段等-->
```
```xml
```
```xml
<
```
```xml
table
```
```xml
tableName
```
```xml
=
```
```xml
"USER"
```
```xml
domainObjectName
```
```xml
=
```
```xml
"User"
```
```xml
>
```
```xml
```
```xml
</
```
```xml
table
```
```xml
>
```
```xml
```
```xml
</
```
```xml
context
```
```xml
>
```
```xml
</
```
```xml
generatorConfiguration
```
```xml
>
```
```
4.点击Maven Project——项目——Plugins——mybatis generator——Run Maven build
![](http://static.oschina.net/uploads/space/2014/0216/132308_OflB_140593.jpg)
5.可以根据自己项目的配置，把生成的代码拷贝到自己的项目中去
## 3生成代码的使用
mybatis设计比较巧妙，Dao层就不用说了，这里主要介绍下实体类User和UserExample
User类就是普通的实体类，定义了数据库对应的字段，以及set/get方法
Example类是干嘛的呢？用其它项目中的几个例子还说明一下吧
1.比如在一个项目 我们要删除某个小组下某个用户的信息
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```java
```
```java
public
```
```java
int
```
```java
deleteUserApplyInfo(
```
```java
long
```
```java
user_id,
```
```java
long
```
```java
team_id){
```
```java
```
```java
StudyTeamUserApplyInfoExample ue =
```
```java
new
```
```java
StudyTeamUserApplyInfoExample();
```
```java
```
```java
ue.createCriteria()
```
```java
```
```java
.andUserIdEqualTo(
```
```java
new
```
```java
BigDecimal(user_id))
```
```java
```
```java
.andTeamIdEqualTo(
```
```java
new
```
```java
BigDecimal(team_id));
```
```java
```
```java
return
```
```java
studyTeamUserApplyInfoDAO.deleteByExample(ue);
```
```java
```
```java
}
```
```
2.根据小组ID（非主键 更新小组信息）
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```java
public
```
```java
int
```
```java
updateStudyTeamInfo(StudyTeamInfo st){
```
```java
```
```java
StudyTeamInfoExample ste =
```
```java
new
```
```java
StudyTeamInfoExample();
```
```java
```
```java
ste.createCriteria().andTeamIdEqualTo(st.getTeamId());
```
```java
```
```java
return
```
```java
studyTeamInfoDAO.updateByExampleSelective(st,ste);
```
```java
```
```java
}
```
```
3.（1）模糊查询并且排序 （2）大于等于某个分数 并且小于某个分数的查询
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```java
public
```
```java
List<StudyTeamInfo> getStudyTeamInfoByName(String team_name){
```
```java
```
```java
StudyTeamInfoExample se =
```
```java
new
```
```java
StudyTeamInfoExample();
```
```java
```
```java
se.createCriteria().andTeamNameLike(
```
```java
"%"
```
```java
+team_name+
```
```java
"%"
```
```java
).andEnableEqualTo((
```
```java
short
```
```java
)
```
```java
1
```
```java
);
```
```java
```
```java
se.setOrderByClause(
```
```java
"team_score desc"
```
```java
);
```
```java
```
```java
List<StudyTeamInfo> ls = studyTeamInfoDAO.selectByExample(se);
```
```java
```
```java
if
```
```java
(ls!=
```
```java
null
```
```java
&&ls.size()>
```
```java
0
```
```java
){
```
```java
```
```java
return
```
```java
ls;
```
```java
```
```java
}
```
```java
```
```java
return
```
```java
null
```
```java
;
```
```java
```
```java
}
```
```
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```java
public
```
```java
StudyTeamLevel getStudyTeamLevel(
```
```java
long
```
```java
score){
```
```java
```
```java
StudyTeamLevelExample le =
```
```java
new
```
```java
StudyTeamLevelExample();
```
```java
```
```java
le.createCriteria().andNeedScoreLessThanOrEqualTo(score).andUpScoreGreaterThan(score);
```
```java
```
```java
List<StudyTeamLevel> ls = studyTeamLevelDAO.selectByExample(le);
```
```java
```
```java
if
```
```java
(ls!=
```
```java
null
```
```java
&&ls.size()>
```
```java
0
```
```java
){
```
```java
```
```java
return
```
```java
ls.get(
```
```java
0
```
```java
);
```
```java
```
```java
}
```
```java
```
```java
return
```
```java
null
```
```java
;
```
```java
```
```java
}
```
```
Example中提供了Critertia，一种面向对象的查询方式，并且根据实体类中字段的属性，生成不同的操作。
当然你也可以根据实际需要直接使用实体类进行增删改查。
## 4一些问题的解决方案
在实际应用中，自己也遇到了一些问题，下面是这些问题的解决方案，欢迎提供更好的方法
1.字段默认值问题
在数据库中，一些字段有默认值，比如c_time,我们在insert操作时，不需要这个字段
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```java
public
```
```java
void
```
```java
saveUserStudyTeamApplyInfo(StudyTeamUserApplyInfo uai){
```
```java
```
```java
long
```
```java
ref = studyTeamInfoDAO.getSeqAllRef();
```
```java
```
```java
uai.setRef(
```
```java
new
```
```java
BigDecimal(ref));
```
```java
```
```java
studyTeamUserApplyInfoDAO.insertSelective(uai);
```
```java
```
```java
}
```
```
可以调用insertSelective方法，传入实体类，方法会根据实体类中存在值的字段动态拼接sql
2.分页问题
mybatis没有提供分页的解决方法，可能是因为数据库之间分页的差距比较大
通过修改java代码只能做到内存分页，所以还是需要在sqlmap中添加数据库分页
参考了网上某篇博客的解决方法（地址找不到了），加了分页头和分页尾的，这样只用写内部的sql
可以一定程度下减少错误几率
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```xml
<!-- oracle 分页头 -->
```
```xml
```
```xml
<
```
```xml
sql
```
```xml
id
```
```xml
=
```
```xml
"oracle_Pagination_Head"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
dynamic
```
```xml
>
```
```xml
```
```xml
<
```
```xml
isNotEmpty
```
```xml
property
```
```xml
=
```
```xml
"first"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
isNotEmpty
```
```xml
property
```
```xml
=
```
```xml
"last"
```
```xml
>
```
```xml
```
```xml
<![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
```
```xml
```
```xml
</
```
```xml
isNotEmpty
```
```xml
>
```
```xml
```
```xml
</
```
```xml
isNotEmpty
```
```xml
>
```
```xml
```
```xml
</
```
```xml
dynamic
```
```xml
>
```
```xml
```
```xml
</
```
```xml
sql
```
```xml
>
```
```xml
```
```xml
<!-- oracle 分页尾 -->
```
```xml
```
```xml
<
```
```xml
sql
```
```xml
id
```
```xml
=
```
```xml
"oracle_Pagination_Tail"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
dynamic
```
```xml
>
```
```xml
```
```xml
<
```
```xml
isNotEmpty
```
```xml
property
```
```xml
=
```
```xml
"first"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
isNotEmpty
```
```xml
property
```
```xml
=
```
```xml
"last"
```
```xml
>
```
```xml
```
```xml
<![CDATA[) row_ where rownum <= #last# ) where rownum_ > #first#]]>
```
```xml
```
```xml
</
```
```xml
isNotEmpty
```
```xml
>
```
```xml
```
```xml
</
```
```xml
isNotEmpty
```
```xml
>
```
```xml
```
```xml
</
```
```xml
dynamic
```
```xml
>
```
```xml
```
```xml
</
```
```xml
sql
```
```xml
>
```
```xml
<
```
```xml
select
```
```xml
id
```
```xml
=
```
```xml
"findAllStudyTeamMessagePage"
```
```xml
parameterClass
```
```xml
=
```
```xml
"java.util.Map"
```
```xml
resultMap
```
```xml
=
```
```xml
"ResultMapWithUserName"
```
```xml
>
```
```xml
```
```xml
<!-- 增加oracle分页头部 -->
```
```xml
```
```xml
<
```
```xml
include
```
```xml
refid
```
```xml
=
```
```xml
"oracle_Pagination_Head"
```
```xml
/>
```
```xml
```
```xml
select a.*,b.user_name,b.photo_name, rownum rn,sysdate
```
```xml
```
```xml
from user_info b,study_team_user_message a
```
```xml
```
```xml
where  b.user_id=a.user_id
```
```xml
```
```xml
and type=0
```
```xml
```
```xml
<
```
```xml
isNotEqual
```
```xml
prepend
```
```xml
=
```
```xml
"and"
```
```xml
property
```
```xml
=
```
```xml
"team_id"
```
```xml
compareValue
```
```xml
=
```
```xml
"0"
```
```xml
>
```
```xml
```
```xml
a.team_id=#team_id#
```
```xml
```
```xml
</
```
```xml
isNotEqual
```
```xml
>
```
```xml
```
```xml
order by a.ref desc
```
```xml
```
```xml
<
```
```xml
include
```
```xml
refid
```
```xml
=
```
```xml
"oracle_Pagination_Tail"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
select
```
```xml
>
```
```
3.mysql text字段无法识别问题
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```xml
<!--对应数据库表 mysql可以加入主键自增 字段命名 忽略某字段等-->
```
```xml
```
```xml
<
```
```xml
table
```
```xml
tableName
```
```xml
=
```
```xml
"article"
```
```xml
domainObjectName
```
```xml
=
```
```xml
"Article"
```
```xml
>
```
```xml
```
```xml
<
```
```xml
columnOverride
```
```xml
column
```
```xml
=
```
```xml
"content"
```
```xml
jdbcType
```
```xml
=
```
```xml
"VARCHAR"
```
```xml
/>
```
```xml
```
```xml
</
```
```xml
table
```
```xml
>
```
```
下载：GIT@OSC [http://git.oschina.net/lujianing/Mybatis_Generator](http://git.oschina.net/lujianing/Mybatis_Generator)
ps：2014-3-28
公司用的是ibatis2.3.x 所以使用的 
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```xml
<
```
```xml
context
```
```xml
id
```
```xml
=
```
```xml
"DB2Tables"
```
```xml
targetRuntime
```
```xml
=
```
```xml
"Ibatis2Java5"
```
```xml
>
```
```
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```xml
<javaClientGenerator type="SPRING"
```
```
如果使用 type=XMLMAPPER （xml直接实现dao）
需要targetRuntime is MyBatis3 而且不向下兼容
[http://mybatis.github.io/generator/configreference/javaClientGenerator.html](http://mybatis.github.io/generator/configreference/javaClientGenerator.html)
2014-9-15
[?](http://my.oschina.net/lujianing/blog/200135#)
```
```xml
<
```
```xml
plugin
```
```xml
>
```
```xml
```
```xml
<
```
```xml
groupId
```
```xml
>org.mybatis.generator</
```
```xml
groupId
```
```xml
>
```
```xml
```
```xml
<
```
```xml
artifactId
```
```xml
>mybatis-generator-maven-plugin</
```
```xml
artifactId
```
```xml
>
```
```xml
```
```xml
<
```
```xml
version
```
```xml
>1.3.0</
```
```xml
version
```
```xml
>
```
```xml
```
```xml
<
```
```xml
dependencies
```
```xml
>
```
```xml
```
```xml
<
```
```xml
dependency
```
```xml
>
```
```xml
```
```xml
<
```
```xml
groupId
```
```xml
>com.oracle</
```
```xml
groupId
```
```xml
>
```
```xml
```
```xml
<
```
```xml
artifactId
```
```xml
>ojdbc14</
```
```xml
artifactId
```
```xml
>
```
```xml
```
```xml
<
```
```xml
version
```
```xml
>10.2.0.2.0</
```
```xml
version
```
```xml
>
```
```xml
```
```xml
</
```
```xml
dependency
```
```xml
>
```
```xml
```
```xml
</
```
```xml
dependencies
```
```xml
>
```
```xml
```
```xml
</
```
```xml
plugin
```
```xml
>
```
```
在pom中可以直接配置依赖的数据库   generatorConfig.xml就不需要再配置数据库的jar了
