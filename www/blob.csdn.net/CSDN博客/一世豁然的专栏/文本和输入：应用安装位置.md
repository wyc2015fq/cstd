# 文本和输入：应用安装位置 - 一世豁然的专栏 - CSDN博客





2017年05月09日 14:21:33[一世豁然](https://me.csdn.net/Explorer_day)阅读数：354








从API 8级开始，您可以将应用程序安装在外部存储设备（例如，设备的SD卡）上。 这是一个可选功能，您可以使用android：installLocation清单属性为您的应用程序声明。 如果您不声明此属性，您的应用程序将仅安装在内部存储上，并且不能将其移动到外部存储。




要允许系统在外部存储器上安装应用程序，请修改您的清单文件，以在<manifest>元素中包含android：installLocation属性，值为“preferExternal”或“auto”。 例如：




```
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    android:installLocation="preferExternal"
    ... >
```


如果您声明“preferExternal”，则请求将应用程序安装在外部存储上，但系统不保证您的应用程序将安装在外部存储上。 如果外部存储器已满，则系统将其安装在内部存储器上。 用户还可以在两个位置之间移动应用程序。




如果您声明“auto”，则表示您的应用程序可能安装在外部存储上，但您没有安装位置的首选项。 系统将根据几个因素决定安装应用程序的位置。 用户还可以在两个位置之间移动应用程序。





当您的应用程序安装在外部存储器上时：


1、只要外部存储器安装在设备上，对应用程序性能没有影响。




2、.apk文件保存在外部存储器上，但所有私有用户数据，数据库，优化的.dex文件和提取的本机代码都保存在内部设备内存中。




3、存储应用程序的唯一容器使用随机生成的密钥进行加密，该密钥只能由最初安装它的设备进行解密。 因此，安装在SD卡上的应用程序仅适用于一个设备。




4、用户可以通过系统设置将应用程序移动到内部存储设备。




警告：当用户使USB大容量存储与计算机共享文件或通过系统设置卸载SD卡时，将从设备中卸载外部存储，并立即杀死所有在外部存储器上运行的应用程序。








一、向后兼容性

您的应用程序在外部存储上安装的功能是仅在运行API 8级（Android 2.2）或更高版本的设备上可用的功能。 在API 8级之前构建的现有应用程序将始终安装在内部存储上，无法移动到外部存储（即使在具有API级别8的设备上）。 但是，如果您的应用程序旨在支持低于8的API级别，则可以选择对具有API Level 8或更高版本的设备支持此功能，并且仍然与使用API级别低于8的设备兼容。





为了允许安装在外部存储器上，并保持与低于API 8级的版本兼容：


1、在<manifest>元素中包含android：installLocation属性，值为“auto”或“preferExternal”。




2、将您的android：minSdkVersion属性保留为（小于“8”），并确保您的应用程序代码仅使用与该级别兼容的API。




3、为了编译您的应用程序，将您的构建目标更改为API级别8.这是必要的，因为较旧的Android库不了解android：installLocation属性，并且在应用程序存在时无法编译。




当您的应用程序安装在API级别低于8的设备上时，将忽略android：installLocation属性，并将应用程序安装在内部存储上。





注意：虽然这样的XML标记将被较老的平台忽略，但是在MinSdkVersion小于“8”的情况下，您必须小心不要使用API 8级中引入的编程API，除非您执行必要的工作以提供向后兼容你的代码。








二、不应在外部存储上安装的应用程序

当用户使USB大容量存储与其计算机共享文件（或以其他方式卸载或删除外部存储）时，安装在外部存储器上并且当前正在运行的任何应用程序都将被杀死。 在大容量存储被禁用并且将外部存储器重新安装在设备上之前，该系统有效地不知道该应用。 除了杀死应用程序并使其不可用于用户，这可以以更严肃的方式破坏某些类型的应用程序。 为了使您的应用程序始终按预期的方式运行，如果使用以下任何功能，则不应将应用程序安装在外部存储上，这是因为在卸载外部存储器时引用的后果：





服务

您的正在运行的服务将被终止，并且重新安装外部存储时不会重新启动。 但是，您可以注册ACTION_EXTERNAL_APPLICATIONS_AVAILABLE广播意图，该意图将通知您的应用程序，当外部存储上安装的应用程序再次可用于系统时。 那时候你可以重新启动你的服务。





报警服务


您在AlarmManager注册的警报将被取消。 重新安装外部存储器时，必须手动重新注册任何警报。





输入法引擎


您的IME将被默认的IME所取代。 当重新安装外部存储器时，用户可以打开系统设置以重新启用IME。





动态壁纸


您的正在运行的动态壁纸将被默认的动态壁纸所取代。 当重新安装外部存储时，用户可以再次选择您的动态壁纸。





应用程序小部件


您的应用程序小部件将从主屏幕中删除。 重新安装外部存储器时，您的应用程序小部件将无法供用户选择，直到系统重置主应用程序（通常不会直到系统重新启动）。





账户记录

使用AccountManager创建的帐户将消失，直到重新安装外部存储。





同步适配器


在重新安装外部存储器之前，您的AbstractThreadedSyncAdapter及其所有同步功能将无法正常工作。





设备管理员


您的DeviceAdminReceiver及其所有管理功能将被禁用，这可能对设备功能造成不可预见的后果，这可能会在重新安装外部存储之后持续存在。





广播接收器监听“启动完成”


在将外部存储器安装到设备之前，系统会传送ACTION_BOOT_COMPLETED广播。 如果您的应用程序安装在外部存储上，则无法接收此广播。





如果您的应用程序使用上面列出的任何功能，则不应允许应用程序安装在外部存储设备上。 默认情况下，系统不允许您的应用程序安装在外部存储上，因此您不需要担心现有的应用程序。 但是，如果您确定您的应用程序永远不应该安装在外部存储器上，那么您应该通过声明android：installLocation的值为“internalOnly”来清除该应用程序。 虽然这不会改变默认行为，但它明确指出，您的应用程序只应安装在内部存储上，并作为提醒您和其他开发人员作出此决定。








三、应安装在外部存储器上的应用程序

当外部存储变得不可用并且游戏进程被杀死时，当存储再次可用并且用户重新启动游戏时（假定游戏在正常活动生命周期中正确地保存其状态），则应该没有可见的效果。





如果您的应用程序需要几兆字节的APK文件，您应该仔细考虑是否使应用程序安装在外部存储上，以便用户可以保留其内部存储空间。




