# 在头文件中用宏定义来避免重复包含，仍然会出现函数重定义的错误 - 一世豁然的专栏 - CSDN博客





2017年02月17日 11:29:10[一世豁然](https://me.csdn.net/Explorer_day)阅读数：1745








本博客转载于：[http://blog.csdn.net/kkforwork/article/details/42679041](http://blog.csdn.net/kkforwork/article/details/42679041)







1. 在头文件包含中用了宏定义，还是会出现函数重定义的错误，表现为“error LNK2005: 已经在*.obj中定义“。

主要原因是在头文件中定义了函数。

因为对每个包含这个头文件的cpp文件而言，都要编译生成一个有这个函数实体的obj文件，对于单个文件而言没有重复定义。但对于整个工程而言，在链接的时候会因为有多个函数定义实体，而报错。

2.  为避免重复定义, 结构体的定义和静态数据的定义也不能放在头文件里?

把定义看成两种：类型定义，数据定义
类型定义不分配内存的，比如类的定义，结构体的定义，它是定义一个数据类型而已
数据定义分配内存，比如类对象定义，变量定义
一个原则：
不分配内存的，放在头文件
分配内存的放在cpp文件，放置重复定义
综上所述，你就可以知道结构体的定义属于类型定义放在头文件，静态数据的定义属于数据定义放在cpp文件
对于函数相同，函数声明你可以看作类型定义，函数实现看作数据定义


3. 另外，对于这一种错误，可以将定义在头文件里的函数定义成inline类型。

因为内联函数的代码会在任何调用它的地方展开。因此，不会出现链接时重定义的错误。

内联展开是在编译时进行的，只有链接的时候源文件之间才有关系。所以内联要想跨源文件必须把实现写在头文件里。如果一个inline函数会在多个源文件中被用到，那么必须把它定义在头文件中。


因此，[内联函数](http://baike.baidu.com/view/534064.htm)一般只会用在函数内容非常简单的时候用。




