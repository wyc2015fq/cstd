# 《TCP/IP入门经典》——网际层 - 一世豁然的专栏 - CSDN博客





2015年08月03日 20:34:00[一世豁然](https://me.csdn.net/Explorer_day)阅读数：1250








一、寻址与发送

  1、在路由式网络中，因物理地址进行传输所需的过程不能跨越路由接口来运行，所以不能利用物理地址实现数据传输。即使可行，其传输也非常麻烦。




  2、TCP/IP隐藏了物理地址，以一种逻辑化，层次化的寻址方案对网络进行组织。这种逻辑寻址方案由网际层的IP协议维护，而逻辑地址被称为IP地址。




  3、地址解析协议（ARP）是另一种网际层协议，它维护一个表格，用于吧IP地址映射到物理地址。这个ARP表链接了IP地址与网卡物理地址。




  4、在一个路由式网络中，TCP/IP软件使用如下策略在网络上发送数据

![](https://img-blog.csdn.net/20150728194441314?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)





  5、为了在复杂的路由式网络中传输数据，网际层协议必须具有以下爱的功能：

   1）、识别网络中所有的计算机。

   2）、提供一种方式来判断何时需要通过网关来传递消息。

   3）、提供一种与硬件无关的方式来识别目的网段，从而让数据报能够高效率的经过路由器到达正确的网段。

   4）、提供一种方式把目的计算机的逻辑IP地址转化为物理地址，让数据能够传输给目的计算机的网络适配器。







二、网际协议（IP）

 一）、简介

  1、IP协议提供了一种分层的，与硬件无关的寻址系统，具有在复杂的路由式网络中传递数据所需的服务。TCP/IP网络上的每个网络适配器都有一个唯一的IP地址。




  2、IP地址分为两个部分：

   1）、网络ID。

   2）、主机ID。




  3、对于区分网络ID和主机ID，最初的结解决方案是把IP地址划分为一系列地址类。A类地址使用地址前8位作为网络ID，B类地址使用地址前16位，C类地址使用地址前16位。

        此方案添加了一个名为“子网划分”的特性，用于在本地范围内对网络结构进行更好的控制。




  4、无类别域间路由选择（CIDR）技术让地址分类系统边上的无意义。







 二）、IP报头字段

  1、每个IP数据报都以一个IP报头开始。源计算机的TCP/IP软件构造这个IP报头，目的计算机的TCP/IP软件利用IP报头中封装的信息处理数据。IP报头包含大量信息，包括源IP

        地址、目的IP地址、数据报长度、IP版本号和多路由器的特殊指令。IP报头的最小长度20字节。




  2、IP报头字段

![](https://img-blog.csdn.net/20150728201709216?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)


   1）、版本：这个4位的字段表示所使用的IP版本。目前IP版本是4，相应的二进制位0100.

   2）、网际报头长度（IHL）：这个4位字段表示IP报头以32位字为单位的长度。IP报头的最小长度是5个32位比特字，相应的二进制表示0101。

   3）、服务类型：源IP能够指定特殊的路由信息。此8位字段的主要用途是对等待通过路由器的数据报区分优先级，而目前大多数IP实现把是这个字段全填为0。

   4）、总长度：此16位字段表示IP数据报的长度，单位是字节，这个长度包含了IP报头和数据载荷。

   5）、标识：此16位字段是一个依序变大的数值，分配给源IP发出的信息。

   6）、标记：此字段表示分段可能性。

   7）、分段位移：此13位的字段是一个数值，被赋予每个连续的分段。

   8）、生存时间（TTL）：此字段表示数据包在被抛弃之前能够保留的时间（以秒为单位）或路由器跳数。

   9）、跳数代表数据包到达目的之前必须经过的路由器的数量。

   10）、协议：此8位表示接收数据载荷的协议。下面是常见的协议标识值

![](https://img-blog.csdn.net/20150731195646739?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)


   11）、报头校检和：这个字段包含16位的校检和，只用于校检报头本身的有效性。

   12）、源IP地址：此32位的字段包含了数据报的IP地址。

   13）、目的IP地址：此32位的字段包含了数据包的目的IP地址。

   14）、IP选项：此字段支持一些可选的报头设置，主要用于测试、调试和安全的目的。

   15）、填充：IP选项字段的长度不是固定的。

   16）、IP数据载荷：此字段一般用于保存传递给TCP或UDP（在传输层中）、ICMP或IGMP的数据。







 三）、IP寻址

  1、IP地址最常用的表达形式是“点分十进制形式”。




  2、地址分类系统把IP地址划分到不同的地址类。绝大多数IP地址属于以下几类：

   1）、A类地址：IP地址的前8位表示网络ID，后24位表示主机ID。

   2）、B类地址：IP地址的前16位表示网络ID，后16位表示主机ID。

   3）、C类地址：IP地址的前24位表示网络ID，后8位表示主机ID。

 注：使用的位数越多，包含的组合也就越多。




  3、如何判断一个I跑地址是A类、B类、C类地址呢？

   1）、如果32位地址以0开头，它就是A类地址。

   2）、如果32位地址以10开头，它就是B类地址。

   3）、如果32位地址以110开头，它就是C类地址。

![](https://img-blog.csdn.net/20150731201807444?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)








 四）、将32位的二进制地址转换为点分十进制形式

  1、只要把二进制数值中为1的位置所代表的数值相加起来，就可以得到相应的十进制数值。IP地址是由4个八位组组成的，每个八位组必须进行单独转换。




 五）、十进制数值转化为二进制八位组

  1、把要转化的值与128相比。如果大于等于128，就把它减去128，并写下1。如果小于128，就减去0，并写下0。

  2、采用第1步的结果，把它与64相比。如果大于等于64，就减去64，并写下1。如果小于64，就减去0，并写下0。

  3、采用第2步的结果，把它与32相比。如果大于等于32，就减去32，并写下1。如果小于32，就减去0，并写下0。

  4、采用第3步的结果，把它与16相比。如果大于等于16，就减去16，并写下1。如果小于16，就减去0，并写下0。

  5、采用第4步的结果，把它与8相比。如果大于等于8，就减去8，并写下1。如果小于8，就减去0，并写下0。

  6、采用第5步的结果，把它与4相比。如果大于等于4，就减去4，并写下1。如果小于4，就减去0，并写下0。

  7、采用第6步的结果，把它与2相比。如果大于等于2，就减去2，并写下1。如果小于2，就减去0，并写下0。

  8、如果第7步的结果是1，把它与1相比就写下1。如果小于1，如果第7步的结果是0，并写下0。




 六）、特殊的IP地址

  1、有一些I跑地址具有特殊含义，不会分配给主机。

   1）、全0的主机ID表示网络本身。

   2）、全1的主机ID表示广播。广播是向网络中全部主机发送的消息。

   3）、以十进制值127开头的地址是环回地址。目的地址为环回地址的消息是由本地TCP/IP软件发送的，其目的在于测试TCP/IP软件是否正常工作。

   4）、RFC 1597（之后被RFC 1918）保留了一些IP地址范围用于私有网络，其设想是，这些私有网络不会链接到internet，所以不必要求是唯一的。







三、地址解析协议

  1、网段上每台主机在内存中都保存着一个被称为ARP表或ARP缓存的表格，其中包含着网段上其他主机的IP地址与物理地址的对应关系。

![](https://img-blog.csdn.net/20150803201028094?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)





  2、ARP请求帧包含未解析的IP地址，还包含发送这个主机的IP地址和物理地址。







四、逆向ARP（RARP）

  1、RARP简称逆向ARP，也就是ARP的逆过程。







五、Internet控制消息协议（ICMP）

  1、发送到远程计算机的数据通常会经过一个或多个路由器，这些路由器再把数据传输到最终目的地的过程中可能发生多种问题。路由器利用Internet地址解析协议（ICMP）消

        息把问题通知给源IP。ICMP还可用于其他调试和排除的功能。




  2、常见的ICMP消息

   1）、Echo Request（回显请求）和Echo Reply（回显应答）。

   2）、Source Quench（源抑制）。

   3）、Destination Unreachable（目的不可到达）。

   4）、Time Exceeded（超时）。

   5）、Fragmentation Needed（需要分段）。







六、网际层其他协议

  1、网际层还包含边界网关协议（BGP）和路由信息协议（RIP）。




  1、IPSec协议IPV4里是可选的，但在IPV6就是必须的。







七、关键术语

![](https://img-blog.csdn.net/20150803203305207?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)




