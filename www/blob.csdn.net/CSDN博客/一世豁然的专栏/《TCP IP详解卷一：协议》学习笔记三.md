# 《TCP/IP详解卷一：协议》学习笔记三 - 一世豁然的专栏 - CSDN博客





2017年03月30日 21:32:23[一世豁然](https://me.csdn.net/Explorer_day)阅读数：1428








一、引言

1、IP是TCP/IP协议族中最为核心的协议。所有的TCP、UDP、ICMP及IGMP数据都以IP数据报格式传输。




2、IP提供不可靠以及无连接的数据包服务

 1）、不可靠的意思是它不能够保证IP数据包能够成功的到达目的地。

 2）、无连接的意思是IP并不维护任何关于后续数据报的状态信息







二、IP首部

1、普通的IP首部长为20个字节，除非含有选项字段。IP数据报的格式如下：

![](https://img-blog.csdn.net/20170327194644754?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRXhwbG9yZXJfZGF5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)





2、4字节的32bit值以下面的次序传输：

      首先是0~7 bit，其次8~15 bit，然后16~23 bit，最后是24~32 bit。这种传输次序称为 big endian字节序。

      注：由于TCP/IP首部中所有的二进制整数在网络中传输时都要求以这种次序，因此它又成为网络字节序。以其他形式存储二进制整数的机器，必须在传输数据之前把首部转换成网络字节序。




3、版本是指协议版本号，因此IP有时也称作为IPv4.




4、首部长度

 1）、首部长度指的是首部占32 bit字的数目包括任何选项。

 2）、由于是一个4比特字段，因此首部长度最长为60个字节。但这种限制使某些选项在当今已没有什么用处。

 3）、普通IP数据报（没有任何选项）字段的值是5。




5、服务类型（TOS）

 1）、服务类型包括一个3 bit的优先权子字段（现在已被忽略），4 bit的TOS子字段，1 bit未用位但必须置0.。

 2）、4 bit的TOS分别代表：最小延时、最大吞吐量、最高可靠性和最小费用。4 bit中只能置其中1 bit。如果所有4 bit均为0，那么就意味着一般服务。

           对不同应用建议的服务类型字段推荐值

![](https://img-blog.csdn.net/20170327202446303?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRXhwbG9yZXJfZGF5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)


 3）、现在大多数的TCP/IP实现都不支持TOS特性。




6、总长度字段

 1）、总长度字段是指整个IP数据报的长度，以字节为单位。利用首部长度字段和总长度字段，就可以知道IP数据报中数据内容的起始位置和长度。由于该字段长为16比特，所以IP数据报最长可达65536字节。

 2）、总长度字段是IP首部必要的内容，因为一些数据链路需要填充一些数据以达到最小长度。




7、标识字段唯一地标识主机发送的每一份数据报。通常每发送一份报文它的值就会加1。




8、TTL生存时间

 1）、TTL字段设置了数据报可以经过的最多路由数。它指定了数据报的生存时间。

 2）、TTL的初始值由源主机设置（通常为32或64），一旦经过一个处理它的路由器，它的值就会减1。当该字段的值为0时，数据报就会被丢弃，并发送ICMP报文通知源主机。




9、首部检验和字段

 1）、此字段是根据IP首部计算的检验和码。它不对首部后面的数据进行计算。

 2）、ICMP、IGMP、UDP和TCP在它们各自的首部中均含有同时覆盖首部和数据检验和码。

 3）、为了计算一份IP数据报的检验和，首先把检验和字段置位0。然后，对首部中每个16 bit进行二进制反码求和，结果存在检验和字段中。




10、每一份IP数据报都包含IP地址和源地址。它们都是32 bit的值。




11、任选项字段

 1）、此是一个时数据报中的一个可变长的可选信息。

 2）、这些任选项定义如下：

    I、安全和处理限制。

    II、记录路径

    III、时间擢

    IV、宽松的源站选项

    V、严格的源站选项

 3）、选项字段一般都是以32 bit作为界限，在必要时插入值为0的填充字节。







三、路由选项

1、从概念上说，IP路由选择是简单的，特别对于主机来说。

 1）、如果目的主机与源主机直接相连或都在一个共享网络上，那么IP数据报就直接发送到目的主机上。

 2）、如果主机把主机报发往一个默认的路由上，由路由器来转发该数据报。




2、IP层既可以配置成路由器的功能，也可以配置成主机的功能。其本质区别在于主机从不把数据报从一个接口转发到另一个接口，二路由器则要转发数据报。




3、在一般的体制中，IP可以从TCP、UDP、ICMP和IGMP接收数据报并进行发送，或者从一个接口接收网络数据报（待转发的数据报）并进行发送。




4、IP层在内存中有一个路由表。

 1）、当收到一份数据报并进行发送时，它都要对该表搜索一次。

 2）、当数据报来自某个网络接口时，IP首先检查目的IP地址是否为本机的IP地址之一或IP广播地址

      I、如果的确是这样，数据报就被送到由IP首部协议字段所指定的协议模块进行处理。

      II、如果数据报的目的不是这些地址，那么：

           如果IP层被设置为路由器的功能，那么就对数据报进行转发，

          否则，丢弃数据报。




5、路由表中的每一项都包含下面这些信息

 1）、目的IP地址。它既可以是一个完整的主机地址，也可以是一个网络地址，由该表目中的标志字段来确定。

 2）、下一站（或下一跳）路由器的IP地址，或者直接连接地网络IP地址。

 3）、标志。其中一个标志指明目的IP地址示网络地址还是主机地址。另一个标志指明另一个下一站路由是否为真正的下一站路由，还是一个直接相连的接口。

 4）、为数据报的传输指定一个网络接口。




6、IP路由选择是逐跳进行的，其主要完成以下的功能:

 1）、搜索路由表，寻找能与目的IP地址完全匹配的表目。

 2）、搜索路由表，寻找能与目的网络号相匹配的表目。

 3）、搜索路由表，寻找标为“默认”的表目。

 4）、如果上面的步骤都没有成功，那么该数据报就不能被传送。







四、子网寻址

1、现在所有的主机都要求支持子网编址。不是把IP地址看成由单纯的一个网络号和一个主机号组成，而是把主机号再分成一个子网号和主机号。




2、在InterNIC获得某类IP网络号后，就由当地的系统管理员来进行分配，来决定是否建议子网，以及分配多少比特给子网号和主机号。许多管理员采用自然的划分方法，即把B类地址中留给主机的16bit中的钱8bit作为子网地址，后8bit作为主机号。但是，并不要求A类或B类地址的子网划分都要以字节为划分界面。




3、子网对外部路由器来说隐藏了内部网络组合的细节。




4、与相同数量的C类地址相比，B类地址的子网可以缩小internet路由表的规模。




4、子网对于子网内部的路由器是不透明的。







五、子网掩码

1、主机需要确定有多少比特用于子网号以及有多少比特用于主机号。这是在引导过程中通过子网掩码来确定的。这个掩码是一个32bit的值，其中值为1的比特留给网络号和子网号，为0的主机留给主机号。




2、子网掩码经常使用十六进制来表示，特别是当一个界限不是一个字节时。




3、给定IP地址和子网掩码后，主机就可以确定IP主机报的目的

 1）、本子网上的主机；

 2）、本网络中其他子网中的主机；

 3）、其他网络上的主机；

注：如果知道本机的IP地址，那么就知道他是否为A类，B类或C类地址，也就知道网络号和子网号之间的分界线。而根据子网掩码就可知道子网号和主机号之间的分界线。







六、特殊情况的IP地址

1、特殊情况的IP地址

![](https://img-blog.csdn.net/20170330212555238?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRXhwbG9yZXJfZGF5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)


 1）、0表示所有的比特位全为0。

 2）、-1表示所有的比特位全为1。

 3）、netid、subnetid和hostid分别表示不全为0，或全1的对应字段。

 4）、子网号栏为空表示该地址没有进行子网划分。




2、我们把特殊情况的IP地址分为三个部分。表的头两项是特殊的源地址，中间项是特殊的环回地址，最后四项是广播地址，



