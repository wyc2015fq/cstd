# (转载)机器学习知识点(十三)吉布斯采样法(Gibbs Sampling) - 专注于数据挖掘算法研究和应用 - CSDN博客





2017年03月03日 10:17:16[fjssharpsword](https://me.csdn.net/fjssharpsword)阅读数：3523
所属专栏：[机器学习专栏](https://blog.csdn.net/column/details/16315.html)









3.1 随机模拟


随机模拟(或者统计模拟)方法有一个很酷的别名是蒙特卡罗方法(Monte Carlo Simulation)。这个方法的发展始于20世纪40年代，和原子弹制造的曼哈顿计划密切相关，当时的几个大牛，包括乌拉姆、冯.诺依曼、费米、费曼、Nicholas Metropolis， 在美国洛斯阿拉莫斯国家实验室研究裂变物质的中子连锁反应的时候，开始使用统计模拟的方法,并在最早的计算机上进行编程实现。

![simulation](http://cos.name/wp-content/uploads/2013/01/simulation.jpg)随机模拟与计算机


现代的统计模拟方法最早由数学家乌拉姆提出，被Metropolis命名为蒙特卡罗方法，蒙特卡罗是著名的赌场，赌博总是和统计密切关联的，所以这个命名风趣而贴切，很快被大家广泛接受。被不过据说费米之前就已经在实验中使用了，但是没有发表。说起蒙特卡罗方法的源头，可以追溯到18世纪，布丰当年用于计算的著名的投针实验就是蒙特卡罗模拟实验。统计采样的方法其实数学家们很早就知道，但是在计算机出现以前，随机数生成的成本很高，所以该方法也没有实用价值。随着计算机技术在二十世纪后半叶的迅猛发展，随机模拟技术很快进入实用阶段。对那些用确定算法不可行或不可能解决的问题，蒙特卡罗方法常常为人们带来希望。

![monte-carlo-simulation](http://cos.name/wp-content/uploads/2013/01/monte-carlo-simulation.jpg)蒙特卡罗方法


统计模拟中有一个重要的问题就是给定一个概率分布，我们如何在计算机中生成它的样本。一般而言均匀分布 的样本是相对容易生成的。 通过线性同余发生器可以生成伪随机数，我们用确定性算法生成之间的伪随机数序列后，这些序列的各种统计指标和均匀分布  的理论计算结果非常接近。这样的伪随机序列就有比较好的统计性质，可以被当成真实的随机数使用。

![sampling](http://cos.name/wp-content/uploads/2013/01/sampling.png)

生成一个概率分布的样本


而我们常见的概率分布，无论是连续的还是离散的分布，都可以基于 的样本生成。例如正态分布可以通过著名的
 Box-Muller 变换得到

[Box-Muller 变换]  如果随机变量  独立且，


则  独立且服从标准正态分布。


其它几个著名的连续分布，包括指数分布、Gamma 分布、t 分布、F 分布、Beta 分布、Dirichlet 分布等等,也都可以通过类似的数学变换得到；离散的分布通过均匀分布更加容易生成。更多的统计分布如何通过均匀分布的变换生成出来，大家可以参考统计计算的书，其中 Sheldon M. Ross 的《统计模拟》是写得非常通俗易懂的一本。


不过我们并不是总是这么幸运的，当的形式很复杂，或者 是个高维的分布的时候，样本的生成就可能很困难了。 譬如有如下的情况
- ,而  我们是可以计算的，但是底下的积分式无法显式计算。
-  是一个二维的分布函数，这个函数本身计算很困难，但是条件分布 的计算相对简单;如果  是高维的，这种情形就更加明显。


此时就需要使用一些更加复杂的随机模拟的方法来生成样本。而本节中将要重点介绍的 MCMC(Markov Chain Monte Carlo) 和 Gibbs Sampling算法就是最常用的一种，这两个方法在现代贝叶斯分析中被广泛使用。要了解这两个算法，我们首先要对马氏链的平稳分布的性质有基本的认识。

3.2 马氏链及其平稳分布


马氏链的数学定义很简单


也就是状态转移的概率只依赖于前一个状态。


我们先来看马氏链的一个具体的例子。社会学家经常把人按其经济状况分成3类：下层(lower-class)、中层(middle-class)、上层(upper-class)，我们用1,2,3 分别代表这三个阶层。社会学家们发现决定一个人的收入阶层的最重要的因素就是其父母的收入阶层。如果一个人的收入属于下层类别，那么他的孩子属于下层收入的概率是 0.65, 属于中层收入的概率是 0.28, 属于上层收入的概率是 0.07。事实上，从父代到子代，收入阶层的变化的转移概率如下

![table-1](http://cos.name/wp-content/uploads/2013/01/table-1.jpg)![markov-transition](http://cos.name/wp-content/uploads/2013/01/markov-transition.png)


使用矩阵的表示方式，转移概率矩阵记为



假设当前这一代人处在下层、中层、上层的人的比例是概率分布向量 ，那么他们的子女的分布比例将是 , 他们的孙子代的分布比例将是 , ……, 第代子孙的收入分布比例将是 。


假设初始概率分布为，则我们可以计算前代人的分布状况如下

![table-2](http://cos.name/wp-content/uploads/2013/01/table-2.jpg)


我们发现从第7代人开始，这个分布就稳定不变了，这个是偶然的吗？我们换一个初始概率分布 试试看，继续计算前代人的分布状况如下

![table-3](http://cos.name/wp-content/uploads/2013/01/table-3.jpg)


我们发现，到第9代人的时候, 分布又收敛了。最为奇特的是，两次给定不同的初始概率分布，最终都收敛到概率分布 ，也就是说收敛的行为和初始概率分布  无关。这说明这个收敛行为主要是由概率转移矩阵决定的。我们计算一下 




我们发现，当  足够大的时候，这个矩阵的每一行都是稳定地收敛到 这个概率分布。自然的，这个收敛现象并非是我们这个马氏链独有的，而是绝大多数马氏链的共同行为，关于马氏链的收敛我们有如下漂亮的定理：

马氏链定理： 如果一个非周期马氏链具有转移概率矩阵,且它的任何两个状态是连通的，那么  存在且与无关，记 ,
 我们有
- 
- 
-  是方程  的唯一非负解


其中,

称为马氏链的平稳分布。


这个马氏链的收敛定理非常重要，所有的 MCMC(Markov Chain Monte Carlo) 方法都是以这个定理作为理论基础的。 定理的证明相对复杂，一般的随机过程课本中也不给证明，所以我们就不用纠结它的证明了，直接用这个定理的结论就好了。我们对这个定理的内容做一些解释说明：
- 该定理中马氏链的状态不要求有限，可以是有无穷多个的；
- 定理中的“非周期“这个概念我们不打算解释了，因为我们遇到的绝大多数马氏链都是非周期的；
- 两个状态是连通并非指 可以直接一步转移到(),而是指  可以通过有限的步转移到达()。马氏链的任何两个状态是连通的含义是指存在一个, 使得矩阵 中的任何一个元素的数值都大于零。
- 我们用  表示在马氏链上跳转第步后所处的状态，如果  存在，很容易证明以上定理的第二个结论。由于


上式两边取极限就得到 


从初始概率分布  出发，我们在马氏链上做状态转移，记的概率分布为, 则有


由马氏链收敛的定理, 概率分布将收敛到平稳分布 。假设到第步的时候马氏链收敛，则有


所以  都是同分布的随机变量，当然他们并不独立。如果我们从一个具体的初始状态  开始,沿着马氏链按照概率转移矩阵做跳转，那么我们得到一个转移序列  由于马氏链的收敛行为， 都将是平稳分布  的样本。

3.3 Markov Chain Monte Carlo


对于给定的概率分布,我们希望能有便捷的方式生成它对应的样本。由于马氏链能收敛到平稳分布，
 于是一个很的漂亮想法是：如果我们能构造一个转移矩阵为的马氏链，使得该马氏链的平稳分布恰好是, 那么我们从任何一个初始状态出发沿着马氏链转移, 得到一个转移序列 ， 如果马氏链在第步已经收敛了，于是我们就得到了  的样本。


这个绝妙的想法在1953年被 Metropolis想到了，为了研究粒子系统的平稳性质， Metropolis 考虑了物理学中常见的波尔兹曼分布的采样问题，首次提出了基于马氏链的蒙特卡罗方法，即Metropolis算法，并在最早的计算机上编程实现。Metropolis 算法是首个普适的采样方法，并启发了一系列 MCMC方法，所以人们把它视为随机模拟技术腾飞的起点。 Metropolis的这篇论文被收录在《统计学中的重大突破》中， Metropolis算法也被遴选为二十世纪的十个最重要的算法之一。


我们接下来介绍的MCMC 算法是 Metropolis 算法的一个改进变种，即常用的 Metropolis-Hastings 算法。由上一节的例子和定理我们看到了，马氏链的收敛性质主要由转移矩阵 决定, 所以基于马氏链做采样的关键问题是如何构造转移矩阵,使得平稳分布恰好是我们要的分布。如何能做到这一点呢？我们主要使用如下的定理。

定理：[细致平稳条件] 如果非周期马氏链的转移矩阵和分布 满足


则  是马氏链的平稳分布，上式被称为细致平稳条件(detailed
 balance condition)。


其实这个定理是显而易见的，因为细致平稳条件的物理含义就是对于任何两个状态,
 从  转移出去到 而丢失的概率质量，恰好会被从  转移回 的概率质量补充回来，所以状态上的概率质量是稳定的，从而是马氏链的平稳分布。数学上的证明也很简单，由细致平稳条件可得


由于 是方程 的解，所以是平稳分布。


假设我们已经有一个转移矩阵为马氏链(表示从状态 转移到状态的概率，也可以写为 或者), 显然，通常情况下  也就是细致平稳条件不成立，所以  不太可能是这个马氏链的平稳分布。我们可否对马氏链做一个改造，使得细致平稳条件成立呢？譬如，我们引入一个 , 我们希望


取什么样的  以上等式能成立呢？最简单的，按照对称性，我们可以取


于是(*)式就成立了。所以有


于是我们把原来具有转移矩阵的一个很普通的马氏链，改造为了具有转移矩阵的马氏链，而 恰好满足细致平稳条件，由此马氏链的平稳分布就是！


在改造  的过程中引入的 称为接受率，物理意义可以理解为在原来的马氏链上，从状态  以 的概率转跳转到状态 的时候，我们以的概率接受这个转移，于是得到新的马氏链的转移概率为。

![mcmc-transition](http://cos.name/wp-content/uploads/2013/01/mcmc-transition.jpg)马氏链转移和接受概率


假设我们已经有一个转移矩阵Q(对应元素为),
 把以上的过程整理一下，我们就得到了如下的用于采样概率分布的算法。

![mcmc-algo-1](http://cos.name/wp-content/uploads/2013/01/mcmc-algo-1.jpg)


上述过程中  说的都是离散的情形，事实上即便这两个分布是连续的，以上算法仍然是有效，于是就得到更一般的连续概率分布 的采样算法，而  就是任意一个连续二元概率分布对应的条件分布。


以上的 MCMC 采样算法已经能很漂亮的工作了，不过它有一个小的问题：马氏链在转移的过程中的接受率  可能偏小，这样采样过程中马氏链容易原地踏步，拒绝大量的跳转，这使得马氏链遍历所有的状态空间要花费太长的时间，收敛到平稳分布的速度太慢。有没有办法提升一些接受率呢?


假设 ,
 此时满足细致平稳条件，于是


上式两边扩大5倍，我们改写为


看，我们提高了接受率，而细致平稳条件并没有打破！这启发我们可以把细致平稳条件(**) 式中的 同比例放大，使得两数中最大的一个放大到1，这样我们就提高了采样中的跳转接受率。所以我们可以取


于是，经过对上述MCMC 采样算法中接受率的微小改造，我们就得到了如下教科书中最常见的 Metropolis-Hastings 算法。

![mcmc-algo-2](http://cos.name/wp-content/uploads/2013/01/mcmc-algo-2.jpg)


对于分布 ,我们构造转移矩阵  使其满足细致平稳条件


此处  并不要求是一维的，对于高维空间的 ，如果满足细致平稳条件


那么以上的 Metropolis-Hastings 算法一样有效。

3.2 Gibbs Sampling


对于高维的情形，由于接受率 的存在(通常 ), 以上 Metropolis-Hastings 算法的效率不够高。能否找到一个转移矩阵Q使得接受率  呢？我们先看看二维的情形，假设有一个概率分布, 考察坐标相同的两个点，我们发现


所以得到


即


基于以上等式，我们发现，在  这条平行于 轴的直线上，如果使用条件分布 做为任何两个点之间的转移概率，那么任何两个点之间的转移满足细致平稳条件。同样的，如果我们在 这条直线上任意取两个点 ,也有如下等式


![gibbs-transition](http://cos.name/wp-content/uploads/2013/01/gibbs-transition.png)平面上马氏链转移矩阵的构造


于是我们可以如下构造平面上任意两点之间的转移概率矩阵Q



有了如上的转移矩阵 Q, 我们很容易验证对平面上任意两点 ,
 满足细致平稳条件


于是这个二维空间上的马氏链将收敛到平稳分布 。而这个算法就称为
 Gibbs Sampling 算法,是 Stuart Geman 和Donald Geman 这两兄弟于1984年提出来的，之所以叫做Gibbs Sampling 是因为他们研究了Gibbs random field, 这个算法在现代贝叶斯分析中占据重要位置。

![gibbs-algo-1](http://cos.name/wp-content/uploads/2013/01/gibbs-algo-1.jpg)

![two-stage-gibbs](http://cos.name/wp-content/uploads/2013/01/two-stage-gibbs.png)Gibbs
 Sampling 算法中的马氏链转移


以上采样过程中，如图所示，马氏链的转移只是轮换的沿着坐标轴 轴和轴做转移，于是得到样本 马氏链收敛后，最终得到的样本就是  的样本，而收敛之前的阶段称为 burn-in period。额外说明一下，我们看到教科书上的 Gibbs Sampling 算法大都是坐标轴轮换采样的，但是这其实是不强制要求的。最一般的情形可以是，在时刻，可以在轴和轴之间随机的选一个坐标轴，然后按条件概率做转移，马氏链也是一样收敛的。轮换两个坐标轴只是一种方便的形式。


以上的过程我们很容易推广到高维的情形，对于(***) 式，如果变为多维情形，可以看出推导过程不变，所以细致平稳条件同样是成立的


此时转移矩阵 Q 由条件分布  定义。上式只是说明了一根坐标轴的情形，和二维情形类似，很容易验证对所有坐标轴都有类似的结论。所以维空间中对于概率分布  可以如下定义转移矩阵
- 如果当前状态为，马氏链转移的过程中，只能沿着坐标轴做转移。沿着  这根坐标轴做转移的时候，转移概率由条件概率  定义；
-  其它无法沿着单根坐标轴进行的跳转，转移概率都设置为 0。


于是我们可以把Gibbs Smapling 算法从采样二维的  推广到采样 维的 

![gibbs-algo-2](http://cos.name/wp-content/uploads/2013/01/gibbs-algo-2.jpg)


以上算法收敛后，得到的就是概率分布的样本，当然这些样本并不独立，但是我们此处要求的是采样得到的样本符合给定的概率分布，并不要求独立。同样的，在以上算法中，坐标轴轮换采样不是必须的，可以在坐标轴轮换中引入随机性，这时候转移矩阵  中任何两个点的转移概率中就会包含坐标轴选择的概率，而在通常的 Gibbs Sampling 算法中，坐标轴轮换是一个确定性的过程，也就是在给定时刻，在一根固定的坐标轴上转移的概率是1。


转载地址：https://cos.name/2013/01/lda-math-mcmc-and-gibbs-sampling/


这篇链接http://www.myexception.cn/cloud/2100158.html也值得学习。



