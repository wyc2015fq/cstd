# PyQt5教程——事件和信号（5） - YZXnuaa的博客 - CSDN博客
2018年04月27日 15:35:34[YZXnuaa](https://me.csdn.net/YZXnuaa)阅读数：92
个人分类：[PyQt](https://blog.csdn.net/YZXnuaa/article/category/7625276)
在这部分PyQt5编程教程中，我们探索应用中事件和信号的发生。
## 事件
所有的GUI应用都是事件驱动的。事件主要由应用的用户操作产生的。但是事件可能由其他条件触发，比如：一个网络连接，一个窗口管理器，一个定时器，这些动作都可能触发事件的产生。当我们调用应用的exec_()方法时，应用进入了主循环。主循环用于检测事件的产生并且将事件送到用于处理的对象中去。
在事件模型，有三个参与者
- 事件源
- 事件对象
- 事件目标
事件源是状态发生改变的对象。它产生了事件。事件对象(evnet)封装了事件源中的状态变化。事件目标是想要被通知的对象。事件源对象代表了处理一个事件直到事件目标做出响应的任务。
PyQt5有一个独一无二的信号和槽机制来处理事件。信号和槽用于对象之间的通信。当指定事件发生，一个事件信号会被发射。槽可以被任何Python脚本调用。当和槽连接的信号被发射时，槽会被调用。
## 信号 & 槽
这个例子演示了PyQt5中的信号和槽的使用。
```
```python
#!/usr/bin/python3
```
```python
# -*- coding: utf-8 -*-
```
```python
"""
```
```python
ZetCode PyQt5 tutorial
```
```python
In this example, we connect a signal
```
```python
of a QSlider to a slot of a QLCDNumber.
```
```python
author: Jan Bodnar
```
```python
website: zetcode.com
```
```python
last edited: January 2015
```
```python
"""
```
```python
import
```
```python
sys
```
```python
from
```
```python
PyQt5.QtCore
```
```python
import
```
```python
Qt
```
```python
from
```
```python
PyQt5.QtWidgets
```
```python
import
```
```python
(QWidget, QLCDNumber, QSlider,
```
```python
```
```python
QVBoxLayout, QApplication)
```
```python
class
```
```python
Example(QWidget):
```
```python
```
```python
```
```python
def
```
```python
__init__(
```
```python
self
```
```python
):
```
```python
```
```python
super
```
```python
().__init__()
```
```python
```
```python
```
```python
self
```
```python
.initUI()
```
```python
```
```python
```
```python
```
```python
def
```
```python
initUI(
```
```python
self
```
```python
):
```
```python
```
```python
```
```python
lcd
```
```python
=
```
```python
QLCDNumber(
```
```python
self
```
```python
)
```
```python
```
```python
sld
```
```python
=
```
```python
QSlider(Qt.Horizontal,
```
```python
self
```
```python
)
```
```python
```
```python
vbox
```
```python
=
```
```python
QVBoxLayout()
```
```python
```
```python
vbox.addWidget(lcd)
```
```python
```
```python
vbox.addWidget(sld)
```
```python
```
```python
self
```
```python
.setLayout(vbox)
```
```python
```
```python
sld.valueChanged.connect(lcd.display)
```
```python
```
```python
```
```python
self
```
```python
.setGeometry(
```
```python
300
```
```python
,
```
```python
300
```
```python
,
```
```python
250
```
```python
,
```
```python
150
```
```python
)
```
```python
```
```python
self
```
```python
.setWindowTitle(
```
```python
'Signal & slot'
```
```python
)
```
```python
```
```python
self
```
```python
.show()
```
```python
```
```python
if
```
```python
__name__
```
```python
=
```
```python
=
```
```python
'__main__'
```
```python
:
```
```python
```
```python
```
```python
app
```
```python
=
```
```python
QApplication(sys.argv)
```
```python
```
```python
ex
```
```python
=
```
```python
Example()
```
```python
```
```python
sys.exit(app.exec_())
```
```
在我们的例子中，我们显示了一个QtGui.QLCDNumber和一个QtGui.QSlider类。我们拖动滑块条的把手，lcd数字会变化。
```
```python
sld.valueChanged.connect(lcd.display)
```
```
这里，我们将滑块条的valueChanged信号和lcd数字显示的display槽连接在一起。
发送者是一个发送了信号的对象。接受者是一个接受了信号的对象。槽是对信号做出反应的方法。
![Signal & slot](http://zetcode.com/img/gui/pyqt5/sigslot.png)Figure: Signal & slot
## 重写事件处理函数
PyQt中的事件处理通常通过重写事件处理函数来处理。
```
```python
#!/usr/bin/python3
```
```python
# -*- coding: utf-8 -*-
```
```python
"""
```
```python
ZetCode PyQt5 tutorial
```
```python
In this example, we reimplement an
```
```python
event handler.
```
```python
author: Jan Bodnar
```
```python
website: zetcode.com
```
```python
last edited: January 2015
```
```python
"""
```
```python
import
```
```python
sys
```
```python
from
```
```python
PyQt5.QtCore
```
```python
import
```
```python
Qt
```
```python
from
```
```python
PyQt5.QtWidgets
```
```python
import
```
```python
QWidget, QApplication
```
```python
class
```
```python
Example(QWidget):
```
```python
```
```python
```
```python
def
```
```python
__init__(
```
```python
self
```
```python
):
```
```python
```
```python
super
```
```python
().__init__()
```
```python
```
```python
```
```python
self
```
```python
.initUI()
```
```python
```
```python
```
```python
```
```python
def
```
```python
initUI(
```
```python
self
```
```python
):
```
```python
```
```python
```
```python
self
```
```python
.setGeometry(
```
```python
300
```
```python
,
```
```python
300
```
```python
,
```
```python
250
```
```python
,
```
```python
150
```
```python
)
```
```python
```
```python
self
```
```python
.setWindowTitle(
```
```python
'Event handler'
```
```python
)
```
```python
```
```python
self
```
```python
.show()
```
```python
```
```python
```
```python
```
```python
def
```
```python
keyPressEvent(
```
```python
self
```
```python
, e):
```
```python
```
```python
```
```python
if
```
```python
e.key()
```
```python
=
```
```python
=
```
```python
Qt.Key_Escape:
```
```python
```
```python
self
```
```python
.close()
```
```python
```
```python
```
```python
if
```
```python
__name__
```
```python
=
```
```python
=
```
```python
'__main__'
```
```python
:
```
```python
```
```python
```
```python
app
```
```python
=
```
```python
QApplication(sys.argv)
```
```python
```
```python
ex
```
```python
=
```
```python
Example()
```
```python
```
```python
sys.exit(app.exec_())
```
```
在我们的例子中，我们重写了keyPressEvent()事件处理函数。
```
```python
def
```
```python
keyPressEvent(
```
```python
self
```
```python
, e):
```
```python
```
```python
```
```python
if
```
```python
e.key()
```
```python
=
```
```python
=
```
```python
Qt.Key_Escape:
```
```python
```
```python
self
```
```python
.close()
```
```
如果我们点击了Esc按钮，应用将会被终止。
## 事件发送者
有时需要方便的知道哪一个组件是信号发送者。因此，PyQt5拥有了sender()方法来解决这个问题。
```
```python
#!/usr/bin/python3
```
```python
# -*- coding: utf-8 -*-
```
```python
"""
```
```python
ZetCode PyQt5 tutorial
```
```python
In this example, we determine the event sender
```
```python
object.
```
```python
author: Jan Bodnar
```
```python
website: zetcode.com
```
```python
last edited: January 2015
```
```python
"""
```
```python
import
```
```python
sys
```
```python
from
```
```python
PyQt5.QtWidgets
```
```python
import
```
```python
QMainWindow, QPushButton, QApplication
```
```python
class
```
```python
Example(QMainWindow):
```
```python
```
```python
```
```python
def
```
```python
__init__(
```
```python
self
```
```python
):
```
```python
```
```python
super
```
```python
().__init__()
```
```python
```
```python
```
```python
self
```
```python
.initUI()
```
```python
```
```python
```
```python
```
```python
def
```
```python
initUI(
```
```python
self
```
```python
):
```
```python
```
```python
btn1
```
```python
=
```
```python
QPushButton(
```
```python
"Button 1"
```
```python
,
```
```python
self
```
```python
)
```
```python
```
```python
btn1.move(
```
```python
30
```
```python
,
```
```python
50
```
```python
)
```
```python
```
```python
btn2
```
```python
=
```
```python
QPushButton(
```
```python
"Button 2"
```
```python
,
```
```python
self
```
```python
)
```
```python
```
```python
btn2.move(
```
```python
150
```
```python
,
```
```python
50
```
```python
)
```
```python
```
```python
```
```python
btn1.clicked.connect(
```
```python
self
```
```python
.buttonClicked)
```
```python
```
```python
btn2.clicked.connect(
```
```python
self
```
```python
.buttonClicked)
```
```python
```
```python
```
```python
self
```
```python
.statusBar()
```
```python
```
```python
```
```python
self
```
```python
.setGeometry(
```
```python
300
```
```python
,
```
```python
300
```
```python
,
```
```python
290
```
```python
,
```
```python
150
```
```python
)
```
```python
```
```python
self
```
```python
.setWindowTitle(
```
```python
'Event sender'
```
```python
)
```
```python
```
```python
self
```
```python
.show()
```
```python
```
```python
```
```python
```
```python
def
```
```python
buttonClicked(
```
```python
self
```
```python
):
```
```python
```
```python
```
```python
sender
```
```python
=
```
```python
self
```
```python
.sender()
```
```python
```
```python
self
```
```python
.statusBar().showMessage(sender.text()
```
```python
+
```
```python
' was pressed'
```
```python
)
```
```python
```
```python
```
```python
if
```
```python
__name__
```
```python
=
```
```python
=
```
```python
'__main__'
```
```python
:
```
```python
```
```python
```
```python
app
```
```python
=
```
```python
QApplication(sys.argv)
```
```python
```
```python
ex
```
```python
=
```
```python
Example()
```
```python
```
```python
sys.exit(app.exec_())
```
```
在我们的例子中，我们有两个按钮。在buttonClikced()方法中，我们调用sender()方法来判断哪一个按钮是我们按下的。
```
```python
btn1.clicked.connect(
```
```python
self
```
```python
.buttonClicked)
```
```python
btn2.clicked.connect(
```
```python
self
```
```python
.buttonClicked)
```
```
两个按钮都连接到了同一个槽中。
```
```python
def
```
```python
buttonClicked(
```
```python
self
```
```python
):
```
```python
```
```python
```
```python
sender
```
```python
=
```
```python
self
```
```python
.sender()
```
```python
```
```python
self
```
```python
.statusBar().showMessage(sender.text()
```
```python
+
```
```python
' was pressed'
```
```python
)
```
```
我们调用sender()方法判断发送信号的信号源是哪一个。然后在应用的状态栏上显示被按下的按钮的标签内容。
![Event sender](http://zetcode.com/img/gui/pyqt5/eventsender.png)Figure: Event sender
## 发送信号
从QObejct生成的对象可以发送信号。在下面的例子中我们将会看到怎样去发送自定义的信号。
```
```python
#!/usr/bin/python3
```
```python
# -*- coding: utf-8 -*-
```
```python
"""
```
```python
ZetCode PyQt5 tutorial
```
```python
In this example, we show how to emit a
```
```python
signal.
```
```python
author: Jan Bodnar
```
```python
website: zetcode.com
```
```python
last edited: January 2015
```
```python
"""
```
```python
import
```
```python
sys
```
```python
from
```
```python
PyQt5.QtCore
```
```python
import
```
```python
pyqtSignal, QObject
```
```python
from
```
```python
PyQt5.QtWidgets
```
```python
import
```
```python
QMainWindow, QApplication
```
```python
class
```
```python
Communicate(QObject):
```
```python
```
```python
```
```python
closeApp
```
```python
=
```
```python
pyqtSignal()
```
```python
```
```python
class
```
```python
Example(QMainWindow):
```
```python
```
```python
```
```python
def
```
```python
__init__(
```
```python
self
```
```python
):
```
```python
```
```python
super
```
```python
().__init__()
```
```python
```
```python
```
```python
self
```
```python
.initUI()
```
```python
```
```python
```
```python
```
```python
def
```
```python
initUI(
```
```python
self
```
```python
):
```
```python
```
```python
self
```
```python
.c
```
```python
=
```
```python
Communicate()
```
```python
```
```python
self
```
```python
.c.closeApp.connect(
```
```python
self
```
```python
.close)
```
```python
```
```python
```
```python
self
```
```python
.setGeometry(
```
```python
300
```
```python
,
```
```python
300
```
```python
,
```
```python
290
```
```python
,
```
```python
150
```
```python
)
```
```python
```
```python
self
```
```python
.setWindowTitle(
```
```python
'Emit signal'
```
```python
)
```
```python
```
```python
self
```
```python
.show()
```
```python
```
```python
```
```python
```
```python
def
```
```python
mousePressEvent(
```
```python
self
```
```python
, event):
```
```python
```
```python
```
```python
self
```
```python
.c.closeApp.emit()
```
```python
```
```python
```
```python
if
```
```python
__name__
```
```python
=
```
```python
=
```
```python
'__main__'
```
```python
:
```
```python
```
```python
```
```python
app
```
```python
=
```
```python
QApplication(sys.argv)
```
```python
```
```python
ex
```
```python
=
```
```python
Example()
```
```python
```
```python
sys.exit(app.exec_())
```
```
我们创建一个新的信号叫做closeApp。当触发鼠标点击事件时信号会被发射。信号连接到了QMainWindow的close()方法。
```
```python
class
```
```python
Communicate(QObject):
```
```python
```
```python
```
```python
closeApp
```
```python
=
```
```python
pyqtSignal()
```
```
信号使用了pyqtSignal()方法创建，并且成为外部类Communicate类的属性。
```
```python
self
```
```python
.c
```
```python
=
```
```python
Communicate()
```
```python
self
```
```python
.c.closeApp.connect(
```
```python
self
```
```python
.close)
```
```
把自定义的closeApp信号连接到QMainWindow的close()槽上。
```
```python
def
```
```python
mousePressEvent(
```
```python
self
```
```python
, event):
```
```python
```
```python
```
```python
self
```
```python
.c.closeApp.emit()
```
```
当我们在窗口上点击一下鼠标，closeApp信号会被发射。应用中断。
这部分的PyQt5教程中，我们概览了信号了槽机制。
