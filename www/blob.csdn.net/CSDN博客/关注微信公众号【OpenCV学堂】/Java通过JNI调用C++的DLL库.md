# Java通过JNI调用C++的DLL库 - 关注微信公众号【OpenCV学堂】 - CSDN博客





2016年09月28日 19:15:25[gloomyfish](https://me.csdn.net/jia20003)阅读数：5570








Java通过JNI实现调用C++程序

 好久没碰JNI这个东西了，刚工作的时候自己写过点东西，这么些年很少用到，最近一个项目又用到它了，因此总结一下给自己留个记号！省下下次再用到到处查资料。Java通过JNI实现调用C或者C++写的程序，实现对底层或者下位机的读写通讯，在桌面开发中是经常遇到的。这里通过一个演示程序，实现Java通过JNI实现C++方法调用。要完成Java JNI调用C++程序，需要如下几步：

**第一步：**创建一个Java Class文件，定义好本地方法接口API，其中本地方法前面要加上关键字native才可以。



```java
package com.gloomyfish.jnidemo;

public class HelloJNI {
	
	public native int helloJNI(String name);
}
```



**第二步：**是要编译对应的Java文件HelloJNI.java通过javah这个命令行即可，我这里写了个bat文件，这样可以指定JDK版本，只要把这个bat文件放到对应的eclipse编译好的build或者bin或者target目录下，然后双击运行即可，bat文件的内容如下：



```
set JAVA_HOME=D:\jdk1.6.0_16
set path=%JAVA_HOME%\bin;%path%
set classpath=.;%classpath%;%JAVA_HOME%\lib
javah com.gloomyfish.jnidemo.HelloJNI
```
运行之后会得到com_gloomyfish_jnidemo_HelloJNI.h文件，打开查看内容应该显示如下：




```cpp
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_gloomyfish_jnidemo_HelloJNI */

#ifndef _Included_com_gloomyfish_jnidemo_HelloJNI
#define _Included_com_gloomyfish_jnidemo_HelloJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_gloomyfish_jnidemo_HelloJNI
 * Method:    helloJNI
 * Signature: (Ljava/lang/String;)I
 */
JNIEXPORT jint JNICALL Java_com_gloomyfish_jnidemo_HelloJNI_helloJNI
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif
```
**第三步：**打开VS2015新建一个win32项目


![](https://img-blog.csdn.net/20160928190522944)



点击下一步选择应用程序类型中DLL，显示如下：
![](https://img-blog.csdn.net/20160928190558616)



然后点击【完成】,目录结构显示如下图双击打开jnitest.cpp,
![](https://img-blog.csdn.net/20160928190824873)


右键添加生成的JNI头文件
![](https://img-blog.csdn.net/20160928191010530)


此外还要添加JDK目录下面include里面的三个头文件jni.h与jawt_md.h与jni_md.h所在的目录。添加方法，右键【jnitest】选择->属性
![](https://img-blog.csdn.net/20160928191048858)


然后完成如下的C++代码

```cpp
// jnitest.cpp : 定义 DLL 应用程序的导出函数。
//

#include "stdafx.h"
#include "com_gloomyfish_jnidemo_HelloJNI.h"

JNIEXPORT jint JNICALL Java_com_gloomyfish_jnidemo_HelloJNI_helloJNI
(JNIEnv *env, jobject obj, jstring param) {
	// convert java string type to c++ char* type
	const char* name = env->GetStringUTFChars(param, 0);
	printf("%s %s", "Hello JNI, I am ", name);
	// release memory
	env->ReleaseStringUTFChars(param, name);
	// return 0;
	return 0;
}
```

生成解决方案之后得到jnitest.dll文件，把DLL文件copy到对应的JDK的bin目录下面和JRE的bin目录下，然后在Java程序中添加如下测试代码：
![](https://img-blog.csdn.net/20160928191206282?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)





