# 推荐系统系列之隐语义模型 - Spark高级玩法 - CSDN博客
2018年04月21日 00:00:00[Spark高级玩法](https://me.csdn.net/rlnLo2pNEfx9c)阅读数：771
**一、隐语义模型的基本思想**
隐语义模型是近年来推荐系统领域较为热门的话题，它主要是根据隐含特征将用户与物品联系起来。
现从简单例子出发介绍隐语义模型的基本思想。假设用户A喜欢《数据挖掘导论》，用户B喜欢《三个火枪手》，现在小编要对用户A和用户B推荐其他书籍。基于 UserCF(基于用户的协同过滤)，找到与他们偏好相似的用户，将相似用户偏好的书籍推荐给他们；基于ItemCF(基于物品的协同过滤)，找到与他们 当前偏好书籍相似的其他书籍，推荐给他们。其实还有一种思路，就是根据用户的当前偏好信息，得到用户的兴趣偏好，将该类兴趣对应的物品推荐给当前用户。比 如，用户A喜欢的《数据挖掘导论》属于计算机类的书籍，那我们可以将其他的计算机类书籍推荐给用户A；用户B喜欢的是文学类数据，可将《巴黎圣母院》等这 类文字作品推荐给用户B。这就是隐语义模型，依据“兴趣”这一隐含特征将用户与物品进行连接，需要说明的是此处的“兴趣”其实是对物品类型的一个分类而 已。
# **二、隐语义模型的数学理解**
我们从数学角度来理解隐语义模型。如下图所示，R矩阵是用户对物品的偏好信息（Rij表示的是user i对item j的兴趣度），P矩阵是用户对各物品类别的一个偏好信息（Pij表示的是user i对class j的兴趣度），Q矩阵是各物品所归属的的物品类别的信息（Qij表示的是item j在class i中的权重）。隐语义模型就是要将矩阵R分解为矩阵P和矩阵Q的乘积，即通过矩阵中的物品类别(class)将用户user和物品item联系起来。实际 上我们需要根据用户当前的物品偏好信息R进行计算，从而得到对应的矩阵P和矩阵Q。
![640?wx_fmt=png&wxfrom=5&wx_lazy=1](https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/adI0ApTVBFV2ayozbgpJzEibyrNXELmkP96TEkDibIaR8e0O0DHnxoAQImw0gPVjysn4YPoLtia3gKiaVtryxRLpicw/640?wx_fmt=png&wxfrom=5&wx_lazy=1)
# **三、隐语义模型所解决的问题**
从上面的陈述我们可以知道，要想实现隐语义模型，我们需解决以下问题：
- 
如何对物品进行分类，分成几类？
- 
如何确定用户对哪些物品类别有兴趣，兴趣程度如何？
- 
对于一个给定的类，选择这个类中的哪些物品进行推荐，如何确定物品在某个类别中的权重？
对于第一个问题，就是找对应的编辑人进行人工分类，但是人工分类会存在以下问题：
- 
当前的人工分类不能代表用户的意见：比如一本《数据挖掘导论》，从编辑人员的角度看会属于计算机类，但从用户来看，可能会归到数学类；
- 
难以把握分类的粒度：仍以《数据挖掘导论》为例，可分类得粗一点，属于计算机类，也可分得再细一点，属于计算机类别中的数据挖掘类；
- 
难以给一个物品多个类别：一本小说可归为文学类，或言情类等；
- 
难以给出多维度的分类：对物品的分类可从多个角度进行，比如一本书可从内容进行分类，也可从作者角度进行分类；
- 
难以确定一个物品在某一分类中的权重：一个物品可能属于多个类别，但是权重不同；
基于以上局限性，显然我们不能靠由个人的主观想法建立起来的分类标准对整个平台用户喜好进行标准化。隐语义模型是从用户的偏好数据出发进行个性推荐的，即基于用户的行为统计进行自动聚类，所以能解决以上提到的5个问题：
**隐语义模型是基于用户的行为数据进行自动聚类的，能反应用户对物品的分类意见；**
我们可以指定将物品聚类的类别数k，k越大，则粒度越细；
隐语义模型能计算出物品在各个类别中的权重，这是根据用户的行为数据统计的，不会只将其归到一类中；
隐语义模型得到的物品类别不是基于同一个维度的，维度是由用户的共同兴趣决定的；
# **四、隐语义模型的样本问题**
隐语义模型在显性反馈数据（也就是评分数据）上能解决评分预测问题并达到了很好的精度。不过推荐系统主要讨论的是隐性反馈数据集，这种数据集的特点 是只有正样本（用户喜欢什么物品），而没有负样本（用户对什么物品不感兴趣）。那么，在隐性反馈数据集上应用隐语义模型解决推荐的第一个关键问题就是如何 给每个用户生成负样本。我们发现对负样本采样时应该 遵循以下原则：
- 
对每个用户，要保证正负样本的平衡（数目相似）；
- 
每个用户采样负样本时，要选取那些很热门，而用户却没有行为的物品：一般认为，很热门而用户却没有行为更加代表用户对这个物品不感兴趣。因为对于冷门的物 品，用户可能是压根没在网站中发现这个物品，所以谈不上是否感兴趣；
**五、隐语义模型的推导思路**
隐语义模型是根据如下公式来计算用户U对物品I的兴趣度。
# ![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/adI0ApTVBFV2ayozbgpJzEibyrNXELmkPAJKVxL6LnuazibL4wmhrjsZRibAoxqCwgVaibfvJdUCVyzrFq7KNOpjZg/640?wx_fmt=png)
其中，隐语义模型会把物品分成K个类型，这个是我们根据经验和业务知识进行反复尝试决定的，p(u,k)表示用户u对于第k个分类的喜爱程度(1 < k <= K)，q(k, i)表示物品i属于第k个分类的权重(1 < k <= K)。
现在我们讨论下如何计算矩阵P和矩阵Q中的参数值。一般做法就是最优化损失函数来求参数。
损失函数如下所示：
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/adI0ApTVBFV2ayozbgpJzEibyrNXELmkPMonzjW1mETjULTuqImM4TJXyD4ibtYPs4ib7jLS3ibZAoloZ1S4xUcCDg/640?wx_fmt=png)
上式中的
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/adI0ApTVBFV2ayozbgpJzEibyrNXELmkPDH6f6hm2bVwAd4tjdz3IejVVOGqftC8oJmCLicAemBYsGBIiacMPMukg/640?wx_fmt=png)
是用来防止过拟合的正则化项，λ需要根据具体应用场景反复实验得到。损失函数的意义是用户u对物品i的真实喜爱程度与推算出来的喜爱程度的均方根误差，通俗 来说就是真实的喜爱程度与推算的喜爱程度的误差，要使模型最合理当然就是使这个误差达到最小值。公式中最后两项是惩罚因子，用来防止分类数取得过大而使误 差减少的不合理做法的发生，λ参数是一个常数，需要根据经验和业务知识进行反复尝试决定的。
损失函数的优化使用随机梯度下降算法：
1）对两组未知数求偏导数
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/adI0ApTVBFV2ayozbgpJzEibyrNXELmkPsficiczWmXiakZuVEX3W4dqcfcpWMafoE00Lg5ZOiab1r2iaYEPvX7r4Qwg/640?wx_fmt=png)
2）根据随机梯度下降法得到递推公式
![640?wx_fmt=png](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/adI0ApTVBFV2ayozbgpJzEibyrNXELmkP8N8vIqRL81RzYOx83Hyxf2ZkiakhI6iavaO7ZHZKYfYiaiaWMZ97KBb9Aw/640?wx_fmt=png)
其中α是在梯度下降的过程中的步长(也可以称作学习速率)，这个值不宜过大也不宜过小，过大会产生震荡而导致很难求得最小值，过小会造成计算速度下降，需 要经过试验得到最合适的值。最终会求得每个用户对于每个隐分类的喜爱程度矩阵P和每个物品与每个隐分类的匹配程度矩阵Q。在用户对物品的偏好信息矩阵R 中，通过迭代可以求得每个用户对每个物品的喜爱程度,选取喜爱程度最高而且用户没有反馈过的物品进行推荐。
在隐语义模型中，重要的参数有以下4个：
1）隐分类的个数F；
2）梯度下降过程中的步长(学习速率)α；
3）损失函数中的惩罚因子λ；
4）正反馈样本数和负反馈样本数的比例ratio；
这四项参数需要在试验过程中获得最合适的值.1）3）4）这三项需要根据推荐系统的准确率、召回率、覆盖率及流行度作为参考, 而2）步长α要参考模型的训练效率。
# **六、优缺点分析**
隐语义模型在实际使用中有一个困难，那就是它很难实现实时推荐。经典的隐语义模型每次训练时都需要扫描所有的用户行为记录，这样才能计算出用户对于 每个隐分类的喜爱程度矩阵P和每个物品与每个隐分类的匹配程度矩阵Q。而且隐语义模型的训练需要在用户行为记录上反复迭代才能获得比较好的性能，因此 LFM的每次训练都很耗时，一般在实际应用中只能每天训练一次，并且计算出所有用户的推荐结果。从而隐语义模型不能因为用户行为的变化实时地调整推荐结果 来满足用户最近的行为。
作者：萌新之机器学习
链接：https://www.jianshu.com/p/7b6bb28c1753
來源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
**推荐阅读：**
1，[【深度学习】⑤--自然语言处理的相关应用](http://mp.weixin.qq.com/s?__biz=MzA3MDY0NTMxOQ==&mid=2247484458&idx=1&sn=670207cb6fa965bb39ec18726ef03262&chksm=9f38e702a84f6e147fa59f71afcd42b72d874d84c1dac264bf02ddbe894c06597a8376d71450&scene=21#wechat_redirect)
2，[深度解析京东个性化推荐系统演进史](http://mp.weixin.qq.com/s?__biz=MzA3MDY0NTMxOQ==&mid=2247484387&idx=1&sn=2b545b5b424ec6ff4b41ed15a71b3f47&chksm=9f38e0cba84f69ddad3ac5511d0466c2885175512e55abbfdb19c90cde4c9e1b9f714755a17f&scene=21#wechat_redirect)
3，[基于Spark Mllib的文本分类](http://mp.weixin.qq.com/s?__biz=MzA3MDY0NTMxOQ==&mid=2247484354&idx=1&sn=7167fd21809c50ad4681e5ab2a6a6390&chksm=9f38e0eaa84f69fce1ec6cc094c74a3beac403a1dac0c50bdd2199ec4e9631d365af905c9068&scene=21#wechat_redirect)
4，[案例：Spark基于用户的协同过滤算法](http://mp.weixin.qq.com/s?__biz=MzA3MDY0NTMxOQ==&mid=2247484291&idx=1&sn=4599b4e31c2190e363aa379a92794ace&chksm=9f38e0aba84f69bd5b78b48e31b3f5b3792ec40e2d25fdbe6bc735f9c98ceb4584462b08e439&scene=21#wechat_redirect)
