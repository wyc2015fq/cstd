# 反向代理学习1：彻底了解与介绍 - starRTC免费im直播会议一对一视频 - CSDN博客
2017年06月30日 18:58:49[starRTC免费IM直播会议一对一视频](https://me.csdn.net/elesos)阅读数：206
**反向代理**是[代理服务器](https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E4%BC%BA%E6%9C%8D%E5%99%A8)的一种。
左边和右边的电脑在通讯时候，需要经过中间的电脑中转，而中间的那部电脑就是代理服务器。非直接的连接。
互联网中的请求发送给反向代理，反向代理把请求转发到内网中的服务器。
很多客户端都通过反向代理访问不同后端服务器上的资源，而不需要知道这些后端服务器的存在，而以为所有资源都来自于这个反向代理服务器。
反向代理的主要作用为：
- 加密和[SSL](https://zh.wikipedia.org/wiki/SSL)加速
- [负载均衡](https://zh.wikipedia.org/wiki/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1)
- 缓存静态内容
- 压缩
- 减速上传
- 安全
- 外网发布
- 突破[互联网封锁](https://zh.wikipedia.org/wiki/%E9%98%B2%E7%81%AB%E9%95%BF%E5%9F%8E)
**正向代理**
A同学在大众创业、万众创新的大时代背景下开启他的创业之路，目前他遇到的最大的一个问题就是启动资金，于是他决定去找马云爸爸借钱，可想而知，最后碰一鼻子灰回来了，情急之下，他想到一个办法，找关系开后门，经过一番消息打探，原来A同学的大学老师王老师是马云的同学，于是A同学找到王老师，托王老师帮忙去马云那借500万过来，当然最后事成了。不过马云并不知道这钱是A同学借的，马云是借给王老师的，最后由王老师转交给A同学。这里的王老师在这个过程中扮演了一个非常关键的角色，就是**代理**，也可以说是正向代理，王老师代替A同学办这件事，这个过程中，真正借钱的人是谁，马云是不知道的，这点非常关键。
我们常说的代理也就是只正向代理，正向代理的过程，它隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代替来请求，某些科学上网工具扮演的就是典型的正向代理角色。用浏览器访问[http://www.google.com](https://link.zhihu.com/?target=http%3A//www.google.com/)
 时，被残忍的block，于是你可以在国外搭建一台代理服务器，让代理帮我去请求google.com，代理把请求返回的相应结构再返回给我。
**反向代理**
大家都有过这样的经历，拨打10086客服电话，可能一个地区的10086客服有几个或者几十个，你永远都不需要关心在电话那头的是哪一个，叫什么，男的，还是女的，漂亮的还是帅气的，你都不关心，你关心的是你的问题能不能得到专业的解答，你只需要拨通了10086的总机号码，电话那头总会有人会回答你，只是有时慢有时快而已。那么这里的10086总机号码就是我们说的**反向代理**。客户不知道真正提供服务人的是谁。
反向代理隐藏了真实的服务端，当我们请求[w](https://link.zhihu.com/?target=http%3A//www.baidu.com/)ww.baidu.com
 的时候，就像拨打10086一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，[w](https://link.zhihu.com/?target=http%3A//www.baidu.com/)ww.baidu.com
 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。Nginx就是性能非常好的反向代理服务器，用来做负载均衡。
两者的区别在于代理的对象不一样：**正向代理**代理的对象是客户端，**反向代理**代理的对象是服务端
反向代理的典型用途是将防火墙后面的服务器提供给 Internet 用户访问，加强安全防护。反向代理还可以为后端的多台服务器提供负载均衡，或为后端较慢的服务器提供 缓冲 服务。

下面简单介绍 Nginx 作为反向代理服务器的方法。
场景描述：访问本地服务器上的 README.md 文件 [http://localhost/README.md](http://localhost/README.md)，本地服务器进行反向代理，从 [https://github.com/moonbingbing/openresty-best-practices/blob/master/README.md](https://github.com/moonbingbing/openresty-best-practices/blob/master/README.md) 获取页面内容。
nginx.conf 配置示例：
worker_processes1;pid
 logs/nginx.pid;error_log logs/error.log
 warn;events
 { worker_connections3000;}http
 { include mime.types;server_tokens
 off;## 下面配置反向代理的参数server
 {listen80;##
 1. 用户访问 http://ip:port，则反向代理到 https://github.comlocation/{proxy_pass
 https://github.com;proxy_redirectoff;proxy_set_header
 Host $host;proxy_set_header X-Real-IP
 $remote_addr;proxy_set_header X-Forwarded-For
 $proxy_add_x_forwarded_for; } ## 2.用户访问 http://ip:port/README.md，则反向代理到##
 https://github.com/.../README.mdlocation/README.md{proxy_set_header
 X-Real-IP $remote_addr;proxy_set_header
 X-Forwarded-For $proxy_add_x_forwarded_for;proxy_pass
 https://github.com/moonbingbing/openresty-best-practices/blob/master/README.md; } }}
输入localhost:8080/README.md即可
我们只需要配置一下 nginx.conf 文件，不用写任何 web 页面，就可以偷偷地从别的服务器上读取一个页面返回给用户。
(1) location
location 项对请求 URI 进行匹配，location 后面配置了匹配规则。例如上面的例子中，如果请求的 URI 是 localhost/，则会匹配 location
 / 这一项；如果请求的 URI 是 localhost/README.md，则会匹配 location /README.md 这项。
上面这个例子只是针对一个确定的 URI 做了反向代理，有的读者会有疑惑：如果对每个页面都进行这样的配置，那将会大量重复，能否做 批量 配置呢？此时需要配合使用 location 的正则匹配功能。具体实现方法可参考本书的 [URL
 匹配章节](https://github.com/moonbingbing/openresty-best-practices/blob/master/ngx/match_uri.md)。
(2) proxy_pass
proxy_pass 后面跟着一个 URL，用来将请求反向代理到 URL 参数指定的服务器上。例如我们上面例子中的 proxy_pass https://github.com，则将匹配的请求反向代理到 https://github.com。
(3) proxy_set_header
默认情况下，反向代理不会转发原始请求中的 Host 头部，如果需要转发，就需要加上这句：proxy_set_header Host $host;
除了上面提到的常用配置项，还有 proxy_redirect、proxy_set_body、proxy_limit_rate 等参数，具体用法可以到[Nginx
 官网](http://nginx.org/en/docs/http/ngx_http_proxy_module.html)查看。
nginx通过proxy_pass_http 配置代理站点，upstream实现负载均衡。

参考：
[https://www.zhihu.com/question/24723688](https://www.zhihu.com/question/24723688)
[https://www.zhihu.com/question/28951394](https://www.zhihu.com/question/28951394)章亦春是个什么样的人？
[http://www.oschina.net/question/28_60461](http://www.oschina.net/question/28_60461)OpenResty
 作者章亦春访谈实录
[https://github.com/moonbingbing/openresty-best-practices/blob/master/ngx/reverse_proxy.md](https://github.com/moonbingbing/openresty-best-practices/blob/master/ngx/reverse_proxy.md)
[https://zh.wikipedia.org/wiki/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86](https://zh.wikipedia.org/wiki/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86)
