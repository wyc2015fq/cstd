# Rsync 使用简单介绍之Shell - sxf_123456的博客 - CSDN博客
2017年04月24日 20:43:42[sxf_0123](https://me.csdn.net/sxf_123456)阅读数：309
Rsync 使用数据备份完成后该操作会自行终止。对于此，最好是在上述命令的基础上再添加一个“－a”选项（对于文件）和“－e”选 项，指定使用远程的shell程序，以保障安全。此时，远端的shell将使用一个加密协议，比如ssh，以便远程的shell可以使用-e ssh格式。
这 样，上述Rsync 使用命令就有了ssh加密协议的保护，具体形式如下：
rsync -a -e ssh localdir host:remotedir
如果想了解整个文件拷贝过程中所发生的一切，可以使用-v和-progress选项。-v选项表示打印出详细的操作过程。rsync默认的操作是单纯地 拷贝文件，不打印任何东西，尽量不打扰用户，只是简单而快速地完成任务。若只使用一次，-v选项将会报告所有被拷贝的文件，并在最后给 出总量。若使用两次-v选项，即在命令中使用-vv的话，rsync将不仅报告所有被拷贝的文件，还会报告那些勿需拷贝的文件，并在最后给出更 详细的信息。-progress选项的任务则主要是显示当前的拷贝进度，包括当前文件的大小，已完成的百分比，当前的传输速度，剩余时间估计，
 等。如果要写一条使用复选项模式和ssh隧道协议的命令，同时还要求有进度指示器的话，则可采用如下形式：
rsync -avv -e ssh -progress localdir host:remotedir
如果在拷贝文件的过程中，传输被中断，Rsync 使用的默认操作是撤消前操作，即从目标机上删除已拷贝的部分文件。如果想在下次拷贝时续传文件 ，不需要重新拷贝所有文件的话，可以使用-partial选项阻止rsync在传输中断时删除已拷贝的部分。如果希望同时使用-partial和-progress 选项的功能，则可以使用-P选项，这是rsync提供的一个更便捷的选项，可以代替上述两者。因此，如果想使用复选项模式的文件拷贝，并关闭 删除选项，同时要求有进度指示器和ssh隧道协议的保护，则可以采用如下命令：
rsync -avvP -e ssh localdir host:remotedir
如果希望系统按照预定的调度计划自行处理，可以简单地在后台守护进程任务中添加Rsync 使用命令。如：要添加rsync命令到/etc/crontab文件中 ，方法如下所示：
30 4 * * * user rsync -aP -e ssh localdir host:remotedir
后台作业任务中的前五项用于定义某个任务何时被调度，第六项告诉后台守护进程哪一个用户将运行该任务。可以把以下例子中的“user”字 符串替换为将运行该任务的实际的用户帐号。例中的后台守护程序被设置为每天早上4：30运行一次。前五个字段的含义依次为秒，小时，月份 中的某一天，年份中的某月和一周中的星期几。时间以0开头，所以秒为0-59，小时为 0-23。接下来的两个字段，月份中的某一天和年份中的 某月，为1-31和1-12。最后一个字段，星期中的某一天，为0-7，不管是0还是7都代表星期天。实际的后台守护进程配置文件都比这复杂，但这
 些是用rsync进行数据备份时创建后台程序的基本操作。如果还想了解更多的创建后台守护程序的相关信息，可以通过启动命令man cron，man crontab和man 5 crontab来获取。如果想集中管理数据备份后台守护进程，可以在备份服务器上创建如下的后台守护项：
30 4 * * * user rsync -aP -e ssh host:remotedir localdir
按照如上所述的方式设置后，Rsync 使用将从某个特定的远程主机上的目录(remotedir)中收集文件信息，并复制这些文件到你所指定的本地 (localdir)目录中。
