# 提取光猫_下挂设备_路由器性能 - sxf_123456的博客 - CSDN博客
2018年05月12日 11:08:00[sxf_0123](https://me.csdn.net/sxf_123456)阅读数：232标签：[mysql](https://so.csdn.net/so/search/s.do?q=mysql&t=blog)
个人分类：[mysql](https://blog.csdn.net/sxf_123456/article/category/7122238)
### **1、提取光猫信息**
#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Time    : 2018/5/11 0011 12:50
# @Author  : Sxf
# @QQ      : 
# @File    : distinct_loid.py
# @Software: PyCharm Community Edition
*"""**在终端使用mysql -u root -p test  -e 'SELECT loid FROM ana_customer WHERE localnet_id='101000';' > loid.txt**将表中数据导出到本地**"""*import pymysql
# read_path = "C:\\Users\\Administrator\\Desktop\\loid.txt"
# write_path = "C:\\Users\\Administrator\\Desktop\\new_customer.txt"
read_path = "/home/data/mysql/test/data/loid.txt"
write_path = "/home/data/mysql/test/data/new_customer.txt"
read_file = open(read_path, "r")
write_file = open(write_path, "w")
connect = pymysql.connect(host="", port=3306, user="", passwd="", db="test", charset="utf8")
for line in read_file:
    line_ = line.strip()
    sql = """select loid,factory_name,model_name,wifi_count,port_count,hard_version from ana_customer where loid='%s'"""%(line_)
    with connect.cursor() as cursor:
        cursor.execute(sql)
        result = cursor.fetchone()
        # anid = result[0]
try:
            loid = result[0]
            factory = str(result[1]).replace(',','')
            model = result[2]
            wifi_count = result[3]
            if wifi_count == 0:
                wifi = "否"
else:
                wifi = "是"
port = result[4]
            if port == 2:
                _port = "两口"
elif port == 4:
                _port = "四口"
else:
                _port = "None"
hard_ver = result[5]
            if hard_ver is None:
                hard_ver = "None"
line_str = loid+","+factory+","+model+","+wifi+","+_port+","+hard_ver+"\n"
write_file.write(line_str)
        except:
            pass
read_file.close()
write_file.close()
### 2、按照loid提取下挂设备、若是路由器分析路由器性能
#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Time    : 2018/5/11 0011 20:33
# @Author  : Sxf
# @QQ      : 
# @File    : get_dev.py
# @Software: PyCharm Community Edition
import pymysql
import  re
# read_path = "F:\\data_mac\\data\\mysql\\test.txt"
# write_path = "F:\\data_mac\\data\\mysql\\data.txt"
read_path = "/home/data/mysql/test/data/new_customer.txt"
write_path = "/home/data/mysql/test/data/data.txt"
read_file = open(read_path, "r", encoding='utf-8')
write_file = open(write_path, "w")
connect = pymysql.connect(host="", port=3306, user="", passwd="", db="test", charset="utf8")
type_dict = {
    "-1":"未知",
"0":"光猫",
"1":"机顶盒",
"2":"路由器",
"3":"手机",
"4":"平板",
"5":"电脑",
"6":"中继器",
"7":"交换机",
"8":"其他"
}
# loid,factory_name,model_name,wifi_count,port_count,hard_version
line_title = 'loid'+','+'光猫厂商'+','+'光猫型号'+','+'是否使用光猫WiFi'+','+'光猫类型（四口或两口）'+','+'光猫硬件版本'+','+'LAN口下挂设备MAC'+','+'下挂设备类型'+','+'下挂设备厂家'+','+'下挂设备型号'+','+'是否使用LAN口'+','+'千兆网口位置'+','+'带宽支持200M'+','+'路由器性能'+','+'是否暑促路由器'+'\n'
write_file.write(line_title)
for line in read_file:
    line_ = line.strip()
    line_cus = line_.split(',')
    loid = line_cus[0]
    hard_ver = line_cus[5]
    model_hgw = line_cus[2]
    sql = """select mac,type,factory_name,model_name,port from ana_device where loid='%s'"""%(loid)
    with connect.cursor() as cursor:
        cursor.execute(sql)
        result_ = cursor.fetchall()
        for result in result_:
            try:
                mac = result[0]
                type_ = result[1]
                # lyq_model = result[3]
if result[1] is None:
                    type = -1
else:
                    type = type_dict.get(str(type_))
                # factory = result[2]
if result[2] is None:
                    factory = "None"
else:
                    factory = result[2]
                # model = result[3]
if result[3] is None:
                    lyq_model = "None"
else:
                    lyq_model = result[3]
                port = result[4]
                if port == 1 or port == 4:
                    _port = "是"
else:
                    _port = "否"
if model_hgw == "None":
                    mport = "None"
band = "None"
else:
                    sql_hgw_class = """SELECT mbport,band_width FROM ana_hgw_class WHERE model_name='%s';"""%(model_hgw)
                    cursor.execute(sql_hgw_class)
                    hgw_result = cursor.fetchone()
                    if hgw_result is None:
                        mport = "None"
band = "None"
else:
                    # mbport =
if hgw_result[0] is None:
                            print(hgw_result[0])
                            mport = "None"
else:
                            mport = hgw_result[0]
                        # band_width =
if hgw_result[1] is None:
                            band = "否"
elif hgw_result[1] >= 200:
                            band = "是"
else:
                            band = "None"
if str(type_) == "2":
                    sql_router = """SELECT grade FROM ana_router_proformance WHERE model_name='%s';"""%(lyq_model)
                    cursor.execute(sql_router)
                    route_res = cursor.fetchone()
                    if route_res is None:
                        grade_ = 'None'
cu_ = "None"
else:
                        if route_res[0] is None:
                            grade_ = 'None'
elif str(route_res[0]) == "2":
                            grade_ = "高"
elif str(route_res[0]) == "1":
                            grade_ = "中"
elif str(route_res[0]) == "0":
                            grade_ = "低"
else:
                            grade_ = "None"
lower_model = str(lyq_model).lower()
                        list_type = ["ws831","ws851","r3g","r3l","e8820","wr886n","wdr6300","ac6","ac9","hm200w","hs200w"]
                        for model_type in list_type:
                            if re.search(model_type.strip(),lower_model):
                                cu_ = "是"
break
                            else:
                                cu_ = "否"
else:
                    grade_ = 'None'
cu_ = "None"
line_str = line_ + "," + mac + "," + str(type) + "," + factory + "," + lyq_model + "," + _port+","+str(mport)+","+ band+","+grade_+","+cu_+"\n"
write_file.write(line_str)
            except:
                raise  Exception
read_file.close()
write_file.close()
