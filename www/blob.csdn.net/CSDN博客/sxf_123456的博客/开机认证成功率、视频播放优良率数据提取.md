# 开机认证成功率、视频播放优良率数据提取 - sxf_123456的博客 - CSDN博客
2018年03月09日 20:43:10[sxf_0123](https://me.csdn.net/sxf_123456)阅读数：78标签：[数据提取](https://so.csdn.net/so/search/s.do?q=数据提取&t=blog)
个人分类：[数据提取](https://blog.csdn.net/sxf_123456/article/category/7495638)
**开机认证成功率**
**iptv_authenticate_20180306.txt**
7988360||7986841
**iptv_authenticate_20180307.txt**
8100206||8098685
**iptv_authenticate_20180308.txt**
7956244||7951808
sh代码：
#!/bin/bash
#开机认证成功率
#每个文件一行数据
#方法:第三列/第一列
str="20180308 20180307 20180306"
array=($str) #将字符串存入数组
length=${#array[@]} #求数组长度
#echo $length
pre_str="iptv_authenticate_" #文件名前缀
las_str=".txt"  #文件名后缀
for ((i=0; i<$length; i++))
do
    file_name="${pre_str}""${array[$i]}""${las_str}" #组合文件名
    echo ${file_name}
    num_1=`cat ${file_name} | awk -F '|' '{print $1}'` #取文件名为${file_name}的第一列
    num_2=`cat ${file_name} | awk -F '|' '{print $3}'` #取文件名为${file_name}的第三列
    #echo ${num_1}
    #echo ${num_2}
    succ_rate=`echo "scale=15;${num_2}/${num_1}" | bc` #取num_2除以num_1的结果，小数点后15位
    ou="0"
    succ="${ou}""${succ_rate}" #计算出的结果前加0
    echo ${succ}
done
**视频播放优良率**
**iptv_qualified_20180306.txt**
SC_DZ||8414439||136106||1||1
**iptv_qualified_20180307.txt**
SC_CD||57121789||988564||1||1
**iptv_qualified_20180308.txt**
SC_CD||49642507||867940||1||1
sh代码：
#!/bin/bash
#各地区视频质量优良率
#方法:1-(第五列/第三列)
str="20180308 20180307 20180306"
array=($str) #将字符串存放数组中
length=${#array[@]} #求数组长度
#echo $length
pre_str="iptv_qualified_" #文件名前缀
las_str=".txt"     #文件后缀
for ((i=0; i<$length; i++)) #遍历文件中含有的日期
do
    file_name="${pre_str}""${array[$i]}""${las_str}" #组合文件名
    echo ${file_name}
    line=`cat ${file_name} | wc -l` #统计文件的行号
    echo ${line}
    for ((j=1; j<=$line; j++)) #遍历文件每行内容
    do 
area=`sed -n "${j},1p" ${file_name} | awk -F '|' '{print $1}'` #取文件名为${file_name}的某行第一列的内容
        num_1=`sed -n "${j},1p" ${file_name} | awk -F '|' '{print $3}'` #取文件名为${file_name}的某行第三列的内容
        num_2=`sed -n "${j},1p" ${file_name} | awk -F '|' '{print $5}'` #取文件名为${file_name}的某行第五列内容
        #echo ${area}
        #echo ${num_1}
        #echo ${num_2}
        succ_rate=`echo "scale=15;${num_2}/${num_1}" | bc -l`  #取第五列除以第三列的结果，小数点后15位
        ou="0"
        succ="${ou}""${succ_rate}"
        value="${area}"",""1"",""${succ}"  #SC_GZ,1,0.019364153870223的格式输出
        echo ${value}
    done
done
**全省视频播放优良率**
**iptv_qualified_20180306.txt**
SC_CD||57121789||988564||1||1
SC_DZ||8414439||136106||1||1
#!/bin/bash
#全省视频质量优良率
#方法:1-sum(各地区视频差率)/sum(各地区视频)
str="20180308 20180307 20180306"
array=($str) #将字符串存入数组
length=${#array[@]} #数组长度
pre_str="iptv_qualified_" #文件前缀名
las_str=".txt"     #文件后缀名
for ((i=0; i<$length; i++))
do
    file_name="${pre_str}""${array[$i]}""${las_str}" #组合文件名
    echo ${file_name}
    line=`cat ${file_name} | wc -l` #统计文件内容行数
    echo ${line}
    sum_1=0
    sum_2=0
    for ((j=1; j<=$line; j++))
    do
        num_1=`sed -n "${j},1p" ${file_name} | awk -F '|' '{print $3}'` #取某行{j}某列{$3}的值
        num_2=`sed -n "${j},1p" ${file_name} | awk -F '|' '{print $5}'` #取某行{j}某列{$5}的值
        let sum_1=${num_1}+sum_1  #某列值求和
        let sum_2=${num_2}+sum_2
    done 
        #echo $sum_1
        #echo $sum_2 
        succ_rate=`echo "scale=15;${sum_2}/${sum_1}" | bc -l` #两个值相除，保留小数点后15位小数
        ou="0"
        succ="${ou}""${succ_rate}"
        value="1"",""${succ}"
        echo ${value}
done
