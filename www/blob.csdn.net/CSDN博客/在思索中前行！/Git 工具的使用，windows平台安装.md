# Git 工具的使用，windows平台安装 - 在思索中前行！ - CSDN博客





2014年10月19日 19:53:25[_Tham](https://me.csdn.net/txl16211)阅读数：1431








## 先谈谈版本控制的一些事



如果你严肃对待编程，就必定会使用“版本控制系统”（Version Control System）。


随着信息科技的发展，软件开发已不是小手工作坊，软件的规模与复杂度已经不再适合一个人单打独斗地开发了，团队协作变得相当重要。如果没有VCS，团队开发就会变得乱七八糟。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_00.jpg)

#### 原始的版本控制

[版本控制](http://www.nowamagic.net/academy/tag/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6)是什么不用多说了，它就是记录我们对文件、目录或工程等的修改历史，方便查看更改历史，备份以便恢复以前的版本，多人协作。


最原始的版本控制是纯手工的版本控制：修改文件，保存文件副本。有时候偷懒省事，保存副本时命名比较随意，时间长了就不知道哪个是新的，哪个是老的了，即使知道新旧，可能也不知道每个版本是什么内容，相对上一版作了什么修改了，当几个版本过去后，很可能就是下面的样子了：

![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_01.jpg)

#### 本地版本控制


手工管理比较麻烦且混乱，所以出现了本地版本控制系统，记录文件每次的更新，可以对每个版本做一个快照，或是记录补丁文件。比如RCS。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_02.png)

#### 集中版本控制


但是本地版本控制系统偏向于个人使用，或者多个使用的人必须要使用相同的设备，如果需要多人协作就不好办了，于是，集中化的版本控制系统（ Centralized Version Control Systems，简称 CVCS ）应运而生，比如Subversion，Perforce。


在CVCS中，所有的版本数据都保存在服务器上，一起工作的人从服务器上同步更新或上传自己的修改。


![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_03.png)


但是，所有的版本数据都存在服务器上，用户的本地设备就只有自己以前所同步的版本，如果不连网的话，用户就看不到历史版本，也无法切换版本验证问题，或在不同分支工作。


而且，所有数据都保存在单一的服务器上，有很大的风险这个服务器会损坏，这样就会丢失所有的数据，当然可以定期备份。

#### 分布式版本控制


针对CVCS的以上缺点，出现了分布式版本控制系统( Distributed Version Control System,简称 DVCS )，如GIT，Mercurial。


DVCS不是复制指定版本的快照，而是把所有的版本信息仓库全部同步到本地，这样就可以在本地查看所有版本历史，可以离线在本地提交，只需在连网时push到相应的服务器或其他用户那里。由于每个用户那里保存的都是所有的版本数据，所以，只要有一个用户的设备没有问题就可以恢复所有的数据。


当然，这增加了本地存储空间的占用。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_04.png)

#### Git是什么


Git是一种近来很流行的分布式版本控制系统（或称源代码管理系统），和传统的SVN、TFVC（TFS Version Control）这样的系统而言，最大的特点就是分布式。所谓分布式是相对于SVN这种集中式而言的，SVN或者TFVC都需要有一个中心服务器保存着源代码，所有开发者都使用客户端和这个服务器交互。

[Git](http://www.nowamagic.net/academy/tag/Git)是Linux内核之父为了管理繁杂的Linux内核而开发的开源系统，随着GitHub这样的开源代码托管系统大热，而为很多人知晓使用。


Git的强大潜力并非真正在于分布式，而是在于其对源代码存储的机制（使用快照），由于这样的机制存在，你可以大量频繁的使用分支来工作，通过分支来隔离功能开发的过程。如果要在TFVC中频繁建立分支是不可想象的。比如我的一个以前的解决方案文件夹大约600M，如果频繁使用分支，那么一方面我的磁盘会出现大量重复的文件占用大量的磁盘空间，另外一方面在VS的历史打开记录中会有很多名称一样的解决方案，你还需要去辨别其所在路径从而确定是否打开了正确的分支代码。


关于版本控制，就谈到这。

## Git诞生背后的一些故事



同生活中的许多伟大事件一样，Git 诞生于一个极富纷争大举创新的年代。Linux 内核开源项目有着为数众广的参与者。绝大多数的 Linux 内核维护工作都花在了提交补丁和保存归档的繁琐事务上（1991－2002年间）。


很多人都知道，Linus在1991年创建了开源的Linux，从此，Linux系统不断发展，已经成为最大的服务器系统软件了。

[Linus](http://www.nowamagic.net/academy/tag/Linus)虽然创建了Linux，但Linux的壮大是靠全世界热心的志愿者参与的，这么多人在世界各地为Linux编写代码，那Linux的代码是如何管理的呢？


事实是，在2002年以前，世界各地的志愿者把源代码文件通过diff的方式发给Linus，然后由Linus本人通过手工方式合并代码！


你也许会想，为什么Linus不把Linux代码放到版本控制系统里呢？不是有CVS、SVN这些免费的版本控制系统吗？因为Linus坚定地反对CVS和SVN，这些集中式的版本控制系统不但速度慢，而且必须联网才能使用。有一些商用的版本控制系统，虽然比CVS、SVN好用，但那是付费的，和Linux的开源精神不符。


不过，到了2002年，Linux系统已经发展了十年了，代码库之大让Linus很难继续通过手工方式管理了，社区的弟兄们也对这种方式表达了强烈不满，于是Linus选择了一个商业的版本控制系统BitKeeper，BitKeeper的东家BitMover公司出于人道主义精神，授权Linux社区免费使用这个版本控制系统。


安定团结的大好局面在2005年就被打破了，原因是Linux社区牛人聚集，不免沾染了一些梁山好汉的江湖习气。开发Samba的Andrew试图破解BitKeeper的协议（这么干的其实也不只他一个），被BitMover公司发现了（监控工作做得不错！），于是BitMover公司怒了，要收回Linux社区的免费使用权。


Linus可以向BitMover公司道个歉，保证以后严格管教弟兄们，嗯，这是不可能的。


开发 BitKeeper 的商业公司同 Linux 内核开源社区的合作关系结束，他们收回了免费使用 BitKeeper 的权力。这就迫使 Linux 开源社区（特别是 Linux 的缔造者 Linus Torvalds ）不得不吸取教训，只有开发一套属于自己的版本控制系统才不至于重蹈覆辙。他们对新的系统制订了若干目标：
- 
速度
- 
简单的设计
- 
对非线性开发模式的强力支持（允许上千个并行开发的分支）
- 
完全分布式
- 
有能力高效管理类似 Linux 内核一样的超大规模项目（速度和数据量）


最后实际情况是这样的：Linus花了两周时间自己用C写了一个分布式版本控制系统，这就是Git！一个月之内，Linux系统的源码已经由Git管理了！牛是怎么定义的呢？大家可以感受一下。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_05.png)

[Git](http://www.nowamagic.net/academy/tag/Git)迅速成为最流行的分布式版本控制系统，尤其是2008年，GitHub网站上线了，它为开源项目免费提供Git存储，无数开源项目开始迁移至GitHub，包括jQuery，PHP，Ruby等等。


历史就是这么偶然，如果不是当年BitMover公司威胁Linux社区，可能现在我们就没有免费而超级好用的Git了。

## 版本控制：集中式VS分布式



前面提到，Linus一直痛恨CVS及SVN这些集中式的版本控制系统，为什么呢？Git是分布式版本控制系统，那么集中式和分布式版本控制系统又有什么区别呢？


先说[集中式](http://www.nowamagic.net/academy/tag/%E9%9B%86%E4%B8%AD%E5%BC%8F)版本控制系统，版本库是集中存放在中央服务器的，而干活的时候，用的都是自己的电脑，所以要先从中央服务器取得最新的版本，然后开始干活，干完活了，再把自己的活推送给中央服务器。中央服务器就好比是一个图书馆，你要改一本书，必须先从图书馆借出来，然后回到家自己改，改完了，再放回图书馆。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_06.jpg)


集中式版本控制系统最大的毛病就是必须联网才能工作，如果在局域网内还好，带宽够大，速度够快，可如果在互联网上，遇到网速慢的话，可能提交一个10M的文件就需要5分钟，这还不得把人给憋死啊。


那[分布式](http://www.nowamagic.net/academy/tag/%E5%88%86%E5%B8%83%E5%BC%8F)版本控制系统与集中式版本控制系统有何不同呢？首先，分布式版本控制系统根本没有“中央服务器”，每个人的电脑上都是一个完整的版本库，这样，你工作的时候，就不需要联网了，因为版本库就在你自己的电脑上。既然每个人电脑上都有一个完整的版本库，那多个人如何协作呢？比方说你在自己电脑上改了文件A，你的同事也在他的电脑上改了文件A，这时，你们俩之间只需把各自的修改推送给对方，就可以互相看到对方的修改了。


和集中式版本控制系统相比，分布式版本控制系统的安全性要高很多，因为每个人电脑里都有完整的版本库，某一个人的电脑坏掉了不要紧，随便从其他人那里复制一个就可以了。而集中式版本控制系统的中央服务器要是出了问题，所有人都没法干活了。


在实际使用分布式版本控制系统的时候，其实很少在两人之间的电脑上推送版本库的修改，因为可能你们俩不在一个局域网内，两台电脑互相访问不了，也可能今天你的同事病了，他的电脑压根没有开机。因此，分布式版本控制系统通常也有一台充当“中央服务器”的电脑，但这个服务器的作用仅仅是用来方便“交换”大家的修改，没有它大家也一样干活，只是交换修改不方便而已。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_03_07.jpg)


当然，Git的优势不单是不必联网这么简单，后面我们还会看到Git极其强大的分支管理，把SVN等远远抛在了后面。


CVS作为最早的开源而且免费的集中式版本控制系统，直到现在还有不少人在用。由于CVS自身设计的问题，会造成提交文件不完整，版本库莫名其妙损坏的情况。同样是开源而且免费的SVN修正了CVS的一些稳定性问题，是目前用得最多的集中式版本库控制系统。


除了免费的外，还有收费的集中式版本控制系统，比如IBM的ClearCase（以前是Rational公司的，被IBM收购了），特点是安装比Windows还大，运行比蜗牛还慢，能用ClearCase的一般是世界500强，他们有个共同的特点是财大气粗，或者人傻钱多。


微软自己也有一个集中式版本控制系统叫VSS，集成在Visual Studio中。由于其反人类的设计，连微软自己都不好意思用了。


分布式版本控制系统除了Git以及促使Git诞生的BitKeeper外，还有类似Git的Mercurial和Bazaar等。这些分布式版本控制系统各有特点，但最快、最简单也最流行的依然是Git！

## Git的思想和基本工作原理



那么，简单地说，Git 究竟是怎样的一个系统呢？请注意，接下来的内容非常重要，若是理解了 [Git](http://www.nowamagic.net/academy/tag/Git) 的思想和基本工作原理，用起来就会知其所以然，游刃有余。


在开始学习 Git 的时候，请不要尝试把各种概念和其他版本控制系统（诸如 Subversion 和 Perforce 等）相比拟，否则容易混淆每个操作的实际意义。Git 在保存和处理各种信息的时候，虽然操作起来的命令形式非常相近，但它与其他版本控制系统的做法颇为不同。理解这些差异将有助于你准确地使用 Git 提供的各种工具。

#### 直接记录快照，而非差异比较


Git 和其他版本控制系统的主要差别在于，Git 只关心文件数据的整体是否发生变化，而大多数其他系统则只关心文件内容的具体差异。这类系统（CVS，Subversion，Perforce，Bazaar 等等）每次记录有哪些文件作了更新，以及都更新了哪些行的什么内容：

![](http://www.nowamagic.net/librarys/images/201401/2014_01_06_01.png)


其他系统在每个版本中记录着各个文件的具体差异


Git 并不保存这些前后变化的差异数据。实际上，Git 更像是把变化的文件作快照后，记录在一个微型的文件系统中。每次提交更新时，它会纵览一遍所有文件的指纹信息并对文件作一快照，然后保存一个指向这次快照的索引。为提高性能，若文件没有变化，Git 不会再次保存，而只对上次保存的快照作一链接。Git 的工作方式就如下图所示。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_06_02.png)


Git 保存每次更新时的文件快照


这是 Git 同其他系统的重要区别。它完全颠覆了传统版本控制的套路，并对各个环节的实现方式作了新的设计。Git 更像是个小型的文件系统，但它同时还提供了许多以此为基础的超强工具，而不只是一个简单的 VCS。稍后会讨论 Git 分支管理的时候，我们会再看看这样的设计究竟会带来哪些好处。

#### 近乎所有操作都是本地执行


在 Git 中的绝大多数操作都只需要访问本地文件和资源，不用连网。但如果用 CVCS 的话，差不多所有操作都需要连接网络。因为 Git 在本地磁盘上就保存着所有当前项目的历史更新，所以处理起来速度飞快。


举个例子，如果要浏览项目的历史更新摘要，Git 不用跑到外面的服务器上去取数据回来，而直接从本地数据库读取后展示给你看。所以任何时候你都可以马上翻阅，无需等待。如果想要看当前版本的文件和一个月前的版本之间有何差异，Git 会取出一个月前的快照和当前文件作一次差异运算，而不用请求远程服务器来做这件事，或是把老版本的文件拉到本地来作比较。


用 CVCS 的话，没有网络或者断开 VPN 你就无法做任何事情。但用 Git 的话，就算你在飞机或者火车上，都可以非常愉快地频繁提交更新，等到了有网络的时候再上传到远程仓库。同样，在回家的路上，不用连接 VPN 你也可以继续工作。换作其他版本控制系统，这么做几乎不可能，抑或非常麻烦。比如 Perforce，如果不连到服务器，几乎什么都做不了（默认无法发出命令 p4 edit file 开始编辑文件，因为 Perforce 需要联网通知系统声明该文件正在被谁修订。但实际上手工修改文件权限可以绕过这个限制，只是完成后还是无法提交更新。）；如果是
 Subversion 或 CVS，虽然可以编辑文件，但无法提交更新，因为数据库在网络上。看上去好像这些都不是什么大问题，但实际体验过之后，你就会惊喜地发现，这其实是会带来很大不同的。

#### 时刻保持数据完整性


在保存到 Git 之前，所有数据都要进行内容的校验和（checksum）计算，并将此结果作为数据的唯一标识和索引。换句话说，不可能在你修改了文件或目录之后，Git 一无所知。这项特性作为 Git 的设计哲学，建在整体架构的最底层。所以如果文件在传输时变得不完整，或者磁盘损坏导致文件数据缺失，Git 都能立即察觉。


Git 使用 SHA-1 算法计算数据的校验和，通过对文件的内容或目录的结构计算出一个 SHA-1 哈希值，作为指纹字符串。该字串由 40 个十六进制字符（0-9 及 a-f）组成，看起来就像是：
24b9da6552252987aa493b52f8696cd6d3b00373


Git 的工作完全依赖于这类指纹字串，所以你会经常看到这样的哈希值。实际上，所有保存在 Git 数据库中的东西都是用此哈希值来作索引的，而不是靠文件名。

#### 多数操作仅添加数据


常用的 Git 操作大多仅仅是把数据添加到数据库。因为任何一种不可逆的操作，比如删除数据，都会使回退或重现历史版本变得困难重重。在别的 VCS 中，若还未提交更新，就有可能丢失或者混淆一些修改的内容，但在 Git 里，一旦提交快照之后就完全不用担心丢失数据，特别是养成定期推送到其他仓库的习惯的话。


这种高可靠性令我们的开发工作安心不少，尽管去做各种试验性的尝试好了，再怎样也不会弄丢数据。至于 Git 内部究竟是如何保存和恢复数据的，我们会在后面讨论 Git 内部原理时再作详述。

#### 文件的三种状态


好，现在请注意，接下来要讲的概念非常重要。对于任何一个文件，在 Git 内都只有三种状态：已提交（committed），已修改（modified）和已暂存（staged）。已提交表示该文件已经被安全地保存在本地数据库中了；已修改表示修改了某个文件，但还没有提交保存；已暂存表示把已修改的文件放在下次提交时要保存的清单中。


由此我们看到 Git 管理项目时，文件流转的三个工作区域：Git 的工作目录，暂存区域，以及本地仓库。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_06_03.png)


工作目录，暂存区域，以及本地仓库


每个项目都有一个 Git 目录（如果 git clone 出来的话，就是其中 .git 的目录；如果 git clone --bare 的话，新建的目录本身就是 Git 目录。），它是 Git 用来保存元数据和对象数据库的地方。该目录非常重要，每次克隆镜像仓库的时候，实际拷贝的就是这个目录里面的数据。


从项目中取出某个版本的所有文件和目录，用以开始后续工作的叫做[工作目录](http://www.nowamagic.net/academy/tag/%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95)。这些文件实际上都是从
 Git 目录中的压缩对象数据库中提取出来的，接下来就可以在工作目录中对这些文件进行编辑。


所谓的暂存区域只不过是个简单的文件，一般都放在 Git 目录中。有时候人们会把这个文件叫做索引文件，不过标准说法还是叫暂存区域。


基本的 Git 工作流程如下：
- 
在工作目录中修改某些文件。
- 
对修改后的文件进行快照，然后保存到暂存区域。
- 
提交更新，将保存在暂存区域的文件快照永久转储到 Git 目录中。


所以，我们可以从文件所处的位置来判断状态：如果是 Git 目录中保存着的特定版本文件，就属于已提交状态；如果作了修改并已放入暂存区域，就属于已暂存状态；如果自上次取出后，作了修改但还没有放到暂存区域，就是已修改状态。

## Git在Windows下的安装



因为目前我在用 Windows，这里就只简单介绍一下 Git 在 [Windows](http://www.nowamagic.net/academy/tag/Windows) 下的安装。其实也不用怎么介绍了，就装个东西而已……


去 [http://git-scm.com/](http://git-scm.com/) 下载 Windows 的安装包，直接安装就行。


Windows下要使用很多Linux/Unix的工具时，需要Cygwin这样的模拟环境，Git也一样。Cygwin的安装和配置都比较复杂，就不建议你折腾了。不过，有高人已经把模拟环境和Git都打包好了，名叫msysgit，只需要下载一个单独的exe安装程序，其他什么也不用装，绝对好用。


msysgit是Windows版的[Git](http://www.nowamagic.net/academy/tag/Git)，从 [http://msysgit.github.io/](http://msysgit.github.io/) 下载，然后按默认选项安装即可。


安装完成后，在开始菜单里找到“Git”->“Git Bash”，蹦出一个类似命令行窗口的东西，就说明Git安装成功了。

![](http://www.nowamagic.net/librarys/images/201401/2014_01_06_04.png)


需要进一步设置，下面直接贴执行（Git Bash）吧：



[view
 source](http://www.nowamagic.net/academy/detail/48160213#viewSource)

[print](http://www.nowamagic.net/academy/detail/48160213#printSource)[?](http://www.nowamagic.net/academy/detail/48160213#about)



|`01`|```Welcome to Git (version 1.8.5.2-preview20131230)```|
|----|----|


|`02`||
|----|----|


|`03`|`Run ````'git help git'``````to display the help index.```|
|----|----|


|`04`|`Run ````'git help <command>'``````to display help````for````specific commands.```|
|----|----|


|`05`||
|----|----|


|`06`|```nowamagic@nowamagic-PC /e/PHPProject```|
|----|----|


|`07`|```$ ssh-keygen -t rsa -C````"nowamagic@163.com"`|
|----|----|


|`08`|`Generating ``public``/``private````rsa key pair.```|
|----|----|


|`09`|```Enter file in which to save the key (/c/Users/nowamagic/.ssh/id_rsa):```|
|----|----|


|`10`|```Created directory````'/c/Users/nowamagic/.ssh'``.`|
|----|----|


|`11`|```Enter passphrase (empty````for````no passphrase):```|
|----|----|


|`12`|```Enter same passphrase again:```|
|----|----|


|`13`|```Your identification has been saved in /c/Users/nowamagic/.ssh/id_rsa.```|
|----|----|


|`14`|`Your ``public````key has been saved in /c/Users/nowamagic/.ssh/id_rsa.pub.```|
|----|----|


|`15`|```The key fingerprint is:```|
|----|----|


|`16`|```b4:55:6e:2f:b7:1e:14:65:f6:61:fb:60:9f:22:70:b0 gonnsai@163.com```|
|----|----|


|`17`||
|----|----|


|`18`|```nowamagic@nowamagic-PC /e/PHPProject```|
|----|----|


|`19`|```$ cd test/```|
|----|----|


|`20`||
|----|----|


|`21`|```nowamagic@nowamagic-PC /e/PHPProject/test (master)```|
|----|----|


|`22`|```$ ls```|
|----|----|


|`23`|```application  index.php  sql````system`|
|----|----|


|`24`||
|----|----|


|`25`|```nowamagic@nowamagic-PC /e/PHPProject/test (master)```|
|----|----|


|`26`|```$ git remote -v```|
|----|----|


|`27`|```origin  git@www.nowamagic.net:test.git (fetch)```|
|----|----|


|`28`|```origin  git@www.nowamagic.net:test.git (push)```|
|----|----|


|`29`||
|----|----|


|`30`|```nowamagic@nowamagic-PC /e/PHPProject/test (master)```|
|----|----|


|`31`|`$`|
|----|----|





或者在命令行输入：



|`1`|```$ git config --global user.name``````"Your Name"```|
|----|----|


|`2`|```$ git config --global user.email````"email@example.com"`|
|----|----|





注意git config命令的--global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。









