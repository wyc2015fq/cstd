# TCP三次握手、四次挥手详解 - HJ - CSDN博客
2018年03月16日 23:02:55[FZH_SYU](https://me.csdn.net/feizaoSYUACM)阅读数：84
个人分类：[计算机网络](https://blog.csdn.net/feizaoSYUACM/article/category/7349917)

**三次握手：**
      第一次握手：建立连接时，客户端发送SYN包（SYN=1）到服务器，并进入SYN_SEND状态，等待服务器确认；
     第二次握手：服务器接收到SYN包，必须确认客户的SYN（ACK=j+1），同时自己也发送一个SYN包（SYN=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；
      第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包（ACK=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手；
**四次挥手：**
        第一次挥手：客户端发送一个FIN，用来关闭客户端到服务器的数据传送，客户端进入FIN_WAIT_1状态；
        第二次挥手：服务器收到FIN后，发送一个ACK给客户端，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），服务器进入CLOSE_WAIT状态；
        第三次挥手：服务器发送一个FIN，用来关闭服务器到客户端的数据传送，服务器进入LAST_ACK状态；
        第四次挥手：客户端收到FIN后，客户端进入TIME_WAIT状态，接着发送一个ACK给服务器，确认序号为收到序号+1，服务器进入CLOSED状态，完成四次挥手；
图解如下：
![](https://img-blog.csdn.net/20180316230234383)
**为什么连接的时候是三次握手，关闭的时候却是四次握手？**
因为当服务器收到客户端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当服务器收到FIN报文时，很可能并不会立即关闭socket，所以只能先回复一个ACK报文，告诉客户端已经收到FIN报文。只有等到服务器所有的报文都发送完了，服务器才会发送FIN报文，因此不能一起发送。故需要四次握手；
**为什么TIME_WAIT状态需要经过2MSL（最大报文段生存时间）才能返回到CLOSE状态？**
虽然按道理，四个报文都发送完毕，我们可以直接进入CLOSE状态了，但是我们必须假象网络是不可靠的，有可能最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。
