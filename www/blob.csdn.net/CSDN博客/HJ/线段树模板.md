# 线段树模板 - HJ - CSDN博客
2018年05月08日 22:55:09[FZH_SYU](https://me.csdn.net/feizaoSYUACM)阅读数：74
单点更新
```
int sum[N<<2],x[N];
void PushUp(int rt)
{
    sum[rt]=sum[rt<<1]+sum[rt<<1|1];
} 
void build(int l,int r,int rt)
{
    if(l==r)
    {
        scanf("%d",&sum[rt]);
        return ;
    }
    int m=(l+r)>>1;
    build(lson);
    build(rson);
    PushUp(rt); 
}
void update(int c,int add,int l,int r,int rt)
{
    if(l==r)
    {
        sum[rt]+=add;
        return ;
    }
    int m=(l+r)>>1;
    if(c<=m)
      update(c,add,lson);
    else 
      update(c,add,rson);
    PushUp(rt);
}
int query(int L,int R,int l,int r,int rt)
{
    if(L<=l&&R<=r)
      return sum[rt];
    int m=(l+r)>>1;
    int res=0;
    if(L<=m)
      res+=query(L,R,lson);
    if(R>m)
      res+=query(L,R,rson);
    return res;
}
```
区间更新
```
ll sum[N<<2],add[N<<2];
struct Node{
    int l,r;
    int mid(){
        return (l+r)>>1;
    }
}tree[N<<2];
void PushUp(int rt)
{
    sum[rt]=sum[rt<<1]+sum[rt<<1|1];
} 
void PushDown(int rt,int m)
{
    if(add[rt])
    {
        add[rt<<1]+=add[rt];
        add[rt<<1|1]+=add[rt];
        sum[rt<<1]+=add[rt]*(m-(m>>1));
        sum[rt<<1|1]+=add[rt]*(m>>1);
    }
}
void build(int l,int r,int rt)
{
    tree[rt].l=l;
    tree[rt].r=r;
    add[rt]=0;
    if(l==r)
    {
        scanf("%I64",&sum[rt]);
        return ;
    }
    int m=tree[rt].mid();
    build(lson);
    build(rson);
    PushUp(rt);
}
void update(int c,int l,int r,int rt)
{
    if(tree[rt].l==l&&tree[rt].r==r)
    {
        add[rt]+=c;
        sum[rt]+=(ll)c*(r-l+1);
        return ;
    }
    if(tree[rt].l==tree[rt].r)
      return ;
    PushDown(rt,tree[rt].r-tree[rt].l+1);
    int m=tree[rt].mid();
    if(r<=m)
      update(c,l,r,rt<<1);
    else if(l>m)
      update(c,l,r,rt<<1|1);
    else
    {
        update(c,lson);
        update(c,rson);
    }
    PushUp(rt);
}
ll query(int l,int r,int rt)
{
    if(l==tree[rt].l&&r==tree[rt].r)
      return sum[rt];
    PushDown(rt,tree[rt].r-tree[rt].l+1);
    int m=tree[rt].mid();
    ll res=0;
    if(r<=m)
      res+=query(l,r,rt<<1);
    else if(l>m)
      res+=query(l,r,rt<<1|1);
    else
    {
        res+=query(lson);
        res+=query(rson);
    }
    return res;
}
```
