# 51nod  1019 逆序数（树状数组） - HJ - CSDN博客
2017年04月11日 00:07:52[FZH_SYU](https://me.csdn.net/feizaoSYUACM)阅读数：305
在一个排列中，如果一对数的前后位置与大小顺序相反，即前面的数大于后面的数，那么它们就称为一个逆序。一个排列中逆序的总数就称为这个排列的逆序数。 
如2 4 3 1中，2 1，4 3，4 1，3 1是逆序，逆序数是4。给出一个整数序列，求该序列的逆序数。 
Input
第1行：N，N为序列的长度（n <= 50000) 
第2 - N + 1行：序列中的元素（0 <= A[i] <= 10^9）
Output
输出逆序数
Input示例
4 
2 
4 
3 
1
Output示例
4
用树状数组优化查询！
```cpp
#include<iostream>
#include<cstring>
#include<algorithm>
using namespace std;
int n,c[50005],a[50005]; 
struct node{
    int x,num;
}s[50005];
int lowbit(int x)
{
    return x&(-x);
}
void update(int t,int v)
{
    for(int i=t;i<=n;i+=lowbit(i))
      c[i]+=v;
}
int getsum(int x)
{
    int cnt=0;
    for(int i=x;i>=1;i-=lowbit(i))
      cnt+=c[i];
    return cnt;
}
int cmp(node a,node b)
{
    return a.x<b.x;
}
int main()
{
    while(cin>>n)
    {
        for(int i=1;i<=n;i++)
        {
            cin>>s[i].x;
            s[i].num=i;
        }
        sort(s+1,s+n+1,cmp);
        for(int i=1;i<=n;i++)
          a[s[i].num]=i;
        memset(c,0,sizeof(c));
        long long ans=0;
        for(int i=1;i<=n;i++)
        {
            update(a[i],1);
            ans+=i-getsum(a[i]);
        }     
        cout<<ans<<endl;
    }
    return 0;
}
```
