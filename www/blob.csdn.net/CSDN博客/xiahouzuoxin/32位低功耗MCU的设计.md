# 32位低功耗MCU的设计 - xiahouzuoxin - CSDN博客





2014年04月08日 23:59:09[xiahouzuoxin](https://me.csdn.net/xiahouzuoxin)阅读数：3648








作者:
 新唐科技





1 前言

传统的低功耗[MCU](http://www.eechina.com/keyword/MCU)设计都是以8位MCU为主，因为8位内核逻辑门数相对较少，运行或泄露[电流](http://www.eechina.com/keyword/%E7%94%B5%E6%B5%81)低，售价也相对低廉。但是，许多新兴的应用都需要比8位内核更大的处理效率。近年智能生活的抬头、[物联网](http://www.eechina.com/keyword/%E7%89%A9%E8%81%94%E7%BD%91)的建立，便携式消费性电子产品与无线功能需求越来越高、设计越来越复杂，要提高性能的同时又要兼顾低功耗，需要有一款高性能低功耗的主控MCU来作为平台。另一方面，工业上的智能化也在展开，如远程监控、数字化、网络化等。简单说来，就是人物连接(云端应用)、物物连接(物联网)需求越来越多，导致产品功能越来越复杂，计算量越来越高，2009年[ARM](http://www.eechina.com/keyword/ARM)发表了32位[Cortex](http://www.eechina.com/keyword/Cortex)-M0内核，提供给MCU厂商一个强而有力的平台，加上工艺微缩技术的进步，[嵌入式](http://www.eechina.com/keyword/%E5%B5%8C%E5%85%A5%E5%BC%8F)闪存工艺普及化及降价，主要成本来自内存大小及模拟外设和IO引脚数量，CPU内核的成本差异已大幅缩短，更促进了高性价比32位低功耗MCU的快速发展。


2 MCU功耗来自何处？

在开始讨论低功耗MCU设计前，必须先探讨MCU功耗的来源，其主要由静态功耗及运行功耗两部分组成。考虑实际的应用，最后决定系统功耗性能指针则必须计算平均功耗。

2.1 运行功耗

现代MCU已集成相当多的模拟外设，不能单纯考虑数字电路的动态功耗。MCU运行时的总功耗由模拟外设功耗和数字外设的动态功耗相加而得。[模拟电路](http://www.eechina.com/keyword/%E6%A8%A1%E6%8B%9F%E7%94%B5%E8%B7%AF)的功耗通常由工作[电压](http://www.eechina.com/keyword/%E7%94%B5%E5%8E%8B)及其性能要求指针来决定，例如100ns传输延迟(Propogation
 Delay)的[比较器](http://www.eechina.com/keyword/%E6%AF%94%E8%BE%83%E5%99%A8)工作电流可能约为40微安，当允许传递延迟规格为1μs时，工作电流有机会降到几个微安。

数字电路的动态功耗主要来自开关频率、电压及等效负载[电容](http://www.eechina.com/keyword/%E7%94%B5%E5%AE%B9)，其计算公式如下：

PDynamic(动态功耗) ~ f(工作频率) x CL(等效负载电容) x VDD2(工作电压)

由以上公式可以理解到降低动态功耗最直接的方式是降低工作电压及工作频率。但MCU实际应用通常要求更宽广的工作电压及更高的性能。在降低工作电压方面，可以选择更新的工艺，并通过[LDO](http://www.eechina.com/keyword/LDO)让CPU内核、数字电路及与引脚输入输出电压无关的模拟外设在低压工作，IO引脚及需要与其他外部电路连接的模拟外设则在较高的系统电压工作。如此可以兼顾低功耗及宽工作电压的需求。在降低工作频率这项参数上，一个设计优良的32位MCU更能突显其性能优势，除了直觉的[MIPS](http://www.eechina.com/keyword/MIPS)比较之外，32位[总线](http://www.eechina.com/keyword/%E6%80%BB%E7%BA%BF)也代表更高的数据存取带宽，能以更低的工作频率达到相同的性能，进而降低整体功耗。另外，如果MCU内置与工作频率相关的模拟外设，例如石英晶体振荡电路、嵌入式闪存或电流式[DAC](http://www.eechina.com/keyword/DAC)，其电流消耗与转换频率成正比，也要纳入低功耗MCU的动态功耗设计考虑。

2.2 静态功耗

传统静态功耗的定义是指系统时钟源关闭时数字电路的漏电流。但是在混合信号低功耗MCU的设计中要同时考虑下列多种漏电流来源，包含数字电路漏电流、SRAM漏电流、待机时已关闭的[仿真](http://www.eechina.com/keyword/%E4%BB%BF%E7%9C%9F)电路漏电流(例如[ADC](http://www.eechina.com/keyword/ADC)，嵌入式闪存)、待机时不关闭的仿真电路工作电流(例如LDO、BOD)及IO引脚的漏电流。因为时钟源已关闭，影响静态功耗的主要参数为工艺、电压及温度。因此，降低静态功耗必须选择超低功耗工艺，但是低功耗工艺通常伴随较高的Vt，导致低电压模拟外设设计困难。另外，以MCU待机电流1微安的规格，代表数字电路漏电
 + RAM保持电流 + LDO工作电流 + BOD(掉电检测或重置电路)工作电流总和必须小于1微安，对于Flash，RAM越来越大及功能越来越多的低功耗MCU设计厂商而言，是十分艰巨的挑战。

2.3 平均功耗

在系统级要兼顾低功耗及高性能，必须考虑实际应用的需求，例如无线环境[传感器](http://www.eechina.com/keyword/%E4%BC%A0%E6%84%9F%E5%99%A8)可能让MCU主时钟及CPU关闭，只开启低频时钟，定时唤醒外围电路进行检测，当符合设定条件的事件发生时快速启动CPU进行处理，即使没有任何事件发生，也必须定时激活CPU维持无线传感器网络的联机。在遥控器的应用中，则可能完全将所有时钟源都关闭，当用户按键时快速唤醒时钟源及CPU进行处理。另外，许多应用都会加入一个MCU作为主机处理器的协处理器，用于监控键盘或[红外](http://www.eechina.com/keyword/%E7%BA%A2%E5%A4%96)线输入、刷新[显示器](http://www.eechina.com/keyword/%E6%98%BE%E7%A4%BA%E5%99%A8)、控制主处理器电源以及智能电池管理等任务。此时平均功耗比单纯的运行功耗或待机功耗更具指标性意义。

平均功耗由下列主要参数组合而成：运行功耗及运行时间，静态待机功耗及待机时间，不同运行模式之间的切换时间。兹以下图进行说明：

![1.JPG](http://www.eechina.com/data/attachment/forum/201308/29/0949477g7grfrjnohvnw4h.jpg)

![f1.JPG](http://www.eechina.com/data/attachment/forum/201308/29/0949479h4oxmuh9vumbaqh.jpg)

因为进入待机模式时间很短，忽略此段时间的电流消耗，公式可以简化为：

![f2.JPG](http://www.eechina.com/data/attachment/forum/201308/29/094947g9djdltocuzacu7u.jpg)

由以上公式观察到除了降低运行电流及静态待机电流外，降低运行时间、唤醒时间及高低速运行模式切换时间也是降低整机功耗的重要手段。另外，上图同时指出，低功耗MCU支持动态切换运行时钟频率是必要的功能。

3 低功耗MCU设计考虑

3.1 工艺选择

为了达到低功耗的运作，并能有效地在低耗电待机模式下达到极低的待机功耗，可以通过对工艺的选择而达到基本的要求门槛。在不强调速度极致的某些工艺分类，选择极低组件截止电流工艺(如下图)进行逻辑门制作，并进行数字设计是方法之一。选择这种策略的额外效益是，通常也能在降低动态工作电流上，达到较好的表现。另外，由于高温大幅增加静态电流，当温度由摄氏25度增加到摄氏85度时，一个典型比例约增加10倍的静态电流，以非低功耗0.18微米工艺开发的32位MCU，逻辑门数200K、4KB
 SRAM在核心电压1.8V、摄氏25度的静态耗电约为5~10微安，当温度升高到摄氏85度时，静态待机电流将会飙升到50~100微安。而低功耗工艺在摄氏85度仅约10微安静态电流。

![2.JPG](http://www.eechina.com/data/attachment/forum/201308/29/094947ejufdp4l4v6llpy6.jpg)

3.2 低功耗高性能的CPU内核

早期低功耗MCU受限于成本及工艺技术，大都选择8位CPU内核，但随着工业上的智能化也在展开，如远程监控，数字化、网络化等。简单说来，就是人物连接(云端应用)、物物连接(物联网)的需求越来越多，导致产品功能越来越复杂，计算量越来越高，8位MCU已逐渐无法满足性能需求。为了兼顾低功耗高性能，选择适用的32位CPU内核是大势所趋。

选择低功耗CPU内核，除了单位频率耗电流外，还需要综合考虑紧凑的低内存代码，相同功能所需的代码越长，除了增加内存成本，也代表更长的运行时间及功耗。另外，由于软件开发成本在后期将会越来越高，大量的参考代码及更多的第三方开发商的支持，都可以有效降低软件的开发时间及成本。所以选择一款更多人使用的CPU内核也是重要的考虑之一，ARM [Cortex-M0](http://www.eechina.com/keyword/Cortex-M0)逻辑门数仅27K，使用的电量在1.8V，超低泄漏180ULL
 (Ultra Low Leakage)仅约50μA/MHz。M0内核采用Thumb2指令集架构，产生出非常紧凑的低内存代码，进一步降低了电源需求。ARM自2009年发表了32位Cortex-M0内核以来，包括[NXP](http://www.eechina.com/keyword/NXP)、新唐科技、[ST](http://www.eechina.com/keyword/ST)、[Freescale](http://www.eechina.com/keyword/Freescale)等多家国内外MCU大厂相继投入Cortex-M0
 MCU开发，不论供货或者品种的齐全度都已十分成熟，投入Cortex-M0的MCU开发商也在持续增加中。

3.3 低功耗数字电路

对于一般的同步数字电路设计，要使数字单元有效降低工作电流，通过控制时钟的频率或截止不需要的时钟跳动，也是重要的方法。低功耗MCU通常配备丰富的时钟控制单元，可对个别的数字外设单元依照需求做降频或升频的工作调整，在达到工作能力的同时，用最低的频率来运行。但为了达到更弹性的时钟源配置，可能导致CPU内核和外围电路时钟不同步的现象，此时必须仔细考虑电路设计，保证跨时钟领域数据存取的正确性。

另外，为了尽量降低CPU介入处理的时间或降低CPU工作频率而节省下来的功耗，可以提供DMA或外围电路相互触发电路进行数据的传递，例如Timer定时自动触发ADC或DAC，并通过DMA进行数据由ADC到RAM或者RAM到DAC的搬移，同时在ADC的输入可以增加简单的数字滤波及平滑化电路，这样可不需要CPU经常介入处理，也不会因为需要实时处理ADC或DAC事件导致中断程序占用太多时间，降低系统的实时性及稳定性。

3.4 支持多种工作模式

为了配合不同的应用需求，并达到系统平均功耗的最小化，低功耗MCU需要提供多种工作模式，让用户灵活调配应用，常见的工作模式有下列几种：

● 正常运行模式：CPU内核及外设正常工作，能实时改变CPU及外设的工作频率(On the Fly)或关闭不需要的时钟源以获得最佳的工作性能。

● 低频工作模式：CPU内核及外设工作于低频的时钟源，例如32.768K晶振或内部低频10K RC[振荡器](http://www.eechina.com/keyword/%E6%8C%AF%E8%8D%A1%E5%99%A8)。通常此时最大的耗电来源为嵌入式闪存及LDO本身的耗电流。如果此时的执行程序不大，可以考虑将程序运作于RAM以降低平均功耗。请注意并不是所有MCU都能支持在RAM执行程序。

● Idle模式：CPU内核停止，时钟源和被致能的外围电路持续工作，直到外围电路符合设定条件唤醒CPU进行数据处理或控制执行流程。通常高频的运行模式，CPU及嵌入式闪存消耗相当大比例的电流，故Idle模式能有效降低平均功耗。

● 待机RAM保持模式：CPU内核及所有时钟源关闭，内置LDO切换到低耗电模式，但是RAM及IO引脚持续供电，维持进入待机之前的状态。

● RTC模式：CPU内核及高频时钟源关闭，内置LDO切换到低耗电模式，由于此时LDO供电能力降低，仅能提供低耗电的外围电路运行，例如32.768K晶振、RTC(实时时钟计数器)、BOD(掉点检测或重置电路)、TN单色[LCD](http://www.eechina.com/keyword/LCD)直接驱动电路等。

● 深层待机模式：CPU内核及所有时钟源关闭，关闭RAM及LDO、BOD等所有外围电路的电源，仅IO引脚(或部分IO引脚)持续供电，由IO引脚或重置(Reset)引脚唤醒CPU。因为此模式下，RAM的数据已丢失，通常会进行内部电源切割，提供数十个状态记录缓存器作为系统重启时的初始状态参考源。此模式的优点是更低的静态电流，通常仅需100nA~500nA，其缺点是并非所有的应用都可以忍受RAM数据丢失及系统重启。

3.5 电源系统的考虑

在多电源系统的应用上，必须考虑低功耗MCU的内部电源规划或自动切换，以下以市电/备用电池双电源系统及内置[USB](http://www.eechina.com/keyword/USB)接口，但平常由电池供电的移动设备来举例说明。

● 市电/备用电池双电源系统：MCU平常由市电经由交直流转换电路供电，当市电断电时，经由连接在备用电源的独立供电引脚进行供电，同时在MCU内部进行电源切割，并提供一个可靠的备用电源自动切换开关，确保市电正常供电时备用电池不会持续被消耗。但仔细考虑，其实有两种状况可能发生，一种是备用电池仅供电给部分低耗电的外围电路，例如32.768K晶振、RTC时钟电路、数据备份寄存器等。当市电来时MCU将重新启动。另外一种状况是当市电断电时，有可能MCU及部分外围电路会被唤醒工作，然后再次进入待机模式。智能型电表就是此类应用的典型代表。在此种应用中，备用电池需要供电给整颗MCU，所以电源自动切换开关必须能承受更高的电流，相对成本也较高。

● 内置USB接口移动设备：此类设备平时由两节电池供电或锂电池供电，工作电压可能为2.2V到3V，当连接到USB时，USB接口转由VBUS供电。此类低功耗MCU如果没有内置5V转3V的USB接口LDO将会产生下列问题，当连接USB时必须由外挂的LDO将USB VBUS的5V电源转换为3V电源同时提供给MCU
 VDD及USB接口电路，但又必须避免LDO输出的3V电源与脱机工作时的电池电源发生冲突，将会需要外加[电源管理](http://www.eechina.com/keyword/%E7%94%B5%E6%BA%90%E7%AE%A1%E7%90%86)电路，增加系统成本及复杂度。

3.6 丰富的唤醒机制及快速唤醒时间

有许多的系统应用场合，需要由外部的单一信号、键盘或甚至串行通信信号来激发MCU启动整体系统的运作。在未被激发的时候，微控制器或甚至大部分的整机需要处于最低耗电的待机状态，以延长电池的寿命。能够在各种需求下被唤醒，也成为微控制器的重要特征。MCU能拥有各式不同的唤醒方式，包括各I/O可作为激发唤醒的通道，或是由I2C、UART、SPI的信道作为被外界组件触发唤醒，或使用内、外部的超低耗电时钟源，通过Timer来计时唤醒。诸多的唤醒机制，只要运用得当，并配合微控制器的低功耗工作切换模式，可以使MCU几乎时时处于极低功耗的状况。

配有快速、高效率内核的MCU，可以在每次唤醒的当下短暂时间里，完成应有的工作与反应，并再次进入深层的低待机模式，以此达到平均耗能下降的目的。但是，如果唤醒后开始执行微指令的时间因为某些因素而拖延得很长，将会使降低总体耗电的目标大打折扣，甚至达不到系统反应的要求。因此，有些MCU，配合起振时间的改进，逻辑设计的配合，使得唤醒后执行指令的时间至少降到数个微秒之内。

3.7 低功耗模拟外设及内存

低功耗MCU在运行时除了CPU内核及被使能的数字外围电路在工作外，越来越多被集成到内部的模拟外围电路也是耗电的主要来源。以最简单的while (1);执行语句来分析运行功耗，共包含下列耗电来源：CPU内核、时钟振荡器、嵌入式闪存内存、及LDO本身的消耗电流。代入以下典型值数据将会更清楚显示各个部分对耗电的影响：

● 工作频率12MHz，MCU电压3V，LDO输出1.8V供给CPU内核、内存及其他数字电路

● 低功耗Cortex-M0内核：600μA

● 嵌入式闪存内存：1.5mA

● 低功耗12MHz晶振电路：230μA

● LDO本身的静态消耗电流：70μA

● 总和 = 0.6 + 2 + 0.23 + 0.07 = 2.4mA，平均功耗约200μA/MHz

其中耗电比例最高的是嵌入式闪存内存。如果要工作在更高频率，通常会启动内置的PLL提供更高频率的时钟源，在1.8V供电的典型PLL，12MHz输入输出48MHz工作电流约为1~2mA，如果不能有效降低PLL耗电，对高频工作的低功耗MCU将是一大电流负担。

LDO的最低静态功耗、32.768kHz晶振电路、BOD及TN LCD驱动电路的工作电流，都会大大影响到待机或RTC模式的功耗指针。以低功耗应用的热能表为例，RTC加LCD显示的功耗要求在3V/8μA以下，这代表可以预估分配给下列电路的电流预算为：LDO静态功耗0.5μA
 + 32.768kHz晶振及RTC电路1μA + BOD 1μA + TN LCD驱动4μA + LCD玻璃1μA + 所有数字电路及模拟外设漏电流0.5μA。这些模拟外设除了低耗电要求，同时必须兼具要求批量生产及温度变化时的一致性，这对模拟设计人员将是一大挑战。

快速唤醒这个性能指针也会影响到下列模拟外设的稳定时间。当MCU从低耗电的待机模式唤醒时，首先要将LDO快速切换到高供电模式，启动内部高速RC振荡器，使能嵌入式闪存及CPU，以上所有电路的稳定时间总和必须在数个微秒内完成，才能符合快速唤醒的需求。

另外一个容易被忽略的设计是外围电路启动电流，因为相当多的便携设备采用CR2032小型锂电池，瞬间推动力仅有数mA，尤其使用一段时间瞬间推动力会更低，当MCU被唤醒时果外围电路启动电流总和太大时，将会导致CR2032输出电压骤降而导致MCU重置(Reset)或工作不正常。为了避免此问题，除了降低外围电路的启动电流，另一种方法是分时分段启动外围电路，不要集中开启太多耗电的电路。

4 平均功耗计算范例

为了让读者更具体了解平均功耗的计算，以新唐科技的低功耗32位MCU Nano系列及血糖计应用为例，进行使用年限的预估。新唐的Nano系列低功耗32位MCU的CPU内核为Cortex-M0，具有200uA/MHz低运行功耗、待机电流仅需1uA、7uS快速唤醒、多重时钟信号来源及多种工作模式，多达128KB
 Flash、16K SRAM及12位ADC、12位DAC、SPI、I2C、I2S、UART、LCD、Touch Key等丰富外设，符合低功耗、高性能MCU应用需求。

此血糖计范例采用CR2032 230mAh电池，使用方式、运行功耗及静态功耗如下表所示。

![t1.JPG](http://www.eechina.com/data/attachment/forum/201308/29/094947h9fy75xraa9pfrxp.jpg)

使用年限的计算方式请参考下表。量测时间比例、显示时间比例及待机时间比例可由上表求得。例如，量测时间比例为“6次 x 0.25分钟 / (60 x 24)分钟 = 0.1%”。其余时间比例依此类推。量测平均电流为“量测时间比例 x (MCU工作耗电流 + 外部量测电路耗电流
 + 待机(含RTC)耗电流 + LCD耗电流 + CR2032自放电)”。显示平均电流为“显示时间比例 x (待机(含RTC)耗电流 + LCD耗电流 + CR2032自放电)”。待机平均电流为“待机时间比例 x (待机(含RTC)耗电流 + CR2032自放电)”。最后计算出使用年限约为2.77年。由于待机时间比例高达99%，故血糖计应用待机电流为延长使用年限最重要的参数。

![t2.JPG](http://www.eechina.com/data/attachment/forum/201308/29/094948u0fvkf0ccliwfic7.jpg)

5 结论

低功耗MCU设计是一个需要多面向考虑的复杂工作，本文仅阐述基本设计理念。开发低功耗MCU产品时，不只要挑战电路设计的高困难度，更要由客户应用的角度考虑性价比，功能最强的不一定是最好的。往往性价比最适合的才能在市场上取得成功。由于[智能电网](http://www.eechina.com/keyword/%E6%99%BA%E8%83%BD%E7%94%B5%E7%BD%91)、物联网、远程控制、[自动化](http://www.eechina.com/keyword/%E8%87%AA%E5%8A%A8%E5%8C%96)管理等低功耗高性能应用需求量持续增加，在可以预见的未来，32位低功耗MCU将逐渐取代8/16位低功耗MCU，成为市场主流。


