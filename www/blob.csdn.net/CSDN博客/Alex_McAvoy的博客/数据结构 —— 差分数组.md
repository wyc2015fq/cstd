# 数据结构 —— 差分数组 - Alex_McAvoy的博客 - CSDN博客





2019年03月24日 22:21:59[Alex_McAvoy](https://me.csdn.net/u011815404)阅读数：20








# 【概述】

差分数组不仅仅是一个优秀的数据结构，还是一种很好的思想，其主要用于**修改区间、查询区间**，其中，修改区间、查询时间的时间复杂度均为 O(1)

对于已知有 n 个元素的离线数列 a，可以建立一个记录它每项与前一项差值的差分数组 f[]，那么显然有：
- f[1]=a[1]-0=a[1]
- f[i]=a[i]-a[i-1]

计算数列各项的值，可以发现：
- a[2]=f[1]+f[2]=a[1]+(a[2]-a[1])=a[2]
- a[3]=f[1]+f[2]+f[3]=a[1]+(a[2]-a[1])+(a[3]-a[2])=a[3]
- a[4]=f[1]+f[2]+f[3]+f[4]=a[1]+(a[2]-a[1])+(a[3]-a[2])+(a[4]-a[3])=a[4]
- ...

以此类推，可以发现数列 a 的第 i 项是可以用差分数组前 i 项和来计算的，即：**a[i]=f[i] 的前缀和**

计算数量每一项的前缀和，那么有：![sum[x]=\sum_{i=1}^xa[x]=\sum_{i=1}^x\sum_{j=1}^if[i]=\sum_{i=1}^x(x-i+1)*f[i]](https://private.codecogs.com/gif.latex?sum%5Bx%5D%3D%5Csum_%7Bi%3D1%7D%5Exa%5Bx%5D%3D%5Csum_%7Bi%3D1%7D%5Ex%5Csum_%7Bj%3D1%7D%5Eif%5Bi%5D%3D%5Csum_%7Bi%3D1%7D%5Ex%28x-i&plus;1%29*f%5Bi%5D)

即：**可用差分数组来求出数列的前缀和**

```cpp
int a[N];
int f[N],sum[N];
void init(){
    f[1]=a[1];
    for(int i=2;i<=n;i++)//差分数组
        f[i]=a[i]-a[i-1];

    for(int i=1;i<=n;i++)//前缀和
        sum[i]=sum[i-1]+a[i];
}
```

# 【用途】

## 1.快速处理区间加减

假如现在要对数列区间 [L,R] 上的每个数都加上 x，那么通过 **a[i]=f[i] 的前缀和** 的性质可以知道：
- 第一个受影响的差分数组中的元素为 f[L]，所以令 **f[L]+=x**，那么后面数列元素在计算过程中都会加上 x
- 最后一个受影响的差分数组中的元素为 f[R]，所以令 **f[R+1]-=x**，那么可以保证不会影响到 R 以后数列元素的计算

这样一来，就不必对区间内每一个数进行处理，只需处理两个差分后的数即可

```cpp
void update(int L,int R,int x){
    f[L]+=x;
    f[R+1]-=x;
}
```

## 2.查询区间和

由于 **可用差分数组来求出数列的前缀和**，那么可以计算出数列各项的前缀和 sum[n] 各项的值

那么，区间 [L,R] 的和即为：**res=sum[R]-sum[L-1]**

```cpp
int query(int L,int R){
    return sum[R]-sum[L-1];
}
```

## 3.查询单点

可用差分数组来求第 x 个点的值

```cpp
int query(int x){
    int sum=0;
    for(int i=1;i<=x;i++)
        sum+=f[i];
    return sum;
}
```

# 【模版】

```cpp
#include<iostream>
#include<cstdio>
#include<cstdlib>
#include<string>
#include<cstring>
#include<cmath>
#include<ctime>
#include<algorithm>
#include<utility>
#include<stack>
#include<queue>
#include<vector>
#include<set>
#include<map>
#define PI acos(-1.0)
#define E 1e-9
#define INF 0x3f3f3f3f
#define LL long long
const int MOD=1000000007;
const int N=200+5;
const int dx[]= {-1,1,0,0};
const int dy[]= {0,0,-1,1};
using namespace std;
int n,m;
int a[N];
int f[N],sum[N];
void init(){//求差分数组与前缀和
    f[1]=a[1];
    for(int i=2;i<=n;i++)//差分数组
        f[i]=a[i]-a[i-1];

    for(int i=1;i<=n;i++)//前缀和
        sum[i]=sum[i-1]+a[i];
}
void update(int L,int R,int x){//修改区间
    f[L]+=x;
    f[R+1]-=x;
}
int query(int L,int R){//查询区间
    return sum[R]-sum[L-1];
}
int main(){
    cin>>n>>m;
    for(int i=1;i<=n;i++)//输入序列
        cin>>a[i];

    init();//计算差分数组与前缀和
    while(m--){//m个操作
        int op;
        cin>>op;
        if(op=='U'){//修改区间
            int l,r,x;
            cin>>l>>r>>x;
            update(l,r,x);
        }
        else if(op=='Q'){//查询操作
            int l,r;
            cin>>l,r;
            cout<<query(l,r)<<endl;
        }
    }
    return 0;
}
```

# 【例题】
- Color the ball（HDU-1556）**(差分数组单点查询)**：[点击这里](https://blog.csdn.net/u011815404/article/details/88802965)
- 借教室（洛谷-P1083）**(差分数组+二分)**：[点击这里](https://blog.csdn.net/u011815404/article/details/88802911)
- 小a的轰炸游戏（2019牛客寒假算法基础集训营 Day1-E）**(多方向的差分)**：[点击这里](https://blog.csdn.net/u011815404/article/details/87022634)



