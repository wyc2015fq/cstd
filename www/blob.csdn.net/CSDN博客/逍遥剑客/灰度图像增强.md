# 灰度图像增强 - 逍遥剑客 - CSDN博客
2007年04月21日 05:20:00[xoyojank](https://me.csdn.net/xoyojank)阅读数：4246
先看基于模板的
1. 
3x3
|1/9|1/9|1/9|
|----|----|----|
|1/9|1/9|1/9|
|1/9|1/9|1/9|
这个模板很明显，就是把当前像素的值用周围的像素值的平均值代替，产生模糊效果
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)// 模糊处理
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)void ImageProcess::BlurImage(CImage* srcImage,CImage* outImage, int blurType)
...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)    CWaitCursor WaitCursor;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//设置进度条范围
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)    ((CMainFrame*)AfxGetMainWnd())->SetProgressRange(0,srcImage->GetWidth());
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int x =0;x < srcImage->GetWidth();x++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//设置当前进度
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)        ((CMainFrame*)AfxGetMainWnd())->SetProgressPos(x);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int y =0;y < srcImage->GetHeight();y++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)int r =0,g =0,b =0;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int col =-blurType;col <= blurType;col++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int row =-blurType;row <= blurType;row++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    COLORREF pixel;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//防止越界
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)if( (x+row) <0||(x+row) >= srcImage->GetWidth() ||
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                        (y+col) <0|| (y+col) >= srcImage->GetHeight())
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                        pixel = srcImage->GetPixel(x,y);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)else
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                        pixel = srcImage->GetPixel(x + row,y + col);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    r += GetRValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    g += GetGValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    b += GetBValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)                }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//取平均值
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)int blocks = (blurType*2+1)*(blurType*2+1);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            r /= blocks;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            g /= blocks;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            b /= blocks;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//写回图像
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            outImage->SetPixelRGB(x,y,r,g,b);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedBlockEnd.gif)}
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)
同样，也有5x5,7x5等等的模板，模板越大，处理后的图像就越模糊
 2.
|0|-1|0|
|----|----|----|
|-1|4|-1|
|0|-1|0|
这是另一种模板，是为了增强当前像素与周围像素的差别，产生的效果就是：锐化
此时的模板叫Laplacian模板，当然，这不是唯一的一种形式，例如：
-1 -2 -1
0   0   0 
1   2   1
-1   0   1
-2   0   2
-1   0   1
是两种简化运算的近似效果，可以取得更快的处理速度
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)// 锐化图像
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)void ImageProcess::SharpImage(CImage* srcImage,CImage* outImage, int sharpType)
...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)int Laplacian[3][9] =
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{0,-1,0,-1,4,-1,0,-1,0},
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{-1,-2,-1,0,0,0,1,2,1},
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{-1,0,1,-2,0,2,-1,0,1}
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)    };
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)    CWaitCursor WaitCursor;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//设置进度条范围
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)    ((CMainFrame*)AfxGetMainWnd())->SetProgressRange(0,srcImage->GetWidth());
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int x =0;x < srcImage->GetWidth();x++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//设置当前进度
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)        ((CMainFrame*)AfxGetMainWnd())->SetProgressPos(x);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int y =0;y < srcImage->GetHeight();y++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)int r =0,g =0,b =0,index =0;;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int col =-1;col <=1;col++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int row =-1;row <=1;row++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    COLORREF pixel;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//防止越界
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)if( (x+row) <0||(x+row) >= srcImage->GetWidth() ||
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                        (y+col) <0|| (y+col) >= srcImage->GetHeight())
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                        pixel = srcImage->GetPixel(x,y);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)else
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                        pixel = srcImage->GetPixel(x + row,y + col);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    r += GetRValue(pixel) * Laplacian[sharpType][index];
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    g += GetGValue(pixel) * Laplacian[sharpType][index];
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    b += GetBValue(pixel) * Laplacian[sharpType][index];
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)                    index++;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)                }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)            }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//增强
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            COLORREF pixel = srcImage->GetPixel(x,y);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//r += GetRValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//g += GetGValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//b += GetBValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//处理颜色值溢出
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            r = (r >255) ?255 : r;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            r = (r <0) ?0 : r;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            g = (g >255) ?255 : g;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            g = (g <0) ?0 : g;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            b = (b >255) ?255 : b;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            b = (b <0) ?0 : b;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//写回图像
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            outImage->SetPixelRGB(x,y,r,g,b);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedBlockEnd.gif)}
3.基本的灰度变换
这应该是最简单的变换了，s=f(x,y)，s为处理后的像素颜色值，而f(x,y)是什么函数，就决定了处理效果
如：
图像反转：s=L-1-r，常用于医学上的透视图的处理
对数变换：s=cLog(1+r)，可以扩展被压缩的高值图像中的暗像素
幂次变换：s=cr^γ，这就是传说中的伽马校正！
代码示例，仅有对数变换，其它同理
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)// 对数变换
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)void ImageProcess::LogTransform(CImage* srcImage, CImage* outImage, int c)
...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)    CWaitCursor WaitCursor;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//设置进度条范围
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)    ((CMainFrame*)AfxGetMainWnd())->SetProgressRange(0,srcImage->GetWidth());
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int x =0;x < srcImage->GetWidth();x++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//设置当前进度
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)        ((CMainFrame*)AfxGetMainWnd())->SetProgressPos(x);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)for(int y =0;y < srcImage->GetHeight();y++)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockStart.gif)![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ContractedSubBlock.gif)...{
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)int r =0,g =0,b =0;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            COLORREF pixel = srcImage->GetPixel(x,y);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            r = GetRValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            g = GetGValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            b = GetBValue(pixel);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            r = (int)(c * log(1.0f+ r));
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            g = (int)(c * log(1.0f+ g));
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            b = (int)(c * log(1.0f+ b));
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//处理颜色值溢出
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            r = (r >255) ?255 : r;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            r = (r <0) ?0 : r;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            g = (g >255) ?255 : g;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            g = (g <0) ?0 : g;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            b = (b >255) ?255 : b;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            b = (b <0) ?0 : b;
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)//写回图像
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/InBlock.gif)            outImage->SetPixelRGB(x,y,r,g,b);
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)        }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedSubBlockEnd.gif)    }
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/ExpandedBlockEnd.gif)}
![](http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif)
