# 一个完整推荐系统的设计实现 - miner_zhu的博客 - CSDN博客





2018年08月14日 15:34:55[miner_zhu](https://me.csdn.net/miner_zhu)阅读数：4015标签：[推荐系统																[搜索																[NLP](https://so.csdn.net/so/search/s.do?q=NLP&t=blog)
个人分类：[推荐系统](https://blog.csdn.net/miner_zhu/article/category/7936550)





工业界完整推荐系统的设计。结论是： **没有某种算法能够完全解决问题， 多重算法+交互设计， 才能解决特定场景的需求。**下文也对之前的一些博文进行梳理，构成一个完整工业界推荐系统所具有的方方面面（主要以百度关键词搜索推荐系统为例）

### 完整的推荐系统肯定不会只用一种推荐算法

在学术界， 一般说到推荐引擎， 我们都是围绕着某一种单独的算法的效果优化进行的， 例如按内容推荐， 协同过滤（包括item-based, user-based, SVD分解等），上下文推荐，Constraint-based推荐，图关系挖掘等。 很多比较牛的单个算法， 就能在某个指标上取得较好效果， 例如MAE，RMSE。。。不过有自己的优点， 每种算法也有自己的缺点， 例如按内容推荐主要推荐和用户历史结果相似的item，一般的item-based容易推荐热门item（被更多人投票过）。。。。   所以在工业界，例如各互联网公司， 都会使用多种算法进行互相配合， 取长补短， 配合产品提升效果。而且在**完整的推荐系统中，不仅有传统的Rating推荐， 还需要辅以非常多的挖掘， Ranking来达到预期效果**。



# 推荐系统3大件：User Profile、基础挖掘推荐、Ranking

在实践中， 一个完整的推荐系统会主要由3部分组成：
- **User Profile**
- **基础推荐挖掘算法**
- **Ranking**

### **User Profile**

A user profile is a representation of information about an individual user that is essential for the (intelligent) application we are considering user profile主要是用户（注册）信息，以及对用户反馈的信息进行处理，聚合，用于描述用户的特征； 是后续推荐和排序的基石。 一般情况下，user profile会包含以下具体内容：
- 用户兴趣数据
- 用户的基础注册信息，背景信息：例如用户出生地，年龄，性别，星座，职业等。这些信息一般从用户注册信息中获取；例如高德，百度地图注册用户，淘宝注册用户等
- 用户行为反馈：包括显示的反馈(explicit)和隐藏(implicit)的反馈，显示的反馈包括用户的评分，点赞等操作，百度关键词搜索推荐工具上的点赞（正向显示反馈）和垃圾桶（负向显示反馈），淘宝上的评分；隐式反馈包括用户的浏览行为，例如在百度关键词搜索推荐上搜过那些词，淘宝上点击了那些页面，在高德上点击了那些POI等
- 用户交互偏好**：**例如用户喜欢使用哪些入口，喜欢哪些操作，以及从这些操作中分析出来的偏好，比如在高德地图上根据用户行为反馈分析出来的用户对美食的偏好：更喜欢火锅，粤菜，还是快餐
- 用户上下文信息：这些信息有些是分析出来的，例如在LBS中分析出来的用户的家在哪儿，公司在哪儿，经常活动的商圈，经常使用的路线等

user profile经常是一份维护好的数据，在使用的时候，会直接使用该数据，或是将该数据存储在KV系统中，供Online系统实时使用。 在搜索或是推荐的场景下，每次请求一般只会涉及到一次user profile的KV请求，所以online使用的时候，主要的实现困难是存储，以及快速KV的快速响应。

### **基础挖掘推荐算法**

基础挖掘推荐算法， 主要使用传统推荐算法， 结合分析的item profile和user profile， 建立user和item的关系，此时并不会过多考虑其他因素，例如是否冷门/热门，最主要的就是**建立user和item的关系。** 在各种论文中狭义的推荐，主要就是指该部分内容。 主要围绕着Rating，以及Top N进行该处的Top N（更像是直接Rating值最高的Top N） 传统的推荐算法研究主要围着这块工作进行，现在已经有很多比较成熟的算法，这些算法相关的研究可参见博文：《[推荐系统经典论文文献及资料](http://semocean.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E6%96%87%E7%8C%AE%E5%8F%8A%E8%B5%84%E6%96%99/)》；其中也能找到到业界较多成功推荐系统的实践分享 主要包含以下几类：
- Content Based推荐： 按内容推荐，主要的工作是user profile, item profile的提取和维护，然后研究各种相似度度量方法（具体相似度度量参见博文：《[推荐系统中的相似度度量](http://semocean.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%BA%A6%E9%87%8F/)》）
- 协同过滤：相当于应用了用户的行为进行推荐（区别于Content based算法），比较经典的算法包括传统的item-based/user-based算法（参见博文：《[协同过滤中item-based与user-based选择依据](http://semocean.com/%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E4%B8%ADitem-based%E4%B8%8Euser-based%E9%80%89%E6%8B%A9%E4%BE%9D%E6%8D%AE/)》，《[collaborative-filtering根据近邻推荐时需要考虑的3要素](http://semocean.com/collaborative-filtering%E6%A0%B9%E6%8D%AE%E8%BF%91%E9%82%BB%E6%8E%A8%E8%8D%90%E6%97%B6%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E7%9A%843%E8%A6%81%E7%B4%A0/)》），SVD，SVD++(具体原理及源码参见博文：《[SVD因式分解实现协同过滤-及源码实现](http://semocean.com/%E5%9B%A0%E5%BC%8F%E5%88%86%E8%A7%A3%E5%AE%9E%E7%8E%B0%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4-%E5%8F%8A%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0/)》)
- 上下文相关推荐：和传统推荐相比， 考虑更多上下文因素，LBS， 移动场景下使用比较多（具体参见博文：《[context-aware-recommendation](http://semocean.com/context-aware-recommendation/)》）
- 基于图的关系挖掘推荐：主要是利用图论原理，根据item,user之间的数据，反馈关联关系，挖掘更深层次的关系进行推荐，该类方法一般效果都不错，当然资源要求也较高。具体参见博文：《[级联二步图关系挖掘关键词推荐系统](http://semocean.com/%E7%BA%A7%E8%81%94%E4%BA%8C%E6%AD%A5%E5%9B%BE%E5%85%B3%E7%B3%BB%E6%8C%96%E6%8E%98%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/)》，《[频繁二项集合的hadoop实现](http://semocean.com/%E9%A2%91%E7%B9%81%E4%BA%8C%E9%A1%B9%E9%9B%86%E5%90%88%E7%9A%84hadoop%E5%AE%9E%E7%8E%B0/)》《[itemrankrandom-walk-based-scoring-algorithm-for-recommener-system](http://semocean.com/itemrankrandom-walk-based-scoring-algorithm-for-recommener-system/)》
- Constrainted-based推荐：根据限制性条件进行演绎推荐

在实际应用时，我们经常使用按内容推荐，item-based寻找从感知的角度比较靠谱的结果，使用SVD,SVD++，图关系寻找更深层次的联系结果。同时在推荐时，会结合很多因素来进行综合排序，例如关键词， 或是LBS中POI的热度等。具体可参见下文ranking部分。

**算法效果衡量**

以上这些算法， 我们在离线的时候，使用Cross-Validation方式，就可以分析出其效果，而且离线分析的时候，代价比较小，比较容易操作。当然，对于不同的问题会使用对应的指标进行衡量。 对于预测Rating准确性主要是用RMSE，或是MAE；具体可参见博文：《[关键词搜索推荐系统中的推荐准确性度量](http://semocean.com/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%90%9C%E7%B4%A2%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E6%8E%A8%E8%8D%90%E5%87%86%E7%A1%AE%E6%80%A7%E5%BA%A6%E9%87%8F/)》 如果是排序， 则更多使用NDCG，MAP,  MRR等指标；具体可参见博文：《[使用ndcg评估关键词推荐系统的相关性](http://semocean.com/%E4%BD%BF%E7%94%A8ndcg%E8%AF%84%E4%BC%B0%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%A7/)》 在具体应用场景中，对于特定推荐问题，会涉及到选用哪种算法的问题。推荐不像CTR预估这样的问题，目标比较单一，经常我们需要考虑多个指标，而且这些指标可能此消彼长，需要做权衡，例如需要考虑算法的准确性(accuracy)，同时也需要考虑算法的覆盖(coverage)，置信度（confidence）,新鲜度(novelty)和惊喜度(Serendipity)，同时还需要考虑推荐为系统带来的收益和效用(utility)。 这些指标经常需要权衡，而且经常提升某一个的时候会导致其它下降，所以有时候存在一定的主观性：我们到底看中哪一个指标？  而且这个问题可能随着系统，平台所处的阶段而不同。 例如在建立口碑的时候，我们可能不太关注coverage，而更关注accuracy，因为要让用户建立一种：该系统很准的认知；如果在系统已经比较成熟了，此时可能需要考虑novelty, serendipity的同时，还需要考虑utility：该推荐能为系统带来什么收益，例如对百度的变现有多大收益？ 对淘宝的销售有多少收益等 具体这些指标的选择可参见博文：《[选择推荐算法时需要考虑得因素](http://semocean.com/%E9%80%89%E6%8B%A9%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95%E6%97%B6%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E5%BE%97%E5%9B%A0%E7%B4%A0/)》

### **Ranking**

**此部分是成熟的搜索、推荐系统具有的核心逻辑**

比较简单的实现方法， 是直接对各种特征拍阈值进行线性加权，比较成熟的系统一般会使用机器学习的方式和综合个维特征， 学习出模型后进行排序， 例如使用Learning to rank技术。 该部分需要考虑的因素较多较为复杂。 和传统的推荐相比， 此处单独将Ranking拿出来。 基础推荐挖掘， 和传统的推荐部分比较类似，主要结合user profile， 挖掘哪些item适合推给哪些user。 但仅根据这些挖掘就直接进行推荐是不够的。 真实online推荐场景中， 需要考虑更多其他因素， 例如：相关性，推荐的上下文，CTR预估，以及商业业务规则。
- 相关性： item与用户的相关性，这是大多数搜索和推荐任务的基石，例如在搜索中判定一个query和一个document的相关性，或是一个query 和 另一个query的相关性，或是在特征比较多的情况下， 一个user 和一个item 记录的相关性；实现方式可以很简单，例如传统的相似度度量方式（参见博文：《[推荐系统中的相似度度量](http://semocean.com/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%BA%A6%E9%87%8F/)》），对于文本，业界使用简单的TF*IDF，或是BM25； 不过很多时候我们需要增加更多维度特征，包括推荐item本身的重要性，例如IDF，Pagerank(具体参见博文：《[pagerank的经济学效用解释](http://semocean.com/pagerank%E7%9A%84%E7%BB%8F%E6%B5%8E%E5%AD%A6%E6%95%88%E7%94%A8%E8%A7%A3%E9%87%8A/)》)，同时使用模型来提升相关性判断的准确性。使用模型的方式会更加复杂，但效果提升也非常明显。具体可参见博文：《[集成树类模型及其在搜索推荐系统中的应用](http://semocean.com/%E9%9B%86%E6%88%90%E6%A0%91%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%85%B6%E5%9C%A8%E6%90%9C%E7%B4%A2%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/)》，《[分类模型在关键词推荐系统中的应用](http://semocean.com/%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%9C%A8%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/)》，《[adaboost](http://semocean.com/adaboost/)》
- 推荐的上下文：例如推荐产品的入口，交互方式， 不同的入口，甚至同一入口的不同交互方式， 推荐的结果有可能都需要不一样； 在LBS生活服务中， 请求发生的时间， 地点也是推荐需要重点考虑的上下文因素，例如饭点对餐饮item的提权； 异地情况下对酒店等结果的加权等
- CTR预估：成熟的商业系统都会使用模型来完成CTR预估，或是转化预估
- 以及商业业务规则：例如黑白名单，或者强制调权。例如在百度关键词搜索推荐中，某些有比较高变现潜力的词， 就应该加权往前排； 比如在高德LBS服务中，有些海底捞的店点评评分较低， 但我们也应该往前排；或是在搜索引擎中，搜国家领导人的名字， 有些最相关的结果可能因为法律因素是需要屏蔽的



本文转自[http://semocean.com](http://semocean.com/)](https://so.csdn.net/so/search/s.do?q=搜索&t=blog)](https://so.csdn.net/so/search/s.do?q=推荐系统&t=blog)




