# 函数指针数组-奇思妙用 - V__KING__的专栏 - CSDN博客





2018年12月28日 13:28:17[v__king__](https://me.csdn.net/V__KING__)阅读数：36








笔者在开发某软件过程中遇到这样一个问题，前级模块传给我二进制数据，输入参数为 char* buffer和 int length，buffer是数据的首地址，length表示这批数据的长度。数据的特点是：长度不定，类型不定，由第一个字节（buffer[0]）标识该数据的类型，共有256（28 ）种可能性。我的任务是必须对每一种可能出现的数据类型都要作处理，并且我的模块包含若干个函数，在每个函数里面都要作类似的处理。若按通常做法，会写出如下代码：

```
void MyFuntion( char* buffer, int length )
{
　　　　__int8 nStreamType = buffer[0];

　　　　switch( nStreamType )
　　　　{
　　　　　　　case 0:
　　　　　　　　　　　function1();
　　　　　　　　　　　break;
　　　　　　　case 1:
　　　　　　　......
　　　　　　　case 255:
　　　　　　　　　　　function255();
　　　　　　　　　　　break;
　　　　　}
}
```

如果按照这种方法写下去，那么在我的每一个函数里面，都必须作如此多的判断，写出的代码肯定很长，并且每一次处理，都要作许多次判断之后才找到正确的处理函数，代码的执行效率也不高。针对上述问题，我想到了用函数指针数组的方法解决这个问题。

函数指针的概念，在潭浩强先生的C语言程序设计这本经典的教程中提及过，在大多数情况下我们使用不到，也忽略了它的存在。函数名实际上也是一种指针，指向函数的入口地址，但它又不同于普通的如int*、double*指针，看下面的例子来理解函数指针的概念：

```
int funtion( int x, int y );
void main ( void ) 
{
 　　　int (*fun) ( int x, int y );
 　　　int a = 10, b = 20;
 　　　function( a, b );
 　　　fun = function;
 　　　（*fun）( a, b );
 　　　　……
}
```

语句1定义了一个函数function，其输入为两个整型数，返回也为一个整型数（输入参数和返回值可为其它任何数据类型）；语句3定义了一个函数指针，与int*或double*定义指针不同的是，函数指针的定义必须同时指出输入参数，表明这是一个函数指针，并且*fun也必须用一对括号括起来；语句6将函数指针赋值为funtion，前提条件是*fun和function的输入参数和返回值必须保持一致。语句5直接调用函数function（），语句7是调用函数指针，二者等效。

当然从上述例子看不出函数指针的优点，目的主要是想引出函数指针数组的概念。我们从上面例子可以得知，既然函数名可以通过函数指针加以保存，那们也一定能定义一个数组保存若干个函数名，这就是函数指针数组。正确使用函数指针数组的前提条件是，这若干个需要通过函数指针数组保存的函数必须有相同的输入、输出值。

这样，我工作中所面临的问题可以解决如下：

首先定义256个处理函数(及其实现)。

```
void funtion0( void );
……..
void funtion255(void );

其次定义函数指针数组，并给数组赋值。
```c
void (*fun[256])(void);

fun[0] = function0;
…….
fun[255] = function();
```

最后，MyFunction()函数可以修改如下：

```
void MyFuntion( char* buffer, int length )
{
　　　　__int8 nStreamType = buffer[0];
　　　　（*fun[nStreamType]）();
}
```

只要2行代码，就完成了256条case语句要做的事，减少了编写代码时工作量，将nStreamType作为数组下标，直接调用函数指针，从代码执行效率上来说，也比case语句高。假如多个函数中均要作如此处理，函数指针数组更能体现出它的优势。

作者：博瓦

来源：CSDN

原文：[https://blog.csdn.net/u010925447/article/details/74295692](https://blog.csdn.net/u010925447/article/details/74295692)

版权声明：本文为博主原创文章，转载请附上博文链接！



