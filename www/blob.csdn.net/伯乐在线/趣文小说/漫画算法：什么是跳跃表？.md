# 漫画算法：什么是跳跃表？ - 文章 - 伯乐在线
本文作者： [伯乐在线](http://blog.jobbole.com) - [玻璃猫](http://www.jobbole.com/members/bjweimengshu) 。未经作者许可，禁止转载！
欢迎加入伯乐在线 [专栏作者](http://blog.jobbole.com/99322)。
这是发生在很多年以前的故事……
![](http://jbcdn2.b0.upaiyun.com/2017/07/daab64eb4fff66513ac482d07e5ae054.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/890d2a8f840ed95165dcd3df24ed584c.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/1ec995966632cc86d75a2511bba11c5c.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/b0c602dc9acb987c129f35169341b74d.jpeg)
几天以前……
![](http://jbcdn2.b0.upaiyun.com/2017/07/53f3319b898ce41a545b29d930946a2a.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/5f1e257214c48a4d8246b9395bb0f0df.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/10dd099feb00060dad6b1339e0db8799.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/45606dfe47cc5586318007d1970f26e5.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/0716a40761dbfdbf797543bb24b58945.jpeg)
几天之后……
![](http://jbcdn2.b0.upaiyun.com/2017/07/5f5785668595f59e8ba4778cae9f2d6a.jpeg)
拍卖行的商品总数量有几十万件，对应数据库商品表的几十万条记录。
如果是按照商品名称精确查询还好办，可以直接从数据库查出来，最多也就上百条记录。
如果是没有商品名称的全量查询怎么办？总不可能把数据库里的所有记录全查出来吧，而且还要支持不同字段的排序。
所以，只能提前在内存中存储有序的全量商品集合，每一种排序方式都保存成独立的集合，每次请求的时候按照请求的排序种类，返回对应的集合。
比如按价格字段排序的集合：
比如按等级字段排序的集合：
需要注意的是，当时还没有Redis这样的内存数据库，所以小灰只能自己实现一套合适的数据结构来存储。
![](http://jbcdn2.b0.upaiyun.com/2017/07/8eadcb96909cbebc38292974d5216fab.jpeg)
拍卖行商品列表是线性的，最容易表达线性结构的自然是数组和链表。可是，无论是数组还是链表，在插入新商品的时候，都会存在性能问题。
按照商品等级排序的集合为例，如果使用数组，插入新商品的方式如下：
![](http://jbcdn2.b0.upaiyun.com/2017/07/af7f12cccfbda80b967d515acebe79d9.jpeg)
如果要插入一个等级是3的商品，首先要知道这个商品应该插入的位置。使用二分查找可以最快定位，这一步时间复杂度是O（logN）。
插入过程中，原数组中所有大于3的商品都要右移，这一步时间复杂度是O（N）。所以总体时间复杂度是O（N）。
如果使用链表，插入新商品的方式如下：
![](http://jbcdn2.b0.upaiyun.com/2017/07/1bce6be23668647edf9eff28d305c84f.jpeg)
如果要插入一个等级是3的商品，首先要知道这个商品应该插入的位置。链表无法使用二分查找，只能和原链表中的节点逐一比较大小来确定位置。这一步的时间复杂度是O（N）。
插入的过程倒是很容易，直接改变节点指针的目标，时间复杂度O（1）。因此总体的时间复杂度也是O（N）。
这对于拥有几十万商品的集合来说，这两种方法显然都太慢了。
![](http://jbcdn2.b0.upaiyun.com/2017/07/e3be5ef6ac109306ee1dd169fb6b8df3.jpeg)
——————————————
![](http://jbcdn2.b0.upaiyun.com/2017/07/00e8f84563ba3fc4e926f4b8b2f5fe7a.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/e795edb90cf7d598d733592920657a97.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/d3cd2a28c4e3e48550d33f7fe4a47fd0.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/02717bbe18ec7d1034580481ffa22e7e.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/9bfe1887ff9177a8c0f303de054c79fe.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/377693e7b3f37892f42e4e144f92c362.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/0b9b3c90dc0681f0af4963d783dff24d.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/15ece5c25170a528131c4e7803c8e0e8.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/a58d35069f85e181659f2c8dc98cffbc.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/325af9d7f350486e58b41b32bd254227.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/c708e4a0c267b5e9f3a37ad309e6c3e8.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/fa5f0684ada4d509f3e978c104f576ac.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/4d469cbe0d0afb9bb7cf2c99f266a5f9.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/d972154799e05c43dc61c56cbc182203.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/e0ef1f5c4cbfa110713984f06904c97a.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/bb33df3e70571a35b0d38cfa2aa0f719.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/c66bd9b6ba634f5df05dfb4931201217.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/757e77b87645239013108a7eac7cac78.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/a502d32bad14a5943b78e5ec283eb6a3.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/ea99ed67b7cdb47d04c3703f12a64bc4.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/e98cfa966bb1cfa58a5e8a11505a3e0f.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/6e5972f05c028476a0b2eb43850a1432.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/ea50cbc49ca84c72b94cb693d121c017.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/3063e527ca511c457824b146b3047fb2.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/ad1e060829476ef9de94d33ea246009d.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/f0fed037f81a07b51108a6d6468e4235.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/6f7628b9803eaae385222da353b34b83.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/0b69b19d022c8a75aa2d83fca3d10066.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/a327ac84038bdf376496a07a5d61d23d.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/98b8caa7a5b7da9aaf7999a7f502fd92.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/df485893afb0b40cfec65ce19233faa6.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/0c38e0ee3659932960bbc9b3c310fab8.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/dedddf4bf8ad251e479ce73ef0f628c9.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/4b8a95bfc81b232d79b2c8056ca454ec.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/4f6bafe8717d30780a0bc7ae1110c37d.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/9e92dc231f4069da54a71fa6be3bd12e.jpeg)
新节点和各层索引节点逐一比较，确定原链表的插入位置。O（logN）
把索引插入到原链表。O（1）
利用抛硬币的随机方式，决定新节点是否提升为上一级索引。结果为“正”则提升并继续抛硬币，结果为“负”则停止。O（logN）
总体上，跳跃表插入操作的时间复杂度是O（logN），而这种数据结构所占空间是2N，既空间复杂度是 O（N）。
![](http://jbcdn2.b0.upaiyun.com/2017/07/95b14789cf228b85159be05aa93cbaa4.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/0a64ff5e6453328bf1360416339c0adb.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/0da2ce061fbca4790c93b0139e66d289.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/86a6084f88fa592dd304e890b72409eb.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/7c32aa5ab5f2c936078f16840eabf1b2.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/41d9de8c654dc43b0f1703b0e29c6590.jpeg)
自上而下，查找第一次出现节点的索引，并逐层找到每一层对应的节点。O（logN）
删除每一层查找到的节点，如果该层只剩下1个节点，删除整个一层（原链表除外）。O（logN）
总体上，跳跃表删除操作的时间复杂度是O（logN）。
![](http://jbcdn2.b0.upaiyun.com/2017/07/24f060f88decdf946d1069ce4c82f57d.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/e7566dee2274eb9bfcefcc13c1a7494c.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2017/07/869228a1933d8e4a9e8ec81afc0603d5.jpeg)
小灰和大黄并不知道，他们的这一解决方案和若干年后Redis当中的Sorted-set不谋而合。而Sorted-set这种有序集合，正是对于跳跃表的改进和应用。
> 
**打赏支持我写出更多好文章，谢谢！**
[打赏作者](#rewardbox)
#### 打赏支持我写出更多好文章，谢谢！
![](http://jbcdn2.b0.upaiyun.com/2016/10/2df4a3ede6e684f78858dfde0e7b118f.jpeg)
