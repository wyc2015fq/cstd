# MySQL全文索引应用简明教程 - 文章 - 伯乐在线
原文出处： [一颗卤蛋](http://www.cnblogs.com/lyroge/p/3837899.html)
本文从以下几个方面介绍下MySQL全文索引的基础知识：
- MySQL全文索引的几个注意事项
- 全文索引的语法
- 几种搜索类型的简介
- 几种搜索类型的实例
### 全文索引的几个注意事项
- 搜索必须在类型为fulltext的索引列上，match中指定的列必须在fulltext中指定过
- 仅能应用在表引擎为MyIsam类型的表中（MySQL 5.6以后也可以用在Innodb表引擎中了）
- 仅能再char、varchar、text类型的列上面创建全文索引
- 像普通索引一样，可以在定义表时指定，也可以在创建表后添加或者修改
- 对于一个大数量级记录插入，向没有索引的表中插入数据后创建索引比向有索引的数据表中插入的过程要快很多
- 搜索字符串必须是一个常量字符串，不能是表的列名
- 在搜索记录的选择性超过50%的时候，认为没有匹配（只在自然搜索中限制）
### 全文索引搜索语法
> 
MATCH (列名1, 列名2,…) AGAINST (搜索字符串 [搜索修饰符])
其中在match里面指定的列名1、2等，就是在建立全文索引中指定的列名， 后面的搜索修饰符说明如下：
> 
search_modifier:
{
IN NATURAL LANGUAGE MODE
| IN NATURAL LANGUAGE MODE WITH QUERY EXPANSION
| IN BOOLEAN MODE
| WITH QUERY EXPANSION
}
### 几种搜索类型的简介
上面的搜索修饰符，实际上说明了3种全文搜索类型
### IN NATURAL LANGUAGE MODE
简介：默认的搜索形式（不加任何搜索修饰符或者修饰符为 IN NATURAL LANGUAGE MODE 的情况）
特点：
- 对于搜索字符串中的字符都解析为正常的字符，没有特殊意义
- 对屏蔽字符列表中的字符串进行过滤
- 当记录的选择性超过50%的时候，通常被认为是不匹配。
- 返回记录按照记录的相关性进行排序显示
### IN BOOLEAN MODE
简介：布尔模式搜索（搜索修饰符为IN BOOLEAN MODE的情况）
特点：
- 会按照一定的规则解析搜索字符串中的特殊字符的含义，进行一些逻辑意义的规则。如：某个单词必须出现，或者不能出现等。
- 这种类型的搜索返回的记录是不按照相关性进行排序的
### WITH QUERY EXPANSION
简介：一种稍微复杂的搜索形式，实际上是进行了2次自然搜索，可以返回记录直接简介性关系的记录，修饰词IN NATURAL LANGUAGE MODE WITH QUERY EXPANSION 或者WITH QUERY EXPANSION modifier
特点：这种类型的搜素，实际上提供了一种间接的搜索功能，比如：我搜索某个词，而且返回的第一行中却不包含搜索词中的任意字符串。可以根据第一次搜索结果的记录词进行第二次匹配，从而可能找到一些间接关系的匹配记录。
### 几种搜索类型的实例介绍
**IN NATURAL LANGUAGE MODE模式下的应用： **
还是应用在product表，其中在name字段我们建立了全文索引，因为我需要根据关键词在name列匹配出相关记录
Sql语句如下：
> 
SELECT * FROM product WHERE match(name) against(‘auto’)
时间还不错，在将近87w的记录中命中了1w多条，耗时1.15秒，效果还是不错
注意：在默认的情况下已经是根据相关性从高到低返回记录了
我们可以SELECT match(name) against(‘auto’) FROM product 查看记录的相关性值，值都在0和1之间， 0代表记录不匹配
###  重要的几个特性：
1. 哪些词会被忽略
搜索词太短 默认全文索引认为4个以上字符的单词是有效词，我们可以在配置中修改ft_min_word_len进行配置
屏蔽词表中的词 默认的全文索引将一些常用词屏蔽掉，因为这些词太常见了，没有任何语义作用，所以搜索过程中是忽略不计的。当然这个列表也是可以配置的。
2. 如何进行分词的
全文索引认为一个连续的有效字符（正则中\w匹配的字符集）是一个单词，也可以包含一个“’”， 但是连续的两个’会被认为是一个分隔符。其他的分隔符如：空格、逗号、句点等
**IN BOOLEAN MODE 模式下的应用：**
在布尔匹配模式中，我们可以添加一些特殊的符号，增加一些搜索过程的逻辑功能。如官方网站中提供的实例（搜索含有mysql字符串 且 不含Yousql的语句）：
> 
 SELECT * FROM articles WHERE MATCH (title,body)
-> AGAINST (‘+MySQL -YourSQL’ IN BOOLEAN MODE);
可见，我们对搜索的控制又多了一些，看起来“高大上”了些。
实际上，上面的操作隐含了几个意思：
- 加号：相当于and
- 减号：相当于not
- 没有：相当于or
**下面看下布尔类型搜索的几个重要特性： **
- 1. 没有50%记录选择性的限制，即使搜索结果记录超过总数的50%也同样返回结果
- 2. 不会自动的按记录的相关性进行降序排序
- 3. 可以直接应用在没有创建fulltext的全文索引上，但是这样会查询的非常慢，所以说还是别用了。
- 4. 支持最小、最大单词长度
- 5. 应用屏蔽词列表
### 布尔搜索支持的操作符：
- n 加号 +：指示修饰的单词必须出现在记录中
- n 减号 -：指示修饰的单词必须不能出现在记录中
- n 没有任何操作符：单词可有可无，但是包含该词的记录相关性高
- n 双引号 “ ： 将一个词组作为一个匹配。如：”one word” 匹配one word在一起的单词
### 下面是官方的一些实例：
> 
至少包含一个词的记录
‘apple banana’
必须包含着两个词
‘+apple +juice’
必须包含apple，包含macintosh的记录相关性高，也可以不包含
‘+apple macintosh’
必须包含apple且不能喊有macintosh
‘+apple -macintosh’
查找apple开头单词的记录
‘apple*’
完整匹配some words单词
‘”some words”‘
了解了基本的mysql全文索引知识，觉得它的全文索引比like当然是强了很多。但是面对高级的搜索还是略显简陋，且性能问题也是担忧。
本人只是作为入门了解，也是对官网一些基本知识的翻译。
