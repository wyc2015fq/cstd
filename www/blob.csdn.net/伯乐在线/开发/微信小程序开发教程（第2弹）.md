# 微信小程序开发教程（第2弹） - 文章 - 伯乐在线
本文作者： [伯乐在线](http://blog.jobbole.com) - [博卡君](http://www.jobbole.com/members/bokajun) 。未经作者许可，禁止转载！
欢迎加入伯乐在线 [专栏作者](http://blog.jobbole.com/99322)。
本系列：
《[微信小程序开发教程（第1弹）](http://blog.jobbole.com/106049/)》
今天一波三折，承受了超出预料的压力和煎熬，最后还是决定继续放出我的更新教程。我想我一没有泄露公司的代码，二没有提供泄露开发工具下载，只是从程序猿角度写了篇开发日志。我已经做好了最坏的准备，就算放弃这份工作，也会把完成的教程交给「名片盒」的团队继续更新发布下去！做了就绝不后悔！只是博卡君水平有限，文章还请各位多包容。
以上！开始吧：
**小提示：**
> 
9月24日深夜，微信官方向外公开了微信小程序的文档 （含 API ）：
[https://mp.weixin.qq.com/debug/wxadoc/dev/index.html](https://mp.weixin.qq.com/debug/wxadoc/dev/index.html)
### 第三章：微信小程序项目结构以及配置
找到创建的 demo 文件夹，把项目导入到你的编辑器，这里使用的是 Sublime Text 编辑器。
![](http://jbcdn2.b0.upaiyun.com/2016/09/206b6be6c273cd0d9b1f4d6c1655a537.jpeg)
这个时候需要根据自己的项目需求结构进行更改了，项目根目录下面是首页渲染的几个 tabBar 页面，以及 app 的一些配置文件，如名片盒项目的 tabBar 是 3 个切换菜单：
![](http://jbcdn2.b0.upaiyun.com/2016/09/b8897bce0f8f393da9a1aa6e5a8b118a.jpeg)
我们先找到 app.json 文件打开配置好这几个菜单，配置好 ”tabBar”，这个直接把配置文件改成你自己设计的即可。
![](http://jbcdn2.b0.upaiyun.com/2016/09/4bebdd5af234203cb0eb8f7edbb86dc1.jpeg)
App.json 里面有几个配置项：
- Pages：这个是编写的 js 文件，后缀 .js 这里不需要使用，配置好正确路径即可正常应用到（应用不到在重启微信开发者工具会直接报 page 错误）。
- Window：配置顶部的一些样式，文档介绍比较详细。
- tabBar：底部的几项配置，见名知意。
- networkTimeout：暂时没发现用处，建议看文档。
- 根据实际项目需求进行添加与更改。
- iconPath 和 selectedIconPath：底部菜单按钮图片与得到切换点击高亮。
- “text”：可以去掉，全部去掉会发现底部 tabar 高度会减少很多。
![](http://jbcdn2.b0.upaiyun.com/2016/09/f1bab288fea9c78d12242c34182a7e0c.png)
Json 文件配置好后，根据项目进行文件创建，
Demo：存放的是假数据，这一期的开发工具支持 require，假数据使用的是 .js 文件形式，
里面的数据结构 json 一致，把 data 暴露出去即可。
![](http://jbcdn2.b0.upaiyun.com/2016/09/56cd21ffcb66c55299f31a213bc09fd3.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2016/09/2f813be928b66de456c0c23576c4d930.jpeg)
然后取数据 require 进来即可，这一点使用很方便；
Images：图片路径；
Page：除 tabar 以外的页面；
Servise：服务交付层（与后台联调真实数据时使用）；
Wxss：一些公共的 css 文件。
看到这里大家发现每个页面都被连带好三个不同的后缀。分别页面，css，js 目前只能依照这样，是微信应用号的一个规范吧。
![](http://jbcdn2.b0.upaiyun.com/2016/09/4ba0871bade6d5ff22c1de07f3833341.jpeg)
Wxss 文件是引入你写的样式文件，也可以直接在里面写样式。
![](http://jbcdn2.b0.upaiyun.com/2016/09/b5c7d668fd75bfef8ff68b46872179f2.jpeg)
Js 文件需全部配置到 pages 里面才能生效。
![](http://jbcdn2.b0.upaiyun.com/2016/09/62f56d38aeb118c3c3a29326fd79bd5f.jpeg)
下一章：微信小程序首页面开发。
### 第四章：微信小程序首页面开发
进行了各种准备与配置后，来到首页开发。首先需要实现首页效果图如下：
![](http://jbcdn2.b0.upaiyun.com/2016/09/293587521659ca21a6af0bf04cfed86f.png)
![](http://jbcdn2.b0.upaiyun.com/2016/09/804d17a4dad8f3794942a3f92c71bf41.jpeg)
Template 名片很多，需要用模板。
这里需要微信提供的基础组件大致是 input（搜索框）、
action-sheet（右边是个底部下拉菜单，需要下拉菜单）、
Scroll-view (右边 ABC 跳转)、（这个目前实现还有点问题，正在攻克中）。
![](http://jbcdn2.b0.upaiyun.com/2016/09/d82f050944367016a67e756ac0dd9375.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2016/09/f794fd77ca7ce2acbf9bedfa83d9bab0.jpeg)
View 是块元素，整个搜索框的一个样式。
![](http://jbcdn2.b0.upaiyun.com/2016/09/38ff7887d0cd7804fd14db7906991e2f.jpeg)
- 名片夹：由于该项目主打名片功能，故很多地方使用，所以需要把名片以 template 分离出来。
- Template：定义一个模板，name 模板的名字其实是个作用域。
- Block：循环控制，名片很多，必须用循环出来，和很多操作数据的前端框架循环差不多。
- 支持自定义属性 data，这里用作判断线上名片以及线下名片。
View 里面是一些数据引入，里面是支持三目运算符。
![](http://jbcdn2.b0.upaiyun.com/2016/09/a32b1dc426ec872d97deecd107ec8f8e.jpeg)
引入 template 时非常方便，is 和 name 一样，data 是 nameData 传递过来的数据填充。
一切都绑定数据为中心点。
![](http://jbcdn2.b0.upaiyun.com/2016/09/20b3536e5ed00936d0ff9446405eb8ee.jpeg)
取到数据具体操作根据你数据结构：
![](http://jbcdn2.b0.upaiyun.com/2016/09/eda67e56e31452d134ba52105bca2cec.jpeg)
这里的数据结构和 json 数据结构一样，
![](http://jbcdn2.b0.upaiyun.com/2016/09/7bfed25c9560909b45431707ec24b173.jpeg)
这里如要传到页面的话即是
> 
this.setData({
nameData:card_list_name.data.cards,
timeData:card_list_time.data.cards
});
因为页面遍历的是 nameData,timeData
![](http://jbcdn2.b0.upaiyun.com/2016/09/4f9742d8d661a2fe54397977eae41e5f.jpeg)
可以看下打印出来的数据结构，根据你的结构进行解析与传递。
![](http://jbcdn2.b0.upaiyun.com/2016/09/693d959ceb0843e7894f10ab678d09f4.jpeg)
也可以看下这里对数据的一些操作。（这里须根据定义的 json 数据格式来操作的）
![](http://jbcdn2.b0.upaiyun.com/2016/09/4d49ce8cdc4d94ee29b9e70a7abfc808.jpeg)
名片的样式由于很多页面需要使用放在 common.css 里面，这个 common.css 是所有页面都需要用到，一些初始化设置。它是在 pp.wxss 里面引用之后才能被映射到全局 APP。
![](http://jbcdn2.b0.upaiyun.com/2016/09/7db557338a17301d071d43ee811ef8d3.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2016/09/51b0f53aa78f0a4575b8303ba78fc363.jpeg)
搜索框：其中 bindChange 为输入框发生改变事件。微信提供的 bindchange 在支持方面还有小问题，目前是失去焦点才能触发到此事件的发生，待后续完善吧，先实现功能再说。
![](http://jbcdn2.b0.upaiyun.com/2016/09/294add3a45127bb4d064c2915051d616.jpeg)


```
bindInputChange: function(e) {
    //发生搜索事情
    var self = this; //this绑定，这个this指向微信的提供window
    var Text = e.detail.value.toUpperCase(); //取到输入的内容
    if (Text == "") { //如果输入为空一些东西需要显示否则不显示
        show_letter = "block";
    } else {
        show_letter = "none";
    }
    this.setData({
        show_letter: show_letter,
        showSheet: true
    });
    var res = nameData;获取到传递的数据
    if (data_type == "name") {} else if (data_type == "time") {
        res = timeData;
    };
    for (var k in res) { //for-in循环取到data里面的cards
        var data = res[k].cards;
        for (var i = 0; i < data.length; i++) { //循环取到需要搜索的关键字对比
            If(data[i].userName != null && data[i].userName.indexOf(Text) != -1) {
                data[i]["display"] = "block"; //存在就是赋值显示
            } else {
                data[i]["display"] = "none"; // 不存在赋值不显示
            }
        }
    }
}
```
![](http://jbcdn2.b0.upaiyun.com/2016/09/39353ffc99b0dd22cf2863eb160f5421.jpeg)
菜单栏：做到菜单栏，使用微信提供的下拉菜单组件 action-sheet，它被触发的条件在这里。
![](http://jbcdn2.b0.upaiyun.com/2016/09/cd6263757dcd16ce0edd5221a5f6cd3b.jpeg)
一切以绑定事件为起点：


```
bindButtonTapSheet: function(e) {
    //调取底部下拉菜单栏
}
```
还是得先布好局才能被调动。
![](http://jbcdn2.b0.upaiyun.com/2016/09/d7cb925148adcd332f7b0b3461fe86f2.jpeg)
Js 配置：
![](http://jbcdn2.b0.upaiyun.com/2016/09/225e05752c769fd064e08c0fe11e71d2.jpeg)
Data 初始化数据：
![](http://jbcdn2.b0.upaiyun.com/2016/09/974fddd05c56386f5ad703c3d82d6044.jpeg)
这里得取非，直接设置 false 调不出来: 调用事件。
![](http://jbcdn2.b0.upaiyun.com/2016/09/f6f57055a0575076dea9486234d088de.jpeg)
调出来还得去掉它啊：如下相同即可
![](http://jbcdn2.b0.upaiyun.com/2016/09/f5ea6a0d005fdbe28a1aaf03a87d3196.jpeg)
取消直接上事件即可。（分为菜单栏外部与底部）
![](http://jbcdn2.b0.upaiyun.com/2016/09/b0d6a8b17daddc9efb0c9ba76f06cf8f.jpeg)
![](http://jbcdn2.b0.upaiyun.com/2016/09/a8713bb23b6e787ecd1075949eaac728.jpeg)
//好了，就是这么简单。实现效果简单，体验效果确实非常不错。
![](http://jbcdn2.b0.upaiyun.com/2016/09/af2bbd4aa69b5b03a0cfdd9c7085b769.png)
还需要个 loading 效果（暂时没做动画，后期再考虑。）
Loading 布局
![](http://jbcdn2.b0.upaiyun.com/2016/09/0956bffdbe416bb651543570381d2410.jpeg)
首页的最外层 view
![](http://jbcdn2.b0.upaiyun.com/2016/09/4c511e8b6ab790e2fc2946a11c9d106a.jpeg)
根据微信的生命周期


```
Onload: function(e) {
    this.setData({
        toastDisplay: ”block”,
        htmlWrapDisplay: ”none”
    })
},
onShow: function(e) {
    this.setData({
        toastDisplay: ”none”,
        htmlWrapDisplay: ”block”
    })
}
```
加载条完成。
![](http://jbcdn2.b0.upaiyun.com/2016/09/35ac3b70352087284184d94aadb60216.jpeg)
扫一扫，直接调用拍照功能，从这里看到微信提供的拍照 api 使用起来非常快速，只需根据需求配置即可。
![](http://jbcdn2.b0.upaiyun.com/2016/09/a0a86fdb2f17cf197045329e587d2d1f.jpeg)
点击扫一扫之后，在开发者工具即可看到如下效果。
![](http://jbcdn2.b0.upaiyun.com/2016/09/8bde1456199d91e5dfaf40d60fbf4b44.jpeg)
做到这里说明下，dom 长度有限制，页面的结构太长，也是无法渲染的，暂且把公司排序暂时先去掉了。
![](http://jbcdn2.b0.upaiyun.com/2016/09/55b85bc4b0cf9a32ad578917e8add7a5.jpeg)
左边的 ABC 跳转（还在继续完善中）。
这里还有个左滑删除名片功能，微信没有提供这个在移动端很实用的功能真的比较遗憾，后面得花点时间自己写下（后续完善）。
