# C 中 static 的常见作用 - 文章 - 伯乐在线
原文出处： [zhenhuaqin，2011-02-28](http://blog.chinaunix.net/uid-21411227-id-1826981.html)
C程序一直由下列部分组成：
  1）正文段——CPU执行的机器指令部分；一个程序只有一个副本；只读，防止程序由于意外事故而修改自身指令；
  2）初始化数据段（数据段）——在程序中所有赋了初值的全局变量，存放在这里。
  3）非初始化数据段（bss段）——在程序中没有初始化的全局变量；内核将此段初始化为0。
  4）栈——增长方向：自顶向下增长；自动变量以及每次函数调用时所需要保存的信息（返回地址；环境信息）。
  5）堆——动态存储分。
**1****．全局静态变量**
在全局变量之前加上关键字static，全局变量就被定义成为一个全局静态变量。
1）内存中的位置：静态存储区（静态存储区在**整个程序运行期间**都存在）
2）初始化：未经初始化的全局静态变量会被程序自动初始化为0（自动对象的值是任意的，除非他被显示初始化）
3）作用域：全局静态变量在声明他的文件之外是不可见的。**准确地讲从定义之处开始到文件结尾。**
**好处：**
定义全局静态变量的好处：
（1）不会被其他文件所访问，修改
（2）其他文件中可以使用相同名字的变量，不会发生冲突。
**2****．局部静态变量**
在局部变量之前加上关键字static，局部变量就被定义成为一个局部静态变量。
  1）内存中的位置：静态存储区
  2）初始化：未经初始化的全局静态变量会被程序自动初始化为0（自动对象的值是任意的，除非他被显示初始化）
  3）作用域：作用域仍为局部作用域，当定义它的函数或者语句块结束的时候，作用域随之结束。
注：当static用来修饰局部变量的时候，它就改变了局部变量的存储位置，从原来的栈中存放改为静态存储区。**但是**局部静态变量在离开作用域之后，并没有被销毁，而是仍然驻留在内存当中，直到程序结束，只不过我们不能再对他进行访问。
当static用来修饰全局变量的时候，它就改变了全局变量的作用域（在声明他的文件之外是不可见的），但是没有改变它的存放位置，还是在静态存储区中。
**3. ****静态函数**
在函数的返回类型前加上关键字static，函数就被定义成为静态函数。
**函数的定义和声明默认情况下是extern****的，但静态函数只是在声明他的文件当中可见，不能被其他文件所用。**
定义静态函数的好处：
（1）其他文件中可以定义相同名字的函数，不会发生冲突
（2）静态函数不能被其他文件所用。 存储说明符auto，register，extern，static，对应两种存储期：自动存储期和静态存储期。 auto和register对应自动存储期。具有自动存储期的变量在进入声明该变量的程序块时被建立，它在该程序块活动时存在，退出该程序块时撤销。
关键字extern和static用来说明具有静态存储期的变量和函数。用static声明的局部变量具有静态存储持续期（static storage duration），或静态范围（static extent）。虽然他的值在函数调用之间保持有效，但是其名字的可视性仍限制在其局部域内。**静态局部对象在程序执行到该对象的声明处时被首次初始化。**
**4****．由于****static****变量的以上特性，可实现一些特定功能。**
1）统计次数功能
声明函数的一个局部变量，并设为static类型，作为一个计数器，这样函数每次被调用的时候就可以进行计数。这是统计函数被调用次数的最好的办法，因为这个变量是和函数息息相关的，而函数可能在多个不同的地方被调用，所以从调用者的角度来统计比较困难。
**5****．不同类型变量的区别**
与auto类型(普通)局部变量相比, static局部变量有三点不同
1） 存储空间分配不同
auto类型分配在栈上, 属于动态存储类别, 占动态存储区空间, 函数调用结束后自动释放, 而static分配在静态存储区, 在程序整个运行期间都不释放. 两者之间的作用域相同, 但生存期不同.
2）static局部变量在所处模块在初次运行时进行初始化工作, 且只操作一次
3）对于局部静态变量, 如果不赋初值, 编译期会自动赋初值0或空字符, 而auto类型的初值是不确定的. (对于C++中的class对象例外, class的对象实例如果不初始化, 则会自动调用默认构造函数, 不管是否是static类型)
**特点: static****局部变量的”记忆性”与生存期的”全局性”**
所谓”记忆性”是指在两次函数调用时, 在第二次调用进入时, 能保持第一次调用退出时的值.
**6****．外部静态变量／函数**
**在C****中 static****有了第二种含义：用来表示不能被其它文件访问的全局变量和函数**。但为了限制全局变量/函数的作用域, 函数或变量前加static使得函数成为静态函数。但此处“static”的含义不是指存储方式，而**是指对函数的作用域仅局限于本文件****(****所以又称内部函数)****。**注意此时, 对于外部(全局)变量, 不论是否有static限制, 它的存储区域都是在静态存储区, 生存期都是全局的. 此时的static只是起作用域限制作用, 限定作用域在本模块(文件)内部.
**使用内部函数的好处是：不同的人编写不同的函数时，不用担心自己定义的函数，是否会与其它文件中的函数同名。**
