# 每天学点C++知识：大于0并不意味着等于1 - 文章 - 伯乐在线
本文由 [伯乐在线](http://blog.jobbole.com) - [黄小非](http://www.jobbole.com/members/huangxiaofei) 翻译，[至秦](http://www.jobbole.com/members/applevip) 校稿。未经许可，禁止转载！
英文出处：[Andrey Karpov](http://cpphints.com/hints/3)。欢迎加入[翻译组](https://github.com/jobbole/translation-project)。
静态代码分析工具可简化编码过程，检测出错误并帮助修复。有个国外团队检测了 200 多个 C/C++ 开源项目，包括了 Php、Qt 和 Linux 内核等知名项目。于是他们每天分享一个错误案例，并给出相应建议。
*译注：本文所指出的错误例子其实非常简单，任何 C++ 的初学者都能看懂。但是这个错误也非常典型，估计很多非常严肃的代码里面都存在这样的错误。*
这个 Bug 是来自于 CoreCLR 源代码*（译注：高大上的出处啊！）*
### 错误代码：

C++
```
bool operator( )(const GUID& _Key1, const GUID& _Key2) const
  { return memcmp(&_Key1, &_Key2, sizeof(GUID)) == -1; }
```
### 解释：
你不能将 memcpy()、strcmp() 以及其他一些标准函数的返回值，和 1、-1 这些具体的数字做比较，因为这些函数的返回值只保证大于 0 或者小于 0（译注：而并不保证大于0就等于1，小于0就等于-1）。
上面那段错误的代码可能在很长时间内都能正常工作。不过那仅仅是因为运气好而已，没什么其他原因。某一天你写的函数很可能突然间就崩溃了 —— 比如，你换了一个编译器编译源代码，或者通过其他方式优化了 memcpy() 函数。然后你的代码就不能正常工作了。
### 正确的代码：

C++
```
bool operator( )(const GUID& _Key1, const GUID& _Key2) const
  { return memcmp(&_Key1, &_Key2, sizeof(GUID)) < 0; }
```
### 建议：
不要依赖函数本身的行为。如果文档上说一个函数能返回一个不等于 0 的值，那它就是这么实现的。也就是说这个函数可能返回 -10、2 或者 1024。你可能经常看到函数的返回值就是 -1、0 或者 1，但是这并不能保证它每次都会这么做。
这个错误是通过 PSV-Studio 静态分析工具扫描分析得到的。错误文本如下：V698 表达式 “memcmp(…) == -1“ 是不正确的。这个函数可能的返回值不一定只有“-1”，而可能是任何负数。请考虑到使用 “memcmp(…) < 0 ”来替换。
> 
**打赏支持我翻译更多好文章，谢谢！**
[打赏译者](#rewardbox)
#### 打赏支持我翻译更多好文章，谢谢！
![](http://www.jobbole.com/wp-content/uploads/2016/04/78805a221a988e79ef3f42d7c5bfd4187.jpeg)
