# 科学网—工程数学公式的自动读取 - 蒋迅的博文




# 工程数学公式的自动读取                                                   ![](./static/image/blog/recommendico.gif)精选

已有 7076 次阅读2012-12-7 09:38|个人分类:[科技](http://blog.sciencenet.cn/home.php?mod=space&uid=420554&do=blog&classid=136794&view=me)|系统分类:[科研笔记](http://blog.sciencenet.cn/home.php?mod=space&do=blog&view=all&uid=420554&catid=1)|关键词:工程,,数学,,muParser,,C++|[数学](misc.php?mod=tag&id=286), [工程](misc.php?mod=tag&id=3515), [muParser](misc.php?mod=tag&id=171712)



作者：蒋迅

让我们来看一个简单的例子。这是笔者在工程计算中用到的一个输入文件的一部分，它代表的是一个净化系统的质量的计算公式。


'       purge system'                0  'ps'

 'c' 'c1      '    .090

 'c' 'c2      '    .024

 's' 'wlg5    '        

 's' 'wlx     '        

 'c' 'd_lg    '    1.73

 'c' 'd_lx    '    35.9

 'c' 'rhepg   '     .50

'eng equation'

'(c1*wlg5/d_lg + c2*wlx/d_lx)*(1 - rhepg)'

运行时，软件需要先读入这个输入文件，然后计算这个数学表达式并输出答案。要想实现这个计算并不难。用FORTRAN、Java或C，我们可以在源程序里嵌入函数的定义 (以C语言为例)：


double massPurgeSys(wlg5,wlx,d_lg,d_lx,hrepg) {

  double c1 = 0.9;

  double c2 = 0.024;

  double y = (c1*wlg5/d_lg + c2*wlx/d_lx)*(1 - rhepg);

  return y;

}

如果使用MATLAB这样的软件或Python这样的直译式电脑程式语言的话会更方便，用户可以直接把数学表达式输入计算机进行计算。所以我知道很多人觉得这是一个不值得一提的问题。

但我面临的是，输入文件中的参数和数学表达式都是随时可能被用户改变的。这些公式有些是在书
本中理论推导得到的，有些则是工程师们在长期工作中总结出来的经验公式，而且在设计计算中经常会改变。我们不能要求用户每次都重新编写程序或重新汇编软
件。所以，这些表达式及其所用得参数都必须原封不动地由软件读入，然后由软件来解读翻译并计算。这是本文要介绍的重点。

我们从最简单的例子开始。假定我们要求3和5的和。通常的记法是：
3+5。因为计算的算子在两个数之间，我们把它称为“[中缀表示法](http://zh.wikipedia.org/wiki/%E4%B8%AD%E7%BC%80%E8%A1%A8%E7%A4%BA%E6%B3%95)”([infix notation](http://en.wikipedia.org/wiki/Infix_notation))。


这种表示法有一个缺点，那就是当我们需要计算包括加、减、乘、除、乘方、开方、对数甚至常用
的函数等多种运算的比较复杂的算式时可能会出现混淆。我们必须引入括号来表明计算的顺序。当然大家平时可能并不都用括号，那是因为我们已经默认了“先乘除
后加减”的等规则。问题是我们必须要教计算机也遵循这些规则。于是出现了“[前缀表示法](http://zh.wikipedia.org/wiki/%E6%B3%A2%E5%85%B0%E8%A1%A8%E7%A4%BA%E6%B3%95)”([prefix notation](http://en.wikipedia.org/wiki/Polish_notation))。用前缀表示法，上面的算式就成了+35。“前缀表示法”是波兰数学家[扬·武卡谢维奇](http://zh.wikipedia.org/wiki/%E6%89%AC%C2%B7%E6%AD%A6%E5%8D%A1%E8%B0%A2%E7%BB%B4%E5%A5%87) ([Jan Lukasiewicz](http://en.wikipedia.org/wiki/Jan_%C5%81ukasiewicz)) 1920年代引入的，用于简化命题逻辑。这种算法避免了由于计算顺序所引起的可能麻烦。“前缀表示法”也称为“波兰表示法”。比如“中缀表示法”所表达的(3+5)*4数就可以用“中缀表示法”写成*+354。注意在这个例子里，“中缀表示法”的括号是必需的，如果将括号去掉，我们就得到一个完全不同的数值：3+5*4。

没有理由规定算子必须放在前面。我们也可以把算子放在后面。这样的表示法就是“[后缀表示法](http://zh.wikipedia.org/wiki/%E9%80%86%E6%B3%A2%E5%85%B0%E8%A1%A8%E7%A4%BA%E6%B3%95)”([postfix notation](http://en.wikipedia.org/wiki/Reverse_Polish_notation))。
因为“后缀表示法”与“前缀表示法”正好顺序相反，所以也叫“逆波兰表示法”（Reverse Polish 
notation，缩写：RPN）。“后缀表示法”由弗里德里希·鲍尔（Friedrich L. 
Bauer）和艾兹格·迪科斯彻在1960年代早期提议用于表达式求值，以利用[堆栈](http://zh.wikipedia.org/wiki/%E5%A0%86%E6%A0%88) ([Stack](http://en.wikipedia.org/wiki/Stack_%28data_structure%29)) 结构和减少计算机内存访问。“后缀表示法”和相应的算法由澳大利亚哲学家、计算机学家查尔斯·汉布林（Charles Hamblin）在1960年代中期扩充用“后缀表示法”，我们可以把“中缀表示法”的3+5写成35+；把“中缀表示法”的(3+5)*4写成435+*。

![](http://image.sciencenet.cn/album/201211/28/120011n7aamaagttastms1.jpg)
惠普的RPN计算器
理论上说,“后缀表示法”和“前缀表示法”是等价的，但是在实际编程中读取数据上更简洁一些，还可以使用堆栈，所以更受商家喜欢。惠普生产的多种计算器都是用的这种算发。有兴趣的读者可以在维基百科上继续了解后缀表示法。很多数据结构的教科书也都有介绍。这里不再赘述。

![](http://image.sciencenet.cn/album/201211/28/124140j466j74ek4kmk7f1.jpg)
Source: [Fast Mathematical Expressions Parser](http://www.codeproject.com/Articles/7773/Fast-Mathematical-.s-Parser)
笔者在最后想介绍一款自动读取数学公式的开源软件：“[muParser](http://en.wikipedia.org/wiki/MuParser)”。这个开源软件是用C++写成的，可以在任何的C++标准编译环境里进行开发。因为开发者提供了源码，使用者可以把它作为[静态连结函式库](http://zh.wikipedia.org/wiki/%E9%9D%9C%E6%85%8B%E9%80%A3%E7%B5%90%E5%87%BD%E5%BC%8F%E5%BA%AB)和[动态链接库](http://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93)嵌入到自己的程序中。据开发者介绍，muParser有以下优点：
- 很容易使用，[只要几行源码](http://www.codeproject.com/Articles/7773/Fast-Mathematical-.s-Parser#idExample)就可以了；
- [比很多类似软件更快](http://www.codeproject.com/Articles/7773/Fast-Mathematical-.s-Parser#idBench)；
- 可以自定义算子；
- 可以自定义多个自变量的函数，可以有一个[字符串](http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E4%B8%B2)变量；
- 可以自定义常数，包扩字符串；
- 可以自定义变量；
- 支持二进制数和十六进制数；
- 包含26个预定义的常用[函数](http://www.codeproject.com/Articles/7773/Fast-Mathematical-.s-Parser#idDef1)和15个常用[算子函数](http://www.codeproject.com/Articles/7773/Fast-Mathematical-.s-Parser#idDef2)。
- 支持数值微分。

muParser的作者是德国的一位软件工程师：[Ingo Berg](http://ingo.berg.myopenid.com/) (iberg)。笔者在网上找不到关于他的任何介绍。但他提供的这个软件包获得了一致好评。推荐与笔者有相同计算需要的读者认真考虑使用muParser。


转载本文请联系原作者获取授权，同时请注明本文来自蒋迅科学网博客。
链接地址：[http://blog.sciencenet.cn/blog-420554-640059.html](http://blog.sciencenet.cn/blog-420554-640059.html)

上一篇：[艺术的地球](blog-420554-639321.html)
下一篇：[这些西瓜够数学的](blog-420554-641395.html)






