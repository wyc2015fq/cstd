# 总线设备驱动框架 - TaigaComplex求职中 - 博客园







# [总线设备驱动框架](https://www.cnblogs.com/TaigaCon/archive/2012/11/15/2770879.html)





总线设备驱动框架是一种类似于输入子系统的框架。

总线设备驱动，顾名思义，共有三个模块，负责硬件资源的设备（device），负责处理硬件事务并且连接其他功能模块的驱动（driver），还有就是连接这两者的总线（bus）。



![](https://pic002.cnblogs.com/images/2012/421096/2012111502555541.jpg)



上图以usb为例子展示了总线设备驱动,其过程分为以下步骤：

1.当加入一个设备时，

　　如果该设备支持中断唤醒线程，那么在中断处理程序内部就获取该设备的资源信息，然后构建device结构体，加入总线的device链表，

　　或者我们可以自己编写模块，在模块中填写该硬件的资源，然后构建device结构体，加入device链表。

2.对于新加入的device，通过比对driver链表的driver结构体的.id_table，寻找合适的驱动

3.当找到合适的driver后，会调用该driver的.probe函数，而device结构体的指针会随着流程传过来给.probe函数，然后我们就能通过传过来的device操作硬件资源了。



对于新加入的driver，需要做的只是把driver结构体进行注册，并且编写其成员.probe函数



可以说，.probe函数是总线设备驱动模式的入口，因为基本上余下的所有操作都从.probe函数开始。

比如说，我们可以在.probe函数内部构建子输入系统的input_dev,然后进行注册；

又或者，可以在.probe函数内部分配并初始化usb控制块,最后submit，使能usb传输；



**总线设备驱动框架主要的目的是分离硬件资源跟操作**，如果硬件资源变动，或者操作需要修改，那就只需要修改一部分。



最后,以后会把usb启动的主要流程记录下来.












