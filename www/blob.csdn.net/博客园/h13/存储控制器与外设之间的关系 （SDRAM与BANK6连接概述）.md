# 存储控制器与外设之间的关系 （SDRAM与BANK6连接概述） - h13 - 博客园
     我们知道，S3C2440对外引出有27根地址线（ADDR0~ADDR26），对应的访问范围为128M，另外，CPU还引出了8根片选信号（nGCS0~nGCS7）——低电平有效，对应8个BANK，这样就达到了1G的地址访问空间。
     理论上我们知道可以使用的地址访问范围为4G（32位的CPU），那么其他的地址空间用来做什么了呢？一部分是用来作为CPU的内部寄存器地址，一部分保留。
     注意：S3C2440的寄存器范围处于：0x48000000~0x5fffffff；存储控制器的地址在：0x48000000~0x48000030（13个）；
     BANK1~BANK5的连接都差不多，所以对应的寄存器设置也一样；参考
    setmem 0x48000008,0x00002e50,32
    setmem 0x4800000c,0x00002e50,32
    setmem 0x48000010,0x00002e50,32
    setmem 0x48000014,0x00002e50,32
    setmem 0x48000018,0x00002e50,32    主要用来设置访问时序
      BANK0稍微有点不同，setmem 0x48000004,0x00000f40,32 （不知道时序方面的设置 是不是和boot rom有关）
      下面重点分析SDRAM的连接与寻址的方式
       几个用于SDRAM的信号：
•       SDRAM的时钟有效信号SCKE；
•       SDRAM的时钟信号SCLK0/SCLK1；
•       数据掩码信号DQM0~DQM3,对应nWBE； 
•       SDRAM的片选信号nSCS0，与nGCS6是同一管脚两个功能；
•       nSRAS 行地址选通脉冲信号；
•       nSCAS 列地址选通脉冲信号；
![](file:///C:/Documents%20and%20Settings/hoy/Application%20Data/Tencent/Users/237283393/QQ/WinTemp/RichOle/H2_]XU5Q%7D23%7D2P8(SM%258_Y8.jpg)
     首先，SDRAM内部是由几个存储阵列组成，每个存储阵列为一个logical BANK
每个logical BANK 即存储阵列 又由行地址和列地址来寻址，就像EXCEL文档表格一样；一般有4个logical BANK。
      对SDRAM的访问分为以下几个步骤;
•使片选信号 nSCS0有效 BANK6 起始地址为0x30000000；
•用两根地址线作为选择信号选择相应的logical BANK （addr25 addr24）；addr26？（思考中）
•对被选芯片进行统一的行列寻址；（行地址数：13  ，列地址数：9）当nSRAS有效时，addr2~addr14上发出的是行地址信号bit[23:11]；当nSCAS有效时，发出的是列地址信号bit[10:2]。
       为什么addr0和addr1没有连接，我们知道BANK6是32位宽的，那么这两根地址线就不用用到了（恒为0）；
       BANK6的起始地址是0x30000000，所以SDRAM的访问地址是0x30000000~0x33ffffff。
• 找到了存储单元，就开始传输数据了，那么怎么组织这32位宽的数据呢？      
内存的这种接法，使它可以以8位访问，也可以16位访问，也可以32位访问 
那4个信号nWBE3~0，正是字节选通控制。 
按8位访问，也就是代码中若有： 
*(unsigned char *) 0x30000000 = 0x78; 
就是一个字节写，这时只有nBWE0信号有效 
如果是0x30000001，则只有nBWE1有效（低），其它无效（高）。 
再举个例，如果是按16位访问呢？ 
如果是16位访问，代码一般就是： 
*(unsigned short *)0x30000000 = 0x1978; 
这是一个16位写。但此时要注意，最低位必须是0，而不能是1，比如地址0x30000001就会使CPU异常，因为必须16位对齐！ 
dat16 = *(unsigned short *)0x30000002; 
这是一个16位读 
在16位访问时，0x30000000地址写操作中，nWBE1, 0 = 低，nWBE3, 2 = 高。当0x30000002时，则是nWBE3,2为低，nWBE1,0为高（无效） 
32位时则是4字节对齐，也就是最低的两个地址位A1，A0必须为0，即对于32位访问，0x30000001, 0x30000002, 0x30000003都会导致异常（出错） 
对于32位访问，0x30000000的下一个地址是0x30000004，因为这个地址是字节地址，但一下子就访问了0x30000000~0x30000003四个字节，也就是nWBE3~0四个信号一起反应！！！ 
不同的CPU访问的机制是不一样的，这要具体看手册了，是分开片选的
本文来自CSDN博客，转载请标明出处：[http://blog.csdn.net/yangyuqi1986/archive/2010/12/02/6051120.aspx](http://blog.csdn.net/yangyuqi1986/archive/2010/12/02/6051120.aspx)
