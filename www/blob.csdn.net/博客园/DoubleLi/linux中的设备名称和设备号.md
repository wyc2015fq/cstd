# linux中的设备名称和设备号 - DoubleLi - 博客园






看赵炯博士的《linux 0.11 源代码注释》已经两三周了，从今天起开始将一些个人总结和感悟分小标题写出来，聊作记忆以供后来查看。
在linux0.11源码的 /linux/boot/bootsect.s中，有一个标号定义ROOT_DEV

! ROOT_DEV: 0x000 - same type of floppy as boot.
! 0x301 - first partition on first drive etc
ROOT_DEV = 0x306

这里，ROOT_DEV是系统指定的根文件系统的设备号。大家都知道linux系统中“一切都是文件”，所以设备也是文件，这里的0x306就是根文件系统所在的设备对应的设备号。
这里要注意：**Linux0.11中使用的设备号命名方式是老式命名规则，和今天的Linux系统设备号命名规则不同。**下面分别进行说明。

## 1、老式Linux设备号命名规则：设备号 = 主设备号 * 256 + 次设备号   （dev_no = (major << 8) + minor）。这里的主设备号是事先定义好的（1-内存，2-磁盘，3-硬盘，4-ttyx，5-tty，6-并行口，7-非命名管道），譬如对于硬盘，主设备号为3，因此3*256+0=0x300即为系统中第一个硬盘的设备号，依次有以下命名：设备号 设备文件对应的设备0x300 /dev/hd0系统中第一个硬盘0x301 /dev/hd1系统中第一个硬盘的第一分区0x302 /dev/hd2系统中第一个硬盘的第二分区0x303 /dev/hd3系统中第一个硬盘的第三分区0x304 /dev/hd4系统中第一个硬盘的第四分区0x305 /dev/hd5系统中第二个硬盘0x306 /dev/hd6系统中第二个硬盘的第一分区······

## 2、现代Linux设备号命名规则：现代Linux要管理的设备种类非常丰富，包括硬盘、U盘、打印机等各种设备。我们仍以硬盘为目标来说明设备命名规则。linux将硬盘分为两类：第一类是传统的IDE硬盘，使用hd标示；第二种是SATA、SCSI、USB硬盘、U盘（严格的说U盘不算硬盘）等，均用sd标示；（hd和sd即这两种硬盘的主设备名）。因此，对于系统中的IDE硬盘，分别用hda，hdb,hdc,hdd来标示1号~4号硬盘（一般主要最多支持4个硬盘。而我们平时使用1块硬盘时，常将其装在主IDE上的主接口上因此单硬盘时硬盘设备名一般是hda）。hda后面的数字用来标示这块硬盘的各个分区，如下：设备文件 对应的设备/dev/hda  主IDE的主接口上的硬盘，即系统第一个硬盘/dev/hda1  第一个硬盘的第一个主分区/dev/hda2  第一个硬盘的第二个主分区/dev/hda3  第一个硬盘的第三个主分区/dev/hda4  第一个硬盘的第四个分区，即扩展分区/dev/hda5  第一个硬盘的第一个逻辑分区/dev/hda6  第一个硬盘的第二个逻辑分区······/dev/hdb  主IDE的从接口上的硬件，即系统第二个硬盘/dev/hdb1  第二个硬盘的第一个主分区······对于SATA，SCSI，USB硬盘，U盘等，只要把hd改成sd就可以了。命名规则是相同的。对比与总结：1、老式命名方法中只有hd，估计是当时只有IDE硬盘的缘故吧。实际上现在IDE硬盘已经很少用了，查了下我的机子就是SATA硬盘的，用sd。2、老式命名中没有考虑逻辑分区，所以每个硬盘需要占用5个数字标示（譬如第一个硬盘末尾从0~4）。而现代命名中硬盘代号改为abcd，后面的分区才用数字标示。并且有一个细节就是分区号是从1开始的，不是0（我猜这样设计是为了和之前老式命名兼容。因为老式命名中数字0代表整个硬盘，分区号也是从1开始的。因此即使现代命名硬盘名直接hda也没有hda0，然后第一个分区还是hda1）。3、每个硬盘只能有四个主分区和扩展分区（三个主分区+一个扩展分区，或者四个主分区），这个是由硬盘本身决定的，跟操作系统没关系。     每个硬盘最多只能有一个扩展分区，这个是由操作系统限制的。我的理解，扩展分区只是标志该分区处被再次分成多个逻辑分区了，因此扩展分区相当于逻辑分区的容器而已，没有必要多个，因此OS限制了扩展分区最多只能有一个。









