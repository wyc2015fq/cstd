# linux下U盘状态检测 - DoubleLi - 博客园






Linux的文件系统是异步的，也就是说写一个文件不是立刻保存到介质（硬盘，U盘等）中，而是存到缓冲区内，等积累到一定程度再一起保存到介质中。如果没有umount就非法拔出U盘，程序是不知道的，fopen，fwrite等函数都依然返回正确，知道操作系统要把写介质的时候，才会提示I/O错误。可是很多数据都会因为这个不及时的错误报告而丢失。
    事实上，USB驱动程序在U盘插入和拔出时，都对系统配置文件做了修改。
    例如U盘驱动程序会在插入或拔出时往 /proc/scsi/usb-storage-0/0 里面记上 Attached：Yes or No
    通过查看这个文件就不难检测U盘是否插入或拔出了。

    注意：U盘是否插入的状态与是否挂载（mount）无关。



当然这也不是唯一的方法检测u盘的状态。根据内核的设置情况，也可能没有/proc/scsi目录，但是/sys目录下面会有usb的目录，插拔u盘，目录会自动创建和消失，如果上面的方法不可行，那么可以通过检测这些目录来判断u盘或者sd卡等存储设备的存在状态，/sys/目录下找到相关的usb或者sd卡的目录，里面有更详细的设备信息，包括设备出厂id，传输速度，容量等。









