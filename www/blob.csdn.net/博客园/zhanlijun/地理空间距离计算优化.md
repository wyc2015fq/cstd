# 地理空间距离计算优化 - zhanlijun - 博客园
# [地理空间距离计算优化](https://www.cnblogs.com/LBSer/p/4020306.html)
[**http://www.cnblogs.com/LBSer/p/4020306.html**](http://www.cnblogs.com/LBSer/p/4020306.html)
**在美团技术博客发表《地理空间距离计算优化》一文，有相似场景的朋友可以参考。**
**[https://tech.meituan.com/2014/09/05/lucene-distance.html](https://tech.meituan.com/2014/09/05/lucene-distance.html)**
打开美团app，不管是筛选团购还是筛选商家，默认的排序项都是“离我最近”或者“智能排序”（如下图所示）。
不管是“离我最近”还是“智能排序”，都涉及到计算用户位置与各个团购单子或者商家的距离（注：在智能排序中距离作为一个重要的参数参与排序打分）。以筛选商家为例，北京地区有5~6w个POI（本文将商家称之为POI），当用户进入商家页，请求北京全城+所有品类+离我最近/智能排序时，我们筛选服务需要计算一遍用户位置与北京全城所有POI的距离。
这种大量计算距离的场景十分消耗资源，从测试来看目前5w个点仅计算一遍距离就需要7ms，而到100w的时候就需要140多ms，随着数据的快速增长，筛选服务的性能将会非常堪忧。
如何优化距离的计算，进而提高计算速度、降低cpu使用率已经迫在眉睫。美团移动后台团购组在此方向上进行了些许探索，下文将分为4部分展开：1）地理空间距离计算原理；2）Lucene使用的距离计算公式；3）优化方案；4）实际应用。
......

