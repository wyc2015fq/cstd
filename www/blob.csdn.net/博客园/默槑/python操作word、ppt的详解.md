# python操作word、ppt的详解 - 默槑 - 博客园







# [python操作word、ppt的详解](https://www.cnblogs.com/modaidai/p/7509512.html)





　　　　　　　　　　　　　　　　　　　　　　　　　　　　python使用win32com的心得



python可以使用一个第三方库叫做win32com达到操作com的目的， 我是安装了ActivePython的第三方库，从官网下载了安装包，该第三方库几乎封装了所有python下面的win32相关的操作，例如win32api,win32gui等等，可以说是比较齐全的了，下载地址可以自行百度获取。 
        主要是有个项目可能要用到ppt转换成视频的功能。 之后在想使用com操作excel还有word，ppt的时候，相信大部分人跟我一样，都是搜索python如何操作ppt，或者win32com操作office之类的搜索语句， 搜索完毕之后，点进去之 后，几乎都直接是代码了，我觉得这样看得我云里雾里的，如果想做些其它操作都做不到，我当时的想法是想知道这些com的操作，究竟在哪里可以查找的到，因 为网上只是有限的几个操作，注入往ppt添加图片，或者doc转成pdf之类的，而实际上的office的com操作时不止这些函数的，那么我们怎么知道 其它的api呢？这样子我们就可以脱离网上的代码，自己编写com代码了。 
         一番查找，谷歌之后，在一个网页上终于找到了答案： 


#### Querying Interfaces

Now, how does one investigate the detail of each object? For example, how does one access the name of a folder? Firstly, it helps to know the interface that the object exposes, and this information can be found in several places:
- The Microsoft API documentation.
- Other useful sources, such as the "Outlook Exchange" documentation.
- The interface file generated by the "COM Makepy utility". To know which file is relevant to the interface in question, either perform a "grep" search for the name of the interface on the win32com/gen_py directory within your Python distribution, or invoke an erroneous method or access a non-existent attribute on an object with that interface in order to see what the name of the interface file is.
- The "OLE/COM Object Viewer" in the "Tools" menu in Microsoft Visual C++ (at least in Visual Studio 6.0).
- Once opened, the "Interfaces" section of the information hierarchy can be explored to reveal some "_Application" entries. For one of these, the information pane will mention "Microsoft Outlook 9.0 Object Library" under "TypeLib", for example.
- Double-clicking on an "_Application" entry will provide an "ITypeInfo Viewer" which contains a "_Methods" section describing the available methods on the application's automation object.
- The "Type Libraries" section of the information hierarchy will list, for example, "Microsoft Outlook 9.0 Object Library", and this can be investigated by double-clicking on that entry.


Hopefully, however, the object that you are accessing is known well enough by PythonWin to permit some kind of attribute or method completion on it. You should only need to resort to the above when more detailed knowledge about a method or attribute is required. You can also try something like this:

dir(object.__class__)

The name of a folder can be accessed as follows:

object.Name # Where object refers to a folder.


        这里的第四个方法就是我找到的确认有效的，其它三个如果有兴趣的可以试试，第四个方法那就是ole/com object viewer工具，百度之下，下载了一个这样的工具，据说安装了vs之后是有的，

不过由于我不知道可执行程序的名字，也无从找起，于是重新下载了一个完整的工具，安装之后

默认安装路径是：C:\Program Files (x86)\Resource Kit



         我就是安装的时候点的太快，结果忘记了路径，重新点击安装，记下了路径。
![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155444_960.png)

         这个工具名字叫做oleview.exe，打开的时候，提示缺少了什么dll，没关系。

      因为我现在知道名字了，然后使用everything搜索了工具，在我的visual studio里面同样找到了该工具，这下子可以完美打开了。


    软件的界面样子大概是： 
![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155444_655.png)
记得要在右侧的
![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155444_888.png)

Type Libraries里面找到相关的library，这里我需要操作的是powerpoint，也就是ppt
![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155444_603.png)

找到之后，双击打开它。
![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155444_2.png)

    在右侧的就是一个列表，左侧的就是对于的内容，刚刚打开的时候，左侧显示的是完整的PowerPoint的api。

    由于这个工具，不能够ctrl+f查找，我们可以ctrl+a，复制左侧的内容到文本中，使用其他诸如sublime文本编辑器执行查找功能。

    下面搜索一下：saveAs（大概就是这个意思，我想找一个api可以另存为ppt为视频的操作）

![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155445_939.png)




    我们找到了这个函数，同时结合网上的例子，我们就知道怎么使用了，传入的第一个参数是FileName，顾名思义就是文件名，第二个是int类型的fileFormat，如果是网上的例子的话，多半只会告诉你一个转换成pdf的代码，但是现在我要的是转成视频。

    我们回到ole viewer，看看有没有fileformat的信息。 果不其然，发现了这样的代码：

![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155445_200.png)


    PpSaveAsFileType

    双击它

![python使用win32com的心得](http://static.open-open.com/lib/uploadImg/20150729/20150729155445_454.png)



    在最后，我找到了ppSaveAsWMV，很好，这样子我们就可以结合网上的例子，修改了。


现在操作ppt的方法我们弄明白了，那么操作word，excel也是一样的道理。 顺便封装了一个comppt.py的操作，由于刚写python，代码不是很溜：
__author__ = 'zxc'
import win32com.client
import time
import os
ppSaveAsWMV = 37
# only for windows platform and with the microsoft office 2010 or above,it needs the library win32com
 
 
def cover_ppt_to_wmv(ppt_src,wmv_target):
    ppt = win32com.client.Dispatch('PowerPoint.Application')
    presentation = ppt.Presentations.Open(ppt_src,WithWindow=False)
    presentation.CreateVideo(wmv_target,-1,4,720,24,60)
    start_time_stamp = time.time()
    while True:
        time.sleep(4)
        try:
            os.rename(wmv_target,wmv_target)
            print 'success'
            break
        except Exception, e:
            pass
    end_time_stamp=time.time()
    print end_time_stamp-start_time_stamp
    ppt.Quit()
    pass
 
if __name__ == '__main__':
    cover_ppt_to_wmv('d:\\python\\demo.ppt','d:\\python\\demo.wmv')















